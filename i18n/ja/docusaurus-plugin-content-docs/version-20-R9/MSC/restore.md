---
id: restore
title: 復元ページ
sidebar_label: 復元ページ
---

**復元**ページから、カレントアプリケーションのアーカイブを手動で復元できます。 このページでは、復元処理を制御するためのオプションをいくつか提供します:

![](../assets/en/MSC/MSC_restore.png)

> 4D の自動復元機能は、アプリケーション復元後に場合に応じてデータログファイルを統合します。

ウィンドウの左側には、アプリケーションの既存のバックアップが表示されます。 **ブラウズ...** ボタンをクリックして、他の場所にあるアーカイブファイルを選択することもできます。 選択したアーカイブはリストに追加されます。

このリストからバックアップファイルを選択すると、ウィンドウの右側にはそのバックアップについての説明が表示されます:

- **パス**: 選択されたバックアップファイルの完全パス名。 <strong x-id="1">表示</strong> ボタンをクリックすると、システムウィンドウでバックアップファイルが表示されます。
- **日付と時刻**: バックアップの日付と時刻
- **内容**: バックアップファイルの内容。 各項目の右側にはチェックボックスがあり、復元をおこなうかどうか、ファイルごとに選択できます。 **すべてを選択する** や **すべての選択をはずす** ボタンを利用して、復元するファイルの設定をおこなうこともできます。
- **復元されたファイルの保存先フォルダー**: 復元されたファイルが配置されるフォルダー。 デフォルトで 4D は Projectフォルダーと同階層にアーカイブ名 (拡張子なし) のフォルダーを作成し、そこにファイルを復元します。 この場所を変更するには **[...]** をクリックして復元ファイルの配置場所を指定します。

**復元** ボタンをクリックすると、選択した項目の復元処理が実行されます。

## 複数のログファイルを連続して統合する

**復元後にひとつ以上のログファイルを統合** オプションを使用して、アプリケーションに複数のログファイルを統合することができます。 たとえば、4つのバックアップに対応する 4つのログファイルアーカイブがある場合、最初のバックアップを復元して、ログアーカイブを一つずつ統合することが可能です。 これにより、たとえば最新のバックアップファイルを失った場合でも、データファイルを復旧することができます。

このオプションが選択されていると、4Dは復元後に標準のファイルを開くダイアログを表示します。ここで統合するログファイルを選択できます。 ファイルを開くダイアログは、キャンセルされるまで統合の都度表示されます。

## 暗号化されたデータベースの復元

カレントアプリケーションと複数のバックアップファイル (.4BK) やログファイル (.4BL) の間で、データ暗号化キー (パスフレーズ) が変更されている可能性があることに注意が必要です。 合致した暗号化キーは常に必要となります。

暗号化されたデータベースのバックアップを復元し、カレントログファイルを統合したい場合、以下の点に注意してください:

- 古いパスフレーズを使用してバックアップを復元した場合、そのパスフレーズは次回のデータベース起動時に必要となります。
- 暗号化のあと、暗号化されたデータファイルを開く際に、バックアップが実行され新しいログファイルが作成されます。 そのため、バックアップファイル (.4BK) を特定のキーで復号化した後、異なるキーで暗号化されたログファイル (.4BL) をそれに統合することはできません。

以下の表は、複数のキーを使用したバックアップ/復元操作における過程の一例をまとめたものです:

| 演算                                    | 生成されるファイル                                                                                | 説明                                                                                                                                                                                                      |
| ------------------------------------- | ---------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 新規データファイル作成                           |                                                                                          |                                                                                                                                                                                                         |
| 新規データ追加 (レコード番号1番) |                                                                                          |                                                                                                                                                                                                         |
| データベースをバックアップ                         | 0000.4BL および 0001.4BK                                    |                                                                                                                                                                                                         |
| データを追加 (レコード番号2番)  |                                                                                          |                                                                                                                                                                                                         |
| データベースをバックアップ                         | 0001.4BL および 0002.4BK                                    |                                                                                                                                                                                                         |
| データを追加 (レコード番号3番)  |                                                                                          |                                                                                                                                                                                                         |
| Key1を使用してデータファイルを暗号化                  | 0003.4BK ファイル (Key1で暗号化)                              | 暗号化をすると (ログファイルも含め) 元のファイルは "Replaced files (Encrypting) YYY-DD-MM HH-MM-SS" というフォルダーに保存されます。 暗号化されたデータファイルを開く際、新しいログファイルが作成され、このログファイルを有効化するためにバックアップ処理がおこなわれます。 |
| データを追加 (レコード番号4番)  |                                                                                          |                                                                                                                                                                                                         |
| データベースをバックアップ                         | 0003.4BL および 0004.4BK ファイル (Key1で暗号化) | 0003.4BK を復元し、0003.4BL を統合することが可能です                                                                                                                                     |
| データを追加 (レコード番号5番)  |                                                                                          |                                                                                                                                                                                                         |
| データベースをバックアップ                         | 0004.4BL および 0005.4BK ファイル (Key1で暗号化) | 0003.4BK を復元し、0003.4BL + 0004.4BL を統合することが可能です。 また、0004.4BK を復元し、0004.4BL を統合することが可能です。                                 |
| データを追加 (レコード番号6番)  |                                                                                          |                                                                                                                                                                                                         |
| Key2を使用してデータファイルを暗号化                  | 0006.4BK ファイル (Key2で暗号化)                              | 暗号化をすると (ログファイルも含め) 元のファイルは "Replaced files (Encrypting) YYY-DD-MM HH-MM-SS" というフォルダーに保存されます。 暗号化されたデータファイルを開く際、新しいログファイルが作成され、このログファイルを有効化するためにバックアップ処理がおこなわれます。 |
| データを追加 (レコード番号7番)  |                                                                                          |                                                                                                                                                                                                         |
| データベースをバックアップ                         | 0006.4BL および 0007.4BK ファイル (Key2で暗号化) | 0006.4BK を復元し、0006.4BL を統合することが可能です                                                                                                                                     |
| データを追加 (レコード番号8番)  |                                                                                          |                                                                                                                                                                                                         |
| データベースをバックアップ                         | 0007.4BL および 0008.4BK ファイル (Key2で暗号化) | 0006.4BK を復元し、0006.4BL + 0007.4BL を統合することが可能です。 また、0007.4BK を復元し、0007.4BL を統合することが可能です。                                 |

> バックアップを復元し、一つ以上の .4BL ファイルを統合する場合、復元された .4BK ファイルおよび .4BL ファイルは同じ暗号化キーを持っていなければなりません。 統合プロセスの間、.4BL ファイルが統合される際に有効な暗号化キーが 4Dキーチェーンに見つからなかった場合、エラーが生成されます。
>
> 連続した複数のデータキーを同じ外部デバイスに保存していた場合、バックアップの復元とログファイルの統合をおこなうと、デバイスが接続されていれば合致するキーの検索が自動的におこなわれます。
