---
id: smtp-new-transporter
title: SMTP New transporter
slug: /commands/smtp-new-transporter
displayed_sidebar: docs
---

<!--REF #_command_.SMTP New transporter.Syntax-->**SMTP New transporter** ( *server* ) -> 戻り値<!-- END REF-->
<!--REF #_command_.SMTP New transporter.Params-->
| 引数 | 型 |  | 説明 |
| --- | --- | --- | --- |
| server | Object | &srarr; | Mail server information |
| 戻り値 | Object | &larr; | SMTP transporter object |

<!-- END REF-->

#### 説明 

<!--REF #_command_.SMTP New transporter.Summary-->**SMTP New transporter** コマンドは、*server* 引数で設定された値を元に新規SMTP 接続を設定し、新しい*transporter* オブジェクトを返します。<!-- END REF-->返された*transporter* オブジェクトは一般的にメールの送信などに使用されます。

*server* 引数には、以下のプロパティを持つオブジェクトを渡します:

| **プロパティ**                | **型** | **詳細**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ------------------------ | ----- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| host                     | テキスト  | SMTP 通信に使用するホストサーバーの名前あるいはIP アドレス。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| port                     | 数値    | (任意) SMTP 通信に使用するポート番号。デフォルト値=587                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| keepAlive                | ブール   | (任意) True であれば、*transporter* オブジェクトが消去されるまで接続をつないだままに保ちます。デフォルト値=True                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| connectionTimeOut        | 数値    | (任意) サーバーとの接続が確立されるまで待つ時間の最大値(秒単位)。デフォルト値=30                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| sendTimeOut              | 数値    | (任意) タイムアウトの前にsendMail の呼び出しを待つ時間の最大値(秒単位)。デフォルト値=100                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| authenticationMode       | テキスト  | SMTP サーバー上でのセッションを開くのに使用する認証モード(\*)。取りうる値: <table> <thead> <tr> <td>定数</td> <td>値</td> <td>コメント</td> </tr> </thead> <tbody> <tr> <td>SMTP authentication CRAM MD5</td> <td>CRAM-MD5</td> <td>CRAM-MD5 プロトコルを使用したSMTP 認証</td> </tr><tr> <td>SMTP authentication login</td> <td>LOGIN</td> <td>LOGIN プロトコルを使用したSMTP 認証</td> </tr><tr> <td>SMTP authentication OAUTH2</td> <td>OAUTH2</td> <td>OAuth 2 プロトコルを使用したSMTP 認証</td> </tr><tr> <td>SMTP authentication plain</td> <td>PLAIN</td> <td>PLAIN プロトコルを使用したSMTP 認証</td> </tr> </tbody> </table>                                                                                                                                                                                                                                                                                                                                                                                                                      |
| accessTokenOAuth2        | テキスト  | OAuth 2 認証資格情報を表すテキスト文字列。*authenticationMode*がOAUTH2 の場合のみ使用されます。*accessTokenOAuth2* が使用されているが*authenticationMode* が省略されていた場合、OAuth2 プロトコルが使用されます(サーバーで許可されていれば)。**注**: アクセストークンには残存時間が決められており、一般的には1時間で失効します。アクセストークンが失効すると、自動再接続は不可能です(例: サーバーから接続解除したなど)。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| user                     | テキスト  | サーバー上で認証をするユーザー名                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| password                 | テキスト  | サーバー上で認証をするユーザーパスワード                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| acceptUnsecureConnection | ブール   | True であれば、暗号化された接続が不可能だった場合に暗号化されてない接続を4D に許可させます(\*\*)。False であれば、暗号化された接続が不可能だった時点でエラーが返されます。デフォルト値=False                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| logFile                  | テキスト  | (任意) 拡張されたログファイル用のファイルパス(\*\*\*)。(カレントのLogs フォルダに対する)相対パス、絶対パスのどちらも指定可能です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| headerCharset            | テキスト  | (任意) eメールに使用される文字セットとエンコーディングです。使用箇所は次の通りです: 主題、添付ファイル名、eメール名属性。取りうる値: <table> <thead> <tr> <td>定数</td> <td>値</td> <td>コメント</td> </tr> </thead> <tbody> <tr> <td>mail mode ISO2022JP</td> <td>US-ASCII\_ISO-2022-JP\_UTF8\_QP</td> <td> *headerCharset*: 可能ならUS-ASCII 、次に可能ならJapanese (ISO-2022-JP) & Quoted-printable 、それも不可なら UTF-8 & Quoted-printable *bodyCharset*: 可能ならUS-ASCII、次に可能ならJapanese (ISO-2022-JP) & 7-bit、それも不可なら UTF-8 & Quoted-printable </td> </tr><tr> <td>mail mode ISO88591</td> <td>ISO-8859-1</td> <td> *headerCharset*: ISO-8859-1 & Quoted-printable *bodyCharset*: ISO-8859-1 & 8-bit </td> </tr><tr> <td>mail mode UTF8</td> <td>US-ASCII\_UTF8\_QP</td> <td>*headerCharset & bodyCharset*: 可能ならUS-ASCII、それが不可ならUTF-8 & Quoted-printable (**デフォルト値**)</td> </tr><tr> <td>mail mode UTF8 in base64</td> <td>US-ASCII\_UTF8\_B64</td> <td>*headerCharset & bodyCharset*: 可能な場合は US-ASCII、それ以外は UTF-8 & base64</td> </tr> </tbody> </table> |
| bodyCharset              | テキスト  | (任意) eメールのhtmlとテキスト本文のコンテンツに使用される文字セットとエンコーディングです。取りうる値: *headerCharset* と同じ(上記参照)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

(\*) もし*authenticationMode* がnull あるいはundefinedだった場合、サーバーによってサポートされる最も安全な認証モードが使用されます。

(\*\*) 利用可能な安全なSMTP ポートは以下の通りです:

* 465: SMTPS
* 587 または 25: サーバーによってサポートされていれば、STARTTLS アップグレードがされたSMTP

(\*\*\*) (コマンドで有効化される)通常のログファイルとは異なり、拡張されたログファイルには送信された全てのメールのMIME コンテンツが保存され、ファイルサイズの上限はありません。詳細な情報については、*4DSMTPLog.txt* の章を参照してください。

**返されたオブジェクト**

返された*transporter* オブジェクトには、以下の**読み込みのみ**のプロパティとメソッドが格納されます:

| **プロパティ**                              | **型** | **詳細**                                                                                                              |
| -------------------------------------- | ----- | ------------------------------------------------------------------------------------------------------------------- |
| *transporter.host*                     | テキスト  | SMTP 通信に使用されているホストサーバーの名前あるいはIP アドレス。                                                                               |
| *transporter.port*                     | 数値    | SMTP 通信に使用されているポート番号。                                                                                               |
| *transporter.keepAlive*                | ブール   | True であれば、*transporter* オブジェクトが消去されるまで接続をつないだままに保ちます。                                                               |
| *transporter.connectionTimeOut*        | 数値    | サーバーとの接続が確立されるまで待つ時間の最大値(秒単位)。                                                                                      |
| *transporter.sendTimeOut*              | 数値    | タイムアウトの前にsendMail の呼び出しを待つ時間の最大値(秒単位)。                                                                              |
| *transporter.acceptUnsecureConnection* | ブール   | 暗号化された接続を確立するのが不可能だった場合に4D に暗号化されてない接続を確立することが許可されていればTrue。許可されていない場合にはFalse となり、その場合、暗号化された接続が不可能だった場合にはエラーが返されます。 |
| *transporter.authenticationMode*       | テキスト  | SMTP サーバー上でセッションを開くために実際に使用されている認証モード。                                                                              |
| *transporter.user*                     | テキスト  | サーバー上で認証をするユーザー名                                                                                                    |
| *transporter.logFile*                  | テキスト  | ログファイル(あれば)のフルパス                                                                                                    |
| *transporter.headerCharset*            | テキスト  | メールのヘッダーと名前部分に使用される文字セットとエンコーディング                                                                                   |
| *transporter.bodyCharset*              | テキスト  | メールの本文に使用される文字セットとエンコーディング                                                                                          |

| **メソッド**                               | **詳細**      |
| -------------------------------------- | ----------- |
| *transporter.send( )*                  | メッセージを送信する。 |
| *SMTP\_transporter.checkConnection( )* | 認証をチェックする。  |

このコマンドは、SMTP サーバーとの接続を**開くわけではない**ことに注意してください。SMTP 接続は、実際には*transporter.send( )* メソッドが実行された時に開かれます。

SMTP 接続は、以下の場合に自動的に閉じられます:

* *keepAlive* プロパティがTrue (デフォルト)の場合には、*transporter* オブジェクトが消去された時。
* *keepAlive* プロパティがFalse の場合には、各*transporter.send( )* メソッドが実行された後。
