---
id: preemptiveWeb
title: プリエンプティブWebプロセスの使用
---

4D Webサーバーを使って、アプリケーションでプリエンプティブWebプロセスを使用することによって、マルチコアコンピューターの利点を最大限引き出すことができます。 4D変換タグや Webデータベースメソッド、ORDA の RESTクラス関数を含めた Web関連コードを、可能な限り多くのコアで同時に実行するよう設定することが可能です。

For in-depth information on preemptive process in 4D, please refer to the _Preemptive 4D processes_ section in the [_4D Language Reference_](https://doc.4d.com).

## Webプロセスにおけるプリエンプティブモードの使用可能状況

実行コンテキストによって、プリエンプティブモードが使用される、または使用可能かを次の表に示します:

| 4D Server   | Interpreted ([debugger attached](../Debugging/debugging-remote.md)) | インタープリター (デバッガー無効) | コンパイル済みコード    |
| ----------- | -------------------------------------------------------------------------------------- | ------------------------------------- | ------------- |
| REST サーバー   | コオペラティブ                                                                                | preemptive                            | preemptive    |
| Web サーバー    | コオペラティブ                                                                                | コオペラティブ                               | _web setting_ |
| Webサービスサーバー | コオペラティブ                                                                                | コオペラティブ                               | _web setting_ |

| 4Dリモート/シングルユーザー | インタープリターコード | コンパイル済みコード    |
| --------------- | ----------- | ------------- |
| REST サーバー       | コオペラティブ     | preemptive    |
| Web サーバー        | コオペラティブ     | _web setting_ |
| Webサービスサーバー     | コオペラティブ     | _web setting_ |

- REST Server: handles [ORDA data model class functions](../REST/ClassFunctions.md)
- Web Server: handles [web templates](templates.md), [4DACTION and database methods](httpRequests.md)
- Web サービスサーバー: SOAPリクエストを処理します
- _**web setting**_ means that the preemptive mode depends on a setting value:
  - when [**Scalable sessions**](sessions.md#enabling-sessions) option is selected, the [preemptive mode is automatically used](sessions.md#preemptive-mode) for web processes.
  - otherwise, the [**Use preemptive processes**](webServerConfig.md#use-preemptive-processes) option is taken into account.
  - Webサービスプロセス (サーバーまたはクライアント) のプリエンプティブモードは、メソッドレベルでサポートされています。 You just have to select "Can be run in preemptive processes" property for published SOAP server methods (see [Publishing a Web Service with 4D](https://doc.4d.com/4Dv19/4D/19/Publishing-a-Web-Service-with-4D.300-5416868.en.html)) or proxy client methods (see [Subscribing to a Web Service in 4D](https://doc.4d.com/4Dv19/4D/19/Subscribing-to-a-Web-Service-in-4D.300-5416870.en.html)) and make sure they are confirmed thread-safe by the compiler.

## スレッドセーフなWebサーバーコードの書き方

Webプロセスをプリエンプティモードで実行するには、Webサーバーで実行されるすべての 4Dコードがスレッドセーフでなければなりません。 When the [preemptive mode is enabled](#availability-of-preemptive-mode-for-web-processes), the following parts of the application will be automatically evaluated by the 4D compiler:

- すべての Web関連データベースメソッド:
  - [`On Web Authentication`](authentication.md#on-web-authentication)
  - [`On Web Connection`](httpRequests.md#on-web-connection)
  - [`On REST Authentication`](REST/configuration.md#using-the-on-rest-authentication-database-method)
  - [`On Mobile App Authentication`](https://developer.4d.com/go-mobile/docs/4d/on-mobile-app-authentication) and [`On Mobile App Action`](https://developer.4d.com/go-mobile/docs/4d/on-mobile-app-action)

- The `compiler_web` project method (regardless of its actual "Execution mode" property);

- Basically any code processed by the [`PROCESS 4D TAGS`](https://doc.4d.com/4dv19R/help/command/en/page816.html) command in the web context, for example through .shtml pages

- Any project method with the "Available through 4D tags and URLS (`4DACTION`, etc.)" attribute

- "RESTリソースとして公開" 属性が有効なテーブルのトリガー

- [ORDA data model class functions](../REST/ClassFunctions.md) called via REST

これらそれぞれのメソッドとコードの部分について、スレッドセーフのルールが遵守されているかをコンパイラーがチェックし、問題があった場合にはエラーを返します。 For more information about thread-safety rules, please refer to the _Writing a thread-safe method_ paragraph in the _Processes_ chapter of the [4D Language Reference](https://doc.4d.com) manual.

## 4D Webコードのスレッドセーフティ

Web関連のほとんどの 4Dコマンドや関数、データベースメソッド、そして URL がスレッドセーフとなり、プリエンプティモードで使用できます。

### 4Dコマンドとデータベースメソッド

All 4D web-related commands are thread-safe, _i.e._:

- all commands from the _Web Server_ theme,
- all commands from the _HTTP Client_ theme.

The web-related database methods are thread-safe and can be used in preemptive mode (see above): `On Web Authentication`, `On Web Connection`, `On REST Authentication`...).

もちろん、これらのメソッドによって実行されるコードもまたスレッドセーフである必要があります。

### WebサーバーURL

以下の 4D WebサーバーURLはスレッドセーフであり、プリエンプティモードで使用可能です:

- _4daction/_ (the called project method must also be thread-safe)
- _4dcgi/_ (the called database methods must also be thread-safe)
- _4dwebtest/_
- _4dblank/_
- _4dstats/_
- _4dhtmlstats/_
- _4dcacheclear/_
- _rest/_
- _4dimgfield/_ (generated by `PROCESS 4D TAGS` for web request on picture fields)
- _4dimg/_ (generated by `PROCESS 4D TAGS` for web request on picture variables)

### プリエンプティブWebプロセスアイコン

ランタイムエクスプローラーと 4D Server管理ウィンドウの両方において、プリエンプティブな Webプロセスに対し専用アイコンが表示されるようになりました:

| プロセスタイプ         | アイコン                                        |
| --------------- | ------------------------------------------- |
| プリエンプティブWebメソッド | ![](../assets/en/WebServer/processIcon.png) |
