<!DOCTYPE html><html lang="ja"><head><meta name="docsearch:version" content="19 R6 BETA"/><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>データ操作 · 4D Documentation</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="ORDA では、[エンティティ](/docs/ja/ORDA/dsmapping.html#entity) および [エンティティセレクション](/docs/ja/ORDA/dsmapping.html#エンティティセレクション) を介してデータにアクセスします。 これらのオブジェクトを使って、データストアのデータを作成・更新・クエリ・ソートすることができます。"/><meta name="docsearch:language" content="ja"/><meta property="og:title" content="データ操作 · 4D Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://4d.github.io/docs/index.html"/><meta property="og:description" content="ORDA では、[エンティティ](/docs/ja/ORDA/dsmapping.html#entity) および [エンティティセレクション](/docs/ja/ORDA/dsmapping.html#エンティティセレクション) を介してデータにアクセスします。 これらのオブジェクトを使って、データストアのデータを作成・更新・クエリ・ソートすることができます。"/><meta property="og:image" content="https://4d.github.io/docs/img/logohome.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://4d.github.io/docs/img/logohome.png"/><link rel="shortcut icon" href="/docs/img/4d.gif"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"/><script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script><script type="text/javascript" src="/docs/alpha/js/comment.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/docs/js/code-blocks-buttons.js"></script><script src="/docs/js/scrollSpy.js"></script><link rel="stylesheet" href="/docs/css/main.css"/><script src="/docs/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/docs/ja"><h2 class="headerTitle">4D Documentation</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a style="font-weight:bold" href="https://developer.4d.com/docs" target="_self">v19 R6 BETA</a></li><li class=""><a href="https://developer.4d.com/docs/Rx" target="_self">v19 R5</a></li><li class=""><a href="https://developer.4d.com/docs/19" target="_self">v19</a></li><li class=""><a href="https://developer.4d.com/docs/18" target="_self">v18</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/docs/img/language.svg" alt="Languages icon"/>日本語</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/ORDA/entities.html">English</a></li><li><a href="/docs/de/ORDA/entities.html">Deutsch</a></li><li><a href="/docs/es/ORDA/entities.html">Español</a></li><li><a href="/docs/fr/ORDA/entities.html">Français</a></li><li><a href="/docs/pt/ORDA/entities.html">Português</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>ORDA</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">プロジェクト管理<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/ja/Project/overview.html">概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Project/architecture.html">プロジェクトのアーキテクチャー</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Project/documentation.html">ドキュメンテーション</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Project/compiler.html">コンパイル</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ランゲージのコンセプト<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/about.html">4D ランゲージについて</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/quick-tour.html">概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/operators.html">演算子</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Data Types</h4><ul><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/data-types.html">データタイプの概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/blob.html">BLOB</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/boolean.html">ブール</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/collection.html">コレクション</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/date.html">日付</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/null-undefined.html">Null と 未定義</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/number.html">数値 (実数、倍長整数、整数)</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/object.html">オブジェクト</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/picture.html">ピクチャー</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/pointer.html">ポインター</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/string.html">文字列</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/time.html">時間</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/variant.html">バリアント</a></li></ul></div><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/variables.html">変数</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/arrays.html">配列</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/methods.html">メソッド</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/parameters.html">引数</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/shared.html">共有オブジェクトと共有コレクション</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/classes.html">クラス</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Control Flow</h4><ul><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/control-flow.html">制御フロー</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/branching.html">分岐構造</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/looping.html">ループ構造</a></li></ul></div><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/error-handling.html">エラー処理</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/interpreted-compiled.html">インタープリターモードとコンパイル済みモード</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/components.html">コンポーネント</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/plug-ins.html">プラグイン</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Concepts/identifiers.html">識別子の命名規則</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">ORDA<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/ja/ORDA/overview.html">ORDAとは何か</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/ORDA/dsmapping.html">データモデルオブジェクト</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/ORDA/ordaClasses.html">データモデルクラス</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/ja/ORDA/entities.html">データ操作</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/ORDA/datastores.html">リモートデータストアの利用</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/ORDA/glossary.html">用語集</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">クラス API リファレンス<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/ja/API/overview.html">クラス API の概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/BlobClass.html">BLOB</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/ClassClass.html">Class</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/CollectionClass.html">Collection</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/CryptoKeyClass.html">CryptoKey</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/DataClassClass.html">DataClass</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/DataClassAttributeClass.html">DataClassAttribute</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/DataStoreClass.html">DataStore</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/EmailObjectClass.html">Email</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/EntityClass.html">Entity</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/EntitySelectionClass.html">EntitySelection</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/FileClass.html">File</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/FolderClass.html">Folder</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/FunctionClass.html">Formula</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/HTTPRequestClass.html">HTTPRequest</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/IMAPTransporterClass.html">IMAPTransporter</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/MailAttachmentClass.html">MailAttachment</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/POP3TransporterClass.html">POP3Transporter</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/SessionClass.html">Session</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/SignalClass.html">Signal</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/SMTPTransporterClass.html">SMTPTransporter</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/SystemWorkerClass.html">SystemWorker</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/WebServerClass.html">WebServer</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/ZipArchiveClass.html">ZIPArchive</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/ZipFileClass.html">ZIPFile</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/API/ZipFolderClass.html">ZIPFolder</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">コードの扱い方<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/ja/code-editor/overview.html">4D コードについて</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/code-editor/write-class-method.html">コードエディター</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/code-editor/find-replace.html">検索と置換</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/code-editor/creating-using-macros.html">マクロの作成と利用</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Tags/tags.html">変換タグ</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">デバッガー<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/ja/Debugging/basics.html">画面の説明</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Debugging/debugger.html">デバッガー</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Debugging/breakpoints.html">ブレークポイントとキャッチコマンド</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Debugging/debugging-remote.html">リモートマシンからのデバッグ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Debugging/debugLogFiles.html">ログファイルの詳細</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">設定<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/ja/settings/overview.html">概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/settings/general.html">一般ページ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/settings/interface.html">インターフェースページ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/settings/compiler.html">コンパイラーページ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/settings/database.html">データベースページ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/settings/backup.html">バックアップページ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/settings/client-server.html">クライアント-サーバーページ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/settings/web.html">Web ページ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/settings/sql.html">SQL ページ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/settings/php.html">PHP ページ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/settings/security.html">セキュリティページ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/settings/compatibility.html">互換性ページ</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">環境設定<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/ja/Preferences/overview.html">概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Preferences/general.html">一般ページ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Preferences/structure.html">ストラクチャーページ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Preferences/forms.html">フォームページ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Preferences/methods.html">メソッドページ</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/Preferences/shortcuts.html">ショートカットページ</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/4D/docs/edit/master/docs/ORDA/entities.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">データ操作</h1></header><article><div><span><p>ORDA では、<a href="/docs/ja/ORDA/dsmapping.html#entity">エンティティ</a> および <a href="/docs/ja/ORDA/dsmapping.html#エンティティセレクション">エンティティセレクション</a> を介してデータにアクセスします。 これらのオブジェクトを使って、データストアのデータを作成・更新・クエリ・ソートすることができます。</p>
<h2><a class="anchor" aria-hidden="true" id="エンティティの作成"></a><a href="#エンティティの作成" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>エンティティの作成</h2>
<p>データクラス内に新しいエンティティを作成する方法は二つあります:</p>
<ul>
<li>エンティティはデータベースレコードへの参照であるため、&quot;クラシックな&quot; 4Dランゲージを使用してレコードを作成し、それを<code>entity.next( )</code> や <code>entitySelection.first( )</code> といった ORDAメソッドで参照することでエンティティを作成できます。</li>
<li>また、<code>dataClass.new( )</code> メソッドを使用することでもエンティティも作成することができます。</li>
</ul>
<p>エンティティはメモリ内にしか作成されないという点に注意してください。 データストアに追加したい場合、<code>entity.save( )</code> メソッドを呼ぶ必要があります。</p>
<p>エンティティ属性は、エンティティオブジェクトのプロパティとして直接利用可能です。 詳細な情報については、<a href="#エンティティ属性の使用">エンティティ属性の使用</a> を参照してください。</p>
<p>たとえば、カレントデータストア内の &quot;Employee&quot; データクラスに新しいエンティティを作成し、firstname と name 属性に &quot;John&quot; と &quot;Dupont&quot; を割り当てたい場合を考えます:</p>
<pre><code class="hljs css language-4d"><span class="hljs-keyword">var</span> <span class="hljs-variable">$myEntity </span>: cs.EmployeeEntity
<span class="hljs-variable">$myEntity</span>:=ds.Employee.<span class="hljs-function">new</span>() <span class="hljs-comment">// エンティティ型の新規オブジェクトを作成します</span>
<span class="hljs-variable">$myEntity</span>.name:=<span class="hljs-string">"Dupont"</span> <span class="hljs-comment">// 'Dupont' を 'name' 属性に代入します</span>
<span class="hljs-variable">$myEntity</span>.firstname:=<span class="hljs-string">"John"</span> <span class="hljs-comment">// 'John' を 'firstname' 属性に代入します</span>
<span class="hljs-variable">$myEntity</span>.<span class="hljs-function">save</span>() <span class="hljs-comment">// エンティティを保存します</span>
</code></pre>
<blockquote>
<p>エンティティは、それが作成されたプロセス内でのみ定義されます。 そのため、たとえばエンティティへの参照を、インタープロセス変数内に保存して他のプロセスで使用する、といったことはできません。</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="エンティティと参照"></a><a href="#エンティティと参照" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>エンティティと参照</h2>
<p>エンティティには、4Dレコードへの参照が格納されています。 異なるエンティティが同じ 4Dレコードを参照することもあり得ます。 また、エンティティは 4Dオブジェクト変数に保存可能であることから、異なる変数が同じエンティティへの参照を格納していることもあり得ます。</p>
<p>以下のコードを実行した場合:</p>
<pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$e1</span>; <span class="hljs-variable">$e2 </span>: cs.EmployeeEntity
 <span class="hljs-variable">$e1</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">// ID 1をもつ社員にアクセスします</span>
 <span class="hljs-variable">$e2</span>:=<span class="hljs-variable">$e1</span>
 <span class="hljs-variable">$e1</span>.name:=<span class="hljs-string">"Hammer"</span>
  <span class="hljs-comment">//$e1 も $e2 も、どちらも同じエンティティへの参照を共有します</span>
  <span class="hljs-comment">//$e2.name の中身も "Hammer" です</span>
</code></pre>
<p>これは以下のように図解することができます:</p>
<p><img src="/docs/assets/en/ORDA/entityRef1.png" alt=""></p>
<p>次に、以下のコードを実行した場合:</p>
<pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$e1</span>; <span class="hljs-variable">$e2 </span>: cs.EmployeeEntity
 <span class="hljs-variable">$e1</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>)
 <span class="hljs-variable">$e2</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>)
 <span class="hljs-variable">$e1</span>.name:=<span class="hljs-string">"Hammer"</span>
  <span class="hljs-comment">//変数 $e1 はエンティティへの参照を格納しています</span>
  <span class="hljs-comment">//変数 $e2 は別のエンティティへの参照を格納しています</span>
  <span class="hljs-comment">//$e2.name の中身は "smith" です</span>
</code></pre>
<p>これは以下のように図解することができます:</p>
<p><img src="/docs/assets/en/ORDA/entityRef2.png" alt=""></p>
<p>しかし、両方のエンティティが同じレコードを参照していることに注意してください。 どちらの場合でも、<code>entity.save( )</code> メソッドを呼び出した場合、レコードは更新されます (衝突が発生した場合を除きます。<a href="#エンティティロッキング">エンティティロッキング</a> 参照)。</p>
<p>実際には、<code>$e1</code> も <code>$e2</code> もエンティティそのものではなく、エンティティへの参照です。 これはつまり、どのような関数やメソッドにも直接受け渡すことができ、ポインターのように振る舞うということです。そしてこれは 4Dポインターよりもずっと高速です。 たとえば:</p>
<pre><code class="hljs css language-4d"><span class="hljs-keyword"> For each</span>(<span class="hljs-variable">$entity</span>;<span class="hljs-variable">$selection</span>)
<span class="hljs-function">    do_Capitalize</span>(<span class="hljs-variable">$entity</span>)<span class="hljs-keyword">
 End for each</span>
</code></pre>
<p>そして do_Capitalize メソッドが以下のような形であった場合:</p>
<pre><code class="hljs css language-4d"> <span class="hljs-variable">$entity</span>:=<span class="hljs-variable">$1</span>
 <span class="hljs-variable">$name</span>:=<span class="hljs-variable">$entity</span>.lastname<span class="hljs-keyword">
 If</span>(<span class="hljs-function">Not</span>(<span class="hljs-variable">$name</span>=<span class="hljs-literal">Null</span>))
    <span class="hljs-variable">$name</span>:=<span class="hljs-function">Uppercase</span>(<span class="hljs-function">Substring</span>(<span class="hljs-variable">$name</span>;<span class="hljs-number">1</span>;<span class="hljs-number">1</span>))+<span class="hljs-function">Lowercase</span>(<span class="hljs-function">Substring</span>(<span class="hljs-variable">$name</span>;<span class="hljs-number">2</span>))<span class="hljs-keyword">
 End if</span>
 <span class="hljs-variable">$entity</span>.lastname:=<span class="hljs-variable">$name</span>
</code></pre>
<p>他の 4D のオブジェクトと同様にエンティティを扱うことができ、<a href="/docs/ja/Concepts/parameters.html">引数</a> としてその参照を渡すことができます。</p>
<blockquote>
<p>エンティティでは、クラシックな 4D言語のような &quot;カレントレコード&quot; という概念はありません。 エンティティは、いくつでも必要な数を同時に使用することができます。 また、エンティティには自動ロックの機構が備わっています (<a href="#エンティティロッキング">エンティティロッキング</a> 参照)。 エンティティの読み込みには、<a href="/docs/ja/ORDA/glossary.html#レイジーローディング">レイジーローディング</a> 機構が使用されます。これはつまり必要な分の情報だけが読み込まれるということです。 いずれにせよ、クライアント/サーバーでは必要であればエンティティを直接自動的に読み込むことも可能です。</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="エンティティ属性の使用"></a><a href="#エンティティ属性の使用" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>エンティティ属性の使用</h2>
<p>エンティティ属性はデータを保存し、対応するテーブルの対応するフィールドをマップします。 ストレージ型のエンティティ属性はエンティティオブジェクトの単純なプロパティとして設定や取得ができますが、<strong>リレートエンティティ (relatedEntity)</strong> 型と <strong>リレートエンティティズ (relatedEntities)</strong> 型のエンティティ属性はエンティティあるいはエンティティセレクションを返します。</p>
<blockquote>
<p>属性の型についての詳細な情報については、<a href="/docs/ja/ORDA/dsmapping.html#ストレージ属性とリレーション属性">ストレージ属性とリレーション属性</a> の段落を参照してください。</p>
</blockquote>
<p>たとえば、ストレージ属性を設定するためには:</p>
<pre><code class="hljs css language-4d"> <span class="hljs-variable">$entity</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">// ID1 の社員エンティティを取得します</span>
 <span class="hljs-variable">$name</span>:=<span class="hljs-variable">$entity</span>.lastname <span class="hljs-comment">// 社員のラストネームを取得します。 例: "Smith"</span>
 <span class="hljs-variable">$entity</span>.lastname:=<span class="hljs-string">"Jones"</span> <span class="hljs-comment">// 社員のラストネームを変更します</span>
 <span class="hljs-variable">$entity</span>.<span class="hljs-function">save</span>() <span class="hljs-comment">// 変更を保存します</span>
</code></pre>
<blockquote>
<p>データベースの BLOBフィールド (<a href="/docs/ja/Concepts/blob.html">スカラーBLOB</a>) は、ORDAで扱われるにあたって、BLOBオブジェクト属性 (<a href="/docs/ja/Concepts/blob.html"><code>4D.Blob</code></a>) に自動変換されます。 BLOBオブジェクト属性を保存する際には、(利用可能なメモリによってのみサイズ制限される BLOBオブジェクトとは異なり) BLOBフィールドのサイズが 2GB に制限されることに注意してください。</p>
</blockquote>
<p>リレート属性にアクセスできるかどうかは、属性の型によります。 たとえば、以下のようなストラクチャーがあるとき:</p>
<p><img src="/docs/assets/en/ORDA/entityAttributes.png" alt=""></p>
<p>リレートされたオブジェクトを通してデータにアクセスすることができます:</p>
<pre><code class="hljs css language-4d"> <span class="hljs-variable">$entity</span>:=ds.Project.<span class="hljs-function">all</span>().<span class="hljs-function">first</span>().theClient <span class="hljs-comment">// 先頭プロジェクトに関連する Company エンティティを取得します</span>
 <span class="hljs-variable">$EntitySel</span>:=ds.Company.<span class="hljs-function">all</span>().<span class="hljs-function">first</span>().companyProjects <span class="hljs-comment">// 先頭の会社に関連する Project エンティティセレクションを取得します</span>
</code></pre>
<p>上記の例において、<em>theClient</em> と <em>companyProjects</em> はどちらもプライマリーリレーション属性であり、二つのデータクラス間の直接的なリレーションを表すことに注意してください。 しかしながら、複数のレベルのリレーションを通したパスに基づいてリレーション属性をビルドすることも可能です(循環参照含む)。 たとえば、以下のようなストラクチャーの場合を考えます:</p>
<p><img src="/docs/assets/en/ORDA/entityAttributes2.png" alt=""></p>
<p>社員はそれぞれマネージャーにもなりえますし、マネージャーを持つこともできます。 ある社員のマネージャーのマネージャーを取得したい場合、以下のように書くことができます:</p>
<pre><code class="hljs css language-4d"> <span class="hljs-variable">$myEmp</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">50</span>)
 <span class="hljs-variable">$manLev2</span>:=<span class="hljs-variable">$myEmp</span>.manager.manager.lastname
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="リレーション属性への値の代入"></a><a href="#リレーション属性への値の代入" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>リレーション属性への値の代入</h2>
<p>ORDAアーキテクチャーでは、リレーション属性はエンティティにリレートされたデータを直接格納します:</p>
<ul>
<li>N対1型リレーション属性 (<strong>リレートエンティティ (relatedEntity)</strong> 型) は一つのエンティティを格納します。</li>
<li>1対N型リレーション属性 (<strong>リレートエンティティズ (relatedEntities)</strong> 型) はエンティティセレクションを格納します。</li>
</ul>
<p>以下の (単純化された) ストラクチャーを見てみましょう:</p>
<p><img src="/docs/assets/en/ORDA/entityAttributes3.png" alt=""></p>
<p>この例では、&quot;Employee&quot; データクラスに属するエンティティの &quot;employer&quot; 属性には、エンティティ型のオブジェクト (あるいは null値) が格納されます。 &quot;Company&quot; データクラスに属するエンティティの &quot;staff&quot; 属性には、エンティティセレクション型のオブジェクト (あるいは null値) が格納されます。</p>
<blockquote>
<p>ORDAでは、リレーションの自動あるいは手動プロパティは何の効力も持ちません。</p>
</blockquote>
<p>&quot;employer&quot; 属性に直接値を代入したい場合には、&quot;Company&quot; データクラスの既存エンティティを渡す必要があります。 たとえば:</p>
<pre><code class="hljs css language-4d"> <span class="hljs-variable">$emp</span>:=ds.Employee.<span class="hljs-function">new</span>() <span class="hljs-comment">// 新規の社員エンティティを作成します</span>
 <span class="hljs-variable">$emp</span>.lastname:=<span class="hljs-string">"Smith"</span> <span class="hljs-comment">// 属性に値を代入します</span>
 <span class="hljs-variable">$emp</span>.employer:=ds.Company.<span class="hljs-function">query</span>(<span class="hljs-string">"name =:1"</span>;<span class="hljs-string">"4D"</span>)[<span class="hljs-number">0</span>]  <span class="hljs-comment">// リレーション属性に会社エンティティを代入します</span>
 <span class="hljs-variable">$emp</span>.<span class="hljs-function">save</span>()
</code></pre>
<p>4D では、&quot;1&quot; エンティティにリレートされている N エンティティ側のリレーション属性への入力を容易にするための追加の手段が提供されています: リレーション属性に代入する際に、&quot;1&quot; エンティティのプライマリーキーを直接渡す方法です。 これが動作するためには、数値あるいはテキスト型のデータ (プライマリーキー値) をリレーション属性に渡します。 すると 4D はデータクラス内の該当するエンティティを自動的に検索してくれます。 たとえば:</p>
<pre><code class="hljs css language-4d"> <span class="hljs-variable">$emp</span>:=ds.Employee.<span class="hljs-function">new</span>()
 <span class="hljs-variable">$emp</span>.lastname:=<span class="hljs-string">"Wesson"</span>
 <span class="hljs-variable">$emp</span>.employer:=<span class="hljs-number">2</span> <span class="hljs-comment">// リレーション属性にプライマリーキーを代入します</span>
  <span class="hljs-comment">// 4D はプライマリーキー (この場合、ID) の値が 2 である会社を検索し、</span>
  <span class="hljs-comment">// それを社員に代入します</span>
 <span class="hljs-variable">$emp</span>.<span class="hljs-function">save</span>()
</code></pre>
<p>これはとくに、リレーショナルデータベースから大量のデータを読み込むときに有用です。 このような読み込みでは通常 &quot;ID&quot; カラムが含まれており、これはリレーション属性に直接割り当て可能なプライマリーキーを参照しています。</p>
<p>これはまた、1 データクラス側で対応するエンティティを事前に作成することなく N エンティティ側のプライマリーキーを割り当てることができるということです。 リレートされているデータクラスに存在しないプライマリーキーを割り当てた場合、それは保管され、&quot;1&quot; データクラス側でエンティティが作成されたときに 4D によって割り当てられます。</p>
<p>&quot;N&quot; データクラス側のリレーション属性を通して、&quot;1&quot; リレートエンティティの属性値を、直接代入・変更することができます。 たとえば、Employee エンティティにリレートされている Company エンティティの name 属性を変更したい場合、以下のように書くことができます:</p>
<pre><code class="hljs css language-code4d"> <span class="hljs-variable">$emp</span>:=ds<span class="hljs-selector-class">.Employee</span>.get(<span class="hljs-number">2</span>) <span class="hljs-comment">// プライマリーキーが 2 の Employee エンティティを読み込みます</span>
 <span class="hljs-variable">$emp</span><span class="hljs-selector-class">.employer</span><span class="hljs-selector-class">.name</span>:=<span class="hljs-string">"4D, Inc."</span> <span class="hljs-comment">// リレートされている Company の name 属性を変更します</span>
 <span class="hljs-variable">$emp</span><span class="hljs-selector-class">.employer</span>.save() <span class="hljs-comment">// リレーション属性の変更を保存します</span>
  <span class="hljs-comment">// リレートされているエンティティも更新されます</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="エンティティセレクションの作成"></a><a href="#エンティティセレクションの作成" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>エンティティセレクションの作成</h2>
<p>以下の方法で、<a href="/docs/ja/ORDA/dsmapping.html#エンティティセレクション">エンティティセレクション</a> 型のオブジェクトを作成することができます:</p>
<ul>
<li><a href="/docs/ja/API/DataClassClass.html#query">データクラス</a> または <a href="/docs/ja/API/EntitySelectionClass.html#query">既存のエンティティセレクション</a> のエンティティに対してクエリを実行する;</li>
<li><a href="/docs/ja/API/DataClassClass.html#all"><code>.all( )</code></a> DataClassクラス関数を使用して、データクラス内の全エンティティを選択する;</li>
<li><code>Create entity selection</code> コマンドあるいは <a href="/docs/ja/API/DataClassClass.html#newselection"><code>.newSelection( )</code></a> DataClassクラス関数を使用して空のエンティティコレクションオブジェクトを作成する;</li>
<li><a href="/docs/ja/API/EntitySelectionClass.html#copy"><code>.copy( )</code></a> EntitySelectionクラス関数を使用して、既存のエンティティセレクションを複製する;</li>
<li><a href="/docs/ja/API/EntitySelectionClass.html">EntitySelectionクラス</a> の様々な関数の中から、<a href="/docs/ja/API/EntitySelectionClass.html#or"><code>.or( )</code></a> のように新しいエンティティセレクションを返すものを使用する;</li>
<li>&quot;リレートエンティティズ&quot; 型のリレーション属性を使用する (以下参照)</li>
</ul>
<p>データクラスに対して、異なるエンティティセレクションを好きなだけ同時に作成し、使用することができます。 エンティティセレクションは、エンティティへの参照を格納しているに過ぎないという点に注意してください。 異なるエンティティセレクションが同じエンティティへの参照を格納することも可能です。</p>
<h3><a class="anchor" aria-hidden="true" id="共有可能追加可能なエンティティセレクション"></a><a href="#共有可能追加可能なエンティティセレクション" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>共有可能/追加可能なエンティティセレクション</h3>
<p>エンティティセレクションには 2種類あります: <strong>共有可能 (shareable)</strong> (複数のプロセスで読み込み可能、ただし追加不可) のものと、<strong>追加可能 (alterable)</strong> (<a href="/docs/ja/API/EntitySelectionClass.html#add"><code>add()</code></a> 関数が使用可能、ただしカレントプロセスでのみ利用可) のものです:</p>
<h4><a class="anchor" aria-hidden="true" id="プロパティ"></a><a href="#プロパティ" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>プロパティ</h4>
<p><strong>共有可能</strong> なエンティティセレクションは以下のような特徴を持ちます:</p>
<ul>
<li>共有オブジェクトまたは共有コレクションに保存することが可能で、複数のプロセス間あるいはワーカー間で引数として受け渡しすることができます。</li>
<li>複数の共有オブジェクトまたは共有コレクションに保存することが可能です。また、グループに属している共有オブジェクトまたは共有コレクションに保存することも可能です (つまり、<em>ロック識別子</em> を持っていないということです)。</li>
<li>新たにエンティティを追加することはできません。 共有可能なエンティティセレクションに対してエンティティを追加しようとした場合、エラーがトリガーされます (エラー1637 - このエンティティセレクションは編集不可です)。 共有可能なエンティティセレクションに対してエンティティを追加したい場合、<a href="/docs/ja/API/EntitySelectionClass.html#add"><code>.add( )</code></a> 関数を呼び出す前に、<a href="/docs/ja/API/EntitySelectionClass.html#copy"><code>.copy( )</code></a> 関数を使用して共有不可のエンティティセレクションへと変換する必要があります。</li>
</ul>
<blockquote>
<p>大多数のエンティティセレクション関数 (<a href="/docs/ja/API/EntitySelectionClass.html#slice"><code>.slice()</code></a>, <a href="/docs/ja/API/EntitySelectionClass.html#and"><code>.and()</code></a> 等) は、呼び出し対象のエンティティセレクションを変更せずに新規のエンティティセレクションを返すため、共有可能なエンティティセレクションに対して使用できます。</p>
</blockquote>
<p><strong>追加可能</strong> なエンティティセレクションは以下のような特徴を持ちます:</p>
<ul>
<li>プロセス間での共有はできません。また共有オブジェクト/コレクションへの保存もできません。 共有不可のエンティティセレクションを共有オブジェクト/コレクションに保存しようとした場合、エラーがトリガーされます (エラー -10721 - 共有オブジェクトまたはコレクションにおいてサポートされる値の型ではありません)。</li>
<li>新規エンティティを受け取ることができます (つまり、<a href="/docs/ja/API/EntitySelectionClass.html#add"><code>.add()</code></a> 関数を使用できます)。</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="共有可能追加可能エンティティセレクションの定義"></a><a href="#共有可能追加可能エンティティセレクションの定義" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>共有可能/追加可能エンティティセレクションの定義</h4>
<p>エンティティセレクションが <strong>共有可能</strong> または <strong>追加可能</strong> のいずれの特性を持つかは、そのエンティティセレクションの作成時に定義され、あとから変更することはできません。 エンティティセレクションの特性は、<a href="/docs/ja/API/EntitySelectionClass.html#isalterable">.isAlterable()</a> 関数または <code>OB Is shared</code> コマンドを使って確認することができます。</p>
<p>新規のエンティティセレクションは次の場合に <strong>共有可能</strong> です:</p>
<ul>
<li>データクラスに対して呼び出された ORDAクラス関数によって生成された場合: <a href="/docs/ja/API/DataClassClass.html#all">dataClass.all()</a>, <a href="/docs/ja/API/DataClassClass.html#fromcollection">dataClass.fromCollection()</a>, <a href="/docs/ja/API/DataClassClass.html#query">dataClass.query()</a> 等。</li>
<li>リレーション属性をもとに生成され、<a href="/docs/ja/API/EntityClass.html#attributename">entity.<em>attributeName</em></a> (例: &quot;company.employees&quot;) の <em>attributeName</em> が 1対Nリレーション属性で、かつ entity 自身がエンティティセレクションに属していない場合。</li>
<li><code>ck shared</code> オプションを指定したうえで、<a href="/docs/ja/API/EntitySelectionClass.html#copy"><code>entitySelection.copy()</code></a> または <code>OB Copy</code> を使用し、明示的に共有可能としてコピーされた場合。</li>
</ul>
<p>例:</p>
<pre><code class="hljs css language-4d"><span class="hljs-variable">$myComp</span>:=ds.Company.<span class="hljs-function">get</span>(<span class="hljs-number">2</span>) <span class="hljs-comment">// $myComp はエンティティセレクションに属していません</span>
<span class="hljs-variable">$employees</span>:=<span class="hljs-variable">$myComp</span>.employees <span class="hljs-comment">// $employees は共有可能です</span>
</code></pre>
<p>新規のエンティティセレクションは次の場合に <strong>追加可能</strong> です:</p>
<ul>
<li><a href="/docs/ja/API/DataClassClass.html#newselection"><code>dataClass.newSelection()</code></a> 関数または <code>Create entity selection</code> コマンドを使用して新規作成された空のエンティティセレクションの場合。</li>
<li><code>ck shared</code> オプションを指定せずに、<a href="/docs/ja/API/EntitySelectionClass.html#copy"><code>entitySelection.copy()</code></a> または <code>OB Copy</code> を使用し、明示的に追加可能としてコピーされた場合。</li>
</ul>
<p>例:</p>
<pre><code class="hljs css language-4d"><span class="hljs-variable">$toModify</span>:=ds.Company.<span class="hljs-function">all</span>().<span class="hljs-function">copy</span>() <span class="hljs-comment">// $toModify は追加可能です</span>
</code></pre>
<p>新規のエンティティセレクションは次の場合に、元となるエンティティセレクションの特性を <strong>継承</strong> します:</p>
<ul>
<li>既存のエンティティセレクションに対して呼び出された ORDAクラス関数 (<a href="/docs/ja/API/EntitySelectionClass.html#query">.query()</a>, <a href="/docs/ja/API/EntitySelectionClass.html#slice">.slice()</a>, 等) によって生成された場合 .</li>
<li>リレーションに基づいて生成された場合:
<ul>
<li><a href="/docs/ja/API/EntityClass.html#attributename">entity.<em>attributeName</em></a> (例: &quot;company.employees&quot;) の <em>attributeName</em> が 1対Nリレーション属性で、かつ entity 自身がエンティティセレクションに属している場合 (<a href="/docs/ja/API/EntityClass.html#getselection">entity.getSelection()</a> エンティティセレクションと同じ特性になります)。</li>
<li><a href="/docs/ja/API/EntitySelectionClass.html#attributename">entitySelection.<em>attributeName</em></a> (例: &quot;employees.employer&quot;) の <em>attributeName</em> がリレーション属性の場合 (エンティティセレクションと同じ特性になります)。</li>
<li><a href="/docs/ja/API/EntitySelectionClass.html#extract">entitySelection.extract()</a> から返されるコレクションがエンティティセレクションを含む場合 (エンティティセレクションと同じ特性になります)。</li>
</ul></li>
</ul>
<p>例:</p>
<pre><code class="hljs css language-4d"><span class="hljs-variable">$highSal</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"salary &gt;= :1"</span>; <span class="hljs-number">1000000</span>)   
    <span class="hljs-comment">// データクラスに対するクエリによって生成されたため $highSal は共有可能です</span>
<span class="hljs-variable">$comp</span>:=<span class="hljs-variable">$highSal</span>.employer <span class="hljs-comment">// $highSal が共有可能なため $comp も共有可能です</span>

<span class="hljs-variable">$lowSal</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"salary &lt;= :1"</span>; <span class="hljs-number">10000</span>).<span class="hljs-function">copy</span>() 
    <span class="hljs-comment">// オプション無しの copy( ) によって生成されたため $lowSal は追加可能です</span>
<span class="hljs-variable">$comp2</span>:=<span class="hljs-variable">$lowSal</span>.employer <span class="hljs-comment">// $lowSal が追加可能なため $comp2 も追加可能です</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="プロセス間のエンティティセレクションの共有-例題"></a><a href="#プロセス間のエンティティセレクションの共有-例題" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>プロセス間のエンティティセレクションの共有 (例題)</h4>
<p>二つのエンティティセレクションを使用し、それらをワーカープロセスに渡して適切な相手にメールを送信したい場合を考えます:</p>
<pre><code class="hljs css language-4d"><span class="hljs-keyword">
var</span> <span class="hljs-variable">$paid</span>; <span class="hljs-variable">$unpaid </span>: cs.InvoicesSelection
<span class="hljs-comment">// 支払済および未払いの請求書のエンティティセレクションをそれぞれ取得します</span>
<span class="hljs-variable">$paid</span>:=ds.Invoices.<span class="hljs-function">query</span>(<span class="hljs-string">"status=:1"</span>; <span class="hljs-string">"支払済"</span>)
<span class="hljs-variable">$unpaid</span>:=ds.Invoices.<span class="hljs-function">query</span>(<span class="hljs-string">"status=:1"</span>; <span class="hljs-string">"未払い"</span>)

<span class="hljs-comment">// これらのエンティティセレクションの参照をワーカーに引数として渡します</span>
<span class="hljs-function">CALL WORKER</span>(<span class="hljs-string">"mailing"</span>; <span class="hljs-string">"sendMails"</span>; <span class="hljs-variable">$paid</span>; <span class="hljs-variable">$unpaid</span>)

</code></pre>
<p><code>sendMails</code> メソッドのコードです:</p>
<pre><code class="hljs css language-4d">
 #<span class="hljs-function">DECLARE </span>(<span class="hljs-variable">$paid </span>: cs.InvoicesSelection; <span class="hljs-variable">$unpaid </span>: cs.InvoicesSelection)<span class="hljs-keyword">
 var</span> <span class="hljs-variable">$invoice </span>: cs.InvoicesEntity<span class="hljs-keyword">

 var</span> <span class="hljs-variable">$server</span>; <span class="hljs-variable">$transporter</span>; <span class="hljs-variable">$email</span>; <span class="hljs-variable">$status </span>: Object

  <span class="hljs-comment">// メールの準備</span>
 <span class="hljs-variable">$server</span>:=<span class="hljs-function">New object</span>()
 <span class="hljs-variable">$server</span>.host:=<span class="hljs-string">"exchange.company.com"</span>
 <span class="hljs-variable">$server</span>.user:=<span class="hljs-string">"myName@company.com"</span>
 <span class="hljs-variable">$server</span>.password:=<span class="hljs-string">"my!!password"</span>
 <span class="hljs-variable">$transporter</span>:=<span class="hljs-function">SMTP New transporter</span>(<span class="hljs-variable">$server</span>)
 <span class="hljs-variable">$email</span>:=<span class="hljs-function">New object</span>()
 <span class="hljs-variable">$email</span>.from:=<span class="hljs-string">"myName@company.com"</span>

  <span class="hljs-comment">// エンティティセレクションをループします</span><span class="hljs-keyword">
 For each</span>(<span class="hljs-variable">$invoice</span>;<span class="hljs-variable">$paid</span>)
    <span class="hljs-variable">$email</span>.to:=<span class="hljs-variable">$invoice</span>.customer.address <span class="hljs-comment">// 顧客のメールアドレス</span>
    <span class="hljs-variable">$email</span>.subject:=<span class="hljs-string">"請求書 # "</span>+<span class="hljs-function">String</span>(<span class="hljs-variable">$invoice</span>.number) + <span class="hljs-string">"のお支払いを確認いたしました。 "</span>

    <span class="hljs-variable">$status</span>:=<span class="hljs-variable">$transporter</span>.<span class="hljs-function">send</span>(<span class="hljs-variable">$email</span>)<span class="hljs-keyword">
 End for each</span><span class="hljs-keyword">

 For each</span>(<span class="hljs-variable">$invoice</span>;<span class="hljs-variable">$unpaid</span>)
    <span class="hljs-variable">$email</span>.to:=<span class="hljs-variable">$invoice</span>.customer.address <span class="hljs-comment">// 顧客のメールアドレス</span>
    <span class="hljs-variable">$email</span>.subject:=<span class="hljs-string">"請求書 # "</span>+<span class="hljs-function">String</span>(<span class="hljs-variable">$invoice</span>.number) + <span class="hljs-string">"のお支払いが確認できていません。 "</span>
    <span class="hljs-variable">$status</span>:=<span class="hljs-variable">$transporter</span>.<span class="hljs-function">send</span>(<span class="hljs-variable">$email</span>)<span class="hljs-keyword">
 End for each</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="エンティティセレクションとストレージ属性"></a><a href="#エンティティセレクションとストレージ属性" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>エンティティセレクションとストレージ属性</h3>
<p>すべてのストレージ属性 (テキスト、数値、ブール、日付) はエンティティセレクションの、あるいはエンティティのプロパティとして利用可能です。 エンティティセレクションと組み合わせて使用した場合、スカラー属性はスカラー値のコレクションを返します。 たとえば:</p>
<pre><code class="hljs css language-4d"> <span class="hljs-variable">$locals</span>:=ds.Person.<span class="hljs-function">query</span>(<span class="hljs-string">"city = :1"</span>;<span class="hljs-string">"San Jose"</span>) <span class="hljs-comment">// 個人のエンティティセレクション</span>
 <span class="hljs-variable">$localEmails</span>:=<span class="hljs-variable">$locals</span>.emailAddress <span class="hljs-comment">// メールアドレス (文字列) のコレクション</span>
</code></pre>
<p>このコードは <em>$localEmails</em> 内に文字列としてのメールアドレスのコレクションを返します。</p>
<h3><a class="anchor" aria-hidden="true" id="エンティティセレクションとリレーション属性"></a><a href="#エンティティセレクションとリレーション属性" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>エンティティセレクションとリレーション属性</h3>
<p>様々なクエリの方法に加えて、リレーション属性をエンティティセレクションのプロパティとして使用することで新しいエンティティセレクションを得ることもできます。 たとえば、以下のようなストラクチャーの場合を考えます:</p>
<p><img src="/docs/assets/en/ORDA/entitySelectionRelationAttributes.png" alt=""></p>
<pre><code class="hljs css language-4d"> <span class="hljs-variable">$myParts</span>:=ds.Part.<span class="hljs-function">query</span>(<span class="hljs-string">"ID &lt; 100"</span>) <span class="hljs-comment">// ID が 100未満のパーツを返します</span>
 <span class="hljs-variable">$myInvoices</span>:=<span class="hljs-variable">$myParts</span>.invoiceItems.invoice
  <span class="hljs-comment">// $myParts 内のパーツにリレートされている請求項目を1行以上含んでいるすべての請求書</span>
</code></pre>
<p>最後の行は、$myParts エンティティセレクション内のパーツにリレートされている請求項目が少なくとも1行含まれているすべての請求書のエンティティセレクションを、$myInvoices 内に返します。 エンティティセレクションのプロパティとしてリレーション属性が使用されると、返される結果は、たとえ返されるエンティティが一つだけだとしても、常に新しいエンティティセレクションとなります。 エンティティセレクションのプロパティとしてリレーション属性が使用された結果、エンティティが何も返ってこない場合には、返されるのは空のエンティティセレクションであり、null ではありません。</p>
<h2><a class="anchor" aria-hidden="true" id="エンティティロッキング"></a><a href="#エンティティロッキング" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>エンティティロッキング</h2>
<p>一般的に、複数のユーザーあるいはプロセスが同じエンティティを同時に読み込んで変更しようとした際にコンフリクトが発生する可能性を管理する必要があります。 レコードロックは、リレーショナルデータベースにおいてデータに矛盾した更新がなされないようにするための手段です。 読み込み時にレコードをロックして他のプロセスが更新できないようにする、あるいは逆に保存時に読み込んでからの間に他のプロセスがレコードを変更していないかどうかを検証する、というのが基本的な概念です。 前者は <strong>ペシミスティック・レコードロック</strong> と呼ばれ、他のユーザーに対してレコードをロックすることで、変更したいレコードを書き込むことができるようにするものです。 後者は <strong>オプティミスティック・レコードロック</strong> と呼ばれ、レコードが更新される必要がある場合にのみ書き込み権限を与えるという柔軟性があります。 ペシミスティック・レコードロックでは、更新される必要がないときでもレコードはロックされたままです。 オプティミスティック・レコードロックではレコードの書き込みの可能/不可能は更新時に判断されます。</p>
<p>ORDA では、以下の二つのロックモードを提供しています:</p>
<ul>
<li>自動的な &quot;オプティミスティック&quot; モード。多くのアプリケーションに適しています。</li>
<li>&quot;ペシミスティック&quot; モード。エンティティをアクセスする前にロックすることができます。</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="自動オプティミスティック・ロック"></a><a href="#自動オプティミスティック・ロック" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自動オプティミスティック・ロック</h3>
<p>この自動機構は、&quot;オプティミスティック・ロック&quot; に基づいたもので、これは Webアプリケーションの場合にとくに適しています。 この概念は以下のような動作原理に基づいています:</p>
<ul>
<li>すべてのエンティティは必ず読み書き可能な状態でロードされます。エンティティの <em>事前</em> ロックというのはありません。</li>
<li>各エンティティには保存されるたびにインクリメントされる内部的なロックスタンプを持っています。</li>
<li>プロセスあるいはユーザーが <code>entity.save( )</code> メソッドでエンティティを保存しようとした場合、4D は保存しようとしているエンティティのスタンプの値とデータ内にあるエンティティのスタンプの値を比較します (データ編集の場合):
<ul>
<li>値が合致している場合、エンティティは保存され、内部スタンプの値はインクリメントされます。</li>
<li>値が合致しない場合、読み込みから保存までの間に他のユーザーがエンティティを編集したことになります。 保存は実行されず、エラーが返されます。</li>
</ul></li>
</ul>
<p>オプティミスティック・ロックの動作は以下ように図解することができます:</p>
<ol>
<li><p>二つのプロセスが同じエンティティを読み込んだとします。<br><br><img src="/docs/assets/en/ORDA/optimisticLock1.png" alt=""></p></li>
<li><p>最初のプロセスがエンティティを編集し、それを保存しようとします。 すると <code>entity.save( )</code> メソッドが呼び出されます。 4Dエンジンは、編集されたエンティティの内部スタンプ値とデータに保存されているエンティティの内部スタンプ値を自動的に比較します。 これは合致しますので、エンティティは保存され、その内部スタンプ値はインクリメントされます。<br><br><img src="/docs/assets/en/ORDA/optimisticLock2.png" alt=""></p></li>
<li><p>二つ目のプロセスも読み込んだエンティティを編集し、それを保存しようとします。 すると <code>entity.save( )</code> メソッドが呼び出されます。 編集されたエンティティの内部スタンプ値はデータに保存されているエンティティの内部スタンプ値と合致しないので、保存は実行されず、エラーが返されます。<br><br><img src="/docs/assets/en/ORDA/optimisticLock3.png" alt=""></p></li>
</ol>
<p>この流れは以下のコードのように分解することもできます:</p>
<pre><code class="hljs css language-4d"> <span class="hljs-variable">$person1</span>:=ds.Person.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">// エンティティを参照</span>
 <span class="hljs-variable">$person2</span>:=ds.Person.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">// 同じエンティティへの別の参照</span>
 <span class="hljs-variable">$person1</span>.name:=<span class="hljs-string">"Bill"</span>
 <span class="hljs-variable">$result</span>:=<span class="hljs-variable">$person1</span>.<span class="hljs-function">save</span>() <span class="hljs-comment">// $result.success=true, 変更は保存されます</span>
 <span class="hljs-variable">$person2</span>.name:=<span class="hljs-string">"William"</span>
 <span class="hljs-variable">$result</span>:=<span class="hljs-variable">$person2</span>.<span class="hljs-function">save</span>() <span class="hljs-comment">// $result.success=false, 変更は保存されません</span>
</code></pre>
<p>この例では、$person1 に Person の、キーが 1 のエンティティを代入します。 次に、同じエンティティの別の参照を変数 $person2 に代入します。 $person1 を用いて、人物の名前を変更してエンティティを保存します。 同じことを $person2 を使用して実行しようとすると、4D はディスク上のエンティティをチェックし、変数 $person2 に代入されたものと同じかどうかを調べます。 結果としてこれは同じものでは無いので、success プロパティには false が返され、二つ目の変更は保存されません。</p>
<p>こういった状況が発生した場合には、たとえば <code>entity.reload()</code> メソッドを使用してディスクからエンティティを再読込し、変更をもう一度おこなうことができます。 また <code>entity.save()</code> メソッドは、異なるプロセスがそれぞれ異なる属性を変更していた場合には保存を実行する &quot;automerge&quot; オプションも提供しています。</p>
<blockquote>
<p><strong>トランザクション</strong> 内においては、特定レコードのコピーがコンタキスト内に一つしか存在しないため、レコードスタンプは使用されません。 レコードを参照するエンティティが複数あっても、同じコピーが検収されるため <code>entity.save()</code> による処理がスタンプエラーを生成することはありません。</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="ペシミスティック・ロック"></a><a href="#ペシミスティック・ロック" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ペシミスティック・ロック</h3>
<p>エンティティは、データアクセス時に任意にロックおよびアンロックすることができます。 エンティティがプロセスからロックされている場合、そのエンティティはプロセスに読み書き可能モードで読み込まれていますが、他のすべてのプロセスに対してロックされています。 ロックされたエンティティは、他のプロセスからは読み込みモードでのみ読み込むことができます。つまり、その値を編集・保存することはできません。</p>
<p>この機能は <code>Entity</code> クラスの 2つの関数に基づいています:</p>
<ul>
<li><a href="/docs/ja/API/EntityClass.html#lock"><code>entity.lock()</code></a></li>
<li><a href="/docs/ja/API/EntityClass.html#unlock"><code>entity.unlock()</code></a></li>
</ul>
<p>詳細な情報については、これらの関数の説明を参照してください。</p>
<blockquote>
<p>ペシミスティック・ロックは <a href="/docs/ja/REST/lock.html">REST API</a> によって扱うことも可能です。</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="4dクラシック・ロックとordaのペシミスティック・ロックの組み合わせ"></a><a href="#4dクラシック・ロックとordaのペシミスティック・ロックの組み合わせ" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4Dクラシック・ロックとORDAのペシミスティック・ロックの組み合わせ</h3>
<p>クラシックコマンドと ORDA コマンドの両方を使用してレコードをロックする場合、以下の原則に注意する必要があります:</p>
<ul>
<li>クラシック4Dコマンドを使用してレコードをロックした場合、そのレコードに相当するエンティティを ORDA でロックすることはできません。</li>
<li>ORDA を使用してエンティティをロックした場合、そのエンティティに相当するレコードをクラシック4Dコマンドでロックすることはできません。</li>
</ul>
<p>これらの原理は以下のような図に表すことができます:</p>
<p><img src="/docs/assets/en/ORDA/concurrent1.png" alt=""></p>
<p><strong>トランザクションロック</strong> はクラシックコマンドと ORDAコマンドの両方に適用されます。 マルチプロセスあるいはマルチユーザーアプリケーションにおいては、トランザクション内でクラシックコマンドを使用してレコードをロックした場合、そのトランザクションが OK あるいはキャンセルされるまで、他のプロセスからそのレコードに相当するエンティティをロックすることはできません (逆もまた然りです)。</p>
<ul>
<li>クラシックコマンドを使用してロックした場合:<br><br><img src="/docs/assets/en/ORDA/concurrent2.png" alt=""></li>
<li>ORDA関数を使用してロックした場合:<br><br><img src="/docs/assets/en/ORDA/concurrent3.png" alt=""></li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/ja/ORDA/ordaClasses.html"><span class="arrow-prev">← </span><span>データモデルクラス</span></a><a class="docs-next button" href="/docs/ja/ORDA/datastores.html"><span>リモートデータストアの利用</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#エンティティの作成">エンティティの作成</a></li><li><a href="#エンティティと参照">エンティティと参照</a></li><li><a href="#エンティティ属性の使用">エンティティ属性の使用</a></li><li><a href="#リレーション属性への値の代入">リレーション属性への値の代入</a></li><li><a href="#エンティティセレクションの作成">エンティティセレクションの作成</a><ul class="toc-headings"><li><a href="#共有可能追加可能なエンティティセレクション">共有可能/追加可能なエンティティセレクション</a></li><li><a href="#エンティティセレクションとストレージ属性">エンティティセレクションとストレージ属性</a></li><li><a href="#エンティティセレクションとリレーション属性">エンティティセレクションとリレーション属性</a></li></ul></li><li><a href="#エンティティロッキング">エンティティロッキング</a><ul class="toc-headings"><li><a href="#自動オプティミスティック・ロック">自動オプティミスティック・ロック</a></li><li><a href="#ペシミスティック・ロック">ペシミスティック・ロック</a></li><li><a href="#4dクラシック・ロックとordaのペシミスティック・ロックの組み合わせ">4Dクラシック・ロックとORDAのペシミスティック・ロックの組み合わせ</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="https://www.4d.com" class="nav-home"><img src="/docs/img/logohome.png" alt="4D Documentation"/></a><div><h5>Community</h5><a href="https://developer.4D.com">4D Developer Center</a><a href="https://blog.4d.com/">4D Blog</a><a href="https://discuss.4d.com">4D Forum</a><a href="https://www.facebook.com/4Dsoftware/">Facebook</a><a href="https://twitter.com/4Dsoftware">Twitter</a><a href="https://www.youtube.com/user/4Dsoftware">Youtube</a><a href="https://github.com/4D/">GitHub</a></div><div><h5>Support</h5><a href="https://doc.4d.com/">4D Doc Center <i>(Where It All Began)</i></a><a href="http://kb.4d.com/">Knowledge Base</a><a href="https://us.4d.com/product-download">Downloads</a><a href="https://us.4d.com/resources">Resources</a><a href="https://us.4d.com/4d-technical-support">Get Support</a></div><div><h5>Company</h5><a href="https://us.4d.com/about-us">About 4D</a><a href="https://us.4d.com/contact-us">Contact us</a><a href="https://us.4d.com/4d-around-the-world">4D around the world</a><a href="https://us.4d.com/careers">Careers</a></div></section><section class="copyright">© 2022 4D SAS - All rights reserved</section><section class="copyright"><a class="cp2" href="https://us.4d.com/terms-and-conditions">Terms &amp; Conditions</a> | <a class="cp2" href="https://us.4d.com/legal-notices">Legal Notices</a> | <a class="cp2" href="https://us.4d.com/data-policy">Data Policy</a> | <a class="cp2" href="https://us.4d.com/cookies-policy">Cookie Policy</a> | <a class="cp2" href="https://us.4d.com/license-0">Product license</a></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '2f94e2c8270ac2b1db0c23691592fb10',
                indexName: '4d',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:ja","version:19 R6 BETA"]}
              });
            </script></body></html>