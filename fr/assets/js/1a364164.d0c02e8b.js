/*! For license information please see 1a364164.d0c02e8b.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[20349],{918498:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var t=n(474848),i=n(28453);const r={id:"authUsers",title:"Sessions et utilisateurs"},o=void 0,l={id:"REST/authUsers",title:"Sessions et utilisateurs",description:"Sessions",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-20-R6/REST/authUsers.md",sourceDirName:"REST",slug:"/REST/authUsers",permalink:"/docs/fr/REST/authUsers",draft:!1,unlisted:!1,editUrl:"https://github.com/4d/docs/issues/new?title=Comment%20on%20REST%2FauthUsers.md%20(20-R6)&body=Please%20enter%20your%20comment%3A",tags:[],version:"20-R6",frontMatter:{id:"authUsers",title:"Sessions et utilisateurs"},sidebar:"docs",previous:{title:"Configuration du serveur",permalink:"/docs/fr/REST/configuration"},next:{title:"Obtenir des informations du serveur",permalink:"/docs/fr/REST/genInfo"}},a={},c=[{value:"Sessions",id:"sessions",level:2},{value:"Mode Force login",id:"mode-force-login",level:2},{value:"Requ\xeates REST descriptives",id:"requ\xeates-rest-descriptives",level:3},{value:"<code>Function authentify</code>",id:"function-authentify",level:2},{value:"Syntaxe",id:"syntaxe",level:3},{value:"Exemple",id:"exemple",level:3}];function u(e){const s={a:"a",admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h2,{id:"sessions",children:"Sessions"}),"\n",(0,t.jsxs)(s.p,{children:["Lorsque les ",(0,t.jsx)(s.a,{href:"/docs/fr/WebServer/sessions#activer-les-sessions",children:"sessions \xe9volutives sont activ\xe9es"})," (recommand\xe9), les requ\xeates REST peuvent cr\xe9er et utiliser des ",(0,t.jsx)(s.a,{href:"/docs/fr/WebServer/sessions",children:"sessions utilisateur web"}),", offrant des fonctionnalit\xe9s suppl\xe9mentaires telles que la gestion de requ\xeates multiples, le partage de donn\xe9es entre les process web clients et le contr\xf4le des privil\xe8ges utilisateur."]}),"\n",(0,t.jsxs)(s.p,{children:["Lorsqu'une session utilisateur web est ouverte, vous pouvez la g\xe9rer via l'objet ",(0,t.jsx)(s.code,{children:"Session"})," et l'",(0,t.jsx)(s.a,{href:"/docs/fr/API/SessionClass",children:"API de session"}),". Les requ\xeates REST ult\xe9rieures r\xe9utilisent le m\xeame cookie de session."]}),"\n",(0,t.jsx)(s.p,{children:"Une session est ouverte apr\xe8s que l'utilisateur a \xe9t\xe9 connect\xe9 avec succ\xe8s (voir ci-dessous)."}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Sur 4D Server, l'ouverture d'une session REST n\xe9cessite une licence client 4D disponible.",(0,t.jsx)(s.br,{})]}),"\n",(0,t.jsx)(s.li,{children:"Sur 4D mono-utilisateur, vous pouvez ouvrir jusqu'\xe0 trois sessions REST \xe0 des fins de test."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"mode-force-login",children:"Mode Force login"}),"\n",(0,t.jsx)(s.admonition,{title:"Compatibilit\xe9",type:"note",children:(0,t.jsxs)(s.p,{children:["L'ancien mode de connexion bas\xe9 sur la m\xe9thode base ",(0,t.jsx)(s.code,{children:"On REST Authentication"})," est ",(0,t.jsx)(s.strong,{children:"d\xe9pr\xe9ci\xe9"})," \xe0 partir de 4D 20 R6. Il est maintenant recommand\xe9 d'",(0,t.jsxs)(s.a,{href:"/docs/fr/ORDA/privileges#fichier-rolesjson",children:["utiliser le ",(0,t.jsx)(s.strong,{children:"mode Force login"})]})," (automatiquement activ\xe9 dans les nouveaux projets) et de mettre en \u0153uvre la fonction ",(0,t.jsx)(s.a,{href:"#dsauthentify",children:(0,t.jsx)(s.code,{children:"ds.authentify()"})}),". Dans les projets convertis, ",(0,t.jsx)(s.a,{href:"/docs/fr/settings/web#activate-rest-authentication-through-dsauthentify-function",children:"un bouton dans la bo\xeete de dialogue des Param\xe8tres"})," vous aide \xe0 mettre \xe0 niveau votre configuration. Dans Qodly Studio for 4D, le mode peut \xeatre d\xe9fini en utilisant l'option ",(0,t.jsx)(s.a,{href:"/docs/fr/WebServer/qodly-studio#force-login",children:(0,t.jsx)(s.strong,{children:"Force login"})})," dans l'onglet Privileges."]})}),"\n",(0,t.jsx)(s.p,{children:"La s\xe9quence de connexion d'un utilisateur est la suivante :"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Lors de la premi\xe8re requ\xeate REST (pour un appel de page Qodly par exemple), une session utilisateur web \"guest\" est cr\xe9\xe9e. Elle n'a aucun privil\xe8ge, aucun droit d'ex\xe9cuter des requ\xeates autres que des ",(0,t.jsx)(s.a,{href:"#descriptive-rest-requests",children:"requ\xeates REST descriptives"}),", aucune licence n'est consomm\xe9e.",(0,t.jsx)(s.br,{}),'\nLes requ\xeates REST descriptives sont toujours trait\xe9es par le serveur, m\xeame si aucune session utilisateur web utilisant une licence n\'est ouverte. Dans ce cas, elles sont trait\xe9es \xe0 travers des sessions "guest".']}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Vous appelez votre fonction ",(0,t.jsx)(s.a,{href:"#authentify",children:(0,t.jsx)(s.code,{children:"authentify()"})})," (cr\xe9\xe9e au pr\xe9alable), dans laquelle vous v\xe9rifiez les informations d'identification de l'utilisateur et appelez ",(0,t.jsx)(s.a,{href:"/docs/fr/API/SessionClass#setprivileges",children:(0,t.jsx)(s.code,{children:"Session.setPrivileges()"})})," avec les privil\xe8ges appropri\xe9s. ",(0,t.jsx)(s.code,{children:"authentify()"})," doit \xeatre une ",(0,t.jsx)(s.a,{href:"/docs/fr/ORDA/ordaClasses#datastore-class",children:"fonction de datastore class"})," expos\xe9e."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["La requ\xeate ",(0,t.jsx)(s.code,{children:"/rest/$catalog/authentify"})," est envoy\xe9e au serveur avec les informations d'identification de l'utilisateur. Cette \xe9tape n\xe9cessite seulement un formulaire de connexion basique qui n'acc\xe8de pas aux donn\xe9es ; cela peut \xeatre une ",(0,t.jsx)(s.a,{href:"/docs/fr/WebServer/qodly-studio",children:"page Qodly"})," (appel\xe9e via la requ\xeate ",(0,t.jsx)(s.code,{children:"/rest/$getWebForm"}),")."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Si l'utilisateur est authentifi\xe9 avec succ\xe8s, une licence 4D est consomm\xe9e sur le serveur et toutes les requ\xeates REST sont accept\xe9es."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"alt-text",src:n(277974).A+"",width:"1344",height:"756"})}),"\n",(0,t.jsxs)(s.p,{children:["Dans la phase de connexion de l'utilisateur, l'utilisation des licences est d\xe9connect\xe9e des sessions utilisateur web. Une licence est requise uniquement lorsque la fonction ",(0,t.jsx)(s.a,{href:"/docs/fr/API/SessionClass#setprivileges",children:(0,t.jsx)(s.code,{children:"Session.setPrivileges()"})})," est ex\xe9cut\xe9e, ce qui vous permet de contr\xf4ler le nombre de licences utilis\xe9es."]}),"\n",(0,t.jsxs)(s.p,{children:["Toutes les autres requ\xeates REST (manipulant des donn\xe9es ou ex\xe9cutant une fonction) ne seront trait\xe9es que si elles sont ex\xe9cut\xe9es dans une session web avec les privil\xe8ges appropri\xe9s, sinon elles retournent une erreur. Pour attribuer des privil\xe8ges \xe0 une session web, vous devez ex\xe9cuter la fonction ",(0,t.jsx)(s.a,{href:"/docs/fr/API/SessionClass#setprivileges",children:(0,t.jsx)(s.code,{children:"Session.setPrivileges()"})})," pour la session. L'ex\xe9cution de cette fonction d\xe9clenche la consommation de la licence 4D."]}),"\n",(0,t.jsx)(s.h3,{id:"requ\xeates-rest-descriptives",children:"Requ\xeates REST descriptives"}),"\n",(0,t.jsx)(s.p,{children:'Les requ\xeates REST descriptives peuvent \xeatre trait\xe9es dans des sessions d\'utilisateurs web qui ne n\xe9cessitent pas de licences (sessions "guest"). Ces requ\xeates sont :'}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["requ\xeates ",(0,t.jsx)(s.a,{href:"/docs/fr/REST/catalog",children:(0,t.jsx)(s.code,{children:"/rest/$catalog"})})," (par exemple ",(0,t.jsx)(s.code,{children:"/rest/$catalog/$all"}),") - acc\xe8s aux dataclass disponibles"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"/rest/$catalog/authentify"})," - la fonction datastore utilis\xe9e pour connecter l'utilisateur"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"/rest/$getWebForm"})," - le rendu d'une page Qodly"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"alt-text",src:n(639907).A+"",width:"1171",height:"302"})}),"\n",(0,t.jsx)(s.h2,{id:"function-authentify",children:(0,t.jsx)(s.code,{children:"Function authentify"})}),"\n",(0,t.jsx)(s.h3,{id:"syntaxe",children:"Syntaxe"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-4d",children:"exposed Function authentify({params : type}) {-> result : type}\n\t// code\n"})}),"\n",(0,t.jsxs)(s.p,{children:["La fonction ",(0,t.jsx)(s.code,{children:"authentify()"})," doit \xeatre impl\xe9ment\xe9e dans la ",(0,t.jsx)(s.a,{href:"/docs/fr/ORDA/ordaClasses#datastore-class",children:"classe DataStore"})," du projet et doit \xeatre appel\xe9e par une requ\xeate REST."]}),"\n",(0,t.jsx)(s.p,{children:"Cette fonction est le seul point d'entr\xe9e disponible \xe0 partir des sessions guest REST lorsque le mode \"force login\" est activ\xe9 : tout autre appel de fonction ou d'acc\xe8s aux donn\xe9es est rejet\xe9 jusqu'\xe0 ce que la session acqui\xe8re les privil\xe8ges appropri\xe9s."}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsxs)(s.p,{children:["La fonction ",(0,t.jsx)(s.code,{children:"authentify()"})," peut toujours \xeatre ex\xe9cut\xe9e par une session guest REST, quelle que soit la configuration du fichier ",(0,t.jsx)(s.a,{href:"/docs/fr/ORDA/privileges#rolesjson-file",children:(0,t.jsx)(s.code,{children:"roles.json"})}),"."]})}),"\n",(0,t.jsxs)(s.p,{children:["La fonction peut recevoir toute information d'authentification ou contextuelle en tant que ",(0,t.jsx)(s.a,{href:"/docs/fr/REST/classFunctions#parameters",children:"param\xe8tre(s)"})," et peut renvoyer n'importe quelle valeur. \xc9tant donn\xe9 que cette fonction ne peut \xeatre appel\xe9e que depuis une requ\xeate REST, les param\xe8tres doivent \xeatre transmis dans le body de la requ\xeate POST."]}),"\n",(0,t.jsx)(s.p,{children:"Cette fonction doit contenir deux parties :"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"un code pour identifier et authentifier l'exp\xe9diteur de la demande REST,"}),"\n",(0,t.jsxs)(s.li,{children:["si l'authentification r\xe9ussit, un appel \xe0 ",(0,t.jsx)(s.a,{href:"/docs/fr/API/SessionClass#setprivileges",children:(0,t.jsx)(s.code,{children:"Session.setPrivileges()"})})," qui attribue les privil\xe8ges appropri\xe9s \xe0 la session."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Si la fonction ne fait pas appel \xe0 ",(0,t.jsx)(s.a,{href:"/docs/fr/API/SessionClass#setprivileges",children:(0,t.jsx)(s.code,{children:"Session.setPrivileges()"})}),", aucun privil\xe8ge n'est attribu\xe9, aucune licence n'est consomm\xe9e et les requ\xeates REST non descriptives ult\xe9rieures sont rejet\xe9es."]}),"\n",(0,t.jsx)(s.h3,{id:"exemple",children:"Exemple"}),"\n",(0,t.jsxs)(s.p,{children:["Vous voulez simplement savoir quels utilisateurs ont ouvert une session Web sur le serveur. Vous avez cr\xe9\xe9 la fonction ",(0,t.jsx)(s.code,{children:"authentify()"})," suivante dans la classe datastore :"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-4d",children:'exposed Function authentify($credentials : Object) : Text\n\nvar $users : cs.UsersSelection\nvar $user : cs.UsersEntity\n\n$users:=ds.Users.query("name = :1"; $credentials.name)\n$user:=$users.first()\n\nIf ($user#Null) //l\'utilisateur est connu\n\tIf (Verify password hash($credentials.password; $user.password))\n\t\tSession.setPrivileges("vip")\n\tElse\n\n\t\treturn "Wrong password"\n\tEnd if\nElse\n        return "Wrong user"\nEnd if\n'})}),"\n",(0,t.jsxs)(s.p,{children:["Pour appeler la fonction ",(0,t.jsx)(s.code,{children:"authentify()"})," :"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"POST"})," ",(0,t.jsx)(s.code,{children:"127.0.0.1:8111/rest/$catalog/authentify"})]}),"\n",(0,t.jsx)(s.p,{children:"Body de la requ\xeate :"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'[{"name":"Henry",\n"password":"123"}]\n'})})]})}function d(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},221020:(e,s,n)=>{var t=n(296540),i=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function c(e,s,n){var t,r={},c=null,u=null;for(t in void 0!==n&&(c=""+n),void 0!==s.key&&(c=""+s.key),void 0!==s.ref&&(u=s.ref),s)o.call(s,t)&&!a.hasOwnProperty(t)&&(r[t]=s[t]);if(e&&e.defaultProps)for(t in s=e.defaultProps)void 0===r[t]&&(r[t]=s[t]);return{$$typeof:i,type:e,key:c,ref:u,props:r,_owner:l.current}}s.Fragment=r,s.jsx=c,s.jsxs=c},474848:(e,s,n)=>{e.exports=n(221020)},639907:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/force-login-1-f9e377d9d1294c166d2e316a30d4eef4.jpeg"},277974:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/force-login-2-c615d4581880aa201c1e7abd591f6146.jpeg"},28453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>l});var t=n(296540);const i={},r=t.createContext(i);function o(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);