"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["27"],{799612:function(e,s,n){n.r(s),n.d(s,{frontMatter:()=>d,toc:()=>c,default:()=>u,metadata:()=>i,assets:()=>o,contentTitle:()=>l});var i=JSON.parse('{"id":"ORDA/privileges","title":"R\xf4les et privil\xe8ges","description":"Prot\xe9ger les donn\xe9es tout en permettant un acc\xe8s rapide et facile aux utilisateurs autoris\xe9s est un d\xe9fi majeur pour les applications web. L\'architecture de s\xe9curit\xe9 ORDA est impl\xe9ment\xe9e au c\u0153ur de votre datastore et vous permet de d\xe9finir des privil\xe8ges sp\xe9cifiques \xe0 toutes les sessions utilisateur web ou REST pour les diff\xe9rentes ressources de votre projet (datastore, dataclasses, fonctions, etc.).","source":"@site/i18n/fr/docusaurus-plugin-content-docs/version-21/ORDA/privileges.md","sourceDirName":"ORDA","slug":"/ORDA/privileges","permalink":"/docs/fr/ORDA/privileges","draft":false,"unlisted":false,"editUrl":"https://github.com/4d/docs/issues/new?title=Comment%20on%20ORDA%2Fprivileges.md%20(21)&body=Please%20enter%20your%20comment%3A","tags":[],"version":"21","frontMatter":{"id":"privileges","title":"R\xf4les et privil\xe8ges"},"sidebar":"docs","previous":{"title":"Datastores distants","permalink":"/docs/fr/ORDA/datastores"},"next":{"title":"Optimisation client/serveur","permalink":"/docs/fr/ORDA/client-server-optimization"}}'),r=n(474848),t=n(884429);let d={id:"privileges",title:"R\xf4les et privil\xe8ges"},l,o={},c=[{value:"Vue d\u2019ensemble",id:"vue-densemble",level:2},{value:"Resources",id:"resources",level:2},{value:"Permissions",id:"permissions",level:2},{value:"Actions de permission",id:"actions-de-permission",level:3},{value:"Inherited permissions",id:"inherited-permissions",level:3},{value:"Attribution de permissions aux fonctions de la classe ORDA",id:"attribution-de-permissions-aux-fonctions-de-la-classe-orda",level:3},{value:"Privil\xe8ges et R\xf4les",id:"privil\xe8ges-et-r\xf4les",level:2},{value:"Exemple",id:"exemple",level:3},{value:"<code>roles.json</code>",id:"rolesjson",level:2},{value:"Default File Location and Content",id:"default-file-location-and-content",level:3},{value:"Restriction Modes",id:"restriction-modes",level:2},{value:"Recommended Configuration",id:"recommended-configuration",level:3},{value:"<code>Roles_Errors.json</code>",id:"roles_errorsjson",level:3},{value:"Exemple de configuration de privil\xe8ges",id:"exemple-de-configuration-de-privil\xe8ges",level:2}];function a(e){let s={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:"Prot\xe9ger les donn\xe9es tout en permettant un acc\xe8s rapide et facile aux utilisateurs autoris\xe9s est un d\xe9fi majeur pour les applications web. L'architecture de s\xe9curit\xe9 ORDA est impl\xe9ment\xe9e au c\u0153ur de votre datastore et vous permet de d\xe9finir des privil\xe8ges sp\xe9cifiques \xe0 toutes les sessions utilisateur web ou REST pour les diff\xe9rentes ressources de votre projet (datastore, dataclasses, fonctions, etc.)."}),"\n",(0,r.jsx)(s.h2,{id:"vue-densemble",children:"Vue d\u2019ensemble"}),"\n",(0,r.jsx)(s.p,{children:"L'architecture de s\xe9curit\xe9 ORDA est bas\xe9e sur les concepts de privil\xe8ges, d'actions de permission (lecture, cr\xe9ation, etc.) et de ressources."}),"\n",(0,r.jsxs)(s.p,{children:["Lorsque les utilisateurs web ou REST sont enregistr\xe9s, leur session est automatiquement charg\xe9e avec les privil\xe8ges associ\xe9s. Les privil\xe8ges sont assign\xe9s \xe0 la session en utilisant la fonction ",(0,r.jsx)(s.a,{href:"/docs/fr/API/SessionClass#setprivileges",children:(0,r.jsx)(s.code,{children:"session.setPrivileges()"})}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["Chaque requ\xeate utilisateur envoy\xe9e dans la session est \xe9valu\xe9e par rapport aux privil\xe8ges d\xe9finis dans le fichier ",(0,r.jsx)(s.code,{children:"roles.json"})," du projet."]}),"\n",(0,r.jsx)(s.p,{children:"Si un utilisateur tente d'ex\xe9cuter une action et ne dispose pas des droits d'acc\xe8s appropri\xe9s, une erreur de privil\xe8ge est g\xe9n\xe9r\xe9e ou, en cas de permission de lecture manquante sur les attributs, ils ne sont pas envoy\xe9s."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"schema",src:n(653024).A+"",width:"960",height:"540"})}),"\n",(0,r.jsx)(s.admonition,{title:"Articles de blog li\xe9s",type:"tip",children:(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://blog.4d.com/filter-access-to-your-data-with-a-complete-system-of-permissions/",children:(0,r.jsx)(s.strong,{children:"Filtrez l'acc\xe8s \xe0 vos donn\xe9es avec un syst\xe8me complet de permissions"})})})}),"\n",(0,r.jsx)(s.h2,{id:"resources",children:"Resources"}),"\n",(0,r.jsx)(s.p,{children:"Vous pouvez assigner des actions de permission sp\xe9cifiques aux ressources suivantes dans votre projet :"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["the ",(0,r.jsx)(s.a,{href:"/docs/fr/ORDA/dsmapping#datastore",children:"datastore"})]}),"\n",(0,r.jsxs)(s.li,{children:["the ",(0,r.jsx)(s.a,{href:"/docs/fr/ORDA/dsmapping#dataclass",children:"dataclasses"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"/docs/fr/ORDA/dsmapping#attribute",children:"attributes"})," (including ",(0,r.jsx)(s.a,{href:"/docs/fr/ORDA/ordaClasses#computed-attributes-1",children:"computed"})," and ",(0,r.jsx)(s.a,{href:"/docs/fr/ORDA/ordaClasses#alias-attributes-1",children:"alias"}),")"]}),"\n",(0,r.jsxs)(s.li,{children:["functions of the ",(0,r.jsx)(s.a,{href:"/docs/fr/ORDA/ordaClasses",children:"data model classes"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"/docs/fr/REST/singleton",children:"singleton"})," functions"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Chaque fois qu'on acc\xe8de \xe0 une ressource dans une session (quelle que soit la mani\xe8re dont on y acc\xe8de), 4D v\xe9rifie que la session dispose des autorisations appropri\xe9es et rejette l'acc\xe8s s'il n'est pas autoris\xe9."}),"\n",(0,r.jsx)(s.h2,{id:"permissions",children:"Permissions"}),"\n",(0,r.jsxs)(s.p,{children:["A permission is the ability to do an action on a resource. For example, ",(0,r.jsx)(s.em,{children:"execute the ds.myTable.myFunction()"})," represents a ",(0,r.jsx)(s.strong,{children:"permission"}),". Permissions are defined for the project in the ",(0,r.jsx)(s.a,{href:"#rolesjson-file",children:(0,r.jsx)(s.code,{children:"roles.json"})})," file. Each permission can be given to one or more ",(0,r.jsx)(s.a,{href:"#privileges-and-roles",children:"privileges"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["When ",(0,r.jsx)(s.strong,{children:"no specific permission"})," has been defined for a resource, access to the resource may be automatically ",(0,r.jsx)(s.strong,{children:"unrestricted"})," or ",(0,r.jsx)(s.strong,{children:"restricted"})," depending on the ",(0,r.jsx)(s.a,{href:"#restriction-modes",children:"default mode defined for the project"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"actions-de-permission",children:"Actions de permission"}),"\n",(0,r.jsx)(s.p,{children:"Les actions disponibles sont li\xe9es \xe0 la ressource cible."}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Actions"}),(0,r.jsx)(s.th,{children:"datastore"}),(0,r.jsx)(s.th,{children:"dataclass"}),(0,r.jsx)(s.th,{children:"attribut"}),(0,r.jsx)(s.th,{children:"fonction du mod\xe8le de donn\xe9es ou fonction singleton"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"create"})}),(0,r.jsx)(s.td,{children:"Cr\xe9er une entit\xe9 dans n'importe quelle dataclass"}),(0,r.jsx)(s.td,{children:"Cr\xe9er une entit\xe9 dans cette dataclass"}),(0,r.jsx)(s.td,{children:"Cr\xe9er une entit\xe9 avec une valeur diff\xe9rente de la valeur par d\xe9faut autoris\xe9e pour cet attribut (ignor\xe9 pour les attributs alias)."}),(0,r.jsx)(s.td,{children:"n/a"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"read"})}),(0,r.jsx)(s.td,{children:"Lire les attributs de n'importe quelle dataclass"}),(0,r.jsx)(s.td,{children:"Lire les attributs de cette dataclass"}),(0,r.jsx)(s.td,{children:"Lire ce contenu d'attribut"}),(0,r.jsx)(s.td,{children:"n/a"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"update"})}),(0,r.jsx)(s.td,{children:"Mettre \xe0 jour les attributs dans n'importe quelle dataclass."}),(0,r.jsx)(s.td,{children:"Mettre \xe0 jour les attributs de cette dataclass."}),(0,r.jsx)(s.td,{children:"Mettre \xe0 jour le contenu de cet attribut (ignor\xe9 pour les attributs alias)."}),(0,r.jsx)(s.td,{children:"n/a"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"drop"})}),(0,r.jsx)(s.td,{children:"Supprimer des donn\xe9es dans n'importe quelle dataclass."}),(0,r.jsx)(s.td,{children:"Supprimer des donn\xe9es dans cette dataclass."}),(0,r.jsx)(s.td,{children:"Supprimer une valeur non nulle pour cet attribut (sauf pour les attributs alias et calcul\xe9s)."}),(0,r.jsx)(s.td,{children:"n/a"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"execute"})}),(0,r.jsx)(s.td,{children:"Ex\xe9cuter n'importe quelle fonction du projet (datastore, dataclass, entity selection, entit\xe9, singleton)"}),(0,r.jsx)(s.td,{children:"Ex\xe9cuter n'importe quelle fonction de dataclass. Les fonctions de dataclass, d'entit\xe9 et d'entity selection sont consid\xe9r\xe9es comme des fonctions de dataclass"}),(0,r.jsx)(s.td,{children:"n/a"}),(0,r.jsx)(s.td,{children:"Ex\xe9cuter cette fonction"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"promote"})}),(0,r.jsx)(s.td,{children:"n/a"}),(0,r.jsx)(s.td,{children:"n/a"}),(0,r.jsx)(s.td,{children:"n/a"}),(0,r.jsx)(s.td,{children:"Associe un privil\xe8ge donn\xe9 lors de l'ex\xe9cution de la fonction. Le privil\xe8ge est ajout\xe9 temporairement et supprim\xe9 \xe0 la fin de l'ex\xe9cution de la fonction. Par mesure de s\xe9curit\xe9, seul le process ex\xe9cutant la fonction re\xe7oit le privil\xe8ge, et non toute la session."})]})]})]}),"\n",(0,r.jsx)(s.admonition,{title:"Notes",type:"note",children:(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Un ",(0,r.jsx)(s.a,{href:"/docs/fr/ORDA/ordaClasses#alias-attributes-1",children:"alias"})," peut \xeatre lu d\xe8s que les privil\xe8ges de la session autorisent l'acc\xe8s \xe0 l'alias lui-m\xeame, m\xeame si les privil\xe8ges de la session n'autorisent pas l'acc\xe8s aux attributs r\xe9solvant l'alias."]}),"\n",(0,r.jsxs)(s.li,{children:["Un ",(0,r.jsx)(s.a,{href:"/docs/fr/ORDA/ordaClasses#computed-attributes-1",children:"attribut calcul\xe9"})," est accessible m\xeame si les attributs sur lesquels il est construit ne font l'objet d'aucune autorisation."]}),"\n",(0,r.jsxs)(s.li,{children:["Vous pouvez assigner une action de permission \xe0 une classe singleton (type ",(0,r.jsx)(s.code,{children:"singleton"}),"), auquel cas elle sera appliqu\xe9e \xe0 toutes ses fonctions expos\xe9es, ou bien \xe0 une fonction de singleton (type ",(0,r.jsx)(s.code,{children:"singletonMethod"}),")."]}),"\n",(0,r.jsxs)(s.li,{children:["Vous pouvez d\xe9finir/supprimer l'action ",(0,r.jsx)(s.strong,{children:"promote"})," dynamiquement pour un process web en utilisant les fonctions ",(0,r.jsx)(s.a,{href:"/docs/fr/API/SessionClass#promote",children:(0,r.jsx)(s.code,{children:"promote()"})})," et ",(0,r.jsx)(s.a,{href:"/docs/fr/API/SessionClass#demote",children:(0,r.jsx)(s.code,{children:"demote()"})}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Valeurs par d\xe9faut : dans l'impl\xe9mentation actuelle, seul ",(0,r.jsx)(s.em,{children:"Null"})," est disponible en tant que valeur par d\xe9faut."]}),"\n",(0,r.jsxs)(s.li,{children:["En mode REST ",(0,r.jsx)(s.a,{href:"/docs/fr/REST/authUsers#force-login-mode",children:"force login"}),", la fonction ",(0,r.jsx)(s.a,{href:"/docs/fr/REST/authUsers#function-authentify",children:(0,r.jsx)(s.code,{children:"authentify()"})})," est toujours ex\xe9cutable par les utilisateurs guest, quelle que soit la configuration des permissions."]}),"\n"]})}),"\n",(0,r.jsxs)(s.p,{children:["Le param\xe9trage des permissions n\xe9cessite d'\xeatre coh\xe9rent, en particulier les permissions ",(0,r.jsx)(s.strong,{children:"update"})," et ",(0,r.jsx)(s.strong,{children:"drop"})," ont \xe9galement besoin d'une permission ",(0,r.jsx)(s.strong,{children:"read"})," (mais ",(0,r.jsx)(s.strong,{children:"create"})," n'en a pas besoin)."]}),"\n",(0,r.jsx)(s.h3,{id:"inherited-permissions",children:"Inherited permissions"}),"\n",(0,r.jsx)(s.p,{children:"Une action de permission d\xe9finie \xe0 un certain niveau est h\xe9rit\xe9e par d\xe9faut aux niveaux inf\xe9rieurs, mais plusieurs niveaux de permissions peuvent \xeatre d\xe9finis :"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Une action de permission d\xe9finie au niveau du datastore est automatiquement assign\xe9e \xe0 toutes les dataclass. L'action de permission ",(0,r.jsx)(s.em,{children:"execute"})," d\xe9finie au niveau du datastore s'applique \xe0 toutes les fonctions du projet, y compris aux fonctions ",(0,r.jsx)(s.a,{href:"/docs/fr/REST/singleton",children:"singleton"}),"."]}),"\n",(0,r.jsx)(s.li,{children:"Une action de permission d\xe9finie au niveau dataclass remplace le param\xe9trage du datastore (le cas \xe9ch\xe9ant). Par d\xe9faut, tous les attributs de la dataclass h\xe9ritent des permissions de la dataclass."}),"\n",(0,r.jsx)(s.li,{children:'Contrairement aux permissions des dataclass, une action de permission d\xe9finie au niveau de l\'attribut ne remplace pas la permission de la dataclass parente, mais y est ajout\xe9e. Par exemple, si vous avez attribu\xe9 le privil\xe8ge "g\xe9n\xe9ral" \xe0 une dataclass et le privil\xe8ge "d\xe9tail" \xe0 un attribut de la dataclass, les deux privil\xe8ges, "g\xe9n\xe9ral" et "d\xe9tail", doivent \xeatre d\xe9finis dans la session afin d\'acc\xe9der \xe0 l\'attribut.'}),"\n"]}),"\n",(0,r.jsx)(s.admonition,{type:"info",children:(0,r.jsxs)(s.p,{children:["Les permissions contr\xf4lent l'acc\xe8s aux objets ou fonctions du datastore. Si vous voulez filtrer les donn\xe9es de lecture selon certains crit\xe8res, vous pouvez envisager d'utiliser les ",(0,r.jsx)(s.a,{href:"/docs/fr/ORDA/entities#restricting-entity-selections",children:"entity selections restreintes"})," qui peuvent \xeatre plus appropri\xe9es dans ce cas."]})}),"\n",(0,r.jsx)(s.h3,{id:"attribution-de-permissions-aux-fonctions-de-la-classe-orda",children:"Attribution de permissions aux fonctions de la classe ORDA"}),"\n",(0,r.jsxs)(s.p,{children:["Lors de la configuration des permissions, les fonctions de classe ORDA sont d\xe9clar\xe9es dans l'\xe9l\xe9ment ",(0,r.jsx)(s.code,{children:"applyTo"})," en utilisant la syntaxe suivante :"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:"<DataclassName>.<functionName>\n"})}),"\n",(0,r.jsx)(s.p,{children:"Par exemple, si vous voulez appliquer une permission \xe0 la fonction suivante :"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-4d",children:"// cs.CityEntity class\nClass extends Entity\n  Function getPopulation() : Integer\n   ...\n"})}),"\n",(0,r.jsx)(s.p,{children:"... vous devez \xe9crire :"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'"applyTo":"City.getPopulation"\n'})}),"\n",(0,r.jsxs)(s.p,{children:['Cela signifie que vous ne pouvez pas utiliser les m\xeames noms de fonctions dans les diff\xe9rentes classes ORDA (entit\xe9, entity selection, dataclass) si vous souhaitez que des privil\xe8ges leur soient attribu\xe9s. Dans ce cas, vous devez utiliser des noms de fonction distincts. Par exemple, si vous avez cr\xe9\xe9 une fonction "drop" dans les classes ',(0,r.jsx)(s.code,{children:"cs.CityEntity"})," et ",(0,r.jsx)(s.code,{children:"cs.CitySelection"}),", vous devez leur donner des noms diff\xe9rents tels que ",(0,r.jsx)(s.code,{children:"dropEntity()"})," et ",(0,r.jsx)(s.code,{children:"dropSelection()"}),'. Vous pouvez ensuite \xe9crire dans le fichier "roles.json" :']}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'	"permissions": {\n		"allowed": [\n			{\n				"applyTo": "City.dropEntity",\n				"type": "method",\n				"promote": [\n					"name"\n				]\n			},\n			{\n				"applyTo": "City.dropSelection",\n				"type": "method",\n				"promote": [\n					"name"\n				]\n			}\n    ]\n'})}),"\n",(0,r.jsx)(s.h2,{id:"privil\xe8ges-et-r\xf4les",children:"Privil\xe8ges et R\xf4les"}),"\n",(0,r.jsxs)(s.p,{children:["Un ",(0,r.jsx)(s.strong,{children:"privil\xe8ge"})," est la capacit\xe9 technique d'ex\xe9cuter des ",(0,r.jsx)(s.strong,{children:"actions"})," sur des ",(0,r.jsx)(s.strong,{children:"ressources"}),", tandis qu'un ",(0,r.jsx)(s.strong,{children:"r\xf4le"}),' est un privil\xe8ge public destin\xe9 \xe0 \xeatre utilis\xe9 par un administrateur. Fondamentalement, un r\xf4le rassemble plusieurs privil\xe8ges pour d\xe9finir un profil utilisateur m\xe9tier. Par exemple, "manageInvoices" pourrait \xeatre un privil\xe8ge tandis que "secr\xe9taire" pourrait \xeatre un r\xf4le (qui inclut "manageInvoices" et d\'autres privil\xe8ges).']}),"\n",(0,r.jsx)(s.p,{children:'Un privil\xe8ge ou un r\xf4le peut \xeatre associ\xe9 \xe0 plusieurs combinaisons "action + ressource". Plusieurs privil\xe8ges peuvent \xeatre associ\xe9s \xe0 une action. Un privil\xe8ge peut inclure d\'autres privil\xe8ges.'}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Vous ",(0,r.jsx)(s.strong,{children:"cr\xe9ez"})," des privil\xe8ges et/ou des r\xf4les dans le fichier ",(0,r.jsx)(s.code,{children:"roles.json"})," (voir ci-dessous). Vous ",(0,r.jsx)(s.strong,{children:"configurez"})," leur port\xe9e en les assignant aux actions de permission appliqu\xe9es aux ressources."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Vous ",(0,r.jsx)(s.strong,{children:"autorisez"})," les privil\xe8ges et/ou les r\xf4les pour chaque session utilisateur \xe0 l'aide de la fonction ",(0,r.jsx)(s.a,{href:"/docs/fr/API/SessionClass#setprivileges",children:(0,r.jsx)(s.code,{children:".setPrivileges()"})})," de la classe ",(0,r.jsx)(s.code,{children:"Session"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"exemple",children:"Exemple"}),"\n",(0,r.jsx)(s.p,{children:"Pour permettre un r\xf4le dans une session :"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-4d",children:'\nexposed Function authenticate($identifier : Text; $password : Text)->$result : Text\n\n    var $user : cs.UsersEntity\n\n    Session.clearPrivileges()\n\n    $result:="Your are authenticated as Guest"\n\n    $user:=ds.Users.query("identifier = :1"; $identifier).first()\n\n    If ($user#Null)\n        If (Verify password hash($password; $user.password))\n            Session.setPrivileges(New object("roles"; $user.role))\n            $result:="Your are authenticated as "+$user.role\n        End if\n    End if\n\n\n'})}),"\n",(0,r.jsx)(s.h2,{id:"rolesjson",children:(0,r.jsx)(s.code,{children:"roles.json"})}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"roles.json"})," file describes the whole web security settings for the project. La syntaxe du fichier ",(0,r.jsx)(s.code,{children:"roles.json"})," est la suivante:"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Nom de propri\xe9t\xe9"}),(0,r.jsx)(s.th,{}),(0,r.jsx)(s.th,{}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Obligatoire"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"privileges"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{}),(0,r.jsxs)(s.td,{children:["Collection d'objets ",(0,r.jsx)(s.code,{children:"privilege"})]}),(0,r.jsx)(s.td,{children:"X"}),(0,r.jsx)(s.td,{children:"Liste de privil\xe8ges d\xe9finis"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"[].privilege"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Text"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Nom de privil\xe8ge"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"[].includes"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Collection de cha\xeenes"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Liste de noms de privil\xe8ges inclus"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"roles"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{}),(0,r.jsxs)(s.td,{children:["Collection d'objets ",(0,r.jsx)(s.code,{children:"role"})]}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Liste de r\xf4les d\xe9finis"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"[].role"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Text"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Nom de r\xf4le"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"[].privileges"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Collection de cha\xeenes"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Liste de noms de privil\xe8ges inclus"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"permissions"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Object"}),(0,r.jsx)(s.td,{children:"X"}),(0,r.jsx)(s.td,{children:"Liste d'actions autoris\xe9es"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"allowed"}),(0,r.jsx)(s.td,{}),(0,r.jsxs)(s.td,{children:["Collection d'objets ",(0,r.jsx)(s.code,{children:"permission"})]}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Liste de permissions autoris\xe9es"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"[].applyTo"}),(0,r.jsx)(s.td,{children:"Text"}),(0,r.jsx)(s.td,{children:"X"}),(0,r.jsxs)(s.td,{children:["Nom de ",(0,r.jsx)(s.a,{href:"#resources",children:"ressource"})," cible"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"[].type"}),(0,r.jsx)(s.td,{children:"Text"}),(0,r.jsx)(s.td,{children:"X"}),(0,r.jsxs)(s.td,{children:["Type de ",(0,r.jsx)(s.a,{href:"#ressources",children:"ressource"}),' : "datastore", "dataclass", "attribute", "method", "singletonMethod", "singleton"']})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"[].read"}),(0,r.jsx)(s.td,{children:"Collection de cha\xeenes"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Liste de privil\xe8ges"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"[].create"}),(0,r.jsx)(s.td,{children:"Collection de cha\xeenes"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Liste de privil\xe8ges"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"[].update"}),(0,r.jsx)(s.td,{children:"Collection de cha\xeenes"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Liste de privil\xe8ges"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"[].drop"}),(0,r.jsx)(s.td,{children:"Collection de cha\xeenes"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Liste de privil\xe8ges"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"[].execute"}),(0,r.jsx)(s.td,{children:"Collection de cha\xeenes"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Liste de privil\xe8ges"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"[].promote"}),(0,r.jsx)(s.td,{children:"Collection de cha\xeenes"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Liste de privil\xe8ges"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"restrictedByDefault"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Boolean"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"If true, access to resources without explicit permissions is denied"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"forceLogin"}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{}),(0,r.jsx)(s.td,{children:"Boolean"}),(0,r.jsx)(s.td,{}),(0,r.jsxs)(s.td,{children:["If true, enables ",(0,r.jsx)(s.a,{href:"/docs/fr/REST/authUsers#force-login-mode",children:'"forceLogin" mode'})]})]})]})]}),"\n",(0,r.jsx)(s.admonition,{title:"Rappel",type:"caution",children:(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Le nom de privil\xe8ge \"WebAdmin\" est r\xe9serv\xe9 \xe0 l'application. Il est d\xe9conseill\xe9 d'utiliser ce nom pour les privil\xe8ges personnalis\xe9s."}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"privileges"})," and ",(0,r.jsx)(s.code,{children:"roles"})," names are case-insensitive."]}),"\n"]})}),"\n",(0,r.jsx)(s.h3,{id:"default-file-location-and-content",children:"Default File Location and Content"}),"\n",(0,r.jsxs)(s.p,{children:["When a new project is created, a default ",(0,r.jsx)(s.code,{children:"roles.json"})," file is generated at:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"<project folder>/Project/Sources/ \n"})}),"\n",(0,r.jsxs)(s.p,{children:["Voir la section ",(0,r.jsx)(s.a,{href:"/docs/fr/Project/architecture#sources",children:"Architecture"})," ."]}),"\n",(0,r.jsx)(s.p,{children:"Default content:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",metastring:'title="/Project/Sources/roles.json"',children:'\n{\n  "privileges": [\n  ],\n  "roles": [\n  ],\n  "permissions": {\n    "allowed": [\n      {\n        "applyTo": "ds",\n        "type": "datastore",\n        "read": [],\n        "create": [],\n        "update": [],\n        "drop": [],\n        "execute": [],\n        "promote": []\n      }\n    ]\n  },\n  "restrictedByDefault": false,\n  "forceLogin": false\n}\n'})}),"\n",(0,r.jsx)(s.admonition,{title:"Compatibilit\xe9",type:"note",children:(0,r.jsxs)(s.p,{children:["Dans les versions pr\xe9c\xe9dentes, le fichier ",(0,r.jsx)(s.code,{children:"roles.json"})," n'\xe9tait pas cr\xe9\xe9 par d\xe9faut. Depuis 4D 20 R6, lors de l'ouverture d'un projet existant qui ne contient pas de fichier ",(0,r.jsx)(s.code,{children:"roles.json"})," ou les param\xe8tres ",(0,r.jsx)(s.code,{children:'"forceLogin" : true'}),", le bouton ",(0,r.jsx)(s.strong,{children:"Activer l'authentification REST via la fonction ds.authentify()"})," est disponible dans la page ",(0,r.jsxs)(s.a,{href:"/docs/fr/settings/web#access",children:[(0,r.jsx)(s.strong,{children:"Fonctionnalit\xe9s Web"})," de la bo\xeete de dialogue Param\xe8tres"]}),". Ce bouton met automatiquement \xe0 jour vos param\xe8tres de s\xe9curit\xe9 (vous devrez peut-\xeatre modifier votre code, ",(0,r.jsx)(s.a,{href:"https://blog.4d.com/force-login-becomes-default-for-all-rest-auth/",children:"voir cet article de blog"}),")."]})}),"\n",(0,r.jsx)(s.admonition,{title:"Qodly Studio",type:"note",children:(0,r.jsxs)(s.p,{children:["In Qodly Studio for 4D, the login mode can be set using the ",(0,r.jsxs)(s.a,{href:"https://developer.4d.com/qodly/4DQodlyPro/force-login",children:[(0,r.jsx)(s.strong,{children:"Force login"})," option"]})," in the Roles and Privileges panel."]})}),"\n",(0,r.jsx)(s.h2,{id:"restriction-modes",children:"Restriction Modes"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"restrictedByDefault"})," property configures how every ",(0,r.jsx)(s.a,{href:"#resources",children:"resource"})," are accessed when ",(0,r.jsx)(s.a,{href:"#permission",children:"no specific permission is defined for it"}),":"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Unrestricted mode"})," (",(0,r.jsx)(s.code,{children:"restrictedByDefault"}),": ",(0,r.jsx)(s.strong,{children:"false"}),"): Resources without defined permissions are accessible to all requests. This mode is suitable for development environments where access can be gradually restricted."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Restricted mode"})," (",(0,r.jsx)(s.code,{children:"restrictedByDefault"}),": ",(0,r.jsx)(s.strong,{children:"true"}),"): Resources without defined permissions are blocked by default. This mode is recommended for production environments where access must be explicitly granted."]}),"\n"]}),"\n",(0,r.jsx)(s.admonition,{title:"Compatibilit\xe9",type:"note",children:(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["When ",(0,r.jsx)(s.strong,{children:"creating a new project"}),", the ",(0,r.jsx)(s.code,{children:"restrictedByDefault"})," property is set to ",(0,r.jsx)(s.strong,{children:"false"})," in the ",(0,r.jsx)(s.em,{children:"roles.json"})," file (see below). Keep in mind that this configuration is tailored for quick start and smooth development. In production environment, ",(0,r.jsxs)(s.a,{href:"#configuring-restrictedbydefault-and-forcelogin-properties",children:["it is recommended to set the ",(0,r.jsx)(s.code,{children:"restrictedByDefault"})," and ",(0,r.jsx)(s.code,{children:"forceLogin"})," properties to ",(0,r.jsx)(s.strong,{children:"true"})]}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["In ",(0,r.jsx)(s.strong,{children:"projects converted from previous releases"}),"; when enabling access to Qodly Studio using the ",(0,r.jsx)(s.a,{href:"https://developer.4d.com/qodly/4DQodlyPro/gettingStarted#one-click-configuration",children:"One-click configuration dialog"}),", the ",(0,r.jsx)(s.code,{children:"restrictedByDefault"})," property is added with value ",(0,r.jsx)(s.strong,{children:"true"})," in the ",(0,r.jsx)(s.em,{children:"roles.json"})," file."]}),"\n"]})}),"\n",(0,r.jsx)(s.h3,{id:"recommended-configuration",children:"Recommended Configuration"}),"\n",(0,r.jsx)(s.p,{children:"Depending on your environment, the recommended settings are:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Production"}),": Set both ",(0,r.jsx)(s.code,{children:"restrictedByDefault"})," and ",(0,r.jsx)(s.a,{href:"/docs/fr/REST/authUsers#force-login-mode",children:(0,r.jsx)(s.code,{children:"forceLogin"})})," to ",(0,r.jsx)(s.strong,{children:"true"}),". This ensures maximum security by requiring user authentication and explicitly defined permissions for resource access."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Development"}),": Set both ",(0,r.jsx)(s.code,{children:"restrictedByDefault"})," and ",(0,r.jsx)(s.a,{href:"/docs/fr/REST/authUsers#force-login-mode",children:(0,r.jsx)(s.code,{children:"forceLogin"})})," to ",(0,r.jsx)(s.strong,{children:"false"}),". This allows easier access during development and debugging, with the possibility to gradually apply restrictions."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"roles_errorsjson",children:(0,r.jsx)(s.code,{children:"Roles_Errors.json"})}),"\n",(0,r.jsxs)(s.p,{children:["Le fichier ",(0,r.jsx)(s.code,{children:"roles.json"})," est analys\xe9 par 4D au d\xe9marrage. Vous devez red\xe9marrer l'application pour que les modifications dans ce fichier soient prises en compte."]}),"\n",(0,r.jsxs)(s.p,{children:["En cas d'erreur(s) lors de l'analyse du fichier ",(0,r.jsx)(s.code,{children:"roles.json"}),", 4D charge le projet mais d\xe9sactive la protection globale d'acc\xe8s - cela permet au d\xe9veloppeur d'acc\xe9der aux fichiers et de corriger l'erreur. Un fichier d'erreur nomm\xe9 ",(0,r.jsx)(s.code,{children:"Roles_Errors.json"})," est g\xe9n\xe9r\xe9 dans le ",(0,r.jsxs)(s.a,{href:"/docs/fr/Project/architecture#logs",children:["dossier ",(0,r.jsx)(s.code,{children:"Logs"})," du projet"]})," et d\xe9crit les lignes d'erreur. Ce fichier est automatiquement supprim\xe9 lorsque le fichier ",(0,r.jsx)(s.code,{children:"roles.json"})," ne contient plus d'erreur."]}),"\n",(0,r.jsxs)(s.p,{children:["Il est recommand\xe9 de v\xe9rifier au d\xe9marrage si un fichier ",(0,r.jsx)(s.code,{children:"Roles_Errors.json"})," existe dans le dossier [Logs](.. Project/architecture.md#logs), ce qui signifie qu'il y a eu une erreur d'analyse et que les acc\xe8s ne seront pas limit\xe9s. Vous pouvez \xe9crire par exemple :"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-4d",metastring:'title="/Sources/DatabaseMethods/onStartup.4dm"',children:'If (Not(File("/LOGS/"+"Roles_Errors.json").exists))\n\u2026\nElse // vous pouvez emp\xeacher l\'ouverture du projet\n ALERT("The roles.json file is malformed or contains inconsistencies, the application will quit.")\n QUIT 4D\nEnd if\n'})}),"\n",(0,r.jsx)(s.h2,{id:"exemple-de-configuration-de-privil\xe8ges",children:"Exemple de configuration de privil\xe8ges"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",metastring:'title="/Project/Sources/roles.json"',children:'\n{\n	"forceLogin": true,\n	"restrictedByDefault": true,\n	"permissions": {\n		"allowed": [\n						{\n				"applyTo": "People",\n				"type": "dataclass",\n				"read": [\n					"viewPeople"\n				]\n			}\n		]\n	},\n	"privileges": [\n		{\n			"privilege": "viewPeople",\n			"includes": []\n		}\n	],\n	"roles": []\n}\n'})})]})}function u(e={}){let{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},653024:function(e,s,n){n.d(s,{A:()=>i});let i=n.p+"assets/images/privileges-schema-d5a0ecd16f6a60f344dbb09d12f2e271.png"},884429:function(e,s,n){n.d(s,{R:()=>d,x:()=>l});var i=n(296540);let r={},t=i.createContext(r);function d(e){let s=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);