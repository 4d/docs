"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["39418"],{727993:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>l,toc:()=>o,default:()=>h,metadata:()=>r,assets:()=>a,contentTitle:()=>d});var r=JSON.parse('{"id":"ORDA/orda-events","title":"\xc9v\xe8nements d\'entit\xe9","description":"Historique","source":"@site/i18n/fr/docusaurus-plugin-content-docs/version-21/ORDA/orda-events.md","sourceDirName":"ORDA","slug":"/ORDA/orda-events","permalink":"/docs/fr/ORDA/orda-events","draft":false,"unlisted":false,"editUrl":"https://github.com/4d/docs/issues/new?title=Comment%20on%20ORDA%2Forda-events.md%20(21)&body=Please%20enter%20your%20comment%3A","tags":[],"version":"21","frontMatter":{"id":"orda-events","title":"\xc9v\xe8nements d\'entit\xe9"},"sidebar":"docs","previous":{"title":"Travailler avec les donn\xe9es","permalink":"/docs/fr/ORDA/entities"},"next":{"title":"Utiliser le marqueur global","permalink":"/docs/fr/ORDA/global-stamp"}}'),s=t(785893),i=t(250065);let l={id:"orda-events",title:"\xc9v\xe8nements d'entit\xe9"},d=void 0,a={},o=[{value:"Vue d\u2019ensemble",id:"vue-densemble",level:2},{value:"Niveau de l&#39;\xe9v\xe9nement",id:"niveau-de-l\xe9v\xe9nement",level:3},{value:"Ex\xe9cution en configuration distante",id:"ex\xe9cution-en-configuration-distante",level:3},{value:"Tableau de synth\xe8se",id:"tableau-de-synth\xe8se",level:3},{value:"Param\xe8tre <em>event</em>",id:"param\xe8tre-event",level:2},{value:"Objet error",id:"objet-error",level:2},{value:"Propri\xe9t\xe9s de l&#39;objet error",id:"propri\xe9t\xe9s-de-lobjet-error",level:3},{value:"Description des fonctions",id:"description-des-fonctions",level:2},{value:"<code>Function event touched</code>",id:"function-event-touched",level:3},{value:"Syntaxe",id:"syntaxe",level:4},{value:"Exemple 1",id:"exemple-1",level:4},{value:"Exemple 2",id:"exemple-2",level:4},{value:"Example 3 (diagram): Client/server with the <code>local</code> keyword:",id:"example-3-diagram-clientserver-with-the-local-keyword",level:4},{value:"Example 4 (diagram): Client/server without the <code>local</code> keyword",id:"example-4-diagram-clientserver-without-the-local-keyword",level:4},{value:"Example 5 (diagram): Qodly application",id:"example-5-diagram-qodly-application",level:4},{value:"<code>Function event validateSave</code>",id:"function-event-validatesave",level:3},{value:"Syntaxe",id:"syntaxe-1",level:4},{value:"Exemple",id:"exemple",level:4},{value:"<code>Function event saving</code>",id:"function-event-saving",level:3},{value:"Syntaxe",id:"syntaxe-2",level:4},{value:"Exemple",id:"exemple-3",level:4},{value:"<code>Function event afterSave</code>",id:"function-event-aftersave",level:3},{value:"Syntaxe",id:"syntaxe-3",level:4},{value:"Exemple",id:"exemple-4",level:4},{value:"<code>Function event validateDrop</code>",id:"function-event-validatedrop",level:3},{value:"Syntaxe",id:"syntaxe-4",level:4},{value:"Exemple",id:"exemple-5",level:4},{value:"<code>Function event dropping</code>",id:"function-event-dropping",level:3},{value:"Syntaxe",id:"syntaxe-5",level:4},{value:"Exemple",id:"exemple-6",level:4},{value:"<code>Function event afterDrop</code>",id:"function-event-afterdrop",level:3},{value:"Syntaxe",id:"syntaxe-6",level:4},{value:"Exemple",id:"exemple-7",level:4}];function c(e){let n={a:"a",admonition:"admonition",code:"code",details:"details",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",summary:"summary",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.details,{children:[(0,s.jsx)(n.summary,{children:"Historique"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Release"}),(0,s.jsx)(n.th,{children:"Modifications"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"21"}),(0,s.jsx)(n.td,{children:"\xc9v\xe9nements ajout\xe9s : validateSave / saving / afterSave / validateDrop / dropping / afterDrop"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"20 R10"}),(0,s.jsx)(n.td,{children:"ajout \xe9v\xe9nement touched"})]})]})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Les \xe9v\xe9nements d'entit\xe9 sont des fonctions qui sont automatiquement invoqu\xe9es par ORDA chaque fois que des entit\xe9s et des attributs d'entit\xe9 sont touch\xe9s (ajout\xe9s, supprim\xe9s ou modifi\xe9s). Vous pouvez \xe9crire des \xe9v\xe9nements tr\xe8s simples, puis les rendre plus sophistiqu\xe9s."}),"\n",(0,s.jsx)(n.p,{children:"Vous ne pouvez pas d\xe9clencher directement l'ex\xe9cution d'une fonction d'\xe9v\xe9nement. Les \xe9v\xe9nements sont appel\xe9s automatiquement par ORDA en fonction des actions de l'utilisateur ou des op\xe9rations effectu\xe9es par le code sur les entit\xe9s et leurs attributs."}),"\n",(0,s.jsx)(n.admonition,{title:"Article(s) de blog sur le sujet",type:"tip",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://blog.4d.com/orda-handle-an-event-driven-logic-during-database-operations",children:"ORDA - G\xe9rer une logique \xe9v\xe9nementielle lors des actions de persistance des donn\xe9es"})})}),"\n",(0,s.jsx)(n.admonition,{title:"Note de compatibilit\xe9",type:"info",children:(0,s.jsx)(n.p,{children:"Les \xe9v\xe9nements d'entit\xe9 ORDA dans le magasin de donn\xe9es sont \xe9quivalents aux triggers dans la base de donn\xe9es 4D. Cependant, les actions d\xe9clench\xe9es au niveau de la base de donn\xe9es 4D \xe0 l'aide des commandes du langage classique 4D ou des actions standard ne d\xe9clenchent pas les \xe9v\xe9nements ORDA."})}),"\n",(0,s.jsx)(n.h2,{id:"vue-densemble",children:"Vue d\u2019ensemble"}),"\n",(0,s.jsx)(n.h3,{id:"niveau-de-l\xe9v\xe9nement",children:"Niveau de l'\xe9v\xe9nement"}),"\n",(0,s.jsxs)(n.p,{children:["Une fonction d'\xe9v\xe9nement d'entit\xe9 est toujours d\xe9finie dans la ",(0,s.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#entity-class",children:"classe Entity"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Un \xe9v\xe9nement peut \xeatre d\xe9fini au niveau de l'",(0,s.jsx)(n.strong,{children:"entit\xe9"})," et/ou de l'",(0,s.jsx)(n.strong,{children:"attribut"})," (y compris les ",(0,s.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#computed-attributes",children:(0,s.jsx)(n.strong,{children:"attributs calcul\xe9s"})}),"). Dans le premier cas, il sera d\xe9clench\xe9 pour tous les attributs de l'entit\xe9 ; dans l'autre cas, il ne sera d\xe9clench\xe9 que pour l'attribut cibl\xe9."]}),"\n",(0,s.jsx)(n.p,{children:"Pour un m\xeame \xe9v\xe9nement, vous pouvez d\xe9finir diff\xe9rentes fonctions pour diff\xe9rents attributs."}),"\n",(0,s.jsx)(n.p,{children:"Vous pouvez \xe9galement d\xe9finir le m\xeame \xe9v\xe9nement au niveau de l'attribut et de l'entit\xe9. L'\xe9v\xe9nement attribut est appel\xe9 en premier, puis l'\xe9v\xe9nement entit\xe9."}),"\n",(0,s.jsx)(n.h3,{id:"ex\xe9cution-en-configuration-distante",children:"Ex\xe9cution en configuration distante"}),"\n",(0,s.jsx)(n.p,{children:"En g\xe9n\xe9ral, les \xe9v\xe9nements ORDA sont ex\xe9cut\xe9s sur le serveur."}),"\n",(0,s.jsxs)(n.p,{children:["Cependant, dans une configuration client/serveur, la fonction d'\xe9v\xe9nement ",(0,s.jsx)(n.code,{children:"touched()"})," peut \xeatre ex\xe9cut\xe9e sur ",(0,s.jsx)(n.strong,{children:"le serveur ou le client"}),", en fonction de l'utilisation du mot-cl\xe9 ",(0,s.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#local-functions",children:(0,s.jsx)(n.code,{children:"local"})}),". Une impl\xe9mentation sp\xe9cifique c\xf4t\xe9 client permet de d\xe9clencher l'\xe9v\xe9nement sur le client."]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Les fonctions ORDA ",(0,s.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#class-constructor",children:(0,s.jsx)(n.code,{children:"constructor()"})})," sont toujours ex\xe9cut\xe9es sur le client."]})}),"\n",(0,s.jsxs)(n.p,{children:["With other remote configurations (i.e. ",(0,s.jsx)(n.a,{href:"https://developer.4d.com/qodly",children:"Qodly applications"}),", ",(0,s.jsx)(n.a,{href:"/docs/fr/REST/REST_requests",children:"REST API requests"}),", or requests through ",(0,s.jsx)(n.a,{href:"/docs/fr/commands/open-datastore",children:(0,s.jsx)(n.code,{children:"Open datastore"})}),"), the ",(0,s.jsx)(n.code,{children:"touched()"})," event function is always executed ",(0,s.jsx)(n.strong,{children:"server-side"}),". Cela signifie que vous devez vous assurer que le serveur peut \"voir\" qu'un attribut a \xe9t\xe9 touch\xe9 pour d\xe9clencher l'\xe9v\xe9nement (voir ci-dessous)."]}),"\n",(0,s.jsx)(n.h3,{id:"tableau-de-synth\xe8se",children:"Tableau de synth\xe8se"}),"\n",(0,s.jsx)(n.p,{children:"Le tableau suivant liste les \xe9v\xe9nements d'entit\xe9 ORDA ainsi que leurs r\xe8gles."}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Ev\xe9nement"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Niveau"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Nom de la fonction"}),(0,s.jsx)(n.th,{style:{textAlign:"center"},children:"(C/S) Ex\xe9cut\xe9 sur"}),(0,s.jsx)(n.th,{children:"Peut arr\xeater l'action en renvoyant une erreur"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Instanciation d'entit\xe9"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Entity"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#class-constructor-1",children:(0,s.jsx)(n.code,{children:"constructor()"})})}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"client"}),(0,s.jsx)(n.td,{children:"non"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Attribut touched"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Attribut"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"event touched <attrName>()"})}),(0,s.jsxs)(n.td,{style:{textAlign:"center"},children:["D\xe9pend du mot-cl\xe9 ",(0,s.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#local-functions",children:(0,s.jsx)(n.code,{children:"local"})})]}),(0,s.jsx)(n.td,{children:"non"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Entity"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"event touched()"})}),(0,s.jsxs)(n.td,{style:{textAlign:"center"},children:["D\xe9pend du mot-cl\xe9 ",(0,s.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#local-functions",children:(0,s.jsx)(n.code,{children:"local"})})]}),(0,s.jsx)(n.td,{children:"non"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Avant l'enregistrement d'une entit\xe9"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Attribut"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"validateSave <attrName>()"})}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"server"}),(0,s.jsx)(n.td,{children:"oui"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Entity"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"validateSave()"})}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"server"}),(0,s.jsx)(n.td,{children:"oui"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Pendant l'enregistrement d'une entit\xe9"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Attribut"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"saving <attrName>()"})}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"server"}),(0,s.jsx)(n.td,{children:"oui"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Entity"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"saving()"})}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"server"}),(0,s.jsx)(n.td,{children:"oui"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Apr\xe8s l'enregistrement d'une entit\xe9"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Entity"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"afterSave()"})}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"server"}),(0,s.jsx)(n.td,{children:"non"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Avant la suppression d'une entit\xe9"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Attribut"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"validateDrop <attrName>()"})}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"server"}),(0,s.jsx)(n.td,{children:"oui"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Entity"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"validateDrop()"})}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"server"}),(0,s.jsx)(n.td,{children:"oui"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Pendant la suppression d'une entit\xe9"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Attribut"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"dropping <attrName>()"})}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"server"}),(0,s.jsx)(n.td,{children:"oui"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"}}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Entity"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"dropping()"})}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"server"}),(0,s.jsx)(n.td,{children:"oui"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Apr\xe8s la suppression d'une entit\xe9"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Entity"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"afterDrop()"})}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"server"}),(0,s.jsx)(n.td,{children:"non"})]})]})]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["La fonction ",(0,s.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#class-constructor-1",children:(0,s.jsx)(n.code,{children:"constructor()"})})," n'est pas en soi une fonction d'\xe9v\xe9nement, mais elle est toujours appel\xe9e lorsqu'une nouvelle entit\xe9 est instanci\xe9e."]})}),"\n",(0,s.jsxs)(n.h2,{id:"param\xe8tre-event",children:["Param\xe8tre ",(0,s.jsx)(n.em,{children:"event"})]}),"\n",(0,s.jsxs)(n.p,{children:["Les fonctions d'\xe9v\xe9nement acceptent un seul objet ",(0,s.jsx)(n.em,{children:"event"})," comme param\xe8tre. Lorsque la fonction est appel\xe9e, le param\xe8tre est rempli avec diverses propri\xe9t\xe9s :"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Nom de propri\xe9t\xe9"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Disponibilit\xe9"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Type"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Description"}),(0,s.jsx)(n.th,{})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:'"kind"'}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Toujours"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:'Nom de l\'\xe9v\xe9nement : "touched", "validateSave", "saving", "afterSave", "validateDrop", "dropping", "afterDrop"'}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.em,{children:"attributeName"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:'Uniquement pour les \xe9v\xe9nements d\xe9finis au niveau des attributs ("validateSave", "saving", "validateDrop", "dropping")'}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsxs)(n.td,{style:{textAlign:"left"},children:["Nom de l'attribut (",(0,s.jsx)(n.em,{children:"ex."}),' "firstname")']}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.em,{children:"dataClassName"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Toujours"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsxs)(n.td,{style:{textAlign:"left"},children:["Nom du verre de donn\xe9es (",(0,s.jsx)(n.em,{children:"ex."}),' "Company")']}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:'"savedAttributes"'}),(0,s.jsxs)(n.td,{style:{textAlign:"left"},children:["Uniquement dans ",(0,s.jsx)(n.a,{href:"#function-event-aftersave",children:(0,s.jsx)(n.code,{children:"afterSave()"})})]}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Collection de cha\xeenes"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Noms des attributs correctement enregistr\xe9s"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:'"droppedAttributes"'}),(0,s.jsxs)(n.td,{style:{textAlign:"left"},children:["Uniquement dans ",(0,s.jsx)(n.a,{href:"#function-event-afterdrop",children:(0,s.jsx)(n.code,{children:"afterDrop()"})})]}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Collection de cha\xeenes"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Noms des attributs correctement supprim\xe9s"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:'"saveStatus"'}),(0,s.jsxs)(n.td,{style:{textAlign:"left"},children:["Uniquement dans ",(0,s.jsx)(n.a,{href:"#function-event-aftersave",children:(0,s.jsx)(n.code,{children:"afterSave()"})})]}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:'"success" si l\'enregistrement a r\xe9ussi, "failed" sinon'}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:'"dropStatus"'}),(0,s.jsxs)(n.td,{style:{textAlign:"left"},children:["Uniquement dans ",(0,s.jsx)(n.a,{href:"#function-event-afterdrop",children:(0,s.jsx)(n.code,{children:"afterDrop()"})})]}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:'"success" si la suppression a r\xe9ussi, "failed" sinon'}),(0,s.jsx)(n.td,{})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"objet-error",children:"Objet error"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"#summary-table",children:"Certaines fonctions d'\xe9v\xe9nement"})," peuvent renvoyer un ",(0,s.jsx)(n.strong,{children:"objet error"})," pour d\xe9clencher une erreur et arr\xeater l'action en cours."]}),"\n",(0,s.jsxs)(n.p,{children:["Lorsqu'une erreur survient dans un \xe9v\xe9nement, les autres \xe9v\xe9nements sont stopp\xe9s \xe0 la premi\xe8re erreur signal\xe9e et l'action (enregistrement pu suppression) est \xe9galement arr\xeat\xe9e. Cette erreur est envoy\xe9e avant d'autres erreurs potentielles telles que ",(0,s.jsx)(n.a,{href:"/docs/fr/API/EntityClass#save",children:"stamp has changed, entity locked"}),", etc."]}),"\n",(0,s.jsx)(n.h3,{id:"propri\xe9t\xe9s-de-lobjet-error",children:"Propri\xe9t\xe9s de l'objet error"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Propri\xe9t\xe9"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Fix\xe9 par le d\xe9veloppeur"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"errCode"}),(0,s.jsx)(n.td,{children:"Integer"}),(0,s.jsxs)(n.td,{children:["Identique \xe0 la commande ",(0,s.jsx)(n.a,{href:"/docs/fr/commands/last-errors",children:(0,s.jsx)(n.code,{children:"Last errors"})})]}),(0,s.jsx)(n.td,{children:"Oui"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"message"}),(0,s.jsx)(n.td,{children:"Text"}),(0,s.jsxs)(n.td,{children:["Identique \xe0 la commande ",(0,s.jsx)(n.a,{href:"/docs/fr/commands/last-errors",children:(0,s.jsx)(n.code,{children:"Last errors"})})]}),(0,s.jsx)(n.td,{children:"Oui"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"extraDescription"}),(0,s.jsx)(n.td,{children:"Object"}),(0,s.jsx)(n.td,{children:"Informations libres \xe0 d\xe9finir"}),(0,s.jsx)(n.td,{children:"Oui"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"seriousError"}),(0,s.jsx)(n.td,{children:"Boolean"}),(0,s.jsxs)(n.td,{children:["Utilis\xe9 uniquement avec les \xe9v\xe9nements de validation (voir ci-dessous). ",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"True"})," : cr\xe9e une ",(0,s.jsx)(n.a,{href:"/docs/fr/Concepts/error-handling#predictable-vs-unpredictable-errors",children:"erreur critique (impr\xe9visible)"})," et d\xe9clenche une exception. Ajoute le statut ",(0,s.jsx)(n.code,{children:"dk status serious validation error"})]}),(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"False"})," : cr\xe9e seulement une ",(0,s.jsx)(n.a,{href:"/docs/fr/Concepts/error-handling#predictable-vs-unpredictable-errors",children:"erreur silencieuse (pr\xe9visible)"}),". Ajoute le statut ",(0,s.jsx)(n.code,{children:"dk status validation failed"}),"."]})]}),(0,s.jsx)(n.td,{children:"Oui (par d\xe9faut : False)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"componentSignature"}),(0,s.jsx)(n.td,{children:"Text"}),(0,s.jsx)(n.td,{children:'Toujours "DBEV"'}),(0,s.jsx)(n.td,{children:"Non"})]})]})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Les ",(0,s.jsx)(n.a,{href:"/docs/fr/Concepts/error-handling#predictable-vs-unpredictable-errors",children:"erreurs critiques"})," sont empil\xe9es dans la collection de la propri\xe9t\xe9 ",(0,s.jsx)(n.code,{children:"errors"})," de l'objet ",(0,s.jsx)(n.strong,{children:"Result"})," renvoy\xe9 par les fonctions ",(0,s.jsx)(n.a,{href:"/docs/fr/API/EntityClass#save",children:(0,s.jsx)(n.code,{children:"save()"})})," ou ",(0,s.jsx)(n.a,{href:"/docs/fr/API/EntityClass#drop",children:(0,s.jsx)(n.code,{children:"drop()"})}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Dans le cas d'une erreur d\xe9clench\xe9e par un \xe9v\xe9nement ",(0,s.jsx)(n.strong,{children:"validate"}),", la propri\xe9t\xe9 ",(0,s.jsx)(n.code,{children:"seriousError"})," permet de choisir le niveau d'erreur \xe0 g\xe9n\xe9rer :\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Si ",(0,s.jsx)(n.strong,{children:"true"})," : une erreur critique est d\xe9clench\xe9e et doit \xeatre trait\xe9e par le ",(0,s.jsx)(n.a,{href:"/docs/fr/Concepts/error-handling#predictable-vs-unpredictable-errors",children:"code de traitement des erreurs"}),", tel qu'un ",(0,s.jsx)(n.a,{href:"/docs/fr/Concepts/error-handling#trycatchend-try",children:'"try catch"'}),". Dans l'objet r\xe9sultat de la fonction appelante, ",(0,s.jsx)(n.code,{children:"status"})," vaut ",(0,s.jsx)(n.code,{children:"dk status serious validation error"})," et ",(0,s.jsx)(n.code,{children:"statusText"})," vaut \"Serious Validation Error\". L'erreur est lev\xe9e \xe0 la fin de l'\xe9v\xe9nement et parvient au client qui demande l'action d'enregistrement/suppression (client REST par exemple)."]}),"\n",(0,s.jsxs)(n.li,{children:["Si ",(0,s.jsx)(n.strong,{children:"false"})," (d\xe9faut) : une ",(0,s.jsx)(n.a,{href:"/docs/fr/Concepts/error-handling#predictable-vs-unpredictable-errors",children:"erreur silencieuse (pr\xe9visible) est g\xe9n\xe9r\xe9e"}),". Elle ne d\xe9clenche aucune exception et n'est pas empil\xe9e dans les erreurs retourn\xe9es par la commande ",(0,s.jsx)(n.a,{href:"/docs/fr/commands/last-errors",children:(0,s.jsx)(n.code,{children:"Last errors"})}),". Dans l'objet r\xe9sultat de la fonction appelante, ",(0,s.jsx)(n.code,{children:"status"})," vaut ",(0,s.jsx)(n.code,{children:"dk status validation failed"})," et ",(0,s.jsx)(n.code,{children:"statusText"}),' vaut "Mild Validation Error".']}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Dans le cas d'une erreur d\xe9clench\xe9e par un \xe9v\xe9nement ",(0,s.jsx)(n.strong,{children:"saving/dropping"}),", lorsqu'un objet d'erreur est renvoy\xe9, l'erreur est toujours d\xe9finie comme critique, quelle que soit la valeur de la propri\xe9t\xe9 ",(0,s.jsx)(n.code,{children:"seriousError"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"description-des-fonctions",children:"Description des fonctions"}),"\n",(0,s.jsx)(n.h3,{id:"function-event-touched",children:(0,s.jsx)(n.code,{children:"Function event touched"})}),"\n",(0,s.jsx)(n.h4,{id:"syntaxe",children:"Syntaxe"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:"{local} Function event touched($event : Object)\n{local} Function event touched <attributeName>($event : Object)\n// code\n"})}),"\n",(0,s.jsx)(n.p,{children:"Cet \xe9v\xe9nement est d\xe9clench\xe9 chaque fois qu'une valeur est modifi\xe9e dans l'entit\xe9."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Si vous avez d\xe9fini la fonction au niveau de l'entit\xe9 (premi\xe8re syntaxe), elle est d\xe9clench\xe9e pour des modifications sur n'importe quel attribut de l'entit\xe9."}),"\n",(0,s.jsx)(n.li,{children:"Si vous avez d\xe9fini la fonction au niveau de l'attribut (deuxi\xe8me syntaxe), elle n'est d\xe9clench\xe9e que pour les modifications sur cet attribut."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Cet \xe9v\xe9nement est d\xe9clench\xe9 d\xe8s que le moteur de 4D Server / 4D d\xe9tecte une modification de la valeur de l'attribut qui peut \xeatre due aux actions suivantes :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["en ",(0,s.jsxs)(n.strong,{children:["client/serveur avec le ",(0,s.jsxs)(n.a,{href:"/docs/fr/ORDA/ordaClasses#local-functions",children:["mot-cl\xe9 ",(0,s.jsx)(n.code,{children:"local"})]})]})," ou en ",(0,s.jsx)(n.strong,{children:"4D mono-utilisateur"})," :\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"l'utilisateur saisit une valeur dans un formulaire 4D,"}),"\n",(0,s.jsxs)(n.li,{children:["le code 4D effectue une assignation avec l'op\xe9rateur ",(0,s.jsx)(n.code,{children:":="}),". L'\xe9v\xe9nement est \xe9galement d\xe9clench\xe9 en cas d'auto-assignation (",(0,s.jsx)(n.code,{children:"$entity.attribute:=$entity.attribute"}),")."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["en ",(0,s.jsxs)(n.strong,{children:["client/serveur sans le mot-cl\xe9 ",(0,s.jsx)(n.code,{children:"local"})]})," : du code 4D effectue une assignation avec l'op\xe9rateur ",(0,s.jsx)(n.code,{children:":="})," est ",(0,s.jsx)(n.a,{href:"/docs/fr/commands/execute-on-server",children:"ex\xe9cut\xe9 sur le serveur"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["en ",(0,s.jsxs)(n.strong,{children:["client/serveur sans le mot-cl\xe9 ",(0,s.jsx)(n.code,{children:"local"})]}),", une ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"https://developer.4d.com/qodly",children:"application Qodly"})})," ou ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/docs/fr/commands/open-datastore",children:"datastore distant"})})," : l'entit\xe9 est re\xe7ue sur le serveur 4D lors de l'appel d'une fonction ORDA (sur l'entit\xe9 ou avec l'entit\xe9 en tant que param\xe8tre). Cela signifie que vous devrez peut-\xeatre mettre en place une fonction ",(0,s.jsx)(n.em,{children:"refresh"})," ou ",(0,s.jsx)(n.em,{children:"preview"})," sur l'application distante qui envoie une requ\xeate ORDA au serveur et d\xe9clenche l'\xe9v\xe9nement."]}),"\n",(0,s.jsxs)(n.li,{children:["avec le serveur REST : la valeur est re\xe7ue sur le serveur REST avec une ",(0,s.jsx)(n.a,{href:"/docs/fr/REST/method#methodupdate",children:"requ\xeate REST"})," (",(0,s.jsx)(n.code,{children:"$method=update"}),")"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["La fonction re\xe7oit un objet ",(0,s.jsx)(n.a,{href:"#event-parameter",children:(0,s.jsx)(n.em,{children:"event"})})," en param\xe8tre."]}),"\n",(0,s.jsxs)(n.p,{children:["Si cette fonction ",(0,s.jsx)(n.a,{href:"../commands/throw",children:"g\xe9n\xe8re"})," une erreur, elle n'arr\xeatera pas l'action en cours."]}),"\n",(0,s.jsxs)(n.admonition,{type:"note",children:[(0,s.jsx)(n.p,{children:"Cet \xe9v\xe9nement est \xe9galement d\xe9clench\xe9 :"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["lorsque les attributs sont assign\xe9s par l'\xe9v\xe9nement ",(0,s.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#class-constructor-1",children:(0,s.jsx)(n.code,{children:"constructor()"})}),","]}),"\n",(0,s.jsxs)(n.li,{children:["lorsque les attributs sont modifi\xe9s via l'",(0,s.jsx)(n.a,{href:"/docs/fr/Admin/dataExplorer",children:"Explorateur de donn\xe9es"}),"."]}),"\n"]})]}),"\n",(0,s.jsx)(n.h4,{id:"exemple-1",children:"Exemple 1"}),"\n",(0,s.jsx)(n.p,{children:"You want to uppercase all text attributes of an entity when it is updated."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:"    //ProductsEntity class\nFunction event touched($event : Object)\n	\n	If (Value type(This[$event.attributeName])=Is text)\n		This[$event.attributeName]:=Uppercase(This[$event.attributeName])\n	End if \n"})}),"\n",(0,s.jsx)(n.h4,{id:"exemple-2",children:"Exemple 2"}),"\n",(0,s.jsxs)(n.p,{children:['The "touched" event is useful when it is not possible to write indexed query code in ',(0,s.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#function-query-attributename",children:(0,s.jsx)(n.code,{children:"Function query()"})})," for a ",(0,s.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#computed-attributes",children:"computed attribute"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["This is the case for example, when your ",(0,s.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#function-query-attributename",children:(0,s.jsx)(n.code,{children:"query"})})," function has to compare the value of different attributes from the same entity with each other. You must use formulas in the returned ORDA query -- which triggers sequential queries."]}),"\n",(0,s.jsx)(n.p,{children:"To fully understand this case, let's examine the following two calculated attributes:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:"Function get onGoing() : Boolean\n        return ((This.departureDate<=Current date) & (This.arrivalDate>=Current date))\n\nFunction get sameDay() : Boolean\n        return (This.departureDate=This.arrivalDate)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Even though they are very similar, these functions cannot be associated with identical queries because they do not compare the same types of values. The first compares attributes to a given value, while the second compares attributes to each other."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For the ",(0,s.jsx)(n.em,{children:"onGoing"})," attribute, the ",(0,s.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#function-query-attributename",children:(0,s.jsx)(n.code,{children:"query"})})," function is simple to write and uses indexed attributes:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'Function query onGoing($event : Object) : Object\n    var $operator : Text\n    var $myQuery : Text\n    var $onGoingValue : Boolean\n    var $parameters : Collection\n    $parameters:=New collection()\n\n    $operator:=$event.operator\n    Case of \n            : (($operator="=") | ($operator="==") | ($operator="==="))\n                $onGoingValue:=Bool($event.value)\n            : (($operator="!=") | ($operator="!=="))\n                $onGoingValue:=Not(Bool($event.value))\n            Else \n                return {query: ""; parameters: $parameters}\n    End case \n\n    $myQuery:=($onGoingValue) ? "departureDate <= :1 AND arrivalDate >= :1" : "departureDate > :1 OR arrivalDate < :1"\n        // the ORDA query string uses indexed attributes, it will be indexed\n    $parameters.push(Current date)\n    return {query: $myQuery; parameters: $parameters}\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For the ",(0,s.jsx)(n.em,{children:"sameDay"})," attribute, the ",(0,s.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#function-query-attributename",children:(0,s.jsx)(n.code,{children:"query"})})," function requires an ORDA query based on formulas and will be sequential:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'Function query sameDay($event : Object) : Text\n    var $operator : Text\n    var $sameDayValue : Boolean\n\n    $operator:=$event.operator\n    Case of \n        : (($operator="=") | ($operator="==") | ($operator="==="))\n            $sameDayValue:=Bool($event.value)\n        : (($operator="!=") | ($operator="!=="))\n            $sameDayValue:=Not(Bool($event.value))\n        Else \n            return ""\n        End case \n\n    return ($sameDayValue) ? "eval(This.departureDate = This.arrivalDate)" : "eval(This.departureDate != This.arrivalDate)"\n        // the ORDA query string uses a formula, it will not be indexed\n\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Using a ",(0,s.jsx)(n.strong,{children:"scalar"})," ",(0,s.jsx)(n.em,{children:"sameDay"}),' attribute updated when other attributes are "touched" will save time:']}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:"    //BookingEntity class\n\nFunction event touched departureDate($event : Object) \n\n    This.sameDay:=(This.departureDate = This.arrivalDate) \n//\n//\nFunction event touched arrivalDate($event : Object) \n\n    This.sameDay:=(This.departureDate = This.arrivalDate)\n\n"})}),"\n",(0,s.jsxs)(n.h4,{id:"example-3-diagram-clientserver-with-the-local-keyword",children:["Example 3 (diagram): Client/server with the ",(0,s.jsx)(n.code,{children:"local"})," keyword:"]}),"\n",(0,s.jsx)(n.mermaid,{value:'\nsequenceDiagram\n\n    Client->>+Server: $people:=ds.People.all().first()\n\n    Client->>+Client: $people.lastname:="Brown"\n   Note over Client: local Function event touched lastname($event : Object) <br>  This.lastname:=Uppercase(This.lastname)\n\nNote over Client:$people.lastname is uppercased\n\n    Client->>+Server: $people.apply()\n   \n   Note over Server: The $people entity is received with the lastname attribute uppercased\n'}),"\n",(0,s.jsxs)(n.h4,{id:"example-4-diagram-clientserver-without-the-local-keyword",children:["Example 4 (diagram): Client/server without the ",(0,s.jsx)(n.code,{children:"local"})," keyword"]}),"\n",(0,s.jsx)(n.mermaid,{value:'\nsequenceDiagram\n\n    Client->>+Server: $people:=ds.People.all().first()\n\n    Client->>+Client: $people.lastname:="Brown"\n\n   Note over Client:$people.lastname is not uppercased\n\n    Client->>+Server: $people.apply()\n\n   Note over Server: Function event touched lastname($event : Object) <br>  This.lastname:=Uppercase(This.lastname)\n\n    Server--\x3e>-Client: The $people entity is updated\n\n   Note over Client:$people.lastname is uppercased\n\n'}),"\n",(0,s.jsx)(n.h4,{id:"example-5-diagram-qodly-application",children:"Example 5 (diagram): Qodly application"}),"\n",(0,s.jsx)(n.mermaid,{value:"\nsequenceDiagram\n\nQodly page->>+ Server: Get an entity into the People Qodly source\n\nQodly page->>+Qodly page: The user updates People.lastname\n\nNote over Qodly page: The People Qodly source lastname attribute is not uppercased\n\nQodly page->>+ Server: Function call People.apply()\n\nNote over Server: Function event touched lastname($event : Object) <br> This.lastname:=Uppercase(This.lastname)\n\nServer--\x3e>-Qodly page: The People Qodly source is updated\nNote over Qodly page: The People Qodly source lastname attribute is uppercased\n\n"}),"\n",(0,s.jsx)(n.h3,{id:"function-event-validatesave",children:(0,s.jsx)(n.code,{children:"Function event validateSave"})}),"\n",(0,s.jsx)(n.h4,{id:"syntaxe-1",children:"Syntaxe"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:"Function event validateSave($event : Object)\nFunction event validateSave <attributeName>($event : Object)\n// code\n"})}),"\n",(0,s.jsx)(n.p,{children:"This event is triggered each time an entity is about to be saved."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"if you defined the function at the entity level (first syntax), it is called for any attribute of the entity."}),"\n",(0,s.jsxs)(n.li,{children:["if you defined the function at the attribute level (second syntax), it is called only for this attribute. This function is ",(0,s.jsx)(n.strong,{children:"not"})," executed if the attribute has not been touched in the entity."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["La fonction re\xe7oit un objet ",(0,s.jsx)(n.a,{href:"#event-parameter",children:(0,s.jsx)(n.em,{children:"event"})})," en param\xe8tre."]}),"\n",(0,s.jsx)(n.p,{children:"This event is triggered by the following functions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/fr/API/EntityClass#save",children:(0,s.jsx)(n.code,{children:"entity.save()"})})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/fr/API/DataClassClass#fromcollection",children:(0,s.jsx)(n.code,{children:"dataClass.fromCollection()"})})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This event is triggered ",(0,s.jsx)(n.strong,{children:"before"}),' the entity is actually saved and lets you check data consistency so that you can stop the action if needed. For example, you can check in this event that "departure date" < "arrival date".']}),"\n",(0,s.jsxs)(n.p,{children:["To stop the action, the code of the function must return an ",(0,s.jsx)(n.a,{href:"#error-object",children:"error object"}),"."]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["It is not recommended to update the entity within this function (using ",(0,s.jsx)(n.code,{children:"This"}),")."]})}),"\n",(0,s.jsx)(n.h4,{id:"exemple",children:"Exemple"}),"\n",(0,s.jsx)(n.p,{children:"In this example, it is not allowed to save a product with a margin lower than 50%. In case of an invalid price attribute, you return an error object and thus, stop the save action."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'// ProductsEntity class\n//\n// validateSave event at attribute level\nFunction event validateSave margin($event : Object) : Object\n	\nvar $result : Object\n	\n//The user can\'t create a product whose margin is < 50%\nIf (This.margin<50)\n	$result:={errCode: 1; message: "The validation of this product failed"; \\\n	extraDescription: {info: "The margin of this product ("+String(This.margin)+") is lower than 50%"}; seriousError: False}\nEnd if \nreturn $result\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"function-event-saving",children:(0,s.jsx)(n.code,{children:"Function event saving"})}),"\n",(0,s.jsx)(n.h4,{id:"syntaxe-2",children:"Syntaxe"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:"Function event saving($event : Object)\nFunction event saving <attributeName>($event : Object)\n// code\n"})}),"\n",(0,s.jsx)(n.p,{children:"This event is triggered each time an entity is being saved."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If you defined the function at the entity level (first syntax), it is called for any attribute of the entity. The function is executed even if no attribute has been touched in the entity (e.g. in case of sending data to an external app each time a save is done)."}),"\n",(0,s.jsxs)(n.li,{children:["If you defined the function at the attribute level (second syntax), it is called only for this attribute. The function is ",(0,s.jsx)(n.strong,{children:"not"})," executed if the attribute has not been touched in the entity."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["La fonction re\xe7oit un objet ",(0,s.jsx)(n.a,{href:"#event-parameter",children:(0,s.jsx)(n.em,{children:"event"})})," en param\xe8tre."]}),"\n",(0,s.jsx)(n.p,{children:"This event is triggered by the following functions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/fr/API/EntityClass#save",children:(0,s.jsx)(n.code,{children:"entity.save()"})})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/fr/API/DataClassClass#fromcollection",children:(0,s.jsx)(n.code,{children:"dataClass.fromCollection()"})})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This event is triggered ",(0,s.jsx)(n.strong,{children:"while"})," the entity is actually saved. If a ",(0,s.jsx)(n.a,{href:"#function-event-validatesave",children:(0,s.jsx)(n.code,{children:"validateSave()"})})," event function was defined, the ",(0,s.jsx)(n.code,{children:"saving()"})," event function is called if no error was triggered by ",(0,s.jsx)(n.code,{children:"validateSave()"}),". For example, you can use this event to create a document on a Google Drive account."]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["The business logic should raise errors which can't be detected during the ",(0,s.jsx)(n.code,{children:"validateSave()"})," events, e.g. a network error"]})}),"\n",(0,s.jsx)(n.p,{children:"During the save action, 4D engine errors can be raised (index, stamp has changed, not enough space on disk)."}),"\n",(0,s.jsxs)(n.p,{children:["To stop the action, the code of the function must return an ",(0,s.jsx)(n.a,{href:"#error-object",children:"error object"}),"."]}),"\n",(0,s.jsx)(n.h4,{id:"exemple-3",children:"Exemple"}),"\n",(0,s.jsx)(n.p,{children:"When a file is saved on disk, catch errors related to disk space for example."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'// ProductsEntity class\n// saving event at attribute level\nFunction event saving userManualPath($event : Object) : Object\n	\nvar $result : Object\nvar $userManualFile : 4D.File\nvar $fileCreated : Boolean\n	\nIf (This.userManualPath#"")\n	$userManualFile:=File(This.userManualPath)\n				\n	// The user manual document file is created on the disk\n	// This may fail if no more space is available\n	Try\n		$fileCreated:=$userManualFile.create() \n	Catch\n		// No more room on disk for example\n		$result:={/\n            errCode: 1; message: "Error during the save action for this product"; /\n            extraDescription: {info: "There is no available space on disk to store the user manual"}/\n        }\n	End try\nEnd if \n	\nreturn $result\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"function-event-aftersave",children:(0,s.jsx)(n.code,{children:"Function event afterSave"})}),"\n",(0,s.jsx)(n.h4,{id:"syntaxe-3",children:"Syntaxe"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:"Function event afterSave($event : Object)\n// code\n"})}),"\n",(0,s.jsx)(n.p,{children:"This event is triggered just after an entity is saved in the data file, when at least one attribute was modified. It is not executed if no attribute has been touched in the entity."}),"\n",(0,s.jsx)(n.p,{children:"This event is useful after saving data to propagate the save action outside the application or to execute administration tasks. For example, it can be used to send a confirmation email after data have been saved. Or, in case of error while saving data, it can make a rollback to restore a consistent state of data."}),"\n",(0,s.jsxs)(n.p,{children:["La fonction re\xe7oit un objet ",(0,s.jsx)(n.a,{href:"#event-parameter",children:(0,s.jsx)(n.em,{children:"event"})})," en param\xe8tre."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["To avoid infinite loops, calling a ",(0,s.jsx)(n.a,{href:"/docs/fr/API/EntityClass#save",children:(0,s.jsx)(n.code,{children:"save()"})})," on the current entity (through ",(0,s.jsx)(n.code,{children:"This"}),") in this function is ",(0,s.jsx)(n.strong,{children:"not allowed"}),". It will raise an error."]}),"\n",(0,s.jsxs)(n.li,{children:["Throwing an ",(0,s.jsx)(n.a,{href:"#error-object",children:"error object"})," is ",(0,s.jsx)(n.strong,{children:"not supported"})," by this function."]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"exemple-4",children:"Exemple"}),"\n",(0,s.jsxs)(n.p,{children:["If an error occurred in the above saving event, the attribute value is reset accordingly in the ",(0,s.jsx)(n.code,{children:"afterSave"})," event:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'// ProductsEntity class\nFunction event afterSave($event : Object)\n	\nIf (($event.status.success=False) && ($event.status.errors=Null))  \n    // $event.status.errors is filled if the error comes from the validateSave event\n		\n	// The userManualPath attribute has not been properly saved\n	// Its value is reset\n	If ($event.savedAttributes.indexOf("userManualPath")=-1)\n		This.userManualPath:=""\n		This.status:="KO"\n	End if \n		\nEnd if \n'})}),"\n",(0,s.jsx)(n.h3,{id:"function-event-validatedrop",children:(0,s.jsx)(n.code,{children:"Function event validateDrop"})}),"\n",(0,s.jsx)(n.h4,{id:"syntaxe-4",children:"Syntaxe"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:"Function event validateDrop($event : Object)\nFunction event validateDrop <attributeName>($event : Object)\n// code\n"})}),"\n",(0,s.jsx)(n.p,{children:"This event is triggered each time an entity is about to be dropped."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If you defined the function at the entity level (first syntax), it is called for any attribute of the entity."}),"\n",(0,s.jsx)(n.li,{children:"If you defined the function at the attribute level (second syntax), it is called only for this attribute."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["La fonction re\xe7oit un objet ",(0,s.jsx)(n.a,{href:"#event-parameter",children:(0,s.jsx)(n.em,{children:"event"})})," en param\xe8tre."]}),"\n",(0,s.jsx)(n.p,{children:"This event is triggered by the following features:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/fr/API/EntityClass#drop",children:(0,s.jsx)(n.code,{children:"entity.drop()"})})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/fr/API/DataClassClass#fromcollection",children:(0,s.jsx)(n.code,{children:"entitySelection.drop()"})})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://doc.4d.com/4Dv20/4D/20.2/Relation-properties.300-6750290.en.html#107320",children:"deletion control rules"})," that can be defined at the database structure level."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This event is triggered ",(0,s.jsx)(n.strong,{children:"before"})," the entity is actually dropped, allowing you to check data consistency and if necessary, to stop the drop action."]}),"\n",(0,s.jsxs)(n.p,{children:["To stop the action, the code of the function must return an ",(0,s.jsx)(n.a,{href:"#error-object",children:"error object"}),"."]}),"\n",(0,s.jsx)(n.h4,{id:"exemple-5",children:"Exemple"}),"\n",(0,s.jsx)(n.p,{children:'In this example, it is not allowed to drop a product that is not labelled "TO DELETE". In this case, you return an error object and thus, stop the drop action.'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'// ProductsEntity class\n\nFunction event validateDrop status($event : Object) : Object\n\nvar $result : Object\n\n// Products must be marked as TO DELETE to be dropped\nIf (This.status#"TO DELETE")\n    $result:={errCode: 1; message: "You can\'t drop this product"; \\\n    extraDescription: {info: "This product must be marked as To Delete"}; seriousError: False}\nEnd if \n\nreturn $result\n'})}),"\n",(0,s.jsx)(n.h3,{id:"function-event-dropping",children:(0,s.jsx)(n.code,{children:"Function event dropping"})}),"\n",(0,s.jsx)(n.h4,{id:"syntaxe-5",children:"Syntaxe"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:"Function event dropping($event : Object)\nFunction event dropping <attributeName>($event : Object)\n// code\n"})}),"\n",(0,s.jsx)(n.p,{children:"This event is triggered each time an entity is being dropped."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If you defined the function at the entity level (first syntax), it is called for any attribute of the entity."}),"\n",(0,s.jsx)(n.li,{children:"If you defined the function at the attribute level (second syntax), it is called only for this attribute."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["La fonction re\xe7oit un objet ",(0,s.jsx)(n.a,{href:"#event-parameter",children:(0,s.jsx)(n.em,{children:"event"})})," en param\xe8tre."]}),"\n",(0,s.jsx)(n.p,{children:"This event is triggered by the following features:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/fr/API/EntityClass#drop",children:(0,s.jsx)(n.code,{children:"entity.drop()"})})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/fr/API/DataClassClass#fromcollection",children:(0,s.jsx)(n.code,{children:"entitySelection.drop()"})})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://doc.4d.com/4Dv20/4D/20.2/Relation-properties.300-6750290.en.html#107320",children:"deletion control rules"})," that can be defined at the database structure level."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This event is triggered ",(0,s.jsx)(n.strong,{children:"while"})," the entity is actually dropped. If a ",(0,s.jsx)(n.a,{href:"#function-event-validatedrop",children:(0,s.jsx)(n.code,{children:"validateDrop()"})})," event function was defined, the ",(0,s.jsx)(n.code,{children:"dropping()"})," event function is called if no error was triggered by ",(0,s.jsx)(n.code,{children:"validateDrop()"}),"."]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["The business logic should raise errors which cannot be detected during the ",(0,s.jsx)(n.code,{children:"validateDrop()"})," events, e.g. a network error."]})}),"\n",(0,s.jsxs)(n.p,{children:["To stop the action, the code of the function must return an ",(0,s.jsx)(n.a,{href:"#error-object",children:"error object"}),"."]}),"\n",(0,s.jsx)(n.h4,{id:"exemple-6",children:"Exemple"}),"\n",(0,s.jsxs)(n.p,{children:["Here is an example of ",(0,s.jsx)(n.code,{children:"dropping"})," event at entity level:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'// ProductsEntity class\nFunction event dropping($event : Object) : Object\n\nvar $result : Object\nvar $userManualFile : 4D.File\n\n$userManualFile:=File(This.userManualPath)\n\n    // When dropping a product, its user manual is also deleted on the disk\n    // This action may fail\nTry\n    If ($userManualFile.exists)\n        $userManualFile.delete()\n    End if \nCatch\n    // Dropping the user manual failed\n    $result:={errCode: 1; message: "Drop failed"; extraDescription: {info: "The user manual can\'t be dropped"}}\nEnd try\n\nreturn $result\n'})}),"\n",(0,s.jsx)(n.h3,{id:"function-event-afterdrop",children:(0,s.jsx)(n.code,{children:"Function event afterDrop"})}),"\n",(0,s.jsx)(n.h4,{id:"syntaxe-6",children:"Syntaxe"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:"Function event afterDrop($event : Object)\n// code\n"})}),"\n",(0,s.jsx)(n.p,{children:"This event is triggered just after an entity is dropped."}),"\n",(0,s.jsx)(n.p,{children:"This event is useful after dropping data to propagate the drop action outside the application or to execute administration tasks. For example, it can be used to send a cancellation email after data have been dropped. Or, in case of error while dropping data, it can log an information for the administrator to check data consistency."}),"\n",(0,s.jsxs)(n.p,{children:["La fonction re\xe7oit un objet ",(0,s.jsx)(n.a,{href:"#event-parameter",children:(0,s.jsx)(n.em,{children:"event"})})," en param\xe8tre."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["To avoid infinite loops, calling a ",(0,s.jsx)(n.a,{href:"/docs/fr/API/EntityClass#drop",children:(0,s.jsx)(n.code,{children:"drop()"})})," on the current entity (through ",(0,s.jsx)(n.code,{children:"This"}),") in this function is ",(0,s.jsx)(n.strong,{children:"not allowed"}),". It will raise an error."]}),"\n",(0,s.jsxs)(n.li,{children:["Throwing an ",(0,s.jsx)(n.a,{href:"#error-object",children:"error object"})," is ",(0,s.jsx)(n.strong,{children:"not supported"})," by this function."]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["The dropped entity is referenced by ",(0,s.jsx)(n.code,{children:"This"})," and still exists in memory."]})}),"\n",(0,s.jsx)(n.h4,{id:"exemple-7",children:"Exemple"}),"\n",(0,s.jsx)(n.p,{children:"If the drop action failed, then the product must be checked manually:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'Function event afterDrop($event : Object)\n\nvar $status : Object\n\nIf (($event.status.success=False) && ($event.status.errors=Null)) \n        //$event.status.errors is filled \n        //if the error comes from the validateDrop event\n    This.status:="Check this product - Drop action failed"\n    $status:=This.save()\nEnd if \n\n'})})]})}function h(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},250065:function(e,n,t){t.d(n,{Z:()=>d,a:()=>l});var r=t(667294);let s={},i=r.createContext(s);function l(e){let n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);