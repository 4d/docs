"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[30984],{603905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(667294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=s(n),m=r,k=c["".concat(p,".").concat(m)]||c[m]||d[m]||l;return n?a.createElement(k,o(o({ref:t},u),{},{components:n})):a.createElement(k,o({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=c;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var s=2;s<l;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},856794:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>p,toc:()=>u});n(667294);var a=n(603905);function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const o={id:"WebSocketServerClass",title:"WebSocketServer"},i=void 0,p={unversionedId:"API/WebSocketServerClass",id:"version-20-R5/API/WebSocketServerClass",title:"WebSocketServer",description:"La classe WebSocketServer vous permet de cr\xe9er et configurer un serveur WebSocket en 4D. Une fois que le serveur WebSocket 4D est actif, vous pouvez ouvrir et utiliser des connexions WebSocket entre 4D et les clients en utilisant la classe WebSocketConnection.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-20-R5/API/WebSocketServerClass.md",sourceDirName:"API",slug:"/API/WebSocketServerClass",permalink:"/docs/fr/API/WebSocketServerClass",draft:!1,editUrl:"https://github.com/4d/docs/issues/new?title=Comment%20on%20API%2FWebSocketServerClass.md%20(20-R5)&body=Please%20enter%20your%20comment%3A",tags:[],version:"20-R5",frontMatter:{id:"WebSocketServerClass",title:"WebSocketServer"},sidebar:"docs",previous:{title:"WebSocketConnection",permalink:"/docs/fr/API/WebSocketConnectionClass"},next:{title:"ZIPArchive",permalink:"/docs/fr/API/ZipArchiveClass"}},s={},u=[{value:"Conditions requises",id:"conditions-requises",level:3},{value:"Exemple",id:"exemple",level:3},{value:"Objet WebSocketServer",id:"objet-websocketserver",level:3},{value:"4D.WebSocketServer.new()",id:"4dwebsocketservernew",level:2},{value:"Param\xe8tre <em>WSSHandler</em>",id:"param\xe8tre-wsshandler",level:3},{value:"Exemple de classe <code>WSSHandler</code>",id:"exemple-de-classe-wsshandler",level:3},{value:"Objet <code>request</code>",id:"objet-request",level:3},{value:"Objet <code>connectionHandler</code>",id:"objet-connectionhandler",level:3},{value:"Exemple de classe <code>connectionHandler</code>",id:"exemple-de-classe-connectionhandler",level:3},{value:"Param\xe8tre <em>options</em>",id:"param\xe8tre-options",level:3},{value:".connections",id:"connections",level:2},{value:"Description",id:"description",level:4},{value:".dataType",id:"datatype",level:2},{value:"Description",id:"description-1",level:4},{value:".handler",id:"handler",level:2},{value:"Description",id:"description-2",level:4},{value:".path",id:"path",level:2},{value:"Description",id:"description-3",level:4},{value:".terminate()",id:"terminate",level:2},{value:"Description",id:"description-4",level:4},{value:".terminated",id:"terminated",level:2},{value:"Description",id:"description-5",level:4}],d={toc:u};function c(e){var{components:t}=e,n=l(e,["components"]);return(0,a.kt)("wrapper",r({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"La classe ",(0,a.kt)("inlineCode",{parentName:"p"},"WebSocketServer")," vous permet de cr\xe9er et configurer un serveur WebSocket en 4D. Une fois que le serveur WebSocket 4D est actif, vous pouvez ouvrir et utiliser des connexions WebSocket entre 4D et les clients en utilisant la classe ",(0,a.kt)("a",r({parentName:"p"},{href:"/docs/fr/API/WebSocketConnectionClass"}),(0,a.kt)("inlineCode",{parentName:"a"},"WebSocketConnection")),"."),(0,a.kt)("details",null,(0,a.kt)("summary",null,"Historique"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Release"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Modifications"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"20"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Ajout"))))),(0,a.kt)("admonition",r({},{title:"\xc0 propos des serveurs WebSocket",type:"note"}),(0,a.kt)("p",{parentName:"admonition"},"Le protocole WebSocket fournit un canal de communication full-duplex entre un serveur WebSocket et un client (par exemple un navigateur Web). Pour plus d'informations sur les serveurs WebSocket, lisez ",(0,a.kt)("a",r({parentName:"p"},{href:"https://en.wikipedia.org/wiki/WebSocket"}),"cette page sur Wikipedia"),".")),(0,a.kt)("admonition",r({},{title:"Voir \xe9galement",type:"info"}),(0,a.kt)("p",{parentName:"admonition"},"Voir \xe9galement ",(0,a.kt)("a",r({parentName:"p"},{href:"https://blog.4d.com/new-built-in-websocket-server/"}),"cet article de blog")," sur le serveur WebSocket 4D.")),(0,a.kt)("h3",r({},{id:"conditions-requises"}),"Conditions requises"),(0,a.kt)("p",null,"Pour cr\xe9er et g\xe9rer votre serveur WebSocket dans 4D, vous devrez utiliser deux classes int\xe9gr\xe9es \xe0 4D :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"cette classe (",(0,a.kt)("inlineCode",{parentName:"li"},"4D.WebSocketServer"),") pour g\xe9rer le serveur lui-m\xeame,"),(0,a.kt)("li",{parentName:"ul"},"la classe ",(0,a.kt)("a",r({parentName:"li"},{href:"/docs/fr/API/WebSocketConnectionClass"}),(0,a.kt)("inlineCode",{parentName:"a"},"4D.WebSocketConnection"))," pour g\xe9rer les connexions et les messages.")),(0,a.kt)("p",null,"De plus, vous devrez cr\xe9er deux classes utilisateurs qui contiendront les fonctions de callback :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"une classe utilisateur pour g\xe9rer les connexions serveur,"),(0,a.kt)("li",{parentName:"ul"},"une classe utilisateur pour g\xe9rer les messages.")),(0,a.kt)("p",null,"Vous devez ",(0,a.kt)("a",r({parentName:"p"},{href:"#4dwebsocketservernew"}),"cr\xe9er le serveur WebSocket")," au sein d'un ",(0,a.kt)("a",r({parentName:"p"},{href:"https://doc.4d.com/4dv20/help/command/fr/page1389.html"}),"worker")," pour maintenir la connexion active."),(0,a.kt)("p",null,"Le ",(0,a.kt)("a",r({parentName:"p"},{href:"/docs/fr/API/WebServerClass"}),"serveur Web 4D")," doit \xeatre d\xe9marr\xe9."),(0,a.kt)("h3",r({},{id:"exemple"}),"Exemple"),(0,a.kt)("p",null,"Dans cet exemple de base, notre serveur WebSocket renverra les messages en majuscules."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Cr\xe9ez le serveur WebSocket en utilisant un worker (obligatoire) et passez votre classe de connexion serveur en tant que param\xe8tre :")),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-4d"}),'// Cr\xe9er une instance de la classe utilisateur\n    // qui g\xe9rera les connexions vers le serveur\nvar $handler: cs.myServerHandler\n$handler := cs.myServerHandler.new()\n\nCALL WORKER("WebSocketServer"; Formula(wss := 4D.WebSocketServer.new($handler)))\n    // attribuer une variable (wss) au WebSocket vous permet\n    // d\'appeler wss.terminate() par la suite.\n')),(0,a.kt)("ol",r({},{start:2}),(0,a.kt)("li",{parentName:"ol"},"D\xe9finissez la classe utilisateur ",(0,a.kt)("inlineCode",{parentName:"li"},"myServerHandler")," contenant la ou les fonction(s) de rappel utilis\xe9e(s) pour g\xe9rer les connexions au serveur :")),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-4d"}),"// Classe myServerHandler\n\nFunction onConnection($wss: Object; $event: Object): Object\n    // retourne une instance de la classe utilisateur\n    // qui traitera les messages\n    return cs.myConnectionHandler.new()\n")),(0,a.kt)("ol",r({},{start:3}),(0,a.kt)("li",{parentName:"ol"},"D\xe9finissez la classe utilisateur ",(0,a.kt)("inlineCode",{parentName:"li"},"myConnectionHandler")," contenant la ou les fonction(s) de callback utilis\xe9e(s) pour g\xe9rer les messages :")),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-4d"}),"// Classe myConnectionHandler\n\nFunction onMessage($ws : 4D.WebSocketConnection; $message : Object)\n    // renvoie le message en majuscules\n    $ws.send(Uppercase($message.data))\n")),(0,a.kt)("admonition",r({},{title:"JS C\xf4t\xe9 client",type:"tip"}),(0,a.kt)("p",{parentName:"admonition"},"Voir ",(0,a.kt)("a",r({parentName:"p"},{href:"https://blog.4d.com/websocket-server/"}),"cet article de blog")," pour un exemple de code Javascript c\xf4t\xe9 client g\xe9rant une connexion WebSocket.")),(0,a.kt)("h3",r({},{id:"objet-websocketserver"}),"Objet WebSocketServer"),(0,a.kt)("p",null,"Les objets WebSocketServer offrent les propri\xe9t\xe9s et fonctions suivantes :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null})))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#connections"}),(0,a.kt)("strong",{parentName:"a"},".connections")," : Collection"),"&","nbsp;","&","nbsp;","&","nbsp;","&","nbsp;toutes les connexions courantes g\xe9r\xe9es par le serveur WebSocket")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#dataType"}),(0,a.kt)("strong",{parentName:"a"},".dataType")," : Text"),"&","nbsp;","&","nbsp;","&","nbsp;","&","nbsp;le type de donn\xe9es re\xe7ues ou envoy\xe9es")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#handler"}),(0,a.kt)("strong",{parentName:"a"},".handler")," : Object"),"&","nbsp;","&","nbsp;","&","nbsp;","&","nbsp;l'accesseur qui r\xe9cup\xe8re l'objet ",(0,a.kt)("inlineCode",{parentName:"td"},"WSSHandler")," utilis\xe9 pour initier le serveur WebSocket")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#path"}),(0,a.kt)("strong",{parentName:"a"},".path")," : Text"),"&","nbsp;","&","nbsp;","&","nbsp;","&","nbsp;le pattern du chemin d'acc\xe8s au serveur WebSocket")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#terminate"}),(0,a.kt)("strong",{parentName:"a"},".terminate()")),"&","nbsp;","&","nbsp;","&","nbsp;","&","nbsp;referme le serveur WebSocket")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#terminated"}),(0,a.kt)("strong",{parentName:"a"},".terminated")," : Boolean"),"&","nbsp;","&","nbsp;","&","nbsp;","&","nbsp;True si le serveur WebSocket est ferm\xe9")))),(0,a.kt)("h2",r({},{id:"4dwebsocketservernew"}),"4D.WebSocketServer.new()"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"4D.WebSocketServer.new"),"( ",(0,a.kt)("em",{parentName:"p"},"WSSHandler")," : Object { ; ",(0,a.kt)("em",{parentName:"p"},"options")," : Object } ) : 4D.WebSocketServer"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#wsshandler-parameter"}),"WSSHandler")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"->"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet de la classe utilisateur d\xe9clarant les callbacks du serveur WebSocket")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#options-parameter"}),"options")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"->"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres de configuration du WebSocket")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"R\xe9sultat"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"4D.WebSocketServer"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Nouvel objet WebSocketServer")))),(0,a.kt)("p",null,"La fonction ",(0,a.kt)("inlineCode",{parentName:"p"},"4D.WebSocketServer.new()")," cr\xe9e et d\xe9marre un serveur WebSocket qui utilisera les callbacks ",(0,a.kt)("em",{parentName:"p"},"WSSHandler")," et les ",(0,a.kt)("em",{parentName:"p"},"options")," sp\xe9cifi\xe9es (optionnellement), et renvoie un objet ",(0,a.kt)("inlineCode",{parentName:"p"},"4D.WebSocketServer"),"."),(0,a.kt)("p",null,"L'appel de cette fonction n\xe9cessite que le ",(0,a.kt)("a",r({parentName:"p"},{href:"/docs/fr/API/WebServerClass"}),"serveur Web 4D")," soit d\xe9marr\xe9. Le ",(0,a.kt)("strong",{parentName:"p"},"host")," et le ",(0,a.kt)("strong",{parentName:"p"},"port")," du serveur WebSocket sont les m\xeames que l'h\xf4te et le port du serveur Web 4D."),(0,a.kt)("h3",r({},{id:"param\xe8tre-wsshandler"}),"Param\xe8tre ",(0,a.kt)("em",{parentName:"h3"},"WSSHandler")),(0,a.kt)("p",null,"Dans le param\xe8tre ",(0,a.kt)("em",{parentName:"p"},"WSSHandler"),", passez une instance d'une classe utilisateur qui sera appel\xe9e chaque fois qu'un \xe9v\xe9nement se produit sur le serveur WebSocket -- essentiellement des \xe9v\xe9nements de connexion. La classe doit d\xe9finir les fonctions de callback suivantes (seule la fonction ",(0,a.kt)("inlineCode",{parentName:"p"},"onConnection")," est obligatoire) :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Propri\xe9t\xe9"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Par d\xe9faut"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onConnection"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"(obligatoire) Callback quand une nouvelle connexion cliente est d\xe9marr\xe9e (voir ci-dessous)"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"undefined")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onOpen"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Callback quand le serveur WebSocket est d\xe9marr\xe9 (voir ci-dessous)"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"undefined")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onTerminate"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Callback quand le serveur WebSocket est stopp\xe9 (voir ci-dessous)"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"undefined")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onError"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Callback quand une erreur est survenue (voir ci-dessous)"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"undefined")))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"WSHandler.onConnection"),"(",(0,a.kt)("em",{parentName:"p"},"WSServer")," : Object ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object) : Object | null"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"WSServer"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"4D.WebSocketServer"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet serveur WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"connection"')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"request"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet ",(0,a.kt)("inlineCode",{parentName:"td"},"request"),". Contient les informations de la requ\xeate de connexion (voir ci-dessous)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"R\xe9sultat"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"->"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#connectionhandler-object"}),"objet ",(0,a.kt)("inlineCode",{parentName:"a"},"connectionHandler"))," (voir ci-dessous). Si cette fonction renvoie un objet ",(0,a.kt)("inlineCode",{parentName:"td"},"connectionHandler"),", un ",(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/API/WebSocketConnectionClass#objet-websocketconnection"}),"objet ",(0,a.kt)("inlineCode",{parentName:"a"},"4D.WebSocketConnection"))," est automatiquement cr\xe9\xe9 et ajout\xe9 \xe0 la ",(0,a.kt)("a",r({parentName:"td"},{href:"#connections"}),"collection de connexions"),". Cet objet est alors re\xe7u comme param\xe8tre dans chaque fonction de l'objet ",(0,a.kt)("inlineCode",{parentName:"td"},"connectionHandler"),". Si la valeur renvoy\xe9e est null ou undefined, la connexion est annul\xe9e.")))),(0,a.kt)("p",null,"Cette callback est appel\xe9e lorsque le handshake est termin\xe9. Elle doit \xeatre appel\xe9e avec un ",(0,a.kt)("a",r({parentName:"p"},{href:"#objet-connectionhandler"}),"objet ",(0,a.kt)("inlineCode",{parentName:"a"},"connectionHandler"))," valide pour cr\xe9er la connexion WebSocket, sinon la connexion est annul\xe9e."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"WSHandler.onOpen"),"(",(0,a.kt)("em",{parentName:"p"},"WSServer")," : Object ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object)"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"WSServer"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"4D.WebSocketServer"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet serveur WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"open"')))),(0,a.kt)("p",null,"\xc9v\xe9nement \xe9mis lorsque le serveur websocket est d\xe9marr\xe9."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"WSHandler.onTerminate"),"(",(0,a.kt)("em",{parentName:"p"},"WSServer")," : Object ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object)"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"WSServer"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"4D.WebSocketServer"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet serveur WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"terminate"')))),(0,a.kt)("p",null,"\xc9v\xe9nement \xe9mis lors de la fermeture du serveur HTTP ou du serveur WebSocket."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"WSHandler.onError"),"(",(0,a.kt)("em",{parentName:"p"},"WSServer")," : Object ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object)"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"WSServer"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"4D.WebSocketServer"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet serveur WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"error"')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"errors"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Collection"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Collection de pile d'erreurs 4D en cas d'erreur d'ex\xe9cution",(0,a.kt)("li",null,"[","].errCode (number) - Code d'erreur 4D"),(0,a.kt)("li",null,"[","].message (text) - Description de l'erreur 4D"),(0,a.kt)("li",null,"[","].componentSignature (text) - Signature du composant interne qui a renvoy\xe9 l'erreur"))))),(0,a.kt)("p",null,"\xc9v\xe9nement \xe9mis lorsqu'une erreur se produit sur le serveur WebSocket."),(0,a.kt)("h3",r({},{id:"exemple-de-classe-wsshandler"}),"Exemple de classe ",(0,a.kt)("inlineCode",{parentName:"h3"},"WSSHandler")),(0,a.kt)("p",null,"Cet exemple de fonctionnalit\xe9 de chat basique montre comment g\xe9rer les connexions au serveur WebSocket dans une classe ",(0,a.kt)("em",{parentName:"p"},"WSSHandler"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-4d"}),'//myWSServerHandler class \n\nFunction onConnection($wss : Object; $event : Object) : Object\n\n    If (VerifyAddress($event.request.remoteAddress))\n        // La m\xe9thode VerifyAddress v\xe9lide l\'adresse du client\n        // L\'objet WSConnectionHandler retourn\xe9 sera utilis\xe9 \n        // par 4D pour instancier l\'objet 4D.WebSocketConnection\n        // li\xe9 \xe0 cette connexion\n        return cs.myConnectionHandler.new()   \n        // Voire objet connectionHandler \n    Else \n        // La connexion est annul\xe9e     \n        return Null \n    End if \n\nFunction onOpen($wss : Object; $event : Object)\nLogFile("*** Server started")\n\nFunction onTerminate($wss : Object; $event : Object)\nLogFile("*** Server closed")\n\nFunction onError($wss : Object; $event : Object)\nLogFile("!!! Server error: "+$event.errors.first().message)\n\n')),(0,a.kt)("h3",r({},{id:"objet-request"}),"Objet ",(0,a.kt)("inlineCode",{parentName:"h3"},"request")),(0,a.kt)("p",null,"Un objet ",(0,a.kt)("inlineCode",{parentName:"p"},"request")," contient les propri\xe9t\xe9s suivantes :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"headers"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"La requ\xeate HTTP GET du client. ",(0,a.kt)("inlineCode",{parentName:"td"},"headers.key=value")," (value peut \xeatre une collection si la m\xeame cl\xe9 appara\xeet plusieurs fois)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"query"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet qui contient les param\xe8tres de l'URL. Par exemple, si les param\xe8tres sont : ",(0,a.kt)("inlineCode",{parentName:"td"},"?key1=value1&key2=value2")," -> ",(0,a.kt)("inlineCode",{parentName:"td"},"query.key1=value1"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"query.key2=value2"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"url"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"contient uniquement l'URL qui est pr\xe9sente dans la requ\xeate HTTP r\xe9elle. Ex : ",(0,a.kt)("inlineCode",{parentName:"td"},"GET /status?name=ryan HTTP/1.1"),' -> url="/status?name=ryan"')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"remoteAddress"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Adresse IP du client")))),(0,a.kt)("h3",r({},{id:"objet-connectionhandler"}),"Objet ",(0,a.kt)("inlineCode",{parentName:"h3"},"connectionHandler")),(0,a.kt)("p",null,"En r\xe9sultat d'une callback ",(0,a.kt)("inlineCode",{parentName:"p"},"WSHandler.onConnection"),", passez un objet ",(0,a.kt)("inlineCode",{parentName:"p"},"connectionHandler"),", qui est une instance d'une classe utilisateur qui sera appel\xe9e \xe0 chaque fois qu'un \xe9v\xe9nement se produira dans la connexion WebSocket -- essentiellement, les messages re\xe7us. La classe doit d\xe9finir les fonctions de callback suivantes (seule la fonction ",(0,a.kt)("inlineCode",{parentName:"p"},"onMessage")," est obligatoire) :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onMessage"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"(obligatoire) Fonction appel\xe9e lorsqu'un nouveau message est re\xe7u de cette connexion")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onOpen"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Fonction appel\xe9e lorsque la ",(0,a.kt)("inlineCode",{parentName:"td"},"4D.WebSocketConnection")," est cr\xe9\xe9e")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onTerminate"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Fonction appel\xe9e lorsque cette connexion est termin\xe9e")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onError"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Fonction appel\xe9e en cas d'erreur")))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"connectionHandler.onMessage"),"(",(0,a.kt)("em",{parentName:"p"},"ws")," : 4D.WebSocketConnection ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object)"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"ws"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/API/WebSocketConnectionClass"}),(0,a.kt)("inlineCode",{parentName:"a"},"4D.WebSocketConnection"))),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet connexion WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"message"')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"data"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text / Blob / Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"donn\xe9es envoy\xe9es par le client")))),(0,a.kt)("p",null,"Callback pour les donn\xe9es WebSocket. Appel\xe9e \xe0 chaque fois que le WebSocket re\xe7oit des donn\xe9es."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"connectionHandler.onOpen"),"(",(0,a.kt)("em",{parentName:"p"},"ws")," : 4D.WebSocketConnection ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object)"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"ws"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/API/WebSocketConnectionClass"}),(0,a.kt)("inlineCode",{parentName:"a"},"4D.WebSocketConnection"))),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet connexion WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"open"')))),(0,a.kt)("p",null,"Appel\xe9e lorsque l'objet ",(0,a.kt)("inlineCode",{parentName:"p"},"connectionHandler")," est cr\xe9\xe9 (apr\xe8s l'\xe9v\xe9nement ",(0,a.kt)("inlineCode",{parentName:"p"},"WSS.onConnection"),")."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"connectionHandler.onTerminate"),"(",(0,a.kt)("em",{parentName:"p"},"ws")," : 4D.WebSocketConnection ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object)"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"ws"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/API/WebSocketConnectionClass"}),(0,a.kt)("inlineCode",{parentName:"a"},"4D.WebSocketConnection"))),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet connexion WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"terminate"')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"code"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Number"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Code de statut indiquant la cause de la fermeture de la connexion. Si la WebSocket ne renvoie pas de code d'erreur, ",(0,a.kt)("inlineCode",{parentName:"td"},"code")," vaut 1005 si aucune erreur ne s'est produite ou 1006 si une erreur s'est produite.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"reason"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Cha\xeene expliquant pourquoi la connexion a \xe9t\xe9 ferm\xe9e. Si le websocket ne renvoie pas de raison, le code est undefined")))),(0,a.kt)("p",null,"Fonction appel\xe9e lorsque la WebSocket est ferm\xe9e."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"connectionHandler.onError"),"(",(0,a.kt)("em",{parentName:"p"},"ws")," : 4D.WebSocketConnection ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object)"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"ws"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/API/WebSocketConnectionClass"}),(0,a.kt)("inlineCode",{parentName:"a"},"4D.WebSocketConnection"))),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet connexion WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"error"')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"errors"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Collection"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"Collection de piles d'erreurs 4D en cas d'erreur d'ex\xe9cution",(0,a.kt)("li",null,"[","].errCode (number) - Code d'erreur 4D"),(0,a.kt)("li",null,"[","].message (text) - Description de l'erreur 4D"),(0,a.kt)("li",null,"[","].componentSignature (text) - Signature du composant interne qui a renvoy\xe9 l'erreur")),(0,a.kt)("td",r({parentName:"tr"},{align:null}))))),(0,a.kt)("p",null,"Fonction appel\xe9e en cas d'erreur."),(0,a.kt)("h3",r({},{id:"exemple-de-classe-connectionhandler"}),"Exemple de classe ",(0,a.kt)("inlineCode",{parentName:"h3"},"connectionHandler")),(0,a.kt)("p",null,"Cet exemple de fonctionnalit\xe9 de chat basique montre comment g\xe9rer les messages dans une classe ",(0,a.kt)("em",{parentName:"p"},"connectionHandler"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-4d"}),'// Classe myConnectionHandler\n\nFunction onMessage($ws : 4D.WebSocketConnection ; $message : Object)\n    // Renvoyer le message \xe0 tous les clients du chat   \n    This.broadcast($ws;$message.data)\n\nFunction onOpen($ws : 4D.WebSocketConnection ; $message : Object)\n    // Envoyer un message aux nouveaux utilisateurs connect\xe9s\n    $ws.send("Welcome on the chat !")   \n    // Envoyer le message "New client connected" \xe0 tous les autres clients de chat\n    This.broadcast($ws; "New client connected")\n\nFunction onTerminate($ws : 4D.WebSocketConnection ; $message : Object)\n    // Envoi du message "Client d\xe9connect\xe9" \xe0 tous les autres clients de chat\n    This.broadcast($ws; "Client d\xe9connect\xe9")\n\nFunction broadcast($ws : 4D.WebSocketConnection ; $message:text)\n    var $client:4D.WebSocketConnection\n    // Renvoyer le message \xe0 tous les clients de chat\n    For each ($client; $ws.wss.connections)\n        // V\xe9rifier que l\'id n\'est pas la connexion actuelle\n        If ($client.id#$ws.id)\n            $client.send($message)\n        End if \n    End for each \n\n')),(0,a.kt)("h3",r({},{id:"param\xe8tre-options"}),"Param\xe8tre ",(0,a.kt)("em",{parentName:"h3"},"options")),(0,a.kt)("p",null,"Dans le param\xe8tre facultatif ",(0,a.kt)("em",{parentName:"p"},"options"),", passez un objet contenant les propri\xe9t\xe9s suivantes :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Propri\xe9t\xe9"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Par d\xe9faut"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"path"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Repr\xe9sente le chemin d'acc\xe8s au serveur WebSocket. Si aucun chemin n'est d\xe9fini, le serveur WebSocket g\xe8re toutes les connexions"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"undefined")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"dataType"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Type de donn\xe9es re\xe7ues par ",(0,a.kt)("inlineCode",{parentName:"td"},"connectionHandler.onMessage")," et envoy\xe9es par la fonction ",(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/API/WebSocketConnectionClass#send"}),(0,a.kt)("inlineCode",{parentName:"a"},"WebSocketConnection.send()")),'. Valeurs : "text", "blob", "object"). Si "objet" : (envoi) transforme l\'objet au format json et l\'envoie ; (r\xe9ception) : re\xe7oit le format json et le transforme en objet'),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"text")))),(0,a.kt)("h2",r({},{id:"connections"}),".connections"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},".connections")," : Collection"),(0,a.kt)("h4",r({},{id:"description"}),"Description"),(0,a.kt)("p",null,"La propri\xe9t\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},".connections")," contient toutes les connexions courantes g\xe9r\xe9es par le serveur WebSocket. Chaque \xe9l\xe9ment de la collection est un ","[objet ",(0,a.kt)("inlineCode",{parentName:"p"},"WebSocketConnection"),"]"," (WebSocketConnectionClass.md)."),(0,a.kt)("p",null,"Lorsqu'une connexion est termin\xe9e, son ",(0,a.kt)("a",r({parentName:"p"},{href:"/docs/fr/API/WebSocketConnectionClass#status"}),(0,a.kt)("inlineCode",{parentName:"a"},"status")),' devient "Closed" et elle est supprim\xe9e de cette collection.'),(0,a.kt)("h2",r({},{id:"datatype"}),".dataType"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},".dataType")," : Text"),(0,a.kt)("h4",r({},{id:"description-1"}),"Description"),(0,a.kt)("p",null,"La propri\xe9t\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},".dataType")," contient le type de donn\xe9es re\xe7ues ou envoy\xe9es."),(0,a.kt)("p",null,"Cette propri\xe9t\xe9 est en lecture seule."),(0,a.kt)("h2",r({},{id:"handler"}),".handler"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},".handler")," : Object"),(0,a.kt)("h4",r({},{id:"description-2"}),"Description"),(0,a.kt)("p",null,"La propri\xe9t\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},".handler")," contient l'accesseur qui r\xe9cup\xe8re l'objet ",(0,a.kt)("inlineCode",{parentName:"p"},"WSSHandler")," utilis\xe9 pour initier le serveur WebSocket."),(0,a.kt)("h2",r({},{id:"path"}),".path"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},".path")," : Text"),(0,a.kt)("h4",r({},{id:"description-3"}),"Description"),(0,a.kt)("p",null,"La propri\xe9t\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},".path")," contient le pattern du chemin d'acc\xe8s au serveur WebSocket. Si aucun chemin n'a \xe9t\xe9 d\xe9fini, le serveur WebSocket g\xe8re toutes les connexions."),(0,a.kt)("p",null,"Cette propri\xe9t\xe9 est en lecture seule."),(0,a.kt)("h2",r({},{id:"terminate"}),".terminate()"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},".terminate()")),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Ne requiert aucun param\xe8tre")))),(0,a.kt)("h4",r({},{id:"description-4"}),"Description"),(0,a.kt)("p",null,"La fonction ",(0,a.kt)("inlineCode",{parentName:"p"},".terminate()")," referme le serveur WebSocket."),(0,a.kt)("h2",r({},{id:"terminated"}),".terminated"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},".terminated")," : Boolean"),(0,a.kt)("h4",r({},{id:"description-5"}),"Description"),(0,a.kt)("p",null,"La propri\xe9t\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},".terminated")," contient True si le serveur WebSocket est ferm\xe9."),(0,a.kt)("p",null,"Cette propri\xe9t\xe9 est en lecture seule."))}c.isMDXComponent=!0}}]);