"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[29422],{449708:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var s=n(474848),t=n(28453);const i={id:"set-query-and-lock",title:"SET QUERY AND LOCK",slug:"/commands/set-query-and-lock",displayed_sidebar:"docs"},l=void 0,c={id:"commands-legacy/set-query-and-lock",title:"SET QUERY AND LOCK",description:"SET QUERY AND LOCK ( verrou )",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-20-R7/commands-legacy/set-query-and-lock.md",sourceDirName:"commands-legacy",slug:"/commands/set-query-and-lock",permalink:"/docs/fr/commands/set-query-and-lock",draft:!1,unlisted:!1,editUrl:"https://github.com/4d/docs/issues/new?title=Comment%20on%20commands-legacy%2Fset-query-and-lock.md%20(20-R7)&body=Please%20enter%20your%20comment%3A",tags:[],version:"20-R7",frontMatter:{id:"set-query-and-lock",title:"SET QUERY AND LOCK",slug:"/commands/set-query-and-lock",displayed_sidebar:"docs"},sidebar:"docs",previous:{title:"QUERY WITH ARRAY",permalink:"/docs/fr/commands/query-with-array"},next:{title:"SET QUERY DESTINATION",permalink:"/docs/fr/commands/set-query-destination"}},a={},d=[{value:"Description",id:"description",level:4},{value:"Exemple",id:"exemple",level:4},{value:"Gestion des erreurs",id:"gestion-des-erreurs",level:4},{value:"Voir aussi",id:"voir-aussi",level:4}];function o(e){const r={a:"a",code:"code",em:"em",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"SET QUERY AND LOCK"})," ( ",(0,s.jsx)(r.em,{children:"verrou"})," )"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Param\xe8tre"}),(0,s.jsx)(r.th,{children:"Type"}),(0,s.jsx)(r.th,{}),(0,s.jsx)(r.th,{children:"Description"})]})}),(0,s.jsx)(r.tbody,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"verrou"}),(0,s.jsx)(r.td,{children:"Boolean"}),(0,s.jsx)(r.td,{children:"\u2192"}),(0,s.jsx)(r.td,{children:"Vrai = verrouiller les enregistrements trouv\xe9s par les recherches, Faux = ne pas les verrouiller"})]})})]}),"\n",(0,s.jsx)(r.h4,{id:"description",children:"Description"}),"\n",(0,s.jsxs)(r.p,{children:["La commande ",(0,s.jsx)(r.strong,{children:"SET QUERY AND LOCK"})," vous permet de demander le verrouillage automatique des enregistrements trouv\xe9s par toutes les recherches qui suivent son appel dans la transaction courante. Ce m\xe9canisme permet de s\u2019assurer que les enregistrements ne puissent pas \xeatre modifi\xe9s par un process autre que le process courant entre une recherche et la manipulation des r\xe9sultats."]}),"\n",(0,s.jsxs)(r.p,{children:["Par d\xe9faut, les enregistrements trouv\xe9s par les recherches ne sont pas verrouill\xe9s. Passez ",(0,s.jsx)(r.strong,{children:"Vrai"})," dans le param\xe8tre ",(0,s.jsx)(r.em,{children:"verrou"})," pour activer le verrouillage."]}),"\n",(0,s.jsx)(r.p,{children:"Cette commande doit imp\xe9rativement \xeatre utilis\xe9e \xe0 l\u2019int\xe9rieur d\u2019une transaction. Si elle est appel\xe9e hors du contexte d\u2019une transaction, une erreur est g\xe9n\xe9r\xe9e. Ce principe permet un meilleur contr\xf4le du verrouillage des enregistrements. Les enregistrements trouv\xe9s restent verrouill\xe9s tant que la transaction n\u2019a pas \xe9t\xe9 termin\xe9e (qu\u2019elle ait \xe9t\xe9 valid\xe9e ou annul\xe9e). A l\u2019issue de la transaction, tous les enregistrements sont d\xe9verrouill\xe9s, except\xe9 l'enregistrement courant."}),"\n",(0,s.jsx)(r.p,{children:"Le verrouillage des enregistrements est effectif pour toutes les tables dans la transaction courante."}),"\n",(0,s.jsxs)(r.p,{children:["Lorsqu'une instruction ",(0,s.jsx)(r.strong,{children:"SET QUERY AND LOCK(Vrai)"})," a \xe9t\xe9 ex\xe9cut\xe9e, les commandes de recherche (par exemple ",(0,s.jsx)(r.a,{href:"/docs/fr/commands/query",children:"QUERY"}),") adoptent un fonctionnement sp\xe9cifique si un enregistrement d\xe9j\xe0 verrouill\xe9 est trouv\xe9 :"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"la recherche est stopp\xe9e et la variable syst\xe8me OK prend la valeur 0,"}),"\n",(0,s.jsx)(r.li,{children:"la s\xe9lection courante est vid\xe9e,"}),"\n",(0,s.jsx)(r.li,{children:"l'ensemble syst\xe8me LockedSet contient l'enregistrement verrouill\xe9 \xe0 l'origine de l'arr\xeat de la recherche."}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"Par cons\xe9quent, dans ce contexte il est n\xe9cessaire de tester l'ensemble LockedSet \xe0 l'issue d'une recherche infructueuse (s\xe9lection courante vide et/ou variable OK \xe0 0) afin de d\xe9terminer la cause de l'\xe9chec."}),"\n",(0,s.jsxs)(r.p,{children:["Appelez ",(0,s.jsx)(r.strong,{children:"SET QUERY AND LOCK(Faux)"})," afin de d\xe9sactiver le m\xe9canisme apr\xe8s usage."]}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"SET QUERY AND LOCK"})," modifie uniquement le comportement des commandes de recherche, c'est-\xe0-dire :"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"/docs/fr/commands/query",children:"QUERY"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"/docs/fr/commands/query-selection",children:"QUERY SELECTION"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"/docs/fr/commands/query-by-example",children:"QUERY BY EXAMPLE"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"/docs/fr/commands/query-by-formula",children:"QUERY BY FORMULA"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"/docs/fr/commands/query-selection-by-formula",children:"QUERY SELECTION BY FORMULA"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"/docs/fr/commands/query-by-sql",children:"QUERY BY SQL"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"/docs/fr/commands/query-with-array",children:"QUERY WITH ARRAY"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"/docs/fr/commands/query-selection-with-array",children:"QUERY SELECTION WITH ARRAY"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"/docs/fr/commands/query-by-attribute",children:"QUERY BY ATTRIBUTE"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"/docs/fr/commands/query-selection-by-attribute",children:"QUERY SELECTION BY ATTRIBUTE"})}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["En revanche, ",(0,s.jsx)(r.strong,{children:"SET QUERY AND LOCK"})," n'affecte pas les autres commandes qui modifient la s\xe9lection courante telles que ",(0,s.jsx)(r.a,{href:"/docs/fr/commands/all-records",children:"ALL RECORDS"}),", ",(0,s.jsx)(r.a,{href:"/docs/fr/commands/relate-many",children:"RELATE MANY"}),", etc."]}),"\n",(0,s.jsx)(r.h4,{id:"exemple",children:"Exemple"}),"\n",(0,s.jsxs)(r.p,{children:["Dans cet exemple, il n\u2019est pas possible de supprimer un client qui aurait \xe9t\xe9 pass\xe9 de la cat\xe9gorie \u201cC\u201d \xe0 la cat\xe9gorie \u201cA\u201d par un autre process entre le ",(0,s.jsx)(r.a,{href:"/docs/fr/commands/query",children:"QUERY"})," et le ",(0,s.jsx)(r.a,{href:"/docs/fr/commands/delete-selection",children:"DELETE SELECTION"})," :"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-4d",children:"\xa0START TRANSACTION\n\xa0SET QUERY AND LOCK(True)\n\xa0QUERY([Clients];[Clients]Cat\xe9gorie=\u201cC\u201d)\n\xa0\xa0//A cet instant, les enregistrements trouv\xe9s sont automatiquement verrouill\xe9s pour tous les autres process\n\xa0DELETE SELECTION([Clients])\n\xa0SET QUERY AND LOCK(False)\n\xa0VALIDATE TRANSACTION\n"})}),"\n",(0,s.jsx)(r.h4,{id:"gestion-des-erreurs",children:"Gestion des erreurs"}),"\n",(0,s.jsx)(r.p,{children:"Si la commande est appel\xe9e hors du contexte d\u2019une transaction, une erreur est g\xe9n\xe9r\xe9e."}),"\n",(0,s.jsx)(r.h4,{id:"voir-aussi",children:"Voir aussi"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"/docs/fr/commands/query",children:"QUERY"})})]})}function u(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>l,x:()=>c});var s=n(296540);const t={},i=s.createContext(t);function l(e){const r=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);