"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["98359"],{714373:function(e,s,n){n.r(s),n.d(s,{metadata:()=>t,contentTitle:()=>i,default:()=>c,assets:()=>d,toc:()=>l,frontMatter:()=>o});var t=JSON.parse('{"id":"commands-legacy/on-exit-database-method","title":"On Exit database method","description":"On Exit database method","source":"@site/i18n/fr/docusaurus-plugin-content-docs/version-20-R7/commands-legacy/on-exit-database-method.md","sourceDirName":"commands-legacy","slug":"/commands/on-exit-database-method","permalink":"/docs/fr/commands/on-exit-database-method","draft":false,"unlisted":false,"editUrl":"https://github.com/4d/docs/issues/new?title=Comment%20on%20commands-legacy%2Fon-exit-database-method.md%20(20-R7)&body=Please%20enter%20your%20comment%3A","tags":[],"version":"20-R7","frontMatter":{"id":"on-exit-database-method","title":"On Exit database method","slug":"/commands/on-exit-database-method","displayed_sidebar":"docs"},"sidebar":"docs","previous":{"title":"On Drop database method","permalink":"/docs/fr/commands/on-drop-database-method"},"next":{"title":"On Host Database Event database method","permalink":"/docs/fr/commands/on-host-database-event-database-method"}}'),r=n("785893"),a=n("250065");let o={id:"on-exit-database-method",title:"On Exit database method",slug:"/commands/on-exit-database-method",displayed_sidebar:"docs"},i=void 0,d={},l=[{value:"Exemple",id:"exemple",level:4},{value:"Voir aussi",id:"voir-aussi",level:4},{value:"Propri\xe9t\xe9s",id:"propri\xe9t\xe9s",level:4}];function u(e){let s={a:"a",br:"br",code:"code",em:"em",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"On Exit database method"})}),"\n\n\n\n\n\n\n\n",(0,r.jsx)(s.table,{children:(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Ne requiert pas de param\xe8tre"}),(0,r.jsx)(s.th,{})]})})}),"\n",(0,r.jsx)(s.h4,{id:""}),"\n",(0,r.jsxs)(s.p,{children:["La m\xe9thode base ",(0,r.jsx)(s.strong,{children:"On Exit"})," est appel\xe9e une fois lorsque vous quittez la base."]}),"\n",(0,r.jsx)(s.p,{children:"Les environnements 4D suivants sont concern\xe9s :"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"4D en mode local"}),"\n",(0,r.jsx)(s.li,{children:"4D en mode distant"}),"\n",(0,r.jsx)(s.li,{children:"Application 4D compil\xe9e et fusionn\xe9e avec 4D VolumeDesktop"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Note :"})," La ",(0,r.jsx)(s.strong,{children:"On Exit database method"})," n'est PAS ex\xe9cut\xe9e par 4D Server. Vous devez utiliser la m\xe9thode base ",(0,r.jsx)(s.em,{children:"Sur arr\xeat serveur"})," dans ce contexte."]}),"\n",(0,r.jsxs)(s.p,{children:["La ",(0,r.jsx)(s.strong,{children:"On Exit database method"})," est ex\xe9cut\xe9e automatiquement par 4D ; \xe0 la diff\xe9rence des m\xe9thodes projet, vous ne pouvez pas appeler cette m\xe9thode base par programmation. Vous pouvez toutefois l'ex\xe9cuter depuis l'\xe9diteur de m\xe9thodes. Vous pouvez \xe9galement utiliser des sous-routines."]}),"\n",(0,r.jsx)(s.p,{children:"On sort de la base lorsque l'un des \xe9v\xe9nements suivants se produit :"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["L'utilisateur s\xe9lectionne la commande ",(0,r.jsx)(s.strong,{children:"Quitter"})," dans le menu ",(0,r.jsx)(s.strong,{children:"Fichier"})," en mode D\xe9veloppement ou Application (action standard Quitter)."]}),"\n",(0,r.jsxs)(s.li,{children:["Un appel \xe0 la commande ",(0,r.jsx)(s.a,{href:"/docs/fr/commands/quit-4d",children:"QUIT 4D"})," a eu lieu."]}),"\n",(0,r.jsxs)(s.li,{children:["Un plug-in 4D a fait appel au point d'entr\xe9e ",(0,r.jsx)(s.a,{href:"/docs/fr/commands/quit-4d",children:"QUIT 4D"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Quel que soit le moyen par lequel la base a \xe9t\xe9 quitt\xe9e, 4D accomplit les actions qui suivent :"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["S'il n'existe pas de ",(0,r.jsx)(s.strong,{children:"On Exit database method"}),", 4D d\xe9truit chaque process un par un, sans distinction. Si un utilisateur est en train de saisir des donn\xe9es, les enregistrements ne seront pas sauvegard\xe9s."]}),"\n",(0,r.jsxs)(s.li,{children:["S'il existe une ",(0,r.jsx)(s.strong,{children:"On Exit database method"}),", 4D d\xe9marre l'ex\xe9cution de cette m\xe9thode dans un process local nouvellement cr\xe9\xe9. Notez que 4D quittera en tout \xe9tat de cause \u2014 la ",(0,r.jsx)(s.strong,{children:"On Exit database method"})," peut assurer le nettoyage et la fermeture de toutes les op\xe9rations que vous voulez, mais la fermeture de la base est in\xe9luctable."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Lorsque 4D est sur le point de quitter, le programme :"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"demande aux process en cours d'ex\xe9cution d'interrompre leur ex\xe9cution d\xe8s que possible (uniquement dans les process ex\xe9cutant du code 4D)"}),"\n",(0,r.jsx)(s.li,{children:'active leur marqueur "process interrompu".'}),"\n",(0,r.jsxs)(s.li,{children:["d\xe9clenche les process qui ont \xe9t\xe9 retard\xe9s par ",(0,r.jsx)(s.a,{href:"/docs/fr/commands/delay-process",children:"DELAY PROCESS"})," ou par d'autres moyens."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"4D poursuit l'it\xe9ration des process tant qu'un process est encore en vie, pour une dur\xe9e maximale de 13 secondes. Pour r\xe9pondre \xe0 une action de sortie, nous recommandons de d\xe9finir un marqueur (comme une entr\xe9e dans l'objet Storage) dans la m\xe9thode base Sur arr\xeat serveur ou dans votre m\xe9thode de sortie personnalis\xe9e. Il peut \xeatre judicieux d'effectuer une boucle dans cette m\xe9thode (10 secondes maximum) pour laisser le temps \xe0 vos process en cours de r\xe9pondre et de quitter correctement. Il n'est pas recommand\xe9 d'attendre plus de 10 secondes, pour \xe9viter que 4D ne stoppe le process ou que le syst\xe8me d'exploitation ne stoppe l'application enti\xe8re."}),"\n",(0,r.jsxs)(s.p,{children:["La ",(0,r.jsx)(s.strong,{children:"On Exit database method"})," est l'emplacement id\xe9al pour :"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Sauvegarder (localement, sur disque) les pr\xe9ferences ou param\xe9trages devant \xeatre r\xe9utilis\xe9s lors de la prochaine session dans la ."}),"\n",(0,r.jsx)(s.li,{children:"Accomplir toute autre action que vous souhaitez ex\xe9cuter automatiquement \xe0 chaque fermeture de la base."}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Note:"})," Rappelez-vous que le process cr\xe9\xe9 pour la ",(0,r.jsx)(s.strong,{children:"On Exit database method"})," est un process client (local), qui n'existe donc pas sur le poste serveur. Par cons\xe9quent, si vous effectuez dans cette m\xe9thode base une recherche ou un tri, tout poste client qui tentera de quitter l'application restera \"bloqu\xe9\". Si vous avez besoin d'acc\xe9der aux donn\xe9es lorsque le client quitte, vous devez cr\xe9er depuis cette m\xe9thode base un process global qui, lui, pourra acc\xe9der aux donn\xe9es. Dans ce cas toutefois, veillez \xe0 ce que ce process puisse terminer son ex\xe9cution (par l'interm\xe9daire de variables interprocess, par exemple) avant d\u2019\xeatre stopp\xe9 par la ",(0,r.jsx)(s.strong,{children:"On Exit database method"})," (\xe0 l'aide de ",(0,r.jsx)(s.a,{href:"/docs/fr/commands/storage",children:"Storage"})," ou d'un objet partag\xe9, par exemple)."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Note :"})," En environnement client/serveur, la ",(0,r.jsx)(s.strong,{children:"On Exit database method"})," s'ex\xe9cute diff\xe9remment selon que l'utilisateur quitte manuellement (via la commande de menu ",(0,r.jsx)(s.strong,{children:"Quitter"})," ou l'appel de la commande ",(0,r.jsx)(s.a,{href:"/docs/fr/commands/quit-4d",children:"QUIT 4D"}),") ou que 4D Server est \xe9teint, ce qui force tous les clients \xe0 quitter.",(0,r.jsx)(s.br,{}),"\nLorsqu'on quitte 4D Server et que l'on accorde un d\xe9lai aux utilisateurs (par exemple 10 minutes), chaque poste client connect\xe9 affiche un message d'avertissement et si l'utilisateur quitte durant le d\xe9lai imparti, la ",(0,r.jsx)(s.strong,{children:"On Exit database method"})," s'ex\xe9cute normalement. Cependant, dans les autres cas (i.e. l'utilisateur ne r\xe9pond pas \xe0 temps, ou le serveur quitte sans d\xe9lai, ou encore le client est d\xe9connect\xe9 manuellement par l'Administrateur), la ",(0,r.jsx)(s.strong,{children:"On Exit database method"})," est ex\xe9cut\xe9e en m\xeame que la connexion au serveur est referm\xe9e. Par cons\xe9quent, le code de la ",(0,r.jsx)(s.strong,{children:"On Exit database method"})," ne peut pas lancer d'autre process local ou serveur, et ne peut pas attendre que les autres process soient annul\xe9s (et ces process ne peuvent plus continuer d'acc\xe9der au serveur). S'il tente de le faire, une erreur r\xe9seau est g\xe9n\xe9r\xe9e (erreur 10001 ou 10002) puisque la connexion au serveur est d\xe9j\xe0 referm\xe9e."]}),"\n",(0,r.jsxs)(s.p,{children:["Pour stopper proprement les process en cours dans le cas o\xf9 l'application est forc\xe9e de quitter, vous devez tester la commande ",(0,r.jsx)(s.a,{href:"/docs/fr/commands/process-aborted",children:"Process aborted"})," dans chaque boucle (Boucle, Tant que, Repeter) qui peut potentiellement durer plus d'une seconde. ",(0,r.jsx)(s.a,{href:"/docs/fr/commands/process-aborted",children:"Process aborted"})," retourne ",(0,r.jsx)(s.strong,{children:"vrai"})," si 4D (mode local, distant ou 4D Server) est sur le point de quitter, signifiant que les traitements vont stopper imm\xe9diatement. Dans ce cas, annulez tous les traitements (",(0,r.jsx)(s.a,{href:"/docs/fr/commands/cancel-transaction",children:"CANCEL TRANSACTION"}),", etc.) et quittez le plus vite possible. Alors que vous avez du temps si l'utilisateur quitte manuellement, vous n'en avez pas lorsque l'application est forc\xe9e de quitter."]}),"\n",(0,r.jsx)(s.h4,{id:"exemple",children:"Exemple"}),"\n",(0,r.jsxs)(s.p,{children:["L'exemple suivant illustre un cas typique o\xf9 vous lancez un ou plusieurs process d'arri\xe8re-plan pour r\xe9aliser des t\xe2ches r\xe9guli\xe8res, fonctionnant sans fin, dans la M\xe9thode base On startup (ou dans le M\xe9thode base On server startup). Un marqueur dans l'objet ",(0,r.jsx)(s.code,{children:"Storage"})," de l'application est utilis\xe9 pour leur indiquer de terminer la t\xe2che - et pour s'assurer qu'ils ont termin\xe9."]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Dans la M\xe9thode base On startup"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-4d",children:' Use(Storage)\n    Storage.global:=Nouvel objet partag\xe9("ExitNow";False)\n End use\n $p:=New process("Serverjob";0;"Background job#1")\n $p1:=New process("Check_Invoices";0;"Background job#2")\n'})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Voici un exemple d'une m\xe9thode d'arri\xe8re-plan :"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-4d",children:"  // effectuer des t\xe2ches r\xe9guli\xe8res en arri\xe8re-plan sur le serveur\n While(Not(Bool(Storage.global.ExitNow)))\n  //  Ex\xe9cuter des t\xe2ches comptables, calculer des donn\xe9es, etc.\n  // ...\n    RETARDER PROCESS(Process courant;60*60) //sleep pendant une minute, puis r\xe9p\xe9ter la boucle\n End while\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Dans la M\xe9thode base On exit :"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-4d",children:" Use(Storage.global)\n    Storage.global.ExitNow:=True //demander \xe0 tous les workers en arri\xe8re-plan de s'arr\xeater\n End use\n \n $time:=Current time\n $finished:=False\n While((($time+10)>(Current time+0))&(Not($finished)))  // maximum 10 secondes\n    $list:=Get process activity(Processes only) // obtenir la liste de tous les process \n    $sublist:=$list.processes.query(\"name='Background job@' and state >=0\") \n    //existe-t-il encore une t\xe2che en arri\xe8re-plan en cours ?\n    $finished:=($sublist.length=0)\n    If($sublist.length>0)\n       For each($job;$sublist)\n          RESUME PROCESS($job.number) //s'assurer que tous les process sont actifs\n        End each\n       End if\n    End while\n"})}),"\n",(0,r.jsx)(s.h4,{id:"voir-aussi",children:"Voir aussi"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.a,{href:"/docs/fr/commands/on-startup-database-method",children:"On Startup database method"}),(0,r.jsx)(s.br,{}),"\n",(0,r.jsx)(s.a,{href:"/docs/fr/commands/quit-4d",children:"QUIT 4D"})]}),"\n",(0,r.jsx)(s.h4,{id:"propri\xe9t\xe9s",children:"Propri\xe9t\xe9s"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{}),(0,r.jsx)(s.th,{})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Num\xe9ro de commande"}),(0,r.jsx)(s.td,{children:"905252"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Thread safe"}),(0,r.jsx)(s.td,{children:"\u2717"})]})]})]})]})}function c(e={}){let{wrapper:s}={...(0,a.a)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},250065:function(e,s,n){n.d(s,{Z:function(){return i},a:function(){return o}});var t=n(667294);let r={},a=t.createContext(r);function o(e){let s=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(a.Provider,{value:s},e.children)}}}]);