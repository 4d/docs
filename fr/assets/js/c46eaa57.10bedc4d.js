"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["46668"],{864225:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>l,toc:()=>c,default:()=>a,metadata:()=>r,assets:()=>o,contentTitle:()=>d});var r=JSON.parse('{"id":"WebServer/http-rules","title":"R\xe8gles de configuration HTTP","description":"Vous pouvez d\xe9finir des r\xe8gles de configuration HTTP pour contr\xf4ler les en-t\xeates de r\xe9ponse HTTP pour toutes les requ\xeates re\xe7ues par le serveur web 4D, y compris les requ\xeates REST. Vous pouvez ajouter, modifier ou supprimer des en-t\xeates HTTP, envoyer des redirections ou d\xe9finir le statut HTTP. Cette fonction est utile pour mettre en \u0153uvre des politiques de s\xe9curit\xe9 bas\xe9es sur le traitement des en-t\xeates.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/version-21/WebServer/http-rules.md","sourceDirName":"WebServer","slug":"/WebServer/http-rules","permalink":"/docs/fr/WebServer/http-rules","draft":false,"unlisted":false,"editUrl":"https://github.com/4d/docs/issues/new?title=Comment%20on%20WebServer%2Fhttp-rules.md%20(21)&body=Please%20enter%20your%20comment%3A","tags":[],"version":"21","frontMatter":{"id":"http-rules","title":"R\xe8gles de configuration HTTP"},"sidebar":"docs","previous":{"title":"Gestionnaire de requ\xeates HTTP","permalink":"/docs/fr/WebServer/http-request-handler"},"next":{"title":"Autoriser les m\xe9thodes projet","permalink":"/docs/fr/WebServer/allowProject"}}'),t=s(474848),i=s(884429);let l={id:"http-rules",title:"R\xe8gles de configuration HTTP"},d,o={},c=[{value:"Conditions requises",id:"conditions-requises",level:2},{value:"Comment d\xe9clarer des r\xe8gles",id:"comment-d\xe9clarer-des-r\xe8gles",level:2},{value:"D\xe9finition des r\xe8gles",id:"d\xe9finition-des-r\xe8gles",level:2},{value:"Motifs d&#39;URL",id:"motifs-durl",level:3},{value:"Actions",id:"actions",level:3},{value:"En-t\xeates non modifiables",id:"en-t\xeates-non-modifiables",level:3},{value:"R\xe8gles de configuration courantes",id:"r\xe8gles-de-configuration-courantes",level:3},{value:"Exemples",id:"exemples",level:2},{value:"Utilisation d&#39;un fichier HTTPRules.json",id:"utilisation-dun-fichier-httprulesjson",level:3},{value:"Utilisation du param\xe8tre <em>settings</em>",id:"utilisation-du-param\xe8tre-settings",level:3}];function u(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Vous pouvez d\xe9finir des r\xe8gles de configuration HTTP pour contr\xf4ler les en-t\xeates de r\xe9ponse HTTP pour toutes les requ\xeates re\xe7ues par le serveur web 4D, y compris les requ\xeates REST. Vous pouvez ajouter, modifier ou supprimer des en-t\xeates HTTP, envoyer des redirections ou d\xe9finir le statut HTTP. Cette fonction est utile pour mettre en \u0153uvre des politiques de s\xe9curit\xe9 bas\xe9es sur le traitement des en-t\xeates."}),"\n",(0,t.jsxs)(n.p,{children:["Pour d\xe9finir des r\xe8gles de configuration HTTP, il suffit d'\xe9crire quelques RegEx pour d\xe9clarer les motifs (",(0,t.jsx)(n.em,{children:"patterns"}),") d'URL que l'on souhaite contr\xf4ler, ainsi que la mani\xe8re de modifier les en-t\xeates de r\xe9ponse. Vous pouvez d\xe9finir ces r\xe8gles en utilisant un fichier ",(0,t.jsx)(n.code,{children:"HTTPRules.json"})," stock\xe9 dans le dossier du projet, ou en utilisant le param\xe8tre ",(0,t.jsx)(n.em,{children:"settings"})," de la fonction ",(0,t.jsx)(n.a,{href:"/docs/fr/API/WebServerClass#start",children:(0,t.jsx)(n.code,{children:"start()"})})," de l'objet serveur web."]}),"\n",(0,t.jsx)(n.h2,{id:"conditions-requises",children:"Conditions requises"}),"\n",(0,t.jsx)(n.p,{children:"Les r\xe8gles de configuration HTTP sont prises en charge dans les contextes suivants :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["les ",(0,t.jsx)(n.a,{href:"/docs/fr/WebServer/sessions#enabling-web-sessions",children:"sessions extensibles"})," ou ",(0,t.jsx)(n.a,{href:"/docs/fr/settings/web#no-sessions",children:"pas de sessions"})," sont activ\xe9es,"]}),"\n",(0,t.jsxs)(n.li,{children:["un serveur web ex\xe9cut\xe9 localement par 4D ou 4D Server, y compris ceux ",(0,t.jsx)(n.a,{href:"/docs/fr/WebServer/webServerObject",children:"ex\xe9cut\xe9s par des composants"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"comment-d\xe9clarer-des-r\xe8gles",children:"Comment d\xe9clarer des r\xe8gles"}),"\n",(0,t.jsx)(n.p,{children:"Vous pouvez d\xe9clarer des r\xe8gles de r\xe9ponse HTTP :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["dans un fichier de configuration nomm\xe9 ",(0,t.jsx)(n.strong,{children:"HTTPRules.json"})," stock\xe9 dans le dossier ",(0,t.jsx)(n.a,{href:"/docs/fr/Project/architecture#sources",children:(0,t.jsx)(n.code,{children:"Project/Sources"})})," du projet. Ces r\xe8gles sont charg\xe9es et appliqu\xe9es dans le serveur Web principal une fois qu'il a d\xe9marr\xe9."]}),"\n",(0,t.jsxs)(n.li,{children:["en utilisant une propri\xe9t\xe9 ",(0,t.jsx)(n.a,{href:"/docs/fr/API/WebServerClass#rules",children:(0,t.jsx)(n.code,{children:".rules"})})," d\xe9finie dans le param\xe8tre ",(0,t.jsx)(n.em,{children:"settings"})," de la fonction ",(0,t.jsx)(n.a,{href:"/docs/fr/API/WebServerClass#start",children:(0,t.jsx)(n.code,{children:"start()"})}),", pour n'importe quel objet serveur web :"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-4d",children:"WEB Server.start($settings.rules) //r\xe8gles au d\xe9marrage du serveur\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Si un fichier ",(0,t.jsx)(n.strong,{children:"HTTPRules.json"})," et un appel \xe0 la commande ",(0,t.jsx)(n.a,{href:"/docs/fr/commands/web-server",children:(0,t.jsx)(n.code,{children:"WEB Server"})})," avec un ",(0,t.jsx)(n.code,{children:"$settings.rules"})," valide sont utilis\xe9s simultan\xe9ment, la commande ",(0,t.jsx)(n.code,{children:"WEB Server"})," est prioritaire."]}),"\n",(0,t.jsxs)(n.p,{children:["Si l'URI de la requ\xeate ne correspond \xe0 aucun des ",(0,t.jsx)(n.em,{children:"patterns"})," RegEx, le serveur web renvoie une r\xe9ponse par d\xe9faut."]}),"\n",(0,t.jsx)(n.h2,{id:"d\xe9finition-des-r\xe8gles",children:"D\xe9finition des r\xe8gles"}),"\n",(0,t.jsxs)(n.p,{children:["Le fichier ",(0,t.jsx)(n.strong,{children:"HTTPRules.json"})," ou la propri\xe9t\xe9 ",(0,t.jsx)(n.a,{href:"/docs/fr/API/WebServerClass#rules",children:(0,t.jsx)(n.code,{children:".rules"})})," doit contenir une collection d'",(0,t.jsx)(n.strong,{children:"objets r\xe8gle"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Un objet r\xe8gle est d\xe9fini par:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'un RegEx d\xe9crivant un motif d\'URL, par exemple "^(.*\\.(jpg|jpeg|png|gif)"'}),"\n",(0,t.jsx)(n.li,{children:'le nom de l\'action \xe0 ex\xe9cuter pour la r\xe9ponse HTTP, par exemple "removeHeaders"'}),"\n",(0,t.jsx)(n.li,{children:'la valeur de l\'action, par exemple "X-Unwanted-Header1"'}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Les autres propri\xe9t\xe9s sont ignor\xe9es."}),"\n",(0,t.jsx)(n.h3,{id:"motifs-durl",children:"Motifs d'URL"}),"\n",(0,t.jsxs)(n.p,{children:["Les motifs d'URL sont donn\xe9s en utilisant des ",(0,t.jsx)(n.strong,{children:"expressions r\xe9guli\xe8res"}),". Pour d\xe9clarer un ",(0,t.jsx)(n.em,{children:"pattern"}),' d\'expression r\xe9guli\xe8re, utilisez le nom de propri\xe9t\xe9 "RegExPattern".']}),"\n",(0,t.jsxs)(n.p,{children:["Ex: ",(0,t.jsx)(n.code,{children:'"RegExPattern": "/Test/Authorized/(.*)"'})]}),"\n",(0,t.jsxs)(n.p,{children:["Lorsque le serveur web re\xe7oit une requ\xeate, ",(0,t.jsx)(n.strong,{children:"tous"})," les motifs d'URL sont d\xe9clench\xe9s s\xe9quentiellement dans l'ordre donn\xe9, et tous les motifs correspondants sont ex\xe9cut\xe9s. Si plusieurs actions modifient des ressources similaires, la derni\xe8re action ex\xe9cut\xe9e est prise en compte."]}),"\n",(0,t.jsx)(n.h3,{id:"actions",children:"Actions"}),"\n",(0,t.jsx)(n.p,{children:"Les mots-cl\xe9s d'action suivants sont pris en charge :"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Mot-cl\xe9"}),(0,t.jsx)(n.th,{children:"Value type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"removeHeaders"})}),(0,t.jsx)(n.td,{children:"Text ou collection de text"}),(0,t.jsx)(n.td,{children:"En-t\xeate(s) \xe0 supprimer des r\xe9ponses HTTP. Si un en-t\xeate \xe0 supprimer n'existe pas dans l'en-t\xeate de la r\xe9ponse, il est ignor\xe9."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"addHeaders"})}),(0,t.jsx)(n.td,{children:"Object"}),(0,t.jsx)(n.td,{children:"Nom (texte) et valeur (texte) des en-t\xeates \xe0 ajouter aux r\xe9ponses HTTP."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"setHeaders"})}),(0,t.jsx)(n.td,{children:"Object"}),(0,t.jsx)(n.td,{children:"Nom (texte) et valeur (texte) des en-t\xeates \xe0 modifier dans les r\xe9ponses HTTP. Si l'en-t\xeate \xe0 modifier n'existe pas dans l'en-t\xeate de la r\xe9ponse, il est ajout\xe9."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"denyAccess"})}),(0,t.jsx)(n.td,{children:"Boolean"}),(0,t.jsx)(n.td,{children:"true pour refuser l'acc\xe8s \xe0 la ressource, false pour l'autoriser. Lorsque l'acc\xe8s \xe0 une ressource est refus\xe9, le serveur web renvoie un statut 403 par d\xe9faut"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"redirect"})}),(0,t.jsx)(n.td,{children:"Text"}),(0,t.jsx)(n.td,{children:"URL de redirection. Lorsqu'une redirection est d\xe9clench\xe9e, le serveur web renvoie par d\xe9faut un statut 302"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"status"})}),(0,t.jsx)(n.td,{children:"Number"}),(0,t.jsx)(n.td,{children:"Statut HTTP"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"en-t\xeates-non-modifiables",children:"En-t\xeates non modifiables"}),"\n",(0,t.jsx)(n.p,{children:"Certains en-t\xeates ne peuvent pas \xeatre ajout\xe9s, modifi\xe9s ou supprim\xe9s :"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"En-t\xeate"}),(0,t.jsx)(n.th,{children:"Ajout"}),(0,t.jsx)(n.th,{children:"Modification"}),(0,t.jsx)(n.th,{children:"Suppression"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Date"}),(0,t.jsx)(n.td,{children:"Non"}),(0,t.jsx)(n.td,{children:"Non"}),(0,t.jsx)(n.td,{children:"Non"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Content-Length"}),(0,t.jsx)(n.td,{children:"Non"}),(0,t.jsx)(n.td,{children:"Non"}),(0,t.jsx)(n.td,{children:"Non"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Content-Encoding"}),(0,t.jsx)(n.td,{children:"Non"}),(0,t.jsx)(n.td,{children:"Non"}),(0,t.jsx)(n.td,{children:"Non"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Vary"}),(0,t.jsx)(n.td,{children:"Oui"}),(0,t.jsx)(n.td,{children:"Non"}),(0,t.jsx)(n.td,{children:"Non"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Set-Cookie"}),(0,t.jsx)(n.td,{children:"Oui"}),(0,t.jsx)(n.td,{children:"Ajoute un cookie"}),(0,t.jsx)(n.td,{children:"Non"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Les modifications non autoris\xe9es de ces en-t\xeates ne g\xe9n\xe8rent pas d'erreurs, mais les modifications seront ignor\xe9es."}),"\n",(0,t.jsx)(n.h3,{id:"r\xe8gles-de-configuration-courantes",children:"R\xe8gles de configuration courantes"}),"\n",(0,t.jsxs)(n.p,{children:["Vous pouvez conna\xeetre les r\xe8gles en vigueur en utilisant la ",(0,t.jsxs)(n.a,{href:"/docs/fr/API/WebServerClass#rules",children:["propri\xe9t\xe9 ",(0,t.jsx)(n.code,{children:".rules"})," de l'objet Serveur Web"]})," :"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"var $rules : Collection\n$rules:=WEB Server.rules //r\xe8gles de configuration courantes\n"})}),"\n",(0,t.jsx)(n.h2,{id:"exemples",children:"Exemples"}),"\n",(0,t.jsxs)(n.p,{children:["Les r\xe8gles de configuration peuvent \xeatre d\xe9finies en utilisant un fichier ",(0,t.jsx)(n.code,{children:"HTTPRules.json"})," ou le param\xe8tre ",(0,t.jsx)(n.em,{children:"settings"})," de la fonction ",(0,t.jsx)(n.a,{href:"/docs/fr/API/WebServerClass#start",children:(0,t.jsx)(n.code,{children:".start()"})})," du serveur web."]}),"\n",(0,t.jsx)(n.h3,{id:"utilisation-dun-fichier-httprulesjson",children:"Utilisation d'un fichier HTTPRules.json"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'\n[\n	{\n		"comment": "Toutes requ\xeates: autoriser m\xe9thode GET, supprimer en-t\xeate \'Server\' et d\xe9finir en-t\xeates de s\xe9curit\xe9",\n		"regexPattern": "/(.*)",\n		"setHeaders": {\n			"Allow": "GET",\n			"X-Frame-Options": "SAMEORIGIN",\n			"Content-Security-Policy": "default-src \'self\'"\n		},\n		"removeHeaders": [\n			"Server"\n		]\n	},\n	{\n		"comment": "requ\xeates REST: autoriser m\xe9thode POST",\n		"regexPattern": "/rest/(.*)",\n		"addHeaders": {\n			"Allow": "POST"\n		}\n	},\n	{\n		"comment": "Fichiers html dans dossier \'doc\' : contr\xf4le du cache",\n		"regexPattern": "/docs/(.*).html",\n		"setHeaders": {\n			"Cache-Control": "max-age=3600"\n		},\n		"removeHeaders": [\n			"X-Powered-By"\n		]\n	},\n	{\n		"comment": "Status 503 sur page \'maintenance\'",\n		"regexPattern": "^/maintenance.html",\n		"status": 503\n	},\n	{\n		"comment": "Redirection fichiers CSS et JS",\n		"regexPattern": "^(.*\\\\\\\\.(css|js))",\n		"redirect": "https://cdn.example.com/"\n	},\n	{\n		"comment": "Redirection images avec code de statut permanent",\n		"regexPattern": "^(.*\\\\\\\\.(jpg|jpeg|png|gif))",\n		"redirect": "https://cdn.example.com/images/",\n		"status": 301\n	},\n	{\n		"comment": "Refuser acc\xe8s \xe0 toutes les ressources dans le dossier \'private\'",\n		"regexPattern": "/private/(.*)",\n		"denyAccess": true\n	},\n	{\n		"comment": "Autoriser acc\xe8s \xe0 toutes les ressources dans le dossier \'private/allowed\'",\n		"regexPattern": "/private/allowed/(.*)",\n		"denyAccess": false\n	}\n]\n\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"utilisation-du-param\xe8tre-settings",children:["Utilisation du param\xe8tre ",(0,t.jsx)(n.em,{children:"settings"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-4d",children:'var $rule:={}\n\nvar $settings:={}\n\n$settings.rules:=[]\n\n$rule:={}\n$rule.comment:="Toutes requ\xeates: autoriser m\xe9thode GET, supprimer en-t\xeate \'Server\' et d\xe9finir en-t\xeates de s\xe9curit\xe9"\n$rule.regexPattern:="/(.*)"\n$rule.setHeaders:={Allow: "GET"}\n$rule.setHeaders["X-Frame-Options"]:="SAMEORIGIN"\n$rule.setHeaders["Content-Security-Policy"]:="default-src \'self\'"\n$rule.removeHeaders:=["Server"]\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="requ\xeates REST: autoriser m\xe9thode POST"\n$rule.regexPattern:="/rest/(.*)"\n$rule.addHeaders:={Allow: "POST"}\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Fichiers html dans dossier \'doc\' : contr\xf4le du cache"\n$rule.regexPattern:="/docs/(.*).html"\n$rule.setHeaders:={}\n$rule.setHeaders["Cache-Control"]:="max-age=3600"\n$rule.removeHeaders:=["X-Powered-By"]\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Status 503 sur page \'maintenance\'"\n$rule.regexPattern:="^/maintenance.html"\n$rule.status:=503\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Redirection fichiers CSS et JS"\n$rule.regexPattern:="^(.*\\\\\\\\.(css|js))"\n$rule.redirect:="https://cdn.example.com/"\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Redirection images avec code de statut permanent"\n$rule.regexPattern:="^(.*\\\\\\\\.(jpg|jpeg|png|gif))"\n$rule.redirect:="https://cdn.example.com/images/"\n$rule.status:=301\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Refuser acc\xe8s \xe0 toutes les ressources dans le dossier \'private\'"\n$rule.regexPattern:="/private/(.*)"\n$rule.denyAccess:=True\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Autoriser acc\xe8s \xe0 toutes les ressources dans le dossier \'private/allowed\'"\n$rule.regexPattern:="/private/allowed/(.*)"\n$rule.denyAccess:=False\n$settings.rules.push($rule)\n\n$return:=WEB Server.start($settings)\n\n'})}),"\n",(0,t.jsx)(n.admonition,{title:"Article(s) de blog sur le sujet",type:"tip",children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://blog.4d.com/new-way-to-control-your-http-responses/",children:"New Way to Control Your HTTP Responses"})})})]})}function a(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},884429:function(e,n,s){s.d(n,{R:()=>l,x:()=>d});var r=s(296540);let t={},i=r.createContext(t);function l(e){let n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);