"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["59717"],{227650:function(e,s,n){n.r(s),n.d(s,{default:()=>c,frontMatter:()=>o,metadata:()=>t,assets:()=>l,toc:()=>d,contentTitle:()=>a});var t=JSON.parse('{"id":"REST/authUsers","title":"Sessions et utilisateurs","description":"Les requ\xeates REST peuvent b\xe9n\xe9ficier des sessions utilisateurs web, offrant des fonctionnalit\xe9s suppl\xe9mentaires telles que la gestion de requ\xeates multiples, le partage de donn\xe9es entre les process du client web, et les privil\xe8ges utilisateur.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/version-20/REST/authUsers.md","sourceDirName":"REST","slug":"/REST/authUsers","permalink":"/docs/fr/20/REST/authUsers","draft":false,"unlisted":false,"editUrl":"https://github.com/4d/docs/issues/new?title=Comment%20on%20REST%2FauthUsers.md%20(20)&body=Please%20enter%20your%20comment%3A","tags":[],"version":"20","frontMatter":{"id":"authUsers","title":"Sessions et utilisateurs"},"sidebar":"docs","previous":{"title":"Configuration du serveur","permalink":"/docs/fr/20/REST/configuration"},"next":{"title":"Obtenir des informations du serveur","permalink":"/docs/fr/20/REST/genInfo"}}'),i=n("785893"),r=n("250065");let o={id:"authUsers",title:"Sessions et utilisateurs"},a=void 0,l={},d=[{value:"Authentification des utilisateurs",id:"authentification-des-utilisateurs",level:2},{value:"Ouverture des sessions",id:"ouverture-des-sessions",level:2},{value:"Mode pr\xe9emptif",id:"mode-pr\xe9emptif",level:2},{value:"Exemple",id:"exemple",level:2}];function u(e){let s={a:"a",blockquote:"blockquote",code:"code",h2:"h2",img:"img",p:"p",pre:"pre",strong:"strong",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s.p,{children:["Les requ\xeates REST peuvent b\xe9n\xe9ficier des ",(0,i.jsx)(s.a,{href:"/docs/fr/20/WebServer/sessions",children:"sessions utilisateurs web"}),", offrant des fonctionnalit\xe9s suppl\xe9mentaires telles que la gestion de requ\xeates multiples, le partage de donn\xe9es entre les process du client web, et les privil\xe8ges utilisateur."]}),"\n",(0,i.jsx)(s.p,{children:"La premi\xe8re \xe9tape \xe0 suivre pour ouvrir une session REST sur le serveur 4D, consiste \xe0 authentifier l'utilisateur qui envoie la requ\xeate."}),"\n",(0,i.jsx)(s.h2,{id:"authentification-des-utilisateurs",children:"Authentification des utilisateurs"}),"\n",(0,i.jsxs)(s.p,{children:["Vous connectez un utilisateur \xe0 votre application en appelant ",(0,i.jsx)(s.a,{href:"/docs/fr/20/REST/directory#directorylogin",children:(0,i.jsx)(s.code,{children:"$directory/login"})})," dans une requ\xeate POST incluant le nom et le mot de passe de l'utilisateur dans l'en-t\xeate. Cette requ\xeate appelle la m\xe9thode base ",(0,i.jsx)(s.code,{children:"On REST Authentication"})," (si elle existe), o\xf9 vous pouvez v\xe9rifier les informations d'identification de l'utilisateur (voir l'exemple ci-dessous)."]}),"\n",(0,i.jsx)(s.h2,{id:"ouverture-des-sessions",children:"Ouverture des sessions"}),"\n",(0,i.jsxs)(s.p,{children:["Lorsque les ",(0,i.jsx)(s.a,{href:"/docs/fr/20/WebServer/sessions#enabling-sessions",children:"sessions \xe9volutives sont activ\xe9es"})," (recommand\xe9), si la m\xe9thode base ",(0,i.jsx)(s.code,{children:"On REST Authentication"})," retourne ",(0,i.jsx)(s.code,{children:"true"}),", une session utilisateur est alors automatiquement ouverte et vous pouvez la g\xe9rer via l'objet ",(0,i.jsx)(s.code,{children:"Session"})," et ",(0,i.jsx)(s.a,{href:"/docs/fr/20/API/SessionClass",children:"l'API Session"}),". Les requ\xeates REST ult\xe9rieures r\xe9utilisent le m\xeame cookie de session."]}),"\n",(0,i.jsxs)(s.p,{children:["Si la m\xe9thode base ",(0,i.jsx)(s.code,{children:"On REST Authentication"})," n'a pas \xe9t\xe9 d\xe9finie, une session ",(0,i.jsx)(s.code,{children:"guest"})," est ouverte."]}),"\n",(0,i.jsx)(s.h2,{id:"mode-pr\xe9emptif",children:"Mode pr\xe9emptif"}),"\n",(0,i.jsxs)(s.p,{children:["Sur 4D Server, les requ\xeates REST sont automatiquement trait\xe9es par des process pr\xe9emptifs, ",(0,i.jsx)(s.strong,{children:"m\xeame en mode interpr\xe9t\xe9"}),". Vous devez vous assurer que votre code est ",(0,i.jsx)(s.a,{href:"/docs/fr/20/WebServer/preemptiveWeb#writing-thread-safe-web-server-code",children:"conforme \xe0 l'ex\xe9cution pr\xe9emptive"}),"."]}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsxs)(s.p,{children:["Pour d\xe9boguer le code web interpr\xe9t\xe9 sur la machine serveur, assurez-vous que le d\xe9bogueur est ",(0,i.jsx)(s.a,{href:"/docs/fr/20/Debugging/debugging-remote",children:"attach\xe9 au serveur"})," ou ",(0,i.jsx)(s.a,{href:"/docs/fr/20/Debugging/debugging-remote",children:"\xe0 une machine distante"}),". Les process Web passent alors en mode coop\xe9ratif et le code du serveur Web peut \xeatre d\xe9bogu\xe9."]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Avec 4D monoposte, le code interpr\xe9t\xe9 s'ex\xe9cute toujours en mode coop\xe9ratif."}),"\n",(0,i.jsx)(s.h2,{id:"exemple",children:"Exemple"}),"\n",(0,i.jsxs)(s.p,{children:["Dans cet exemple, l'utilisateur saisit son adresse email et son mot de passe dans une page html qui requ\xeate ",(0,i.jsx)(s.a,{href:"/docs/fr/20/REST/directory#directorylogin",children:(0,i.jsx)(s.code,{children:"$directory/login"})})," dans un POST (il est recommand\xe9 d'utiliser une connexion HTTPS pour envoyer la page html). La m\xe9thode base ",(0,i.jsx)(s.code,{children:"On REST Authentication"})," est appel\xe9e afin de vous permettre d\u2019\xe9valuer ces identifiants et de d\xe9finir la session."]}),"\n",(0,i.jsx)(s.p,{children:"La page de connexion HTML :"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"alt-text",src:n(122878).Z+"",width:"268",height:"85"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-html",children:'<html><body bgcolor="#ffffff">\n\n<div id="demo">\n    <FORM name="myForm">\nEmail: <INPUT TYPE=TEXT NAME=userId VALUE=""><br/>\nPassword: <INPUT TYPE=TEXT NAME=password VALUE=""><br/>\n<button type="button" onclick="onClick()">\nLogin\n</button>\n<div id="authenticationFailed" style="visibility:hidden;">Authentication failed</div>\n</FORM>\n</div>\n\n<script>\nfunction sendData(data) {\n  var XHR = new XMLHttpRequest();\n\n  XHR.onreadystatechange = function() {\n    if (this.status == 200) {      \n      window.location = "authenticationOK.shtml"; \n      }\n      else {\n      document.getElementById("authenticationFailed").style.visibility = "visible";\n      }\n  };\n\n  XHR.open(\'POST\', \'http://127.0.0.1:8044/rest/$directory/login\'); //rest server address\n\n  XHR.setRequestHeader(\'username-4D\', data.userId);\n  XHR.setRequestHeader(\'password-4D\', data.password);\n  XHR.setRequestHeader(\'session-4D-length\', data.timeout);\n\n  XHR.send();\n};\nfunction onClick()\n{\nsendData({userId:document.forms[\'myForm\'].elements[\'userId\'].value , password:document.forms[\'myForm\'].elements[\'password\'].value , timeout:120})\n}\n<\/script></body></html>\n\n'})}),"\n",(0,i.jsxs)(s.p,{children:["Lorsque la page de connexion est envoy\xe9e au serveur, la m\xe9thode base ",(0,i.jsx)(s.code,{children:"On REST Authentication"})," est appel\xe9e :"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-4d",children:'    //On REST Authentication\n\n#DECLARE($userId : Text; $password : Text) -> $Accepted : Boolean\nvar $sales : cs.SalesPersonsEntity\n\n$Accepted:=False\n\n //Un url \'/rest\' a \xe9t\xe9 appel\xe9 avec les en-t\xeates username-4D et password-4D\nIf ($userId#"")\n    $sales:=ds.SalesPersons.query("email = :1"; $userId).first()\n    If ($sales#Null)\n        If (Verify password hash($password; $sales.password))\n            fillSession($sales)\n            $Accepted:=True\n        End if \n    End if \nEnd if \n'})}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsxs)(s.p,{children:["D\xe8s qu'elle a \xe9t\xe9 appel\xe9e et qu'elle a renvoy\xe9 ",(0,i.jsx)(s.code,{children:"True"}),", la m\xe9thode base ",(0,i.jsx)(s.code,{children:"On REST Authentication"})," n'est plus appel\xe9e dans la session."]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["La m\xe9thode projet ",(0,i.jsx)(s.code,{children:"fillSession"})," initialise la session utilisateur, par exemple :"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-4d",children:'#DECLARE($sales : cs.SalesPersonsEntity)\nvar $info : Object\n\n$info:=New object()\n$info.userName:=$sales.firstname+" "+$sales.lastname\n\nSession.setPrivileges($info)\n\nUse (Session.storage)\n    If (Session.storage.myTop3=Null)\n        Session.storage.myTop3:=$sales.customers.orderBy("totalPurchase desc").slice(0; 3)\n    End if \nEnd use\n'})})]})}function c(e={}){let{wrapper:s}={...(0,r.a)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},122878:function(e,s,n){n.d(s,{Z:function(){return t}});let t="data:image/png;base64,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"},250065:function(e,s,n){n.d(s,{Z:function(){return a},a:function(){return o}});var t=n(667294);let i={},r=t.createContext(i);function o(e){let s=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);