"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[86727],{603905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>c});var a=n(667294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),m=u(n),c=r,g=m["".concat(s,".").concat(c)]||m[c]||p[c]||l;return n?a.createElement(g,i(i({ref:t},d),{},{components:n})):a.createElement(g,i({ref:t},d))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var u=2;u<l;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},221640:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>d});n(667294);var a=n(603905);function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const i={id:"global-stamp",title:"Utiliser le marqueur global"},o=void 0,s={unversionedId:"ORDA/global-stamp",id:"version-20-R5/ORDA/global-stamp",title:"Utiliser le marqueur global",description:"Vue d\u2019ensemble",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-20-R5/ORDA/global-stamp.md",sourceDirName:"ORDA",slug:"/ORDA/global-stamp",permalink:"/docs/fr/ORDA/global-stamp",draft:!1,editUrl:"https://github.com/4d/docs/issues/new?title=Comment%20on%20ORDA%2Fglobal-stamp.md%20(20-R5)&body=Please%20enter%20your%20comment%3A",tags:[],version:"20-R5",frontMatter:{id:"global-stamp",title:"Utiliser le marqueur global"},sidebar:"docs",previous:{title:"Travailler avec les donn\xe9es",permalink:"/docs/fr/ORDA/entities"},next:{title:"Datastores distants",permalink:"/docs/fr/ORDA/datastores"}},u={},d=[{value:"Vue d\u2019ensemble",id:"vue-densemble",level:2},{value:"Configuration du suivi des changements de donn\xe9es",id:"configuration-du-suivi-des-changements-de-donn\xe9es",level:2},{value:"Configuration de la structure",id:"configuration-de-la-structure",level:3},{value:"Utilisation de l&#39;Editeur de structure",id:"utilisation-de-lediteur-de-structure",level:3},{value:"Exemple",id:"exemple",level:2}],p={toc:d};function m(e){var{components:t}=e,n=l(e,["components"]);return(0,a.kt)("wrapper",r({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",r({},{id:"vue-densemble"}),"Vue d\u2019ensemble"),(0,a.kt)("p",null,"4D g\xe8re automatiquement un ",(0,a.kt)("strong",{parentName:"p"},"marqueur de modification globale")," interne, utile en cas d'impl\xe9mentation d'un suivi des modifications de donn\xe9es, par exemple pour surveiller l'activit\xe9, la sauvegarde, la synchronisation incr\xe9mentielle, etc."),(0,a.kt)("p",null,"Le marqueur de modification global est un nombre, toujours maintenu par 4D, m\xeame en cas de restitution de la base de donn\xe9es, d'importation, etc. Notez cependant que le marqueur peut \xeatre modifi\xe9 par la fonction ",(0,a.kt)("a",r({parentName:"p"},{href:"/docs/fr/API/DataStoreClass#setglobalstamp"}),(0,a.kt)("inlineCode",{parentName:"a"},".setGlobalStamp()")),"."),(0,a.kt)("p",null,"Une fois que le ",(0,a.kt)("a",r({parentName:"p"},{href:"#configuring-data-change-tracking"}),"suivi des changements de donn\xe9es est configur\xe9 et activ\xe9"),", les actions suivantes sont automatiquement ex\xe9cut\xe9es par 4D \xe0 chaque modification de l'enregistrement (ajout, modification, suppression) :"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"La valeur courante du marqueur de modification globale est stock\xe9e dans l'attribut sp\xe9cial \"",(0,a.kt)("strong",{parentName:"p"},"GlobalStamp\" de l'entit\xe9 concern\xe9e.\nEn cas de suppression, une nouvelle entit\xe9 est \xe9galement ajout\xe9e dans la table `"),"DeletedRecords` avec des informations \xe0 propos de l'entit\xe9 supprim\xe9e et la valeur courante du marqueur de modification global est enregistr\xe9e dans l'attribut \"__Stamp\".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"La valeur du marqueur de modification global est incr\xe9ment\xe9e."))),(0,a.kt)("p",null,"Ce m\xe9canisme vous permet d'identifier les entit\xe9s qui ont \xe9t\xe9 modifi\xe9es, ajout\xe9es ou supprim\xe9es depuis un point dans le temps, et de mettre en \u0153uvre toute action appropri\xe9e (voir exemple)."),(0,a.kt)("admonition",r({},{type:"info"}),(0,a.kt)("p",{parentName:"admonition"},"Ne confondez pas le ",(0,a.kt)("strong",{parentName:"p"},"marqueur de modification global")," avec le ",(0,a.kt)("strong",{parentName:"p"},"marqueur interne d'entit\xe9"),", utilis\xe9 pour la fonctionnalit\xe9 de ",(0,a.kt)("a",r({parentName:"p"},{href:"/docs/fr/ORDA/entities#automatic-optimistic-lock"}),"verrouillage optimiste"),".")),(0,a.kt)("h2",r({},{id:"configuration-du-suivi-des-changements-de-donn\xe9es"}),"Configuration du suivi des changements de donn\xe9es"),(0,a.kt)("p",null,"Par d\xe9faut, le marqueur de modification global n'est pas cr\xe9\xe9 (la fonction ",(0,a.kt)("a",r({parentName:"p"},{href:"/docs/fr/API/DataStoreClass#getglobalstamp"}),(0,a.kt)("inlineCode",{parentName:"a"},".getGlobalStamp()"))," retourne 0. Pour activer le suivi des changements de donn\xe9es, vous devez ajouter des champs sp\xe9ciaux et une table \xe0 votre structure. Vous pouvez utiliser le menu contextuel de l'\xe9diteur de structure pour cr\xe9er automatiquement tous les \xe9l\xe9ments n\xe9cessaires."),(0,a.kt)("h3",r({},{id:"configuration-de-la-structure"}),"Configuration de la structure"),(0,a.kt)("p",null,"Pour activer le suivi des changements de donn\xe9es, la structure de l'application doit contenir au moins une table avec un champ ",(0,a.kt)("inlineCode",{parentName:"p"},"__GlobalStamp"),"."),(0,a.kt)("p",null,"De plus, pour assurer la bonne marche de la fonctionnalit\xe9, les conditions suivantes sont requises :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Le champ ",(0,a.kt)("inlineCode",{parentName:"li"},"__GlobalStamp")," doit \xeatre de type ",(0,a.kt)("em",{parentName:"li"},"Integer 64 bits"),", avec ",(0,a.kt)("em",{parentName:"li"},"index automatique"),", ",(0,a.kt)("em",{parentName:"li"},"Exposer comme ressource REST"),", et ",(0,a.kt)("em",{parentName:"li"},"Invisible")," s\xe9lectionn\xe9."),(0,a.kt)("li",{parentName:"ul"},"Une table ",(0,a.kt)("inlineCode",{parentName:"li"},"__DeletedRecords")," doit \xeatre ajout\xe9e, avec les champs suivants :")),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Champ"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"__PrimaryKey"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Cl\xe9 primaire de l'entit\xe9 supprim\xe9e")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"__Stamp"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Integer 64 bits"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Marqueur global juste avant la suppression")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"__TableName"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Nom de la table de l'entit\xe9 supprim\xe9e")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"__TableNumber"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Longint"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Num\xe9ro de la table de l'entit\xe9 supprim\xe9e")))),(0,a.kt)("p",null,"Vous ne pouvez suivre que les changements de donn\xe9es dans les tables ayant le champ ",(0,a.kt)("inlineCode",{parentName:"p"},"__GlobalStamp"),"."),(0,a.kt)("admonition",r({},{type:"note"}),(0,a.kt)("p",{parentName:"admonition"},"Dans le langage 4D, la valeur du champ ",(0,a.kt)("inlineCode",{parentName:"p"},"__GlobalStamp")," doit \xeatre g\xe9r\xe9e par le biais d'une variable de type ",(0,a.kt)("inlineCode",{parentName:"p"},"Real"),".")),(0,a.kt)("h3",r({},{id:"utilisation-de-lediteur-de-structure"}),"Utilisation de l'Editeur de structure"),(0,a.kt)("p",null,"L'Editeur de structure de 4D vous permet d'activer ou de d\xe9sactiver le suivi du changement de donn\xe9es \xe0 l'aide d'une commande de menu."),(0,a.kt)("p",null,"Pour activer le suivi des changements de donn\xe9es :"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"S\xe9lectionnez la ou les table(s) pour lesquelles vous souhaitez activer le suivi des changements de donn\xe9es."),(0,a.kt)("li",{parentName:"ol"},"Faites un clic droit sur une table s\xe9lectionn\xe9e et choisissez ",(0,a.kt)("strong",{parentName:"li"},"Activer le suivi du changement de donn\xe9es")," dans le menu contextuel."),(0,a.kt)("li",{parentName:"ol"},"Une bo\xeete de dialogue de confirmation s'affiche. Cliquez sur ",(0,a.kt)("strong",{parentName:"li"},"OK"),".")),(0,a.kt)("p",null,"4D effectue alors les modifications suivantes :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Un champ ",(0,a.kt)("inlineCode",{parentName:"li"},"__GlobalStamp")," pr\xe9configur\xe9 est ajout\xe9 \xe0 la ou aux table(s)."),(0,a.kt)("li",{parentName:"ul"},"Si elle n'existe pas d\xe9j\xe0, une table ",(0,a.kt)("inlineCode",{parentName:"li"},"__DeletedRecords")," est ajout\xe9e \xe0 la structure.")),(0,a.kt)("p",null,"Pour d\xe9sactiver le suivi des changements de donn\xe9es :"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"S\xe9lectionnez la ou les table(s) pour lesquelles vous souhaitez supprimer le suivi des changements de donn\xe9es."),(0,a.kt)("li",{parentName:"ol"},"Faites un clic droit sur une table s\xe9lectionn\xe9e et choisissez ",(0,a.kt)("strong",{parentName:"li"},"D\xe9sactiver le suivi du changement de donn\xe9es")," dans le menu contextuel."),(0,a.kt)("li",{parentName:"ol"},"Une bo\xeete de dialogue de confirmation s'affiche. Cliquez sur ",(0,a.kt)("strong",{parentName:"li"},"OK"),".")),(0,a.kt)("p",null,"4D supprime alors le champ ",(0,a.kt)("inlineCode",{parentName:"p"},"__GlobalStamp")," de la ou des table(s). Notez que si vous voulez supprimer la table ",(0,a.kt)("inlineCode",{parentName:"p"},"__DeletedRecords"),", vous devez le faire manuellement."),(0,a.kt)("h2",r({},{id:"exemple"}),"Exemple"),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-4d"}),'var $oldStamp : Real\nvar $tableName : Text\nvar $modifiedEmps : cs.EmployeeSelection\nvar $deletedEmpsInfo : cs.__DeletedRecordsSelection\n\n$tableName:="Employee"\n$oldStamp:=... //load the previous stamp value  \n    //from which you want to compare the current stamp\n\nIf ($oldStamp # ds.getGlobalStamp())\n        //get all new or modified entities\n    $modifiedEmps:=ds[$tableName].query("__GlobalStamp > :1"; $oldStamp)\n        //get all deleted entities\n    $deletedEmpsInfo:=ds.__DeletedRecords.query("__Stamp > :1 and __TableName = :2";\\\n    $oldStamp; $tableName)\nEnd if\n')))}m.isMDXComponent=!0}}]);