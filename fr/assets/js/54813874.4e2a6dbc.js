"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["29678"],{661701:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>l,toc:()=>a,default:()=>u,metadata:()=>r,assets:()=>d,contentTitle:()=>o});var r=JSON.parse('{"id":"WebServer/http-request-handler","title":"Gestionnaire de requ\xeates HTTP","description":"Par d\xe9faut, les requ\xeates HTTP re\xe7ues par le serveur web 4D sont trait\xe9es par des fonctionalit\xe9s int\xe9gr\xe9es de traitement ou le serveur REST.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/version-21/WebServer/http-request-handler.md","sourceDirName":"WebServer","slug":"/WebServer/http-request-handler","permalink":"/docs/fr/WebServer/http-request-handler","draft":false,"unlisted":false,"editUrl":"https://github.com/4d/docs/issues/new?title=Comment%20on%20WebServer%2Fhttp-request-handler.md%20(21)&body=Please%20enter%20your%20comment%3A","tags":[],"version":"21","frontMatter":{"id":"http-request-handler","title":"Gestionnaire de requ\xeates HTTP"},"sidebar":"docs","previous":{"title":"Traitement des requ\xeates HTTP","permalink":"/docs/fr/WebServer/httpRequests"},"next":{"title":"HTTP Rules","permalink":"/docs/fr/WebServer/http-rules"}}'),i=s(474848),t=s(884429);let l={id:"http-request-handler",title:"Gestionnaire de requ\xeates HTTP"},o,d={},a=[{value:"Conditions requises",id:"conditions-requises",level:2},{value:"Comment d\xe9finir les gestionnaires",id:"comment-d\xe9finir-les-gestionnaires",level:2},{value:"D\xe9finition du gestionnaire",id:"d\xe9finition-du-gestionnaire",level:2},{value:"Motifs d&#39;URL",id:"motifs-durl",level:3},{value:"Correspondance des motifs",id:"correspondance-des-motifs",level:4},{value:"Motifs non autoris\xe9s",id:"motifs-non-autoris\xe9s",level:4},{value:"Class et method",id:"class-et-method",level:3},{value:"Verbs",id:"verbs",level:3},{value:"Exemple",id:"exemple",level:2},{value:"Code du gestionnaire de requ\xeate",id:"code-du-gestionnaire-de-requ\xeate",level:2},{value:"Configuration des fonctions",id:"configuration-des-fonctions",level:3},{value:"Entr\xe9e : une instance de la classe 4D.IncomingMessage",id:"entr\xe9e--une-instance-de-la-classe-4dincomingmessage",level:3},{value:"Sortie : une instance de la classe 4D.OutgoingMessage",id:"sortie--une-instance-de-la-classe-4doutgoingmessage",level:3},{value:"Exemple",id:"exemple-1",level:3},{value:"Voir \xe9galement",id:"voir-\xe9galement",level:2}];function c(e){let n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Par d\xe9faut, les requ\xeates HTTP re\xe7ues par le serveur web 4D sont trait\xe9es par des ",(0,i.jsx)(n.a,{href:"/docs/fr/WebServer/httpRequests",children:"fonctionalit\xe9s int\xe9gr\xe9es de traitement"})," ou le ",(0,i.jsx)(n.a,{href:"/docs/fr/REST/REST_requests",children:"serveur REST"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Toutefois, 4D prend en charge la mise en \u0153uvre de ",(0,i.jsx)(n.strong,{children:"gestionnaires de requ\xeates HTTP personnalis\xe9s"})," (",(0,i.jsx)(n.em,{children:"custom HTTP handlers"}),"), vous permettant d'intercepter des requ\xeates HTTP entrantes sp\xe9cifiques et de les traiter \xe0 l'aide de votre propre code."]}),"\n",(0,i.jsxs)(n.p,{children:["Lorsqu'un gestionnaire de requ\xeate HTTP personnalis\xe9 intercepte une requ\xeate, celle-ci est trait\xe9e directement et aucune autre fonctionnalit\xe9 de traitement (par exemple, les m\xe9thodes base ",(0,i.jsx)(n.a,{href:"/docs/fr/WebServer/authentication#on-web-authentication",children:"On Web authentication"})," ou ",(0,i.jsx)(n.a,{href:"/docs/fr/WebServer/httpRequests#on-web-connection",children:"On Web connection"}),") n'est appel\xe9e."]}),"\n",(0,i.jsx)(n.p,{children:"Les gestionnaires de requ\xeates HTTP personnalis\xe9s r\xe9pondent \xe0 divers besoins, y compris :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"l'utilisation d'une URL d\xe9di\xe9e comme fournisseur de ressources ou comme zone de t\xe9l\xe9chargement de fichiers (pour t\xe9l\xe9charger ou t\xe9l\xe9verser divers fichiers),"}),"\n",(0,i.jsx)(n.li,{children:"la redirection sur des pages sp\xe9cifiques en fonction d'un contexte (utilisateur authentifi\xe9, privil\xe8ges accord\xe9s...),"}),"\n",(0,i.jsx)(n.li,{children:"la gestion d'une authentification via oAuth 2.0."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"conditions-requises",children:"Conditions requises"}),"\n",(0,i.jsx)(n.p,{children:"Les gestionnaires de requ\xeates HTTP personnalis\xe9s sont pris en charge dans le contexte suivant :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["les ",(0,i.jsx)(n.a,{href:"/docs/fr/WebServer/sessions#enabling-web-sessions",children:"sessions extensibles"})," ou ",(0,i.jsx)(n.a,{href:"/docs/fr/settings/web#no-sessions",children:"pas de sessions"})," sont activ\xe9es,"]}),"\n",(0,i.jsxs)(n.li,{children:["un serveur web ex\xe9cut\xe9 localement par 4D ou 4D Server, y compris ceux ",(0,i.jsx)(n.a,{href:"/docs/fr/WebServer/webServerObject",children:"ex\xe9cut\xe9s par des composants"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["Pour des raisons de s\xe9curit\xe9, l'acc\xe8s externe au datastore peut \xeatre interdit dans 4D. Vous devez configurer les ",(0,i.jsx)(n.a,{href:"/docs/fr/ORDA/privileges",children:"privil\xe8ges ORDA"})," pour autoriser les requ\xeates HTTP."]})}),"\n",(0,i.jsx)(n.h2,{id:"comment-d\xe9finir-les-gestionnaires",children:"Comment d\xe9finir les gestionnaires"}),"\n",(0,i.jsx)(n.p,{children:"Vous pouvez d\xe9clarer des gestionnaires de requ\xeates HTTP :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["dans un fichier de configuration nomm\xe9 ",(0,i.jsx)(n.strong,{children:"HTTPHandlers.json"})," stock\xe9 dans le dossier ",(0,i.jsx)(n.a,{href:"/docs/fr/Project/architecture#sources",children:(0,i.jsx)(n.code,{children:"Project/Sources"})})," du projet. Les gestionnaires de requ\xeates HTTP sont charg\xe9s et appliqu\xe9s dans le serveur Web principal une fois qu'il est d\xe9marr\xe9."]}),"\n",(0,i.jsxs)(n.li,{children:["en utilisant une propri\xe9t\xe9 ",(0,i.jsx)(n.a,{href:"/docs/fr/API/WebServerClass#handlers",children:(0,i.jsx)(n.code,{children:".handlers"})})," dans le param\xe8tre ",(0,i.jsx)(n.em,{children:"settings"})," de la fonction ",(0,i.jsx)(n.a,{href:"/docs/fr/API/WebServerClass#start",children:"start()"}),", pour n'importe quel objet serveur web :"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-4d",children:"WEB Server.start($settings.handlers) //prise en compte au d\xe9marrage du server web\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Si \xe0 la fois un fichier ",(0,i.jsx)(n.strong,{children:"HTTPHandlers.json"})," et un appel \xe0 la commande ",(0,i.jsx)(n.a,{href:"/docs/fr/commands/web-server",children:(0,i.jsx)(n.code,{children:"WEB Server"})})," avec un ",(0,i.jsx)(n.code,{children:"$settings.handlers"})," valide sont utilis\xe9s, la commande ",(0,i.jsx)(n.code,{children:"WEB Server"})," est prioritaire."]}),"\n",(0,i.jsxs)(n.p,{children:["Le fichier json (ou l'objet dans le param\xe8tre ",(0,i.jsx)(n.em,{children:"settings"}),") contient tous les mod\xe8les d'URL list\xe9s, les verbes trait\xe9s et le code \xe0 appeler."]}),"\n",(0,i.jsxs)(n.p,{children:["Les ",(0,i.jsx)(n.em,{children:"handlers"})," sont fournis sous la forme d'une collection."]}),"\n",(0,i.jsxs)(n.p,{children:["Au moment de l'ex\xe9cution, le premier motif (",(0,i.jsx)(n.em,{children:"pattern"}),") correspondant \xe0 l'URL est ex\xe9cut\xe9, les autres sont ignor\xe9s."]}),"\n",(0,i.jsxs)(n.p,{children:["Voici un exemple du contenu d'un fichier ",(0,i.jsx)(n.em,{children:"HTTPHandlers.json"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'\n[\n    {\n        "class": "GeneralHandling",\n        "method": "gettingStarted",\n        "pattern": "start",\n        "verbs": "get, post"\n    }\n]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Cette d\xe9claration de gestionnaire peut \xeatre lue ainsi : quand une requ\xeate commen\xe7ant par ",(0,i.jsx)(n.code,{children:"/start/"})," avec un verbe ",(0,i.jsx)(n.code,{children:"GET"})," ou ",(0,i.jsx)(n.code,{children:"POST"})," est re\xe7ue par le serveur, la fonction ",(0,i.jsx)(n.code,{children:"gettingStarted"})," du singleton ",(0,i.jsx)(n.code,{children:"GeneralHandling"})," est ex\xe9cut\xe9e."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"Vous devez red\xe9marrer le serveur Web pour que les modifications apport\xe9es dans ce fichier soient prises en compte."})}),"\n",(0,i.jsx)(n.h2,{id:"d\xe9finition-du-gestionnaire",children:"D\xe9finition du gestionnaire"}),"\n",(0,i.jsx)(n.p,{children:"Un gestionnaire est d\xe9fini par :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"un motif d'URL \xe0 intercepter"}),"\n",(0,i.jsx)(n.li,{children:"une fonction et sa classe o\xf9 le code est impl\xe9ment\xe9 pour traiter le motif d'URL en question"}),"\n",(0,i.jsx)(n.li,{children:"les verbes avec lesquels l'URL peut \xeatre appel\xe9e pour d\xe9clencher le gestionnaire personnalis\xe9"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"L'identifiant du gestionnaire est le couple [motif + un verbe parmi la liste des verbes]."}),"\n",(0,i.jsx)(n.h3,{id:"motifs-durl",children:"Motifs d'URL"}),"\n",(0,i.jsxs)(n.p,{children:["Les motifs d'URL peuvent \xeatre fournis sous forme de ",(0,i.jsx)(n.strong,{children:"pr\xe9fixes"})," ou en utilisant des ",(0,i.jsx)(n.strong,{children:"expressions r\xe9guli\xe8res"})," (",(0,i.jsx)(n.em,{children:"regex"}),")."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:['Pour d\xe9clarer un motif de pr\xe9fixe, utilisez le nom de propri\xe9t\xe9 "pattern" dans le fichier HTTPHandlers.json. Les pr\xe9fixes sont consid\xe9r\xe9s comme des expressions r\xe9guli\xe8res contenant d\xe9j\xe0 un ',(0,i.jsx)(n.code,{children:"/"})," initial et final.",(0,i.jsx)(n.br,{}),"\nEx : ",(0,i.jsx)(n.code,{children:'"pattern" : "docs"'})," ou ",(0,i.jsx)(n.code,{children:'"pattern" : "docs/invoices"'})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Pour d\xe9clarer un motif d'expression r\xe9guli\xe8re, utilisez le nom de la propri\xe9t\xe9 \"regexPattern\" dans le fichier HTTPHandlers.json. Les motifs d'expressions r\xe9guli\xe8res sont trait\xe9s directement.\nEx: ",(0,i.jsx)(n.code,{children:'"regexPattern" : "/docs/.+/index\\.html"'})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:'Les propri\xe9t\xe9s "Pattern" et "regexPattern" ne peuvent pas \xeatre utilis\xe9es dans la m\xeame d\xe9finition de gestionnaire (dans ce cas, seule la propri\xe9t\xe9 "regexPattern" est prise en compte).'}),"\n",(0,i.jsx)(n.h4,{id:"correspondance-des-motifs",children:"Correspondance des motifs"}),"\n",(0,i.jsx)(n.p,{children:"Les motifs d'URL sont d\xe9clench\xe9s dans l'ordre d\xe9fini :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"le premier motif correspondant est ex\xe9cut\xe9"}),"\n",(0,i.jsx)(n.li,{children:"les motifs suivants ne sont pas ex\xe9cut\xe9s m\xeame s'ils correspondent \xe0 l'URL"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Par cons\xe9quent, vous devez appliquer une strat\xe9gie pr\xe9cise lorsque vous \xe9crivez vos gestionnaires : les motifs les plus d\xe9taill\xe9s doivent \xeatre \xe9crits avant les motifs plus g\xe9n\xe9raux."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'[\n    {\n        "class": "InvoiceslHandling",\n        "method": "handleTheInvoice",\n        "regexPattern": "/docs/invoices/details/theInvoice",\n        "verbs": "GET"\n    },\n    {\n        "class": "InvoiceslHandling",\n        "method": "handleUnauthorizedVerbs",\n        "regexPattern": "/docs/invoices/details/theInvoice",\n        "comment": "This handler is triggered for all verbs except GET (handled above)"\n    },\n    {\n        "class": "DocsHandling",\n        "method": "handleDocs",\n        "regexPattern": "/docs",\n        "comment": "This handler is triggered for all the verbs"\n    }\n]\n\n'})}),"\n",(0,i.jsx)(n.h4,{id:"motifs-non-autoris\xe9s",children:"Motifs non autoris\xe9s"}),"\n",(0,i.jsx)(n.p,{children:"Les motifs d'URL correspondant aux fonctions de traitement HTTP int\xe9gr\xe9es de 4D ne sont pas autoris\xe9s dans les gestionnaires HTTP personnalis\xe9s. Par exemple, les motifs suivants ne peuvent pas \xeatre trait\xe9s :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/4DACTION"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/rest"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/$lib/renderer"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/$shared"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"class-et-method",children:"Class et method"}),"\n",(0,i.jsx)(n.p,{children:'Vous d\xe9clarez le code \xe0 ex\xe9cuter lorsqu\'un motif d\'URL d\xe9fini est intercept\xe9 \xe0 l\'aide des propri\xe9t\xe9s "class" et "method".'}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:['"class" : nom de la classe sans ',(0,i.jsx)(n.code,{children:"cs."}),', par exemple "UsersHandling" pour la classe utilisateur ',(0,i.jsx)(n.code,{children:"cs.UsersHandling"}),". Il doit s'agir d'une classe ",(0,i.jsx)(n.a,{href:"/docs/fr/Concepts/classes#shared-singleton",children:(0,i.jsx)(n.strong,{children:"partag\xe9e"})})," et ",(0,i.jsx)(n.a,{href:"/docs/fr/Concepts/classes#singleton-classes",children:(0,i.jsx)(n.strong,{children:"singleton"})}),"."]}),"\n",(0,i.jsx)(n.li,{children:'"m\xe9thode" : fonction de classe appartenant \xe0 la classe.'}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"#request-handler-code",children:"Voir ci-dessous"})," pour plus d'informations sur le code du gestionnaire de requ\xeate."]}),"\n",(0,i.jsx)(n.h3,{id:"verbs",children:"Verbs"}),"\n",(0,i.jsx)(n.p,{children:'Vous pouvez utiliser la propri\xe9t\xe9 "verbs" dans la d\xe9finition du gestionnaire pour d\xe9clarer les verbes HTTP pris en charge dans les requ\xeates entrantes pour ce gestionnaire. Une requ\xeate qui utilise un verbe qui n\'est pas explicitement autoris\xe9 est automatiquement rejet\xe9e par le serveur.'}),"\n",(0,i.jsx)(n.p,{children:"Vous pouvez d\xe9clarer plusieurs verbes, s\xe9par\xe9s par une virgule. Les noms de verbes ne sont pas sensibles \xe0 la casse."}),"\n",(0,i.jsxs)(n.p,{children:["Ex : ",(0,i.jsx)(n.code,{children:'"verbs" : "PUT, POST"'})]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"Aucun contr\xf4le n'est effectu\xe9 sur les noms de verbes. Tous les noms peuvent \xeatre utilis\xe9s."})}),"\n",(0,i.jsxs)(n.p,{children:['Par d\xe9faut, si la propri\xe9t\xe9 "verbs" n\'est pas utilis\xe9e pour un gestionnaire, ',(0,i.jsx)(n.strong,{children:"tous"})," les verbes HTTP sont pris en charge dans les requ\xeates entrantes pour ce gestionnaire (sauf ceux \xe9ventuellement utilis\xe9s au pr\xe9alable dans un motif plus d\xe9taill\xe9, comme illustr\xe9 dans l'exemple ci-dessus)."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Le verbe HTTP peut \xe9galement \xeatre \xe9valu\xe9 ",(0,i.jsxs)(n.a,{href:"/docs/fr/API/IncomingMessageClass#verb",children:["\xe0 l'aide de la propri\xe9t\xe9 ",(0,i.jsx)(n.code,{children:".verb"})," dans le code du gestionnaire de requ\xeate"]})," pour \xeatre accept\xe9 ou rejet\xe9."]})}),"\n",(0,i.jsx)(n.h2,{id:"exemple",children:"Exemple"}),"\n",(0,i.jsx)(n.p,{children:"Voici un exemple d\xe9taill\xe9 de fichier HTTPHandlers.json :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'\n[\n   {\n        "class": "GeneralHandling",\n        "method": "handle",\n        "pattern": "info", //URL prefix\n        "verbs": "GET"\n    }, \n    {\n        "class": "UsersHandling",\n        "method": "manageAccount",\n        "pattern": "userAccount/update",   //URL prefix\n        "verbs": "PUT,POST"\n    }, \n    {\n        "class": "FinancialHandling",\n        "method": "handleInvoices",\n        "regexPattern": "/docs/invoices/(past|today)", //URL prefix given as a regex\n        "verbs": "GET"\n    },\n    {\n        "class": "DocsHandling",\n        "method": "handleDocs",\n        "regexPattern": "/docs/myPage.html",  //URL prefix given as a regex\n        "verbs": "GET"\n    },\n    {\n        "class": "InvoicesHandling",\n        "method": "handleTheInvoice",\n        "pattern": "docs/invoices/details/theInvoice", // The most specific URL first\n        "verbs": "GET,POST"\n    },\n    {\n        "class": "InvoicesHandling",\n        "method": "handleDetails",\n        "pattern": "docs/invoices/details",    // The general URLs after\n        "verbs": "GET"\n    },\n    {\n        "class": "InvoicesHandling",\n        "method": "handleInvoices",   // The general URLs after\n        "pattern": "docs/invoices",\n        "verbs": "GET"\n    }\n]\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"Dans cet exemple, vous devez impl\xe9menter les fonctions suivantes :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Fonction ",(0,i.jsx)(n.em,{children:"handle"})," dans la classe ",(0,i.jsx)(n.em,{children:"GeneralHandling"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"manageAccount"})," dans la classe ",(0,i.jsx)(n.em,{children:"UsersHandling"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"handleInvoices"})," dans la classe ",(0,i.jsx)(n.em,{children:"FinancialHandling"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"handleDocs"})," dans la classe ",(0,i.jsx)(n.em,{children:"DocsHandling"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"handleTheInvoice"})," / ",(0,i.jsx)(n.em,{children:"handleDetails"})," / ",(0,i.jsx)(n.em,{children:"handleInvoices"})," dans la classe ",(0,i.jsx)(n.em,{children:"InvoicesHandling"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Exemples d'URL d\xe9clenchant les gestionnaires personnalis\xe9s :"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"IP:port/info/"})," avec un verbe GET\n",(0,i.jsx)(n.code,{children:"IP:port/info/general"})," avec un verbe GET"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"IP:port/userAccount/update/"})," avec un verbe POST\n",(0,i.jsx)(n.code,{children:"IP:port/userAccount/update/profile"})," avec un verbe POST"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"IP:port/docs/invoices/past"})," avec un verbe GET\n",(0,i.jsx)(n.code,{children:"IP:port/docs/invoices/today/latest"})," avec un verbe GET"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"IP:port//docs/myPage.html"})," avec un verbe GET"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"IP:port//docs/invoices/"})," avec un verbe GET, appelle la fonction ",(0,i.jsx)(n.em,{children:"handleInvoices"})," (classe ",(0,i.jsx)(n.em,{children:"InvoicesHandling"}),")\n",(0,i.jsx)(n.code,{children:"IP:port//docs/invoices/details/"})," avec un verbe GET, appelle la fonction ",(0,i.jsx)(n.em,{children:"handleDetails"})," (classe ",(0,i.jsx)(n.em,{children:"InvoicesHandling"}),")\n",(0,i.jsx)(n.code,{children:"IP :port//docs/invoices/details/theInvoice/xxxxxx"})," avec un verbe GET, appelle la fonction ",(0,i.jsx)(n.em,{children:"handleTheInvoice"})," (classe ",(0,i.jsx)(n.em,{children:"InvoiceslHandling"}),")"]}),"\n",(0,i.jsx)(n.h2,{id:"code-du-gestionnaire-de-requ\xeate",children:"Code du gestionnaire de requ\xeate"}),"\n",(0,i.jsx)(n.h3,{id:"configuration-des-fonctions",children:"Configuration des fonctions"}),"\n",(0,i.jsxs)(n.p,{children:["Le code du gestionnaire de requ\xeates HTTP doit \xeatre mis en \u0153uvre dans une fonction d'une classe ",(0,i.jsx)(n.a,{href:"/docs/fr/Concepts/classes#shared-singleton",children:(0,i.jsx)(n.strong,{children:"partag\xe9e"})})," et ",(0,i.jsx)(n.a,{href:"/docs/fr/Concepts/classes#singleton-classes",children:(0,i.jsx)(n.strong,{children:"singleton"})}),"."]}),"\n",(0,i.jsxs)(n.p,{children:['Si le singleton est manquant ou non partag\xe9, une erreur "Cannot find singleton" est renvoy\xe9e par le serveur. Si la classe ou la fonction ',(0,i.jsx)(n.a,{href:"#handler-definition",children:"d\xe9finie comme handler"})," dans le fichier HTTPHandlers.json n'est pas trouv\xe9e, le serveur renvoie l'erreur \"Cannot find singleton function\"."]}),"\n",(0,i.jsxs)(n.p,{children:["Les fonctions du gestionnaire de requ\xeates ne sont pas n\xe9cessairement partag\xe9es, sauf si certaines propri\xe9t\xe9s du gestionnaire sont modifi\xe9es par ces fonctions. Dans ce cas, vous devez d\xe9clarer ses fonctions avec le ",(0,i.jsxs)(n.a,{href:"/docs/fr/Concepts/classes#shared-functions",children:["mot-cl\xe9 ",(0,i.jsx)(n.code,{children:"shared"})]}),"."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Il est ",(0,i.jsx)(n.strong,{children:"d\xe9conseill\xe9"})," d'exposer les fonctions du gestionnaire de requ\xeates aux appels REST externes en utilisant les mots-cl\xe9s ",(0,i.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#exposed-vs-non-exposed-functions",children:(0,i.jsx)(n.code,{children:"exposed"})})," ou ",(0,i.jsx)(n.a,{href:"/docs/fr/ORDA/ordaClasses#onhttpget-keyword",children:(0,i.jsx)(n.code,{children:"onHTTPGet"})}),"."]})}),"\n",(0,i.jsx)(n.h3,{id:"entr\xe9e--une-instance-de-la-classe-4dincomingmessage",children:"Entr\xe9e : une instance de la classe 4D.IncomingMessage"}),"\n",(0,i.jsxs)(n.p,{children:["Lorsqu'une requ\xeate a \xe9t\xe9 intercept\xe9e par le gestionnaire, elle est re\xe7ue sur le serveur en tant qu'instance de la classe ",(0,i.jsx)(n.a,{href:"/docs/fr/API/IncomingMessageClass",children:"4D.IncomingMessage"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Toutes les informations n\xe9cessaires concernant la requ\xeate sont disponibles dans cet objet, y compris l'URL, le verbe, les en-t\xeates et, le cas \xe9ch\xe9ant, les param\xe8tres (plac\xe9s dans l'URL) et le corps de la requ\xeate."}),"\n",(0,i.jsx)(n.p,{children:"Ensuite, le gestionnaire de requ\xeate peut utiliser ces informations pour mettre en oeuvre une logique m\xe9tier appropri\xe9e."}),"\n",(0,i.jsx)(n.h3,{id:"sortie--une-instance-de-la-classe-4doutgoingmessage",children:"Sortie : une instance de la classe 4D.OutgoingMessage"}),"\n",(0,i.jsxs)(n.p,{children:["Le gestionnaire de requ\xeate peut renvoyer une instance d'objet de la classe ",(0,i.jsx)(n.a,{href:"/docs/fr/API/OutgoingMessageClass",children:"4D.OutGoingMessage"}),", c'est-\xe0-dire un contenu web complet pr\xeat \xe0 \xeatre trait\xe9 par un navigateur, comme un contenu de fichier."]}),"\n",(0,i.jsx)(n.h3,{id:"exemple-1",children:"Exemple"}),"\n",(0,i.jsxs)(n.p,{children:["La classe ",(0,i.jsx)(n.a,{href:"/docs/fr/API/IncomingMessageClass",children:"4D.IncomingMessage"})," fournit des fonctions pour obtenir les ",(0,i.jsx)(n.a,{href:"/docs/fr/API/IncomingMessageClass#headers",children:"headers"})," et le ",(0,i.jsx)(n.a,{href:"/docs/fr/API/IncomingMessageClass#gettext",children:"body"})," de la requ\xeate."]}),"\n",(0,i.jsx)(n.p,{children:"Voici un exemple simple pour t\xe9l\xe9charger un fichier sur le serveur."}),"\n",(0,i.jsxs)(n.p,{children:["Le fichier ",(0,i.jsx)(n.strong,{children:"HTTPHandlers.json"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'[\n    {\n        "class": "UploadFile",\n        "method": "uploadFile",\n        "regexPattern": "/putFile",\n        "verbs": "POST"\n    }\n]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["L'URL appel\xe9e est : ",(0,i.jsx)(n.a,{href:"http://127.0.0.1:8044/putFile?fileName=testFile",children:"http://127.0.0.1:8044/putFile?fileName=testFile"})]}),"\n",(0,i.jsxs)(n.p,{children:["Le contenu binaire du fichier est plac\xe9 dans le corps de la requ\xeate et un verbe POST est utilis\xe9. Le nom du fichier est fourni en param\xe8tre (",(0,i.jsx)(n.em,{children:"fileName"}),") dans l'URL. Il est re\xe7u dans l'objet ",(0,i.jsx)(n.a,{href:"/docs/fr/API/IncomingMessageClass#urlquery",children:(0,i.jsx)(n.code,{children:"urlQuery"})})," de la requ\xeate."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-4d",children:'    //UploadFile class\n\nshared singleton Class constructor()\n	\n	\nFunction uploadFile($request : 4D.IncomingMessage) : 4D.OutgoingMessage\n	\n	var $response:=4D.OutgoingMessage.new()\n	\n	var $body:="Not supported file"\n	var $fileName; $fileType : Text\n	var $file : 4D.File\n	var $picture : Picture\n	var $created : Boolean\n	\n	$fileName:=$request.urlQuery.fileName\n	$fileType:=$request.getHeader("Content-Type")\n	\n	Case of \n		: ($fileType="application/pdf")\n			$file:=File("/PACKAGE/Files/"+$fileName+".pdf")\n			$created:=$file.create()\n			$file.setContent($request.getBlob())\n			$body:="Upload OK - File size: "+String($file.size)\n			\n		: ($fileType="image/jpeg")\n			$file:=File("/PACKAGE/Files/"+$fileName+".jpg")\n			$picture:=$request.getPicture()\n			WRITE PICTURE FILE($file.platformPath; $picture)\n			$body:="Upload OK - Image size: "+String($file.size)\n			\n	End case \n	\n	$response.setBody($body)\n	$response.setHeader("Content-Type"; "text/plain")\n	\n	return $response\n\n'})}),"\n",(0,i.jsx)(n.h2,{id:"voir-\xe9galement",children:"Voir \xe9galement"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://blog.4d.com/master-http-requests-with-4d-request-handlers/",children:"Ma\xeetriser les requ\xeates HTTP avec les gestionnaires de requ\xeates 4D"})," (blog post)"]})]})}function u(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},884429:function(e,n,s){s.d(n,{R:()=>l,x:()=>o});var r=s(296540);let i={},t=r.createContext(i);function l(e){let n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);