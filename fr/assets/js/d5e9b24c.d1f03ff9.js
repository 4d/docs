"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[84575],{603905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>k});var a=n(667294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=s(n),k=r,u=m["".concat(p,".").concat(k)]||m[k]||d[k]||l;return n?a.createElement(u,o(o({ref:t},c),{},{components:n})):a.createElement(u,o({ref:t},c))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=m;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var s=2;s<l;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},869081:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>p,toc:()=>c});n(667294);var a=n(603905);function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const o={id:"WebSocketServerClass",title:"WebSocketServer"},i=void 0,p={unversionedId:"API/WebSocketServerClass",id:"version-20-R3/API/WebSocketServerClass",title:"WebSocketServer",description:"Historique",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-20-R3/API/WebSocketServerClass.md",sourceDirName:"API",slug:"/API/WebSocketServerClass",permalink:"/docs/fr/20-R3/API/WebSocketServerClass",draft:!1,editUrl:"https://github.com/4d/docs/issues/new?title=Comment%20on%20API%2FWebSocketServerClass.md%20(20-R3)&body=Please%20enter%20your%20comment%3A",tags:[],version:"20-R3",frontMatter:{id:"WebSocketServerClass",title:"WebSocketServer"},sidebar:"docs",previous:{title:"WebSocketConnection",permalink:"/docs/fr/20-R3/API/WebSocketConnectionClass"},next:{title:"ZIPArchive",permalink:"/docs/fr/20-R3/API/ZipArchiveClass"}},s={},c=[{value:"Conditions requises",id:"conditions-requises",level:3},{value:"Exemple",id:"exemple",level:3},{value:"Objet WebSocketServer",id:"objet-websocketserver",level:3},{value:"4D.WebSocketServer.new()",id:"4dwebsocketservernew",level:2},{value:"<em>WSSHandler</em> parameter",id:"wsshandler-parameter",level:3},{value:"Example of <code>WSSHandler</code> class",id:"example-of-wsshandler-class",level:3},{value:"<code>request</code> object",id:"request-object",level:3},{value:"<code>connectionHandler</code> object",id:"connectionhandler-object",level:3},{value:"Example of <code>connectionHandler</code> class",id:"example-of-connectionhandler-class",level:3},{value:"<em>options</em> parameter",id:"options-parameter",level:3},{value:".connections",id:"connections",level:2},{value:"Description",id:"description",level:4},{value:".dataType",id:"datatype",level:2},{value:"Description",id:"description-1",level:4},{value:".handler",id:"handler",level:2},{value:"Description",id:"description-2",level:4},{value:".path",id:"path",level:2},{value:"Description",id:"description-3",level:4},{value:".terminate()",id:"terminate",level:2},{value:"Description",id:"description-4",level:4},{value:".terminated",id:"terminated",level:2},{value:"Description",id:"description-5",level:4}],d={toc:c};function m(e){var{components:t}=e,n=l(e,["components"]);return(0,a.kt)("wrapper",r({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("details",null,(0,a.kt)("summary",null,"Historique"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Version"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Modifications"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"v20"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Ajout"))))),(0,a.kt)("p",null,"La classe ",(0,a.kt)("inlineCode",{parentName:"p"},"WebSocketServer")," vous permet de cr\xe9er et configurer un serveur WebSocket en 4D. Une fois le serveur WebSocket 4D actif, vous pouvez ouvrir et utiliser les connexions WebSocket entre 4D et les clients en utilisant la classe ",(0,a.kt)("a",r({parentName:"p"},{href:"/docs/fr/20-R3/API/WebSocketConnectionClass"}),(0,a.kt)("inlineCode",{parentName:"a"},"WebSocketConnection")),"."),(0,a.kt)("admonition",r({},{title:"\xc0 propos des serveurs WebSocket",type:"note"}),(0,a.kt)("p",{parentName:"admonition"},"Le protocole WebSocket fournit un canal de communication full-duplex entre un serveur WebSocket et un client (par exemple un navigateur Web). Pour plus d'informations sur les serveurs WebSocket, lisez ",(0,a.kt)("a",r({parentName:"p"},{href:"https://en.wikipedia.org/wiki/WebSocket"}),"cette page sur Wikipedia"),".")),(0,a.kt)("admonition",r({},{title:"Voir aussi",type:"info"}),(0,a.kt)("p",{parentName:"admonition"},"Voir \xe9galement ",(0,a.kt)("a",r({parentName:"p"},{href:"https://blog.4d.com/new-built-in-websocket-server/"}),"cet article de blog")," sur le serveur WebSocket 4D.")),(0,a.kt)("h3",r({},{id:"conditions-requises"}),"Conditions requises"),(0,a.kt)("p",null,"Pour cr\xe9er et g\xe9rer votre serveur WebSocket dans 4D, vous devrez utiliser deux classes int\xe9gr\xe9es \xe0 4D :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"cette classe (",(0,a.kt)("inlineCode",{parentName:"li"},"4D.WebSocketServer"),") pour g\xe9rer le serveur lui-m\xeame,"),(0,a.kt)("li",{parentName:"ul"},"la classe ",(0,a.kt)("a",r({parentName:"li"},{href:"/docs/fr/20-R3/API/WebSocketConnectionClass"}),(0,a.kt)("inlineCode",{parentName:"a"},"4D.WebSocketConnection"))," pour g\xe9rer les connexions et les messages.")),(0,a.kt)("p",null,"De plus, vous devrez cr\xe9er deux classes utilisateurs qui contiendront les fonctions de callback :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"une classe utilisateur pour g\xe9rer les connexions serveur,"),(0,a.kt)("li",{parentName:"ul"},"une classe utilisateur pour g\xe9rer les messages.")),(0,a.kt)("p",null,"Vous devez ",(0,a.kt)("a",r({parentName:"p"},{href:"#4dwebsocketservernew"}),"cr\xe9er le serveur WebSocket")," au sein d'un ",(0,a.kt)("a",r({parentName:"p"},{href:"https://doc.4d.com/4dv20/help/command/fr/page1389.html"}),"worker")," pour maintenir la connexion active."),(0,a.kt)("p",null,"The ",(0,a.kt)("a",r({parentName:"p"},{href:"/docs/fr/20-R3/API/WebServerClass"}),"4D Web Server")," must be started."),(0,a.kt)("h3",r({},{id:"exemple"}),"Exemple"),(0,a.kt)("p",null,"Dans cet exemple de base, notre serveur WebSocket renverra les messages en majuscules."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Cr\xe9ez le serveur WebSocket en utilisant un worker (obligatoire) et passez votre classe de connexion serveur en tant que param\xe8tre :")),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-4d"}),'    // Cr\xe9er une instance de la classe utilisateur\n    // qui g\xe9rera les connexions vers le serveur\nvar $handler: cs.myServerHandler\n$handler := cs.myServerHandler.new()\n\nCALL WORKER("WebSocketServer"; Formula(wss := 4D.WebSocketServer.new($handler)))\n    // attribuer une variable (wss) au WebSocket vous permet\n    // d\'appeler wss.terminate() par la suite\n')),(0,a.kt)("ol",r({},{start:2}),(0,a.kt)("li",{parentName:"ol"},"D\xe9finissez la classe utilisateur ",(0,a.kt)("inlineCode",{parentName:"li"},"myServerHandler")," contenant la ou les fonction(s) de callback utilis\xe9e(s) pour g\xe9rer les connexions au serveur :")),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-4d"}),"// Classe myServerHandler\n\nFunction onConnection($wss: Object; $event: Object): Object\n    // retourne une instance de la classe utilisateur\n    // qui traitera les messages\n    return cs.myConnectionHandler.new() \n")),(0,a.kt)("ol",r({},{start:3}),(0,a.kt)("li",{parentName:"ol"},"D\xe9finissez la classe utilisateur ",(0,a.kt)("inlineCode",{parentName:"li"},"myConnectionHandler")," contenant la ou les fonction(s) de callback utilis\xe9e(s) pour g\xe9rer les messages :")),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-4d"}),"// Classe myConnectionHandler\n\nFunction onMessage($ws : 4D.WebSocketConnection; $message : Object)\n    // renvoie le message en majuscules\n    $ws.send(Uppercase($message.data))\n\n")),(0,a.kt)("admonition",r({},{title:"Client-Side JS",type:"tip"}),(0,a.kt)("p",{parentName:"admonition"},"Voir ",(0,a.kt)("a",r({parentName:"p"},{href:"https://blog.4d.com/websocket-server/"}),"cet article de blog")," pour un exemple de code Javascript c\xf4t\xe9 client g\xe9rant une connexion WebSocket.")),(0,a.kt)("h3",r({},{id:"objet-websocketserver"}),"Objet WebSocketServer"),(0,a.kt)("p",null,"Les objets WebSocketServer offrent les propri\xe9t\xe9s et fonctions suivantes :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null})))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#connections"}),(0,a.kt)("strong",{parentName:"a"},".connections")," : Collection"),"\xa0","\xa0","\xa0","\xa0","toutes les connexions courantes g\xe9r\xe9es par le serveur WebSocket")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#dataType"}),(0,a.kt)("strong",{parentName:"a"},".dataType")," : Text"),"\xa0","\xa0","\xa0","\xa0","le type de donn\xe9es re\xe7ues ou envoy\xe9es")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#handler"}),(0,a.kt)("strong",{parentName:"a"},".handler")," : Object"),"\xa0","\xa0","\xa0","\xa0","l'accesseur qui r\xe9cup\xe8re l'objet ",(0,a.kt)("inlineCode",{parentName:"td"},"WSSHandler")," utilis\xe9 pour initier le serveur WebSocket")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#path"}),(0,a.kt)("strong",{parentName:"a"},".path")," : Text"),"\xa0","\xa0","\xa0","\xa0","le mod\xe8le du chemin d'acc\xe8s au serveur WebSocket")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#terminate"}),(0,a.kt)("strong",{parentName:"a"},".terminate()")),"\xa0","\xa0","\xa0","\xa0","closes the WebSocket server")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#terminated"}),(0,a.kt)("strong",{parentName:"a"},".terminated")," : Boolean"),"\xa0","\xa0","\xa0","\xa0","True si le serveur WebSocket est ferm\xe9")))),(0,a.kt)("h2",r({},{id:"4dwebsocketservernew"}),"4D.WebSocketServer.new()"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"4D.WebSocketServer.new"),"( ",(0,a.kt)("em",{parentName:"p"},"WSSHandler")," : Object { ; ",(0,a.kt)("em",{parentName:"p"},"options")," : Object } ) : 4D.WebSocketServer"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#wsshandler-parameter"}),"WSSHandler")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"->"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet de la classe utilisateur d\xe9clarant les callbacks du serveur WebSocket")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#options-parameter"}),"options")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"->"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres de configuration du WebSocket")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"R\xe9sultat"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"4D.WebSocketServer"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Nouvel objet WebSocketServer")))),(0,a.kt)("p",null,"|"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"4D.WebSocketServer.new()")," function creates and starts a WebSocket server that will use the specified ",(0,a.kt)("em",{parentName:"p"},"WSSHandler")," callbacks and (optionally) ",(0,a.kt)("em",{parentName:"p"},"options"),", and returns a ",(0,a.kt)("inlineCode",{parentName:"p"},"4D.WebSocketServer")," object."),(0,a.kt)("p",null,"Calling this function requires that the ",(0,a.kt)("a",r({parentName:"p"},{href:"/docs/fr/20-R3/API/WebServerClass"}),"4D Web Server")," is started. The ",(0,a.kt)("strong",{parentName:"p"},"host")," and ",(0,a.kt)("strong",{parentName:"p"},"port")," of the WebSocket server are the same as the host and port of the 4D Web Server."),(0,a.kt)("h3",r({},{id:"wsshandler-parameter"}),(0,a.kt)("em",{parentName:"h3"},"WSSHandler")," parameter"),(0,a.kt)("p",null,"In the ",(0,a.kt)("em",{parentName:"p"},"WSSHandler")," parameter, pass an instance of a user class that will be called every time an event occurs on the WebSocket server --essentially, connection events. The class should define the following callback functions (only ",(0,a.kt)("inlineCode",{parentName:"p"},"onConnection")," is mandatory):"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Propri\xe9t\xe9"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Par d\xe9faut"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onConnection"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/20-R3/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"(obligatoire) Callback quand une nouvelle connexion cliente est d\xe9marr\xe9e (voir ci-dessous)"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"undefined")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onOpen"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/20-R3/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Callback quand le serveur WebSocket est d\xe9marr\xe9 (voir ci-dessous)"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"undefined")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onTerminate"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/20-R3/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Callback quand le serveur WebSocket est stopp\xe9 (voir ci-dessous)"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"undefined")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onError"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/20-R3/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Callback quand une erreur est survenue (voir ci-dessous)"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"undefined")))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"WSHandler.onConnection"),"(",(0,a.kt)("em",{parentName:"p"},"WSServer")," : Object ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object) : Object | null"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"WSServer"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"4D.WebSocketServer"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet serveur WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"connection"')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"request"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("inlineCode",{parentName:"td"},"request")," object. Contient les informations de la requ\xeate de connexion (voir ci-dessous)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"R\xe9sultat"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"->"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"#connectionhandler-object"}),(0,a.kt)("inlineCode",{parentName:"a"},"connectionHandler")," object")," (see below). If this function returns a ",(0,a.kt)("inlineCode",{parentName:"td"},"connectionHandler")," object, a ",(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/20-R3/API/WebSocketConnectionClass#websocketconnection-object"}),(0,a.kt)("inlineCode",{parentName:"a"},"4D.WebSocketConnection")," object")," is automatically created and added to the ",(0,a.kt)("a",r({parentName:"td"},{href:"#connections"}),"collection of connections"),". This object is then received as parameter in each function of the ",(0,a.kt)("inlineCode",{parentName:"td"},"connectionHandler")," object. Si la valeur renvoy\xe9e est null ou undefined, la connexion est annul\xe9e.")))),(0,a.kt)("p",null,"Cette callback est appel\xe9e lorsque le handshake est termin\xe9. It must be called with a valid ",(0,a.kt)("a",r({parentName:"p"},{href:"#connectionhandler-object"}),(0,a.kt)("inlineCode",{parentName:"a"},"connectionHandler")," object")," to create the WebSocket connection, otherwise the connection is cancelled."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"WSHandler.onOpen"),"(",(0,a.kt)("em",{parentName:"p"},"WSServer")," : Object ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object)"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"WSServer"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"4D.WebSocketServer"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet serveur WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"open"')))),(0,a.kt)("p",null,"\xc9v\xe9nement \xe9mis lorsque le serveur websocket est d\xe9marr\xe9."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"WSHandler.onTerminate"),"(",(0,a.kt)("em",{parentName:"p"},"WSServer")," : Object ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object)"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"WSServer"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"4D.WebSocketServer"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet serveur WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"terminate"')))),(0,a.kt)("p",null,"\xc9v\xe9nement \xe9mis lors de la fermeture du serveur HTTP ou du serveur WebSocket."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"WSHandler.onError"),"(",(0,a.kt)("em",{parentName:"p"},"WSServer")," : Object ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object)"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"WSServer"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"4D.WebSocketServer"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet serveur WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"error"')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"errors"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Collection"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Collection of 4D error stack in case of execution error",(0,a.kt)("li",null,"[","].errCode (number) -  4D error code"),(0,a.kt)("li",null,"[","].message (text) - Description of the 4D error"),(0,a.kt)("li",null,"[","].componentSignature (text) - Signature of the internal component which returned the error"))))),(0,a.kt)("p",null,"\xc9v\xe9nement \xe9mis lorsqu'une erreur se produit sur le serveur WebSocket."),(0,a.kt)("h3",r({},{id:"example-of-wsshandler-class"}),"Example of ",(0,a.kt)("inlineCode",{parentName:"h3"},"WSSHandler")," class"),(0,a.kt)("p",null,"This example of a basic chat feature illustrates how to handle WebSocket server connections in a ",(0,a.kt)("em",{parentName:"p"},"WSSHandler")," class."),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-4d"}),'//myWSServerHandler class \n\nFunction onConnection($wss : Object; $event : Object) : Object\n\n    If (VerifyAddress($event.request.remoteAddress))\n        // The VerifyAddress method validates the client address\n        // The returned WSConnectionHandler object will be used \n        // by 4D to instantiate the 4D.WebSocketConnection object\n        // related to this connection\n        return cs.myConnectionHandler.new()   \n        // See connectionHandler object\n    Else \n        // The connection is cancelled      \n        return Null \n    End if \n\nFunction onOpen($wss : Object; $event : Object)\nLogFile("*** Server started")\n\nFunction onTerminate($wss : Object; $event : Object)\nLogFile("*** Server closed")\n\nFunction onError($wss : Object; $event : Object)\nLogFile("!!! Server error: "+$event.errors.first().message)\n\n')),(0,a.kt)("h3",r({},{id:"request-object"}),(0,a.kt)("inlineCode",{parentName:"h3"},"request")," object"),(0,a.kt)("p",null,"A ",(0,a.kt)("inlineCode",{parentName:"p"},"request")," object contains the following properties:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"headers"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"La requ\xeate HTTP GET du client. ",(0,a.kt)("inlineCode",{parentName:"td"},"headers.key=value")," (value can be a collection if the same key appears multiple times)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"query"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet qui contient les param\xe8tres de l'URL. For example, if parameters are: ",(0,a.kt)("inlineCode",{parentName:"td"},"?key1=value1&key2=value2")," -> ",(0,a.kt)("inlineCode",{parentName:"td"},"query.key1=value1"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"query.key2=value2"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"url"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"contient uniquement l'URL qui est pr\xe9sente dans la requ\xeate HTTP r\xe9elle. Ex: ",(0,a.kt)("inlineCode",{parentName:"td"},"GET /status?name=ryan HTTP/1.1"),' -> url="/status?name=ryan"')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"remoteAddress"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Adresse IP du client")))),(0,a.kt)("h3",r({},{id:"connectionhandler-object"}),(0,a.kt)("inlineCode",{parentName:"h3"},"connectionHandler")," object"),(0,a.kt)("p",null,"As a result of the ",(0,a.kt)("inlineCode",{parentName:"p"},"WSHandler.onConnection")," callback, pass a ",(0,a.kt)("inlineCode",{parentName:"p"},"connectionHandler")," object, which is an instance of a user class that will be called every time an event occurs in the WebSocket connection --essentially, messages received. The class should define the following callback functions (only ",(0,a.kt)("inlineCode",{parentName:"p"},"onMessage")," is mandatory):"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onMessage"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/20-R3/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"(obligatoire) Fonction appel\xe9e lorsqu'un nouveau message est re\xe7u de cette connexion")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onOpen"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/20-R3/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Function called when the ",(0,a.kt)("inlineCode",{parentName:"td"},"4D.WebSocketConnection")," is created")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onTerminate"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/20-R3/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Fonction appel\xe9e lorsque cette connexion est termin\xe9e")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"onError"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/20-R3/API/FunctionClass"}),"Function")),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Fonction appel\xe9e en cas d'erreur")))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"connectionHandler.onMessage"),"(",(0,a.kt)("em",{parentName:"p"},"ws")," : 4D.WebSocketConnection ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object)"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"ws"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/20-R3/API/WebSocketConnectionClass"}),(0,a.kt)("inlineCode",{parentName:"a"},"4D.WebSocketConnection"))),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet connexion WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"message"')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"data"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text / Blob / Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"donn\xe9es envoy\xe9es par le client")))),(0,a.kt)("p",null,"Callback pour les donn\xe9es WebSocket. Appel\xe9e \xe0 chaque fois que le WebSocket re\xe7oit des donn\xe9es."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"connectionHandler.onOpen"),"(",(0,a.kt)("em",{parentName:"p"},"ws")," : 4D.WebSocketConnection ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object)"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"ws"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/20-R3/API/WebSocketConnectionClass"}),(0,a.kt)("inlineCode",{parentName:"a"},"4D.WebSocketConnection"))),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet connexion WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"open"')))),(0,a.kt)("p",null,"Called when the ",(0,a.kt)("inlineCode",{parentName:"p"},"connectionHandler")," object is created (after ",(0,a.kt)("inlineCode",{parentName:"p"},"WSS.onConnection")," event)."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"connectionHandler.onTerminate"),"(",(0,a.kt)("em",{parentName:"p"},"ws")," : 4D.WebSocketConnection ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object)"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"ws"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/20-R3/API/WebSocketConnectionClass"}),(0,a.kt)("inlineCode",{parentName:"a"},"4D.WebSocketConnection"))),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet connexion WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"terminate"')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"code"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Number"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Code de statut indiquant la cause de la fermeture de la connexion. If the WebSocket does not return an error code, ",(0,a.kt)("inlineCode",{parentName:"td"},"code")," is set to 1005 if no error occurred or to 1006 if there was an error.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"reason"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Cha\xeene expliquant pourquoi la connexion a \xe9t\xe9 ferm\xe9e. Si le websocket ne renvoie pas de raison, le code est undefined")))),(0,a.kt)("p",null,"Fonction appel\xe9e lorsque la WebSocket est ferm\xe9e."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"connectionHandler.onError"),"(",(0,a.kt)("em",{parentName:"p"},"ws")," : 4D.WebSocketConnection ; ",(0,a.kt)("em",{parentName:"p"},"event")," : Object)"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"ws"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/20-R3/API/WebSocketConnectionClass"}),(0,a.kt)("inlineCode",{parentName:"a"},"4D.WebSocketConnection"))),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Objet connexion WebSocket courant")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"event"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Object"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"<-"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Param\xe8tres")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"type"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),'"error"')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"errors"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Collection"),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:"center"}),"Collection of 4D errors stack in case of execution error",(0,a.kt)("li",null,"[","].errCode (number) -  4D error code"),(0,a.kt)("li",null,"[","].message (text) - Description of the 4D error"),(0,a.kt)("li",null,"[","].componentSignature (text) - Signature of the internal component which returned the error")),(0,a.kt)("td",r({parentName:"tr"},{align:null}))))),(0,a.kt)("p",null,"Fonction appel\xe9e en cas d'erreur."),(0,a.kt)("h3",r({},{id:"example-of-connectionhandler-class"}),"Example of ",(0,a.kt)("inlineCode",{parentName:"h3"},"connectionHandler")," class"),(0,a.kt)("p",null,"This example of a basic chat feature illustrates how to handle messages in a ",(0,a.kt)("em",{parentName:"p"},"connectionHandler")," class."),(0,a.kt)("pre",null,(0,a.kt)("code",r({parentName:"pre"},{className:"language-4d"}),'// myConnectionHandler Class\n\nFunction onMessage($ws : 4D.WebSocketConnection; $message : Object)\n    // Resend the message to all chat clients   \n    This.broadcast($ws;$message.data)\n\nFunction onOpen($ws : 4D.WebSocketConnection; $message : Object)\n    // Send a message to new connected users\n    $ws.send("Welcome on the chat!")    \n    // Send "New client connected" message to all other chat clients\n    This.broadcast($ws;"New client connected")\n\nFunction onTerminate($ws : 4D.WebSocketConnection; $message : Object)\n    // Send "Client disconnected" message to all other chat clients\n    This.broadcast($ws;"Client disconnected")\n\nFunction broadcast($ws : 4D.WebSocketConnection; $message:text)\n    var $client:4D.WebSocketConnection\n    // Resend the message to all chat clients\n    For each ($client; $ws.wss.connections)\n        // Check that the id is not the current connection\n        If ($client.id#$ws.id)\n            $client.send($message)\n        End if \n    End for each \n\n')),(0,a.kt)("h3",r({},{id:"options-parameter"}),(0,a.kt)("em",{parentName:"h3"},"options")," parameter"),(0,a.kt)("p",null,"In the optional ",(0,a.kt)("em",{parentName:"p"},"options")," parameter, pass an object that contains the following properties:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Propri\xe9t\xe9"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Par d\xe9faut"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"path"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Repr\xe9sente le chemin d'acc\xe8s au serveur WebSocket. Si aucun chemin n'est d\xe9fini, le serveur WebSocket g\xe8re toutes les connexions"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"undefined")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null}),"dataType"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Text"),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Type of the data received through the ",(0,a.kt)("inlineCode",{parentName:"td"},"connectionHandler.onMessage")," and the data send by ",(0,a.kt)("a",r({parentName:"td"},{href:"/docs/fr/20-R3/API/WebSocketConnectionClass#send"}),(0,a.kt)("inlineCode",{parentName:"a"},"WebSocketConnection.send()")),' function. Valeurs : "text", "blob", "object"). Si "objet" : (envoi) transforme l\'objet au format json et l\'envoie ; (r\xe9ception) : re\xe7oit le format json et le transforme en objet'),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"text")))),(0,a.kt)("h2",r({},{id:"connections"}),".connections"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},".connections")," : Collection"),(0,a.kt)("h4",r({},{id:"description"}),"Description"),(0,a.kt)("p",null,"La propri\xe9t\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},".connections")," contient toutes les connexions courantes g\xe9r\xe9es par le serveur WebSocket. Chaque \xe9l\xe9ment de la collection est un objet ",(0,a.kt)("a",r({parentName:"p"},{href:"/docs/fr/20-R3/API/WebSocketConnectionClass"}),(0,a.kt)("inlineCode",{parentName:"a"},"WebSocketConnection")),"."),(0,a.kt)("p",null,"When a connection is terminated, its ",(0,a.kt)("a",r({parentName:"p"},{href:"/docs/fr/20-R3/API/WebSocketConnectionClass#status"}),(0,a.kt)("inlineCode",{parentName:"a"},"status")),' changes to "Closed" and it is removed from this collection.'),(0,a.kt)("h2",r({},{id:"datatype"}),".dataType"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},".dataType")," : Text"),(0,a.kt)("h4",r({},{id:"description-1"}),"Description"),(0,a.kt)("p",null,"La propri\xe9t\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},".dataType")," contient le type de donn\xe9es re\xe7ues ou envoy\xe9es."),(0,a.kt)("p",null,"Cette propri\xe9t\xe9 est en lecture seule."),(0,a.kt)("h2",r({},{id:"handler"}),".handler"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},".handler")," : Object"),(0,a.kt)("h4",r({},{id:"description-2"}),"Description"),(0,a.kt)("p",null,"La propri\xe9t\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},".handler")," contient l'accesseur qui r\xe9cup\xe8re l'objet ",(0,a.kt)("inlineCode",{parentName:"p"},"WSSHandler")," utilis\xe9 pour initier le serveur WebSocket."),(0,a.kt)("h2",r({},{id:"path"}),".path"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},".path")," : Text"),(0,a.kt)("h4",r({},{id:"description-3"}),"Description"),(0,a.kt)("p",null,"La propri\xe9t\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},".path")," contient le mod\xe8le du chemin d'acc\xe8s au serveur WebSocket. Si aucun chemin n'a \xe9t\xe9 d\xe9fini, le serveur WebSocket g\xe8re toutes les connexions."),(0,a.kt)("p",null,"Cette propri\xe9t\xe9 est en lecture seule."),(0,a.kt)("h2",r({},{id:"terminate"}),".terminate()"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},".terminate()")),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Param\xe8tres"),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Type"),(0,a.kt)("th",r({parentName:"tr"},{align:"center"})),(0,a.kt)("th",r({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:null})),(0,a.kt)("td",r({parentName:"tr"},{align:"center"})),(0,a.kt)("td",r({parentName:"tr"},{align:null}),"Ne requiert aucun param\xe8tre")))),(0,a.kt)("p",null,"|"),(0,a.kt)("h4",r({},{id:"description-4"}),"Description"),(0,a.kt)("p",null,"La fonction ",(0,a.kt)("inlineCode",{parentName:"p"},".terminate()")," closes the WebSocket server. "),(0,a.kt)("h2",r({},{id:"terminated"}),".terminated"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},".terminated")," : Boolean"),(0,a.kt)("h4",r({},{id:"description-5"}),"Description"),(0,a.kt)("p",null,"La propri\xe9t\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},".terminated")," contient True si le serveur WebSocket est ferm\xe9."),(0,a.kt)("p",null,"Cette propri\xe9t\xe9 est en lecture seule."))}m.isMDXComponent=!0}}]);