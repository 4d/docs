---
id: webServerObject
title: Objet Serveur Web
---

## Aperçu

A 4D project can start and monitor a web server for the main (host) application as well as each hosted component.

For example, if you installed two components in your main application, you can start and monitor up to three independant web servers from your application:

- one web server for the host application,
- un serveur web pour le composant n°1,
- un serveur web pour le composant n°2.

Other than memory, there is no limit to the number of components and thus, of web servers, that can be attached to a single 4D application project.

Each 4D web server, including the main application's web server, is exposed as a specific **object**. Once instantiated, a web server object can be handled from the current application or from any component.

> Les [commandes WEB](https://doc.4d.com/4Dv18/4D/18/Web-Server.201-4504301.en.html) héritées du langage 4D sont prises en charge mais ne peuvent pas sélectionner le serveur Web auquel elles s'appliquent (voir ci-dessous).

Each web server (host application or component) can be used in its own separate context, including:
- les appels vers la méthode base `On Web Authentication` et `On Web Connection`
- le traitement des balises 4D et les appels de méthodes,
- la gestion de sessions web et des protocoles TLS.

Cette fonctionnalité vous permet de développer des composants indépendants et des fonctionnalités qui accompagnent leurs propres interfaces Web.


## Instancier un objet serveur web

The web server object of the host application (default web server) is automatically loaded by 4D at startup. Thus, if you write in a newly created project:

```4d
$nbSrv:=WEB Server list.length   
//la valeur de $nbSrv est 1
```

Pour instancier un objet serveur web, appelez la commande `WEB Server` :

```4d
C_OBJECT(webServer)
    //appeler le serveur web depuis le contexte courant
webServer:=WEB Server  
    //équivalent à
webServer:=WEB Server(Web server database)
```

If the application uses components and you want to call:
- the host application's web server from a component or
- le serveur qui a reçu la requête (quel que soit le serveur)

vous pouvez également utiliser :

```4d
C_OBJECT(webServer)  
    //appler le serveur web hôte depuis un composant  
webServer:=WEB Server(Web server host database)  
    //appeler le serveur web cible
webServer:=WEB Server(Web server receiving request)  
```


## Méthodes du serveur web

Un objet serveur Web contient les méthodes membres suivantes :

| Méthode   | Paramètres       | Valeur retournée | Description            |
| --------- | ---------------- | ---------------- | ---------------------- |
| `start()` | settings (objet) | status (object)  | Démarre le serveur web |
| `stop()`  | -                | -                | Stoppe le serveur web  |

Pour démarrer et arrêter un serveur Web, il suffit d'appeler les méthodes membres `start()` et `stop()` de l'objet serveur Web :

```4d
C_OBJECT($status)
    //pour démarrer un serveur web avec les paramètres par défaut
$status:=webServer.start()
    //pour démarrer un serveur web avec des paramètres personnalisés   
    //objet $settings contenant des propriétés du serveur web
webServer.start($settings)

    //pour stopper le serveur web
$status:=webServer.stop()
```


## Propriétés du serveur web

Un objet serveur Web contient les propriétés suivantes.

| Propriété                  | Type                | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| -------------------------- | ------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| certificateFolder          | Texte               | Dossier dans lequel les fichiers de certificat sont sauvegardés. Format POSIX du chemin d'accès complet à l'aide de filesystem. Peut être passé comme objet `Folder` dans le paramètre `settings`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| characterSet               | Numérique ou texte  | Character set that the 4D Web Server should use to communicate with browsers connecting to the application. La valeur par défaut dépend de la langue du système d'exploitation. Peut être une chaîne MIBEnum longint ou Name, identifiants [définis par l'IANA](http://www.iana.org/assignments/character-sets) pris en charge par le serveur Web 4D : <li>4 = ISO-8859-1</li><li>12 = ISO-8859-9</li><li>13 = ISO-8859-10</li><li>17 = Shift-JIS</li><li>2024 = Windows-31J</li><li>2026 = Big5</li><li>38 = euc-kr</li><li>106 = UTF-8</li><li>2250 = Windows-1250</li><li>2251 = Windows-1251</li><li>2253 = Windows-1253</li><li>2255 = Windows-1255</li><li>2256 = Windows-1256                                                                                                                                                                                                                                                                                                                                                                                                                       |
| cipherSuite                | Texte               | Liste de chiffrement utilisée pour le protocole sécurisé. Définit la priorité des algorithmes de chiffrement mis en œuvre par le serveur Web. Peut être une séquence de chaînes séparées par des deux-points (par exemple "ECDHE-RSA-AES128 -..."). Voir la [page des chiffrements](https://www.openssl.org/docs/manmaster/man1/ciphers.html) sur le site OpenSSL.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| CORSEnabled                | boolean             | Statut CORS (Cross-origin resource sharing) activé pour le serveur Web. Pour des raisons de sécurité, les requêtes "cross-domain" sont interdites par défaut au niveau du navigateur. Lorsqu'il est activé (True), les appels XHR (par exemple les requêtes REST) à partir de pages Web hors du domaine peuvent être autorisés dans votre application (vous devez définir la liste des adresses autorisées dans la liste des domaines CORS, voir `CORSSettings` ci-dessous). Lorsqu'il est désactivé (False, par défaut), toutes les requêtes entre sites (cross site) envoyées avec CORS sont ignorées. Lorsqu'il est activé (True) et qu'un domaine ou une méthode non autorisé(e) envoie une requête entre sites, elle est rejetée avec une réponse d'erreur «403 - forbidden».<p><p>Par défaut : False (désactivé)<p>Pour plus d'informations sur CORS, veuillez consulter la [page de partage de ressources cross-origin](http://en.wikipedia.org/wiki/Cross-origin_resource_sharing) sur Wikipedia.                                                          |
| CORSSettings               | collection d'objets | Liste des hôtes et des méthodes autorisés pour le service CORS (voir `CORSEnabled` ci-dessus). Chaque objet doit contenir une propriété **host** et, optionnellement, une propriété **methods** :<li>**host** (texte, obligatoire) : nom de domaine ou adresse IP à partir duquel les pages externes sont autorisées à envoyer des requêtes de données au serveur via CORS. Plusieurs attributs de domaine peuvent être ajoutés pour créer une liste blanche. Si *host* n'est pas présent ou vide, l'objet est ignoré. Plusieurs syntaxes sont prises en charge :<br>192.168.5.17:8081<br>192.168.5.17<br>192.168.\*<br>192.168.\*:8081<br>http://192.168.5.17:8081<br>http://\*.myDomain.com<br>http://myProject.myDomain.com<br>\*.myDomain.com<br>myProject.myDomain.com<br>\*<li>**methods** (texte, facultatif) : méthode(s) HTTP acceptée(s) pour l'hôte CORS correspondant. Séparez chaque méthode par un ";" (ex : "post;get"). Si *methods* est vide, null ou non défini, toutes les méthodes sont activées. |
| debugLog                   | number              | Etat du fichier journal des requêtes HTTP (HTTPDebugLog_nn.txt, stocké dans le dossier "Logs" de l'application - nn est le numéro de fichier). <li>0 = désactivé</li><li>1 = activé sans les parties du corps (la taille du corps est fournie dans ce cas)</li><li>3 = activé avec les parties du corps en réponse uniquement</li><li>5 = activé avec des parties du corps sur requête uniquement</li><li>7 = activé avec des parties du corps en réponse et requête</li>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| defaultHomepage            | Texte               | Nom de la page d'accueil par défaut ou "" pour ne pas envoyer la page d'accueil personnalisée                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| HSTSEnabled                | boolean             | État de HTTP Strict Transport Security (HSTS). HSTS permet au serveur Web de déclarer que les navigateurs doivent interagir avec uniquement via des connexions HTTPS sécurisées. Les navigateurs enregistreront les informations HSTS la première fois qu'ils recevront une réponse du serveur Web, puis toutes les futures requêtes HTTP seront automatiquement transformées en requêtes HTTPS. La durée de stockage de ces informations par le navigateur est indiquée avec la propriété `HSTSMaxAge`. HSTS nécessite l'activation de HTTPS sur le serveur. HTTP doit également être activé pour permettre des connexions client initiales.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| HSTSMaxAge                 | number              | Durée maximale (en secondes) d'activation de HSTS pour chaque nouvelle connexion client. Ces informations sont stockées côté client pendant la durée spécifiée. <p><p>Valeur par défaut : 63072000 (2 ans)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| HTTPCompressionLevel       | number              | Niveau de compression pour tous les échanges HTTP compressés pour le serveur HTTP 4D (requêtes clients ou réponses serveur). Ce sélecteur vous permet d'optimiser les échanges en priorisant soit la vitesse d'exécution (moins de compression), soit la quantité de compression (moins de vitesse). <p><p>Valeurs possibles : <ul><li>1 à 9 (où 1 correspond à la compression la plus rapide et 9 la plus élevée).</li><li> -1 = définir un compromis entre la vitesse et le taux de compression.</li></ul> Par défaut = 1 (compression plus rapide).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| HTTPCompressionThreshold   | number              | Seuil de taille (octets) pour les requêtes en dessous desquelles les échanges ne doivent pas être compressés. Ce paramètre est utile pour éviter de perdre du temps machine en compressant les petits échanges. <p><p>Seuil de compression par défaut = 1024 octets                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| HTTPEnabled                | boolean             | État du protocole HTTP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| HTTPPort                   | number              | Numéro de port IP d'écoute pour HTTP. <p><p>Par défaut = 80                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| HTTPTrace                  | boolean             | Activation HTTP TRACE. Pour des raisons de sécurité, le serveur Web rejette par défaut les requêtes HTTP TRACE avec une erreur 405. Lorsqu'il est activé, le serveur Web répond aux requêtes HTTP TRACE avec la ligne de requête, l'en-tête et le corps.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| HTTPSEnabled               | boolean             | État du protocole HTTPS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| HTTPSPort                  | number              | Numéro de port IP d'écoute pour HTTPS. <p><p>Par défaut = 443                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| inactiveProcessTimeout     | number              | Durée de vie (en minutes) des process de session inactives. À la fin du délai d'attente (tiemout), le process est tué sur le serveur, la méthode base `On Web Close Process` est appelée, puis le contexte de session est détruit. <p><p>Par défaut = 480 minutes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| inactiveSessionTimeout     | number              | Durée de vie (en minutes) des sessions inactives (durée définie dans le cookie). À la fin de cette période, le cookie de session expire et n'est plus envoyé par le client HTTP. <p><p>Par défaut = 480 minutes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| IPAddressToListen          | Texte               | Adresse IP sur laquelle le serveur Web 4D recevra les requêtes HTTP. Les formats de chaîne IPv6 et IPv4 sont pris en charge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| *isRunning*                | boolean             | État d'exécution du serveur Web                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| keepSession                | boolean             | État d'activation de la gestion de session <p><p>Par défaut = true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| logRecording               | number              | Valeur d'enregistrement des requêtes de journal (logweb.txt). <li>0 = Ne pas enregistrer (par défaut)</li><li>1 = Enregistrer au format CLF</li><li>2 = Enregistrer au format DLF</li><li>3 = Enregistrer au format ELF</li><li>4 = Enregistrer au format WLF</li>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| maxConcurrentProcesses     | number              | Nombre maximal de process Web simultanés pris en charge par le serveur Web. Lorsque ce nombre (moins un) est atteint, 4D ne crée aucun autre process et retourne le statut HTTP 503 - Service Unavailable to all new requests. <p><p>Valeurs possibles : 10 - 32000 <p><p>Par défaut = 100                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| maxRequestSize             | number              | Taille maximale (en octets) des requêtes HTTP entrantes (POST) que le serveur Web est autorisé à traiter. Passer la valeur maximale (2147483648) signifie qu'en pratique, aucune limite n'est définie. Cette limite est utilisée pour éviter la saturation du serveur Web en raison de requêtes entrantes trop volumineuses. Si une requête atteint cette limite, le serveur Web la rejette. <p><p>Valeurs possibles : 500000 - 2147483648                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| maxSessions                | number              | Nombre maximum de sessions simultanées. Lorsque vous atteignez la limite, la session la plus ancienne est fermée (et la méthode base `On Web Close Process` est appelée) si le serveur Web doit en créer une nouvelle. Le nombre de sessions simultanées ne peut pas dépasser le nombre total de processus Web (propriété `maxConcurrentProcesses`, 100 par défaut)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| minTLSVersion              | number              | Version TLS minimale acceptée pour les connexions. Les tentatives de connexion de clients prenant en charge uniquement les versions inférieures au minimum seront rejetées. <p><p>Valeurs possibles :<li>1 = `TLSv1_0`</li><li>2 = `TLSv1_1`</li><li>3 = `TLSv1_2` (par défaut)</li><p><p>En cas de modification, le serveur doit être redémarré pour utiliser la nouvelle valeur.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| *name*                     | Texte               | Name of the web server application                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| *openSSLVersion*           | Texte               | Version de la bibliothèque OpenSSL utilisée                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| *perfectForwardSecrecy*    | boolean             | Disponibilité PFS sur le serveur                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| rootFolder                 | Texte               | Chemin du dossier racine du serveur Web. Format POSIX du chemin d'accès complet à l'aide de filesystem. Peut être passé comme objet `Folder` dans le paramètre `settings`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| sessionCookieDomain        | Texte               | Champ "domaine" du cookie de session. Utilisé pour contrôler la portée des cookies de session. Par exemple, si vous définissez la valeur "/*.4d.fr" pour ce sélecteur, le client enverra un cookie uniquement lorsque la requête est adressée au domaine ".4d.fr", ce qui exclut les serveurs hébergeant des données statiques externes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| sessionCookieName          | Texte               | Nom du cookie utilisé pour stocker l'ID de session. <p><p>Par défaut = "4DSID"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| sessionCookiePath          | Texte               | Champ "path" du cookie de session. Utilisé pour contrôler la portée des cookies de session. Par exemple, si vous définissez la valeur "/4DACTION" pour ce sélecteur, le client enverra un cookie uniquement pour les requêtes dynamiques commençant par 4DACTION, et non pour les images, les pages statiques, etc.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| sessionIPAddressValidation | boolean             | Validation d'adresse IP pour les cookies de session. Pour des raisons de sécurité, le serveur Web vérifie par défaut l'adresse IP de chaque requête contenant un cookie de session et la rejette si cette adresse ne correspond pas à l'adresse IP utilisée pour créer le cookie. Dans certaines applications spécifiques, vous souhaiterez peut-être désactiver cette validation et accepter les cookies de session, même lorsque leurs adresses IP ne correspondent pas. Par exemple, lorsque les appareils mobiles basculent entre les réseaux Wifi et 3G/4G, leur adresse IP change. Dans ce cas, vous pouvez permettre aux clients de continuer à utiliser leurs sessions Web même lorsque les adresses IP changent. <p><p>Note : ce paramètre réduit le niveau de sécurité de votre application                                                                                                                                                                                                                                                                                   |

Ces propriétés sont définies :

1. à l'aide du paramètre `settings` de la méthode `webServer.start()` (sauf pour les propriétés en lecture seule, voir ci-dessous),
2. if not used, using the `WEB SET OPTION` command (host applications only),
3. if not used, in the settings of the host application or the component.

- Si le serveur Web n'est pas démarré, les propriétés contiennent les valeurs qui seront utilisées au prochain démarrage du serveur Web.
- Si le serveur Web est démarré, les propriétés contiennent les valeurs réelles utilisées par le serveur Web (les paramètres par défaut peuvent avoir été remplacés par le paramètre `settings` de la méthode `webServer.start()`.

> *isRunning*, *name*, *openSSLVersion* et *perfectForwardSecrecy* sont des propriétés en lecture seule qui ne peuvent pas être prédéfinies dans le paramètre objet `settings` pour la méthode `start()`.


## Portée des commandes 4D Web

Le langage 4D contient [plusieurs commandes](https://doc.4d.com/4Dv18/4D/18/Web-Server.201-4504301.en.html) permettant de contrôler le serveur Web. Cependant, ces commandes sont destinées à fonctionner avec un seul serveur Web (par défaut). Lorsque vous utilisez ces commandes dans le contexte d'objets serveur Web, assurez-vous que leur portée est appropriée.

| Commande                        | Portée                            |
| ------------------------------- | --------------------------------- |
| `SET DATABASE PARAMETER`        | Host application web server       |
| `WEB CLOSE SESSION`             | Serveur Web ayant reçu la requête |
| `WEB GET BODY PART`             | Serveur Web ayant reçu la requête |
| `WEB Get body part count`       | Serveur Web ayant reçu la requête |
| `WEB Get Current Session ID`    | Serveur Web ayant reçu la requête |
| `WEB GET HTTP BODY`             | Serveur Web ayant reçu la requête |
| `WEB GET HTTP HEADER`           | Serveur Web ayant reçu la requête |
| `WEB GET OPTION`                | Host application web server       |
| `WEB Get server info`           | Host application web server       |
| `WEB GET SESSION EXPIRATION`    | Serveur Web ayant reçu la requête |
| `WEB Get session process count` | Serveur Web ayant reçu la requête |
| `WEB GET STATISTICS`            | Host application web server       |
| `WEB GET VARIABLES`             | Serveur Web ayant reçu la requête |
| `WEB Is secured connection`     | Serveur Web ayant reçu la requête |
| `WEB Is server running`         | Host application web server       |
| `WEB SEND BLOB`                 | Serveur Web ayant reçu la requête |
| `WEB SEND FILE`                 | Serveur Web ayant reçu la requête |
| `WEB SEND HTTP REDIRECT`        | Serveur Web ayant reçu la requête |
| `WEB SEND RAW DATA`             | Serveur Web ayant reçu la requête |
| `WEB SEND TEXT`                 | Serveur Web ayant reçu la requête |
| `WEB SET HOME PAGE`             | Host application web server       |
| `WEB SET HTTP HEADER`           | Serveur Web ayant reçu la requête |
| `WEB SET OPTION`                | Host application web server       |
| `WEB SET ROOT FOLDER`           | Host application web server       |
| `WEB START SERVER`              | Host application web server       |
| `WEB STOP SERVER`               | Host application web server       |
| `WEB Validate digest`           | Serveur Web ayant reçu la requête |
