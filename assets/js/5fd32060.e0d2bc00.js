"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["87437"],{957015:function(e,n,r){r.r(n),r.d(n,{metadata:()=>t,contentTitle:()=>i,default:()=>h,assets:()=>c,toc:()=>d,frontMatter:()=>a});var t=JSON.parse('{"id":"commands-legacy/execute-on-server","title":"Execute on server","description":"Execute on server ( procedure ; stack {; name {; param {; param2 ; ... ; paramN}}}{; *} ) : Integer","source":"@site/versioned_docs/version-20-R7/commands-legacy/execute-on-server.md","sourceDirName":"commands-legacy","slug":"/commands/execute-on-server","permalink":"/docs/commands/execute-on-server","draft":false,"unlisted":false,"editUrl":"https://github.com/4d/docs/issues/new?title=Comment%20on%20commands-legacy%2Fexecute-on-server.md%20(20-R7)&body=Please%20enter%20your%20comment%3A","tags":[],"version":"20-R7","frontMatter":{"id":"execute-on-server","title":"Execute on server","slug":"/commands/execute-on-server","displayed_sidebar":"docs"},"sidebar":"docs","previous":{"title":"EXECUTE ON CLIENT","permalink":"/docs/commands/execute-on-client"},"next":{"title":"GET REGISTERED CLIENTS","permalink":"/docs/commands/get-registered-clients"}}'),s=r("785893"),o=r("250065");let a={id:"execute-on-server",title:"Execute on server",slug:"/commands/execute-on-server",displayed_sidebar:"docs"},i=void 0,c={},d=[{value:"Description",id:"description",level:4},{value:"Process Method",id:"process-method",level:5},{value:"Process Stack",id:"process-stack",level:5},{value:"Process Name",id:"process-name",level:5},{value:"Parameter to Process Method",id:"parameter-to-process-method",level:5},{value:"Optional * Parameter",id:"optional--parameter",level:5},{value:"Example 1",id:"example-1",level:4},{value:"Example 2",id:"example-2",level:4},{value:"Example 3",id:"example-3",level:4},{value:"See also",id:"see-also",level:4},{value:"Properties",id:"properties",level:4}];function l(e){let n={a:"a",br:"br",code:"code",em:"em",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Execute on server"})," ( ",(0,s.jsx)(n.em,{children:"procedure"})," ; ",(0,s.jsx)(n.em,{children:"stack"})," {; ",(0,s.jsx)(n.em,{children:"name"})," {; ",(0,s.jsx)(n.em,{children:"param"})," {; ",(0,s.jsx)(n.em,{children:"param2"})," ; ... ; ",(0,s.jsx)(n.em,{children:"paramN"}),"}}}{; *} ) : Integer"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"procedure"}),(0,s.jsx)(n.td,{children:"Text"}),(0,s.jsx)(n.td,{children:"\u2192"}),(0,s.jsx)(n.td,{children:"Procedure to be executed within the process"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"stack"}),(0,s.jsx)(n.td,{children:"Integer"}),(0,s.jsx)(n.td,{children:"\u2192"}),(0,s.jsx)(n.td,{children:"Stack size in bytes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"name"}),(0,s.jsx)(n.td,{children:"Text"}),(0,s.jsx)(n.td,{children:"\u2192"}),(0,s.jsx)(n.td,{children:"Name of the process created"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"param"}),(0,s.jsx)(n.td,{children:"Expression"}),(0,s.jsx)(n.td,{children:"\u2192"}),(0,s.jsx)(n.td,{children:"Parameter(s) to the procedure"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"*"}),(0,s.jsx)(n.td,{children:"Operator"}),(0,s.jsx)(n.td,{children:"\u2192"}),(0,s.jsx)(n.td,{children:"Unique process"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Function result"}),(0,s.jsx)(n.td,{children:"Integer"}),(0,s.jsx)(n.td,{children:"\u2190"}),(0,s.jsx)(n.td,{children:"Process number for newly created process or already executing process"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"description",children:"Description"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"Execute on server"})," command starts a new process on the Server machine (if it is called in Client/Server) or on the same machine (if it is called in single-user) and returns the process number for that process."]}),"\n",(0,s.jsxs)(n.p,{children:["You use this function to start a stored procedure. For more information about stored procedures, see the section ",(0,s.jsx)(n.em,{children:"Stored Procedures"})," in the 4D Server Reference manual."]}),"\n",(0,s.jsxs)(n.p,{children:["If you call ",(0,s.jsx)(n.strong,{children:"Execute on server"})," on a Client machine, the command returns a negative process number. If you call it on the Server machine, it returns a positive process number. Note that calling ",(0,s.jsx)(n.a,{href:"/docs/commands/new-process",children:"New process"})," on the Server machine does the same thing as calling ",(0,s.jsx)(n.strong,{children:"Execute on server"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["If the process could not be created (for example, if there is not enough memory), ",(0,s.jsx)(n.strong,{children:"Execute on server"})," returns zero (0) and an error is generated. You can catch this error using an error-handling method installed using ",(0,s.jsx)(n.a,{href:"/docs/commands/on-err-call",children:"ON ERR CALL"}),"."]}),"\n",(0,s.jsx)(n.h5,{id:"process-method",children:"Process Method"}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.em,{children:"procedure"}),", you pass the name of the process method for the new process. After 4D has set up the context for the new process, it starts executing this method, which therefore becomes the process method."]}),"\n",(0,s.jsx)(n.h5,{id:"process-stack",children:"Process Stack"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.em,{children:"stack"})," parameter allows you indicate the amount of memory allocated for the stack of the process. It is the space in memory used to \u201Cpile up\u201D method calls, local variables, parameters in subroutines, and stacked records."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Pass 0 in ",(0,s.jsx)(n.em,{children:"stack"})," to use a default stack size, suitable for most applications (recommended setting)."]}),"\n",(0,s.jsx)(n.li,{children:"In certain particular cases, you may want to set a custom value. It must be expressed in bytes. This setting should be used with precaution, it depends on the process chain call and the platform."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," The stack is NOT the total memory for the process. Processes share memory for records, interprocess variables, and so on. A process also uses extra memory for storing its process variables. The stack contains various items of 4D internal information; the amount of information kept on the stack depends on the number of nested method calls the process will employ, the number of forms that it will open before closing them and the number and size of local variables used in each nested method call."]}),"\n",(0,s.jsx)(n.h5,{id:"process-name",children:"Process Name"}),"\n",(0,s.jsxs)(n.p,{children:["You pass the name of the new process in ",(0,s.jsx)(n.em,{children:"name"}),". In single-user, this name will appear in the list of processes of the Runtime Explorer and will be returned by the ",(0,s.jsx)(n.a,{href:"/docs/commands/process-info",children:"Process info"})," command when applied to this new process. In Client/Server, this name will appear in blue in the Stored Procedure list of the 4D Server main window."]}),"\n",(0,s.jsx)(n.p,{children:"You can omit this parameter; if you do so, the name of the process will be the empty string."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Warning:"})," Contrary to ",(0,s.jsx)(n.a,{href:"/docs/commands/new-process",children:"New process"}),", do not attempt to make a process local in scope by prefixing its name with the dollar sign (",(0,s.jsx)(n.em,{children:"$"}),") while using ",(0,s.jsx)(n.strong,{children:"Execute on server"}),". This will work in single-user, because ",(0,s.jsx)(n.strong,{children:"Execute on server"})," acts as ",(0,s.jsx)(n.a,{href:"/docs/commands/new-process",children:"New process"})," in this environment. On the other hand, in Client/Server, this will generate an error."]}),"\n",(0,s.jsx)(n.h5,{id:"parameter-to-process-method",children:"Parameter to Process Method"}),"\n",(0,s.jsxs)(n.p,{children:["You can pass parameters to the process method. You can pass parameters in the same way as you would pass them to a subroutine. However, there is a restriction\u2014you cannot pass pointer expressions. Also, remember that arrays cannot be passed as parameters to a method. Upon starting execution in the context of the new process, the process method receives the parameters values in ",(0,s.jsx)(n.em,{children:"$1"}),", ",(0,s.jsx)(n.em,{children:"$2"}),", etc."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," If you pass parameters to the process method, you must pass the ",(0,s.jsx)(n.em,{children:"name"})," parameter; it cannot be omitted in this case."]}),"\n",(0,s.jsxs)(n.p,{children:["If you pass an object or a collection as ",(0,s.jsx)(n.em,{children:"param"}),", a copy is sent (and not a reference) and the JSON form is used in UTF-8 for the server. If the object or collection contains pointers, their dereferenced values are sent, and not the pointers themselves."]}),"\n",(0,s.jsx)(n.h5,{id:"optional--parameter",children:"Optional * Parameter"}),"\n",(0,s.jsxs)(n.p,{children:["Specifying this last parameter tells 4D to first check whether or not a process with the name you passed in ",(0,s.jsx)(n.em,{children:"name"})," is already running. If it is, 4D does not start a new process and returns the process number of the process with that name."]}),"\n",(0,s.jsx)(n.h4,{id:"example-1",children:"Example 1"}),"\n",(0,s.jsx)(n.p,{children:"You want to log some information from the remote side in a text file on the server machine."}),"\n",(0,s.jsx)(n.p,{children:"You execute the method with local information as parameters on a remote machine:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'\xa0$process:=Execute on server("WriteLog";0;"WriteLogFile";Current user;String(Current date);String(Current time))\n'})}),"\n",(0,s.jsx)(n.p,{children:"The WriteLog method will be executed on the server. It contains, for example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'\xa0var $1;$2;$3 : Text\n\xa0TEXT TO DOCUMENT(Get 4D folder(Logs folder)+"Log"+$1+".txt";$2+" "+$3)\n'})}),"\n",(0,s.jsx)(n.h4,{id:"example-2",children:"Example 2"}),"\n",(0,s.jsxs)(n.p,{children:["The following example shows how importing data can be dramatically accelerated in Client/Server. The Regular Import method listed below allows you to test how long it takes to import records using the ",(0,s.jsx)(n.a,{href:"/docs/commands/import-text",children:"IMPORT TEXT"})," command on the Client side:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'\xa0\xa0// Regular Import Project Method\n\xa0$vhDocRef:=Open document("")\n\xa0If(OK=1)\n\xa0\xa0\xa0\xa0CLOSE DOCUMENT($vhDocRef)\n\xa0\xa0\xa0\xa0FORM SET INPUT([Table1];"Import")\n\xa0\xa0\xa0\xa0$vhStartTime:=Current time\n\xa0\xa0\xa0\xa0IMPORT TEXT([Table1];Document)\n\xa0\xa0\xa0\xa0$vhEndTime:=Current time\n\xa0\xa0\xa0\xa0ALERT("It took "+String(0+($vhEndTime-$vhStartTime))+" seconds.")\n\xa0End if\n'})}),"\n",(0,s.jsx)(n.p,{children:"With the regular import data, 4D Client performs the parsing of the text file, then, for each record, create a new record, fills out the fields with the imported data and sends the record to the Server machine so it can be added to the database. There are consequently many requests going over the network. A way to optimize the operation is to use a stored procedure to do the job locally on the Server machine. The Client machine loads the document into a BLOB, start a stored procedure passing the BLOB as parameter. The stored procedure stores the BLOB into a document on the server machine disk, then imports the document locally. The import data is therefore performed locally at a single-user version-like speed because most the network requests have been eliminated. Here is the CLIENT IMPORT project method. Executed on the Client machine, it starts the SERVER IMPORT stored procedure listed just below:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'\xa0\xa0// CLIENT IMPORT Project Method\n\xa0\xa0// CLIENT IMPORT ( Pointer ; String )\n\xa0\xa0// CLIENT IMPORT ( -> [Table] ; Input form )\n\xa0\n\xa0var $1 : Pointer\n\xa0var $2 : Text\n\xa0var $vhDocRef : Time\n\xa0var $vxData : Blob\n\xa0var spErrCode : Integer\n\xa0\n\xa0\xa0// Select the document do be imported\n\xa0$vhDocRef:=Open document("")\n\xa0If(OK=1)\n\xa0\xa0// If a document was selected, do not keep it open\n\xa0\xa0\xa0\xa0CLOSE DOCUMENT($vhDocRef)\n\xa0\xa0\xa0\xa0$vhStartTime:=Current time\n\xa0\xa0// Try to load it in memory\n\xa0\xa0\xa0\xa0DOCUMENT TO BLOB(Document;$vxData)\n\xa0\xa0\xa0\xa0If(OK=1)\n\xa0\xa0// If the document could be loaded in the BLOB,\n\xa0\xa0// Start the stored procedure that will import the data on the server machine\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0$spProcessID:=Execute on server("SERVER IMPORT";0;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0"Server Import Services";Table($1);$2;$vxData)\n\xa0\xa0// At this point, we no longer need the BLOB in this process\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0CLEAR VARIABLE($vxData)\n\xa0\xa0// Wait for the completion of the operation performed by the stored procedure\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0Repeat\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0DELAY PROCESS(Current process;300)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0GET PROCESS VARIABLE($spProcessID;spErrCode;spErrCode)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0If(Undefined(spErrCode))\n\xa0\xa0// Note: if the stored procedure has not initialized its own instance\n\xa0\xa0// of the variable spErrCode, we may be returned an undefined variable\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0spErrCode:=1\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0End if\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0Until(spErrCode<=0)\n\xa0\xa0// Tell the stored procedure that we acknowledge\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0spErrCode:=1\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0SET PROCESS VARIABLE($spProcessID;spErrCode;spErrCode)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0$vhEndTime:=Current time\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0ALERT("It took "+String(0+($vhEndTime-$vhStartTime))+" seconds.")\n\xa0\xa0\xa0\xa0Else\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0ALERT("There is not enough memory to load the document.")\n\xa0\xa0\xa0\xa0End if\n\xa0End if\n'})}),"\n",(0,s.jsx)(n.p,{children:"Here is the SERVER IMPORT project method executed as a stored procedure:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'\xa0\xa0// SERVER IMPORT Project Method\n\xa0\xa0// SERVER IMPORT ( Long ; String ; BLOB )\n\xa0\xa0// SERVER IMPORT ( Table Number ; Input form ; Import Data )\n\xa0\n\xa0var $1 : Integer\n\xa0var $2 : Text\n\xa0var $3 : Blob\n\xa0var spErrCode : Integer\n\xa0\n\xa0\xa0// Operation is not finished yet, set spErrCode to 1\n\xa0spErrCode:=1\n\xa0$vpTable:=Table($1)\n\xa0FORM SET INPUT($vpTable->;$2)\n\xa0$vsDocName:="Import File "+String(1+Random)\n\xa0DELETE DOCUMENT($vsDocName)\n\xa0BLOB TO DOCUMENT($vsDocName;$3)\n\xa0IMPORT TEXT($vpTable->;$vsDocName)\n\xa0DELETE DOCUMENT($vsDocName)\n\xa0\xa0// Operation is finished, set spErrCode to 0\n\xa0spErrCode:=0\n\xa0\xa0// Wait until the requester Client got the result back\n\xa0Repeat\n\xa0\xa0\xa0\xa0DELAY PROCESS(Current process;1)\n\xa0Until(spErrCode>0)\n'})}),"\n",(0,s.jsx)(n.p,{children:"Once these two project methods have been implemented in a database, you can perform a \u201CStored Procedure-based\u201D import data by, for instance, writing:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'\xa0CLIENT IMPORT(->[Table1];"Import")\n'})}),"\n",(0,s.jsx)(n.p,{children:"With some benchmarks you will discover that using this method you can import records up to 60 times faster than the regular import."}),"\n",(0,s.jsx)(n.h4,{id:"example-3",children:"Example 3"}),"\n",(0,s.jsxs)(n.p,{children:["Refer to the ",(0,s.jsx)(n.em,{children:"SP-Based Services (Example)"})," section in the ",(0,s.jsx)(n.em,{children:"4D Server Reference"})," manual."]}),"\n",(0,s.jsx)(n.h4,{id:"see-also",children:"See also"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"/docs/commands/execute-on-client",children:"EXECUTE ON CLIENT"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.a,{href:"/docs/commands/new-process",children:"New process"})]}),"\n",(0,s.jsx)(n.h4,{id:"properties",children:"Properties"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{}),(0,s.jsx)(n.th,{})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Command number"}),(0,s.jsx)(n.td,{children:"373"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Thread safe"}),(0,s.jsx)(n.td,{children:"\u2717"})]})]})]})]})}function h(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},250065:function(e,n,r){r.d(n,{Z:function(){return i},a:function(){return a}});var t=r(667294);let s={},o=t.createContext(s);function a(e){let n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);