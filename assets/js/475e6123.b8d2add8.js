"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[16871],{509319:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>d,toc:()=>i});var r=s(474848),t=s(28453);const o={id:"set-query-and-lock",title:"SET QUERY AND LOCK",slug:"/commands/set-query-and-lock",displayed_sidebar:"docs"},c=void 0,d={id:"commands-legacy/set-query-and-lock",title:"SET QUERY AND LOCK",description:"SET QUERY AND LOCK ( lock )",source:"@site/versioned_docs/version-20-R7/commands-legacy/set-query-and-lock.md",sourceDirName:"commands-legacy",slug:"/commands/set-query-and-lock",permalink:"/docs/commands/set-query-and-lock",draft:!1,unlisted:!1,editUrl:"https://github.com/4d/docs/issues/new?title=Comment%20on%20commands-legacy%2Fset-query-and-lock.md%20(20-R7)&body=Please%20enter%20your%20comment%3A",tags:[],version:"20-R7",frontMatter:{id:"set-query-and-lock",title:"SET QUERY AND LOCK",slug:"/commands/set-query-and-lock",displayed_sidebar:"docs"},sidebar:"docs",previous:{title:"QUERY WITH ARRAY",permalink:"/docs/commands/query-with-array"},next:{title:"SET QUERY DESTINATION",permalink:"/docs/commands/set-query-destination"}},a={},i=[{value:"Description",id:"description",level:4},{value:"Example",id:"example",level:4},{value:"Error management",id:"error-management",level:4},{value:"See also",id:"see-also",level:4}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"SET QUERY AND LOCK"})," ( ",(0,r.jsx)(n.em,{children:"lock"})," )"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"lock"}),(0,r.jsx)(n.td,{children:"Boolean"}),(0,r.jsx)(n.td,{children:"\u2192"}),(0,r.jsx)(n.td,{children:"True = Lock the records found by queries False = Do not lock records"})]})})]}),"\n",(0,r.jsx)(n.h4,{id:"description",children:"Description"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"SET QUERY AND LOCK"})," command can be used to request the automatic locking of records found by all queries that follow the calling of this command in the current transaction. This means that the records cannot be modified by a process other than the current process between a query and the handling of results."]}),"\n",(0,r.jsxs)(n.p,{children:["By default, the records found by queries are not locked. Pass ",(0,r.jsx)(n.strong,{children:"True"})," in the ",(0,r.jsx)(n.em,{children:"lock"})," parameter to activate locking."]}),"\n",(0,r.jsx)(n.p,{children:"It is imperative for this command to be used within a transaction. If it is called outside of this context, an error is generated. This allows for better control of record locking. The records found will stay locked as long as the transaction has not been terminated (whether validated or cancelled). After the transaction is completed, all the records are unlocked, except the current record."}),"\n",(0,r.jsx)(n.p,{children:"The records are locked for all the tables in the current transaction."}),"\n",(0,r.jsxs)(n.p,{children:["When a ",(0,r.jsx)(n.strong,{children:"SET QUERY AND LOCK"}),"(True) statement has been executed, the query commands (for example ",(0,r.jsx)(n.a,{href:"/docs/commands/query",children:"QUERY"}),") adopt a specific functioning if a record that is already locked is found:"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The query is stopped and the system variable OK is set to 0,"}),"\n",(0,r.jsx)(n.li,{children:"The current selection is cleared,"}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.em,{children:"LockedSet"})," system set contains the locked record that caused the query to be stopped."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Consequently, in this context it is necessary to test the ",(0,r.jsx)(n.em,{children:"LockedSet"})," set after a fruitless query (current selection empty and/or OK variable set to 0) in order to determine the cause of the failure."]}),"\n",(0,r.jsxs)(n.p,{children:["Call ",(0,r.jsx)(n.strong,{children:"SET QUERY AND LOCK"}),"(False) in order to disable this mechanism afterward."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"SET QUERY AND LOCK"})," only modifies the behavior for query commands, in other words:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/commands/query",children:"QUERY"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/commands/query-selection",children:"QUERY SELECTION"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/commands/query-by-example",children:"QUERY BY EXAMPLE"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/commands/query-by-formula",children:"QUERY BY FORMULA"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/commands/query-by-sql",children:"QUERY BY SQL"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/commands/query-selection-by-formula",children:"QUERY SELECTION BY FORMULA"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/commands/query-selection-with-array",children:"QUERY SELECTION WITH ARRAY"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/commands/query-with-array",children:"QUERY WITH ARRAY"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/commands/query-by-attribute",children:"QUERY BY ATTRIBUTE"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/commands/query-selection-by-attribute",children:"QUERY SELECTION BY ATTRIBUTE"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["However, SET QUERY AND LOCK does not affect other commands that modify the current selection such as ",(0,r.jsx)(n.a,{href:"/docs/commands/all-records",children:"ALL RECORDS"}),", ",(0,r.jsx)(n.a,{href:"/docs/commands/relate-many",children:"RELATE MANY"}),", etc."]}),"\n",(0,r.jsx)(n.h4,{id:"example",children:"Example"}),"\n",(0,r.jsxs)(n.p,{children:["In this example, it is not possible to delete a client who would have been passed from category \u201cC\u201d to category \u201cA\u201d in another process between the ",(0,r.jsx)(n.a,{href:"/docs/commands/query",children:"QUERY"})," and ",(0,r.jsx)(n.a,{href:"/docs/commands/delete-selection",children:"DELETE SELECTION"})," commands:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-4d",children:"\xa0START TRANSACTION\n\xa0SET QUERY AND LOCK(True)\n\xa0QUERY([Customers];[Customers]Category=\u201cC\u201d)\n\xa0\xa0//At this moment, the records found are automatically locked for all other processes\n\xa0DELETE SELECTION([Customers])\n\xa0SET QUERY AND LOCK(False)\n\xa0VALIDATE TRANSACTION\n"})}),"\n",(0,r.jsx)(n.h4,{id:"error-management",children:"Error management"}),"\n",(0,r.jsx)(n.p,{children:"If the command is not called in the context of a transaction, an error is generated."}),"\n",(0,r.jsx)(n.h4,{id:"see-also",children:"See also"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"/docs/commands/query",children:"QUERY"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>d});var r=s(296540);const t={},o=r.createContext(t);function c(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);