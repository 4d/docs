"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["27580"],{471124:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>d,toc:()=>c,default:()=>h,metadata:()=>s,assets:()=>o,contentTitle:()=>i});var s=JSON.parse('{"id":"WebServer/http-rules","title":"HTTP Rules","description":"You can define HTTP rules to control HTTP response headers for any requests received by the 4D web server, including REST requests. You can add, modify, or remove HTTP headers, send redirections or set the HTTP status. This feature is useful to implement security policies based upon the handling of headers.","source":"@site/versioned_docs/version-21/WebServer/http-rules.md","sourceDirName":"WebServer","slug":"/WebServer/http-rules","permalink":"/docs/WebServer/http-rules","draft":false,"unlisted":false,"editUrl":"https://github.com/4d/docs/issues/new?title=Comment%20on%20WebServer%2Fhttp-rules.md%20(21)&body=Please%20enter%20your%20comment%3A","tags":[],"version":"21","frontMatter":{"id":"http-rules","title":"HTTP Rules"},"sidebar":"docs","previous":{"title":"Gestionnaire de requ\xeates HTTP","permalink":"/docs/WebServer/http-request-handler"},"next":{"title":"Allowing project methods","permalink":"/docs/WebServer/allowProject"}}'),t=r(785893),l=r(250065);let d={id:"http-rules",title:"HTTP Rules"},i=void 0,o={},c=[{value:"Requirements",id:"requirements",level:2},{value:"How to set rules",id:"how-to-set-rules",level:2},{value:"Rules Definition",id:"rules-definition",level:2},{value:"URL patterns",id:"url-patterns",level:3},{value:"Actions",id:"actions",level:3},{value:"Non-modifiable headers",id:"non-modifiable-headers",level:3},{value:"Current rules",id:"current-rules",level:3},{value:"Examples",id:"examples",level:2},{value:"Using a HTTPRules.json file",id:"using-a-httprulesjson-file",level:3},{value:"Using a <em>settings</em> parameter",id:"using-a-settings-parameter",level:3}];function a(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"You can define HTTP rules to control HTTP response headers for any requests received by the 4D web server, including REST requests. You can add, modify, or remove HTTP headers, send redirections or set the HTTP status. This feature is useful to implement security policies based upon the handling of headers."}),"\n",(0,t.jsxs)(n.p,{children:["To define HTTP rules, you just need to write some RegEx to declare the URL patterns you want to control, as well as how to modify response headers. You can set these rules using a ",(0,t.jsx)(n.code,{children:"HTTPRules.json"})," file stored in the project folder, or using the ",(0,t.jsx)(n.em,{children:"settings"})," parameter ",(0,t.jsx)(n.a,{href:"/docs/API/WebServerClass#start",children:(0,t.jsx)(n.code,{children:"start()"})})," function of the web server object."]}),"\n",(0,t.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,t.jsx)(n.p,{children:"HTTP rules are supported in the following contexts:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/WebServer/sessions#enabling-web-sessions",children:"scalable sessions"})," or ",(0,t.jsx)(n.a,{href:"/docs/settings/web#no-sessions",children:"no sessions"})," are enabled,"]}),"\n",(0,t.jsxs)(n.li,{children:["a web server run locally by 4D or 4D Server, including those ",(0,t.jsx)(n.a,{href:"/docs/WebServer/webServerObject",children:"run by components"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"how-to-set-rules",children:"How to set rules"}),"\n",(0,t.jsx)(n.p,{children:"You can declare HTTP response rules:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["in a configuration file named ",(0,t.jsx)(n.strong,{children:"HTTPRules.json"})," stored in the ",(0,t.jsx)(n.a,{href:"/docs/Project/architecture#sources",children:(0,t.jsx)(n.code,{children:"Project/Sources"})})," folder of the project. Rules are loaded and applied in the main Web server once it is started."]}),"\n",(0,t.jsxs)(n.li,{children:["using a ",(0,t.jsx)(n.a,{href:"/docs/API/WebServerClass#rules",children:(0,t.jsx)(n.code,{children:".rules"})})," property set in the ",(0,t.jsx)(n.em,{children:"settings"})," parameter of the ",(0,t.jsx)(n.a,{href:"/docs/API/WebServerClass#start",children:(0,t.jsx)(n.code,{children:"start()"})})," function, for any web server object:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-4d",children:"WEB Server.start($settings.rules) //set rules at web server startup\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If both a ",(0,t.jsx)(n.strong,{children:"HTTPRules.json"})," file and a call to the ",(0,t.jsx)(n.a,{href:"/docs/commands/web-server",children:(0,t.jsx)(n.code,{children:"WEB Server"})})," command with a valid ",(0,t.jsx)(n.code,{children:"$settings.rules"})," are used, the ",(0,t.jsx)(n.code,{children:"WEB Server"})," command has priority."]}),"\n",(0,t.jsx)(n.p,{children:"If the URI of the request does not match any of the RegEx patterns, the web server returns a default response."}),"\n",(0,t.jsx)(n.h2,{id:"rules-definition",children:"Rules Definition"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"HTTPRules.json"})," file or the ",(0,t.jsx)(n.a,{href:"/docs/API/WebServerClass#rules",children:(0,t.jsx)(n.code,{children:".rules"})})," property must contain a collection of ",(0,t.jsx)(n.strong,{children:"rule objects"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"A rule object is defined by:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'a RegEx describing a URL pattern, e.g. "^(.*\\.(jpg|jpeg|png|gif))"'}),"\n",(0,t.jsx)(n.li,{children:'the name of the action to execute for the HTTP response, e.g. "removeHeaders"'}),"\n",(0,t.jsx)(n.li,{children:'the value of the action, e.g. "X-Unwanted-Header1"'}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Other properties are ignored."}),"\n",(0,t.jsx)(n.h3,{id:"url-patterns",children:"URL patterns"}),"\n",(0,t.jsxs)(n.p,{children:["URL patterns are given using ",(0,t.jsx)(n.strong,{children:"regular expressions"}),'. To declare a regular expression pattern, use the "RegExPattern" property name.']}),"\n",(0,t.jsxs)(n.p,{children:["Ex: ",(0,t.jsx)(n.code,{children:'"RegExPattern": "/Test/Authorized/(.*)"'})]}),"\n",(0,t.jsxs)(n.p,{children:["When the web server receives a request, ",(0,t.jsx)(n.strong,{children:"all"})," URL patterns are triggered sequentially in the given order, and all matching patterns are executed. In case of several actions modifying similar resources, the last executed action is taken into account."]}),"\n",(0,t.jsx)(n.h3,{id:"actions",children:"Actions"}),"\n",(0,t.jsx)(n.p,{children:"The following action keywords are supported:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Keyword"}),(0,t.jsx)(n.th,{children:"Value type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"removeHeaders"})}),(0,t.jsx)(n.td,{children:"Text or Collection of texts"}),(0,t.jsx)(n.td,{children:"Header(s) to remove from the HTTP responses. If a header to remove does not exist in the response header, it is ignored."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"addHeaders"})}),(0,t.jsx)(n.td,{children:"Object"}),(0,t.jsx)(n.td,{children:"Name (text) and value (text) of header(s) to add to the HTTP responses."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"setHeaders"})}),(0,t.jsx)(n.td,{children:"Object"}),(0,t.jsx)(n.td,{children:"Name (text) and value (text) of header(s) to modify in the HTTP responses. If a header to modify does not exist in the response header, it is added."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"denyAccess"})}),(0,t.jsx)(n.td,{children:"Boolean"}),(0,t.jsx)(n.td,{children:"true to deny access to the resource, false to allow access. When the access to a resource is denied, the web server returns a 403 status by default"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"redirect"})}),(0,t.jsx)(n.td,{children:"Text"}),(0,t.jsx)(n.td,{children:"Redirection URL. When a redirection is triggered, the web server returns a 302 status by default"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"status"})}),(0,t.jsx)(n.td,{children:"Number"}),(0,t.jsx)(n.td,{children:"HTTP status"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"non-modifiable-headers",children:"Non-modifiable headers"}),"\n",(0,t.jsx)(n.p,{children:"Some headers could not be added, modified or removed:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Header"}),(0,t.jsx)(n.th,{children:"Add"}),(0,t.jsx)(n.th,{children:"Set"}),(0,t.jsx)(n.th,{children:"Remove"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Date"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"No"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Content-Length"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"No"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Content-Encoding"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"No"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Vary"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"No"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Set-Cookie"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Add cookie"}),(0,t.jsx)(n.td,{children:"No"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Unauthorized changes on these headers do not generate errors, however modifications will be ignored."}),"\n",(0,t.jsx)(n.h3,{id:"current-rules",children:"Current rules"}),"\n",(0,t.jsxs)(n.p,{children:["You can know the current rules using the ",(0,t.jsxs)(n.a,{href:"/docs/API/WebServerClass#rules",children:[(0,t.jsx)(n.code,{children:".rules"})," property of the Web Server object"]}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"var $rules : Collection\n$rules:=WEB Server.rules //current rules\n"})}),"\n",(0,t.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsxs)(n.p,{children:["Rules can be set using a ",(0,t.jsx)(n.code,{children:"HTTPRules.json"})," file or the ",(0,t.jsx)(n.em,{children:"settings"})," parameter of the ",(0,t.jsx)(n.a,{href:"/docs/API/WebServerClass#start",children:(0,t.jsx)(n.code,{children:".start()"})})," web server function."]}),"\n",(0,t.jsx)(n.h3,{id:"using-a-httprulesjson-file",children:"Using a HTTPRules.json file"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'\n[\n	{\n		"comment": "All requests: allow GET method for, remove \'Server\' header and set security headers",\n		"regexPattern": "/(.*)",\n		"setHeaders": {\n			"Allow": "GET",\n			"X-Frame-Options": "SAMEORIGIN",\n			"Content-Security-Policy": "default-src \'self\'"\n		},\n		"removeHeaders": [\n			"Server"\n		]\n	},\n	{\n		"comment": "REST requests: allow POST method",\n		"regexPattern": "/rest/(.*)",\n		"addHeaders": {\n			"Allow": "POST"\n		}\n	},\n	{\n		"comment": "HTML files in \'doc\' folder: set cache control",\n		"regexPattern": "/docs/(.*).html",\n		"setHeaders": {\n			"Cache-Control": "max-age=3600"\n		},\n		"removeHeaders": [\n			"X-Powered-By"\n		]\n	},\n	{\n		"comment": "Status 503 on \'maintenance\' page",\n		"regexPattern": "^/maintenance.html",\n		"status": 503\n	},\n	{\n		"comment": "Redirect CSS and JS files",\n		"regexPattern": "^(.*\\\\\\\\.(css|js))",\n		"redirect": "https://cdn.example.com/"\n	},\n	{\n		"comment": "Redirect images with permanent status code",\n		"regexPattern": "^(.*\\\\\\\\.(jpg|jpeg|png|gif))",\n		"redirect": "https://cdn.example.com/images/",\n		"status": 301\n	},\n	{\n		"comment": "Deny access for all resources placed in the \'private\' folder",\n		"regexPattern": "/private/(.*)",\n		"denyAccess": true\n	},\n	{\n		"comment": "Allow access to all resources placed in the \'private/allowed\' folder",\n		"regexPattern": "/private/allowed/(.*)",\n		"denyAccess": false\n	}\n]\n\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"using-a-settings-parameter",children:["Using a ",(0,t.jsx)(n.em,{children:"settings"})," parameter"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-4d",children:'var $rule:={}\n\nvar $settings:={}\n\n$settings.rules:=[]\n\n$rule:={}\n$rule.comment:="All requests: allow GET method for, remove \'Server\' header and set security headers"\n$rule.regexPattern:="/(.*)"\n$rule.setHeaders:={Allow: "GET"}\n$rule.setHeaders["X-Frame-Options"]:="SAMEORIGIN"\n$rule.setHeaders["Content-Security-Policy"]:="default-src \'self\'"\n$rule.removeHeaders:=["Server"]\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="REST requests: allow POST method"\n$rule.regexPattern:="/rest/(.*)"\n$rule.addHeaders:={Allow: "POST"}\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="HTML files in \'doc\' folder: set cache control"\n$rule.regexPattern:="/docs/(.*).html"\n$rule.setHeaders:={}\n$rule.setHeaders["Cache-Control"]:="max-age=3600"\n$rule.removeHeaders:=["X-Powered-By"]\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Status 503 on \'maintenance\' page"\n$rule.regexPattern:="^/maintenance.html"\n$rule.status:=503\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Redirect CSS and JS files"\n$rule.regexPattern:="^(.*\\\\\\\\.(css|js))"\n$rule.redirect:="https://cdn.example.com/"\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Redirect images with permanent status code"\n$rule.regexPattern:="^(.*\\\\\\\\.(jpg|jpeg|png|gif))"\n$rule.redirect:="https://cdn.example.com/images/"\n$rule.status:=301\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Deny access for all resources placed in the \'private\' folder"\n$rule.regexPattern:="/private/(.*)"\n$rule.denyAccess:=True\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Allow access to all resources placed in the \'private/allowed\' folder"\n$rule.regexPattern:="/private/allowed/(.*)"\n$rule.denyAccess:=False\n$settings.rules.push($rule)\n\n$return:=WEB Server.start($settings)\n\n'})}),"\n",(0,t.jsx)(n.admonition,{title:"Related blog post",type:"tip",children:(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://blog.4d.com/new-way-to-control-your-http-responses/",children:"New Way to Control Your HTTP Responses"})})})]})}function h(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},250065:function(e,n,r){r.d(n,{Z:()=>i,a:()=>d});var s=r(667294);let t={},l=s.createContext(t);function d(e){let n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);