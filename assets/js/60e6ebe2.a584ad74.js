"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["3284"],{322395:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>l,toc:()=>o,default:()=>h,metadata:()=>r,assets:()=>d,contentTitle:()=>a});var r=JSON.parse('{"id":"WebServer/http-request-handler","title":"Gestionnaire de requ\xeates HTTP","description":"By default, HTTP requests received by the 4D web server are handled through built-in processing features or the REST server.","source":"@site/versioned_docs/version-21/WebServer/http-request-handler.md","sourceDirName":"WebServer","slug":"/WebServer/http-request-handler","permalink":"/docs/WebServer/http-request-handler","draft":false,"unlisted":false,"editUrl":"https://github.com/4d/docs/issues/new?title=Comment%20on%20WebServer%2Fhttp-request-handler.md%20(21)&body=Please%20enter%20your%20comment%3A","tags":[],"version":"21","frontMatter":{"id":"http-request-handler","title":"Gestionnaire de requ\xeates HTTP"},"sidebar":"docs","previous":{"title":"Processing HTTP requests","permalink":"/docs/WebServer/httpRequests"},"next":{"title":"HTTP Rules","permalink":"/docs/WebServer/http-rules"}}'),i=s(785893),t=s(250065);let l={id:"http-request-handler",title:"Gestionnaire de requ\xeates HTTP"},a=void 0,d={},o=[{value:"Requirements",id:"requirements",level:2},{value:"How to set handlers",id:"how-to-set-handlers",level:2},{value:"Handler definition",id:"handler-definition",level:2},{value:"URL patterns",id:"url-patterns",level:3},{value:"Forbidden patterns",id:"forbidden-patterns",level:4},{value:"Class et method",id:"class-et-method",level:3},{value:"Verbs",id:"verbs",level:3},{value:"Example",id:"example",level:2},{value:"Request handler code",id:"request-handler-code",level:2},{value:"Function configuration",id:"function-configuration",level:3},{value:"Input: an instance of the 4D.IncomingMessage class",id:"input-an-instance-of-the-4dincomingmessage-class",level:3},{value:"Sortie : une instance de la classe 4D.OutgoingMessage",id:"sortie--une-instance-de-la-classe-4doutgoingmessage",level:3},{value:"Example",id:"example-1",level:3},{value:"See also",id:"see-also",level:2}];function c(e){let n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["By default, HTTP requests received by the 4D web server are handled through ",(0,i.jsx)(n.a,{href:"/docs/WebServer/httpRequests",children:"built-in processing features"})," or the ",(0,i.jsx)(n.a,{href:"/docs/REST/REST_requests",children:"REST server"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["In addition, 4D supports the implementation of ",(0,i.jsx)(n.strong,{children:"custom HTTP Request handlers"}),", allowing you to intercept specific incoming HTTP requests and process them using your own code."]}),"\n",(0,i.jsxs)(n.p,{children:["When a custom HTTP request handler intercepts a request, it is processed directly and no other processing features (e.g. ",(0,i.jsx)(n.a,{href:"/docs/WebServer/authentication#on-web-authentication",children:"On Web authentication"})," or ",(0,i.jsx)(n.a,{href:"/docs/WebServer/httpRequests#on-web-connection",children:"On Web connection"})," database methods) are called."]}),"\n",(0,i.jsx)(n.p,{children:"Les gestionnaires de requ\xeates HTTP personnalis\xe9s r\xe9pondent \xe0 divers besoins, y compris :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"l'utilisation d'une URL d\xe9di\xe9e comme fournisseur de ressources ou comme zone de t\xe9l\xe9chargement de fichiers (pour t\xe9l\xe9charger ou t\xe9l\xe9verser divers fichiers),"}),"\n",(0,i.jsx)(n.li,{children:"la redirection sur des pages sp\xe9cifiques en fonction d'un contexte (utilisateur authentifi\xe9, privil\xe8ges accord\xe9s...),"}),"\n",(0,i.jsx)(n.li,{children:"la gestion d'une authentification via oAuth 2.0."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,i.jsx)(n.p,{children:"Custom HTTP Request handlers are supported in the following context:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/WebServer/sessions#enabling-web-sessions",children:"scalable sessions"})," or ",(0,i.jsx)(n.a,{href:"/docs/settings/web#no-sessions",children:"no sessions"})," are enabled,"]}),"\n",(0,i.jsxs)(n.li,{children:["a web server run locally by 4D or 4D Server, including those ",(0,i.jsx)(n.a,{href:"/docs/WebServer/webServerObject",children:"run by components"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["For security reasons, external access to the datastore can be disallowed in 4D. You need to configure the ",(0,i.jsx)(n.a,{href:"/docs/ORDA/privileges",children:"ORDA privileges"})," to allow HTTP requests."]})}),"\n",(0,i.jsx)(n.h2,{id:"how-to-set-handlers",children:"How to set handlers"}),"\n",(0,i.jsx)(n.p,{children:"You can declare HTTP Request handlers:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["in a configuration file named ",(0,i.jsx)(n.strong,{children:"HTTPHandlers.json"})," stored in the ",(0,i.jsx)(n.a,{href:"/docs/Project/architecture#sources",children:(0,i.jsx)(n.code,{children:"Project/Sources"})})," folder of the project. HTTP Request handlers are loaded and applied in the main Web server once it is started."]}),"\n",(0,i.jsxs)(n.li,{children:["using a ",(0,i.jsx)(n.a,{href:"/docs/API/WebServerClass#handlers",children:(0,i.jsx)(n.code,{children:".handlers"})})," property set in the ",(0,i.jsx)(n.em,{children:"settings"})," parameter of the ",(0,i.jsx)(n.a,{href:"/docs/API/WebServerClass#start",children:"start()"})," function, for any web server object:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-4d",children:"WEB Server.start($settings.handlers) //set rules at web server startup\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If both a ",(0,i.jsx)(n.strong,{children:"HTTPHandlers.json"})," file and a call to the ",(0,i.jsx)(n.a,{href:"/docs/commands/web-server",children:(0,i.jsx)(n.code,{children:"WEB Server"})})," command with a valid ",(0,i.jsx)(n.code,{children:"$settings.handlers"})," are used, the ",(0,i.jsx)(n.code,{children:"WEB Server"})," command has priority."]}),"\n",(0,i.jsxs)(n.p,{children:["The json file (or the object in the ",(0,i.jsx)(n.em,{children:"settings"})," parameter) contains all listened URL patterns, the handled verbs, and the code to be called."]}),"\n",(0,i.jsx)(n.p,{children:"Handlers are provided as a collection."}),"\n",(0,i.jsx)(n.p,{children:"Au moment de l'ex\xe9cution, le premier motif correspondant \xe0 l'URL est ex\xe9cut\xe9, les autres sont ignor\xe9s."}),"\n",(0,i.jsxs)(n.p,{children:["Voici un exemple du contenu d'un fichier ",(0,i.jsx)(n.em,{children:"HTTPHandlers.json"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'\n[\n    {\n        "class": "GeneralHandling",\n        "method": "gettingStarted",\n        "pattern": "start",\n        "verbs": "get, post"\n    }\n]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Cette d\xe9claration de gestionnaire peut \xeatre lue ainsi : quand une requ\xeate commen\xe7ant par ",(0,i.jsx)(n.code,{children:"/start/"})," avec un verbe ",(0,i.jsx)(n.code,{children:"GET"})," ou ",(0,i.jsx)(n.code,{children:"POST"})," est re\xe7ue par le serveur, la fonction ",(0,i.jsx)(n.code,{children:"gettingStarted"})," du singleton ",(0,i.jsx)(n.code,{children:"GeneralHandling"})," est ex\xe9cut\xe9e."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"Vous devez red\xe9marrer le serveur Web pour que les modifications apport\xe9es dans ce fichier soient prises en compte."})}),"\n",(0,i.jsx)(n.h2,{id:"handler-definition",children:"Handler definition"}),"\n",(0,i.jsx)(n.p,{children:"Un gestionnaire est d\xe9fini par :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"un motif d'URL \xe0 intercepter"}),"\n",(0,i.jsx)(n.li,{children:"une fonction et sa classe o\xf9 le code est impl\xe9ment\xe9 pour traiter le motif d'URL en question"}),"\n",(0,i.jsx)(n.li,{children:"les verbes avec lesquels l'URL peut \xeatre appel\xe9e pour d\xe9clencher le gestionnaire personnalis\xe9"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"L'identifiant du gestionnaire est le couple [motif + un verbe parmi la liste des verbes]."}),"\n",(0,i.jsx)(n.h3,{id:"url-patterns",children:"URL patterns"}),"\n",(0,i.jsxs)(n.p,{children:["URL patterns can be given as ",(0,i.jsx)(n.strong,{children:"prefixes"})," or using ",(0,i.jsx)(n.strong,{children:"regular expressions"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:['To declare a prefix pattern, use the "pattern" property name in the HTTPHandlers.json file. Prefixes are considered as regular expressions already containing starting and ending ',(0,i.jsx)(n.code,{children:"/"}),".",(0,i.jsx)(n.br,{}),"\nEx: ",(0,i.jsx)(n.code,{children:'"pattern" : "docs"'})," or ",(0,i.jsx)(n.code,{children:'"pattern" : "docs/invoices"'})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:['To declare a regular expression pattern, use the "regexPattern" property name in the HTTPHandlers.json file. Regular expressions patterns are handled directly.\nEx: ',(0,i.jsx)(n.code,{children:'"regexPattern" : "/docs/.+/index\\.html"'})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:'"Pattern" and "regexPattern" properties cannot be used in the same handler definition (in this case, only the "regexPattern" property is taken into account).'}),"\n",(0,i.jsx)(n.p,{children:"Les motifs d'URL sont d\xe9clench\xe9s dans l'ordre d\xe9fini :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"le premier motif correspondant est ex\xe9cut\xe9"}),"\n",(0,i.jsx)(n.li,{children:"les motifs suivants ne sont pas ex\xe9cut\xe9s m\xeame s'ils correspondent \xe0 l'URL"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"As a consequence, you need to apply a accurate strategy when writing your handlers: the most detailed patterns must be written before the more general patterns."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'[\n    {\n        "class": "InvoiceslHandling",\n        "method": "handleTheInvoice",\n        "regexPattern": "/docs/invoices/details/theInvoice",\n        "verbs": "GET"\n    },\n    {\n        "class": "InvoiceslHandling",\n        "method": "handleUnauthorizedVerbs",\n        "regexPattern": "/docs/invoices/details/theInvoice",\n        "comment": "This handler is triggered for all verbs except GET (handled above)"\n    },\n    {\n        "class": "DocsHandling",\n        "method": "handleDocs",\n        "regexPattern": "/docs",\n        "comment": "This handler is triggered for all the verbs"\n    }\n]\n\n'})}),"\n",(0,i.jsx)(n.h4,{id:"forbidden-patterns",children:"Forbidden patterns"}),"\n",(0,i.jsx)(n.p,{children:"Les motifs d'URL correspondant aux fonctions de traitement HTTP int\xe9gr\xe9es de 4D ne sont pas autoris\xe9s dans les gestionnaires HTTP personnalis\xe9s. Par exemple, les motifs suivants ne peuvent pas \xeatre trait\xe9s :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/4DACTION"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/rest"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/$lib/renderer"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/$shared"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"class-et-method",children:"Class et method"}),"\n",(0,i.jsx)(n.p,{children:'Vous d\xe9clarez le code \xe0 ex\xe9cuter lorsqu\'un motif d\'URL d\xe9fini est intercept\xe9 \xe0 l\'aide des propri\xe9t\xe9s "class" et "method".'}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:['"class": class name without ',(0,i.jsx)(n.code,{children:"cs."}),', e.g. "UsersHandling" for the ',(0,i.jsx)(n.code,{children:"cs.UsersHandling"})," user class. It must be a ",(0,i.jsx)(n.a,{href:"/docs/Concepts/classes#shared-singleton",children:(0,i.jsx)(n.strong,{children:"shared"})})," and ",(0,i.jsx)(n.a,{href:"/docs/Concepts/classes#singleton-classes",children:(0,i.jsx)(n.strong,{children:"singleton"})})," class."]}),"\n",(0,i.jsx)(n.li,{children:'"method": class function belonging to the class.'}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"#request-handler-code",children:"See below"})," for information about the request handler code."]}),"\n",(0,i.jsx)(n.h3,{id:"verbs",children:"Verbs"}),"\n",(0,i.jsx)(n.p,{children:'You can use the "verbs" property in the handler definition to declare HTTP verbs that are supported in incoming requests for this handler. A request that uses a verb that is not explicitely allowed is automatically rejected by the server.'}),"\n",(0,i.jsx)(n.p,{children:"You can declare several verbs, separated by a comma. Verb names are not case sensitive."}),"\n",(0,i.jsxs)(n.p,{children:["Ex : ",(0,i.jsx)(n.code,{children:'"verbs" : "PUT, POST"'})]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"No control is done on verb names. All names can be used."})}),"\n",(0,i.jsxs)(n.p,{children:['By default, if the "verbs" property is not used for a handler, ',(0,i.jsx)(n.strong,{children:"all"})," HTTP verbs are supported in incoming requests for this handler (except those possibly used beforehand in a more detailed pattern, as shown in the example above)."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Le verbe HTTP peut \xe9galement \xeatre \xe9valu\xe9 ",(0,i.jsxs)(n.a,{href:"/docs/API/IncomingMessageClass#verb",children:["\xe0 l'aide de la propri\xe9t\xe9 ",(0,i.jsx)(n.code,{children:".verb"})," dans le code du gestionnaire de requ\xeate"]})," pour \xeatre accept\xe9 ou rejet\xe9."]})}),"\n",(0,i.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,i.jsx)(n.p,{children:"Voici un exemple d\xe9taill\xe9 de fichier HTTPHandlers.json :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'\n[\n   {\n        "class": "GeneralHandling",\n        "method": "handle",\n        "pattern": "info", //URL prefix\n        "verbs": "GET"\n    }, \n    {\n        "class": "UsersHandling",\n        "method": "manageAccount",\n        "pattern": "userAccount/update",   //URL prefix\n        "verbs": "PUT,POST"\n    }, \n    {\n        "class": "FinancialHandling",\n        "method": "handleInvoices",\n        "regexPattern": "/docs/invoices/(past|today)", //URL prefix given as a regex\n        "verbs": "GET"\n    },\n    {\n        "class": "DocsHandling",\n        "method": "handleDocs",\n        "regexPattern": "/docs/myPage.html",  //URL prefix given as a regex\n        "verbs": "GET"\n    },\n    {\n        "class": "InvoicesHandling",\n        "method": "handleTheInvoice",\n        "pattern": "docs/invoices/details/theInvoice", // The most specific URL first\n        "verbs": "GET,POST"\n    },\n    {\n        "class": "InvoicesHandling",\n        "method": "handleDetails",\n        "pattern": "docs/invoices/details",    // The general URLs after\n        "verbs": "GET"\n    },\n    {\n        "class": "InvoicesHandling",\n        "method": "handleInvoices",   // The general URLs after\n        "pattern": "docs/invoices",\n        "verbs": "GET"\n    }\n]\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"Dans cet exemple, vous devez impl\xe9menter les fonctions suivantes :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Fonction ",(0,i.jsx)(n.em,{children:"handle"})," dans la classe ",(0,i.jsx)(n.em,{children:"GeneralHandling"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"manageAccount"})," dans la classe ",(0,i.jsx)(n.em,{children:"UsersHandling"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"handleInvoices"})," dans la classe ",(0,i.jsx)(n.em,{children:"FinancialHandling"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"handleDocs"})," dans la classe ",(0,i.jsx)(n.em,{children:"DocsHandling"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"handleTheInvoice"})," / ",(0,i.jsx)(n.em,{children:"handleDetails"})," / ",(0,i.jsx)(n.em,{children:"handleInvoices"})," dans la classe ",(0,i.jsx)(n.em,{children:"InvoicesHandling"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Examples of URLs triggering the handlers:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"IP:port/info/"})," avec un verbe GET\n",(0,i.jsx)(n.code,{children:"IP:port/info/general"})," avec un verbe GET"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"IP:port/userAccount/update/"})," avec un verbe POST\n",(0,i.jsx)(n.code,{children:"IP:port/userAccount/update/profile"})," avec un verbe POST"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"IP:port/docs/invoices/past"})," avec un verbe GET\n",(0,i.jsx)(n.code,{children:"IP:port/docs/invoices/today/latest"})," avec un verbe GET"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"IP:port//docs/myPage.html"})," avec un verbe GET"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"IP:port//docs/invoices/"})," avec un verbe GET, appelle la fonction ",(0,i.jsx)(n.em,{children:"handleInvoices"})," (classe ",(0,i.jsx)(n.em,{children:"InvoicesHandling"}),")\n",(0,i.jsx)(n.code,{children:"IP:port//docs/invoices/details/"})," avec un verbe GET, appelle la fonction ",(0,i.jsx)(n.em,{children:"handleDetails"})," (classe ",(0,i.jsx)(n.em,{children:"InvoicesHandling"}),")\n",(0,i.jsx)(n.code,{children:"IP :port//docs/invoices/details/theInvoice/xxxxxx"})," avec un verbe GET, appelle la fonction ",(0,i.jsx)(n.em,{children:"handleTheInvoice"})," (classe ",(0,i.jsx)(n.em,{children:"InvoiceslHandling"}),")"]}),"\n",(0,i.jsx)(n.h2,{id:"request-handler-code",children:"Request handler code"}),"\n",(0,i.jsx)(n.h3,{id:"function-configuration",children:"Function configuration"}),"\n",(0,i.jsxs)(n.p,{children:["The HTTP Request handler code must be implemented in a function of a ",(0,i.jsx)(n.a,{href:"/docs/Concepts/classes#shared-singleton",children:(0,i.jsx)(n.strong,{children:"Shared"})})," ",(0,i.jsx)(n.a,{href:"/docs/Concepts/classes#singleton-classes",children:(0,i.jsx)(n.strong,{children:"singleton class"})}),"."]}),"\n",(0,i.jsxs)(n.p,{children:['Si le singleton est manquant ou non partag\xe9, une erreur "Cannot find singleton" est renvoy\xe9e par le serveur. Si la classe ou la fonction ',(0,i.jsx)(n.a,{href:"#handler-definition",children:"d\xe9finie comme handler"})," dans le fichier HTTPHandlers.json n'est pas trouv\xe9e, le serveur renvoie l'erreur \"Cannot find singleton function\"."]}),"\n",(0,i.jsxs)(n.p,{children:["Les fonctions du gestionnaire de requ\xeates ne sont pas n\xe9cessairement partag\xe9es, sauf si certaines propri\xe9t\xe9s du gestionnaire sont modifi\xe9es par ces fonctions. Dans ce cas, vous devez d\xe9clarer ses fonctions avec le ",(0,i.jsxs)(n.a,{href:"/docs/Concepts/classes#shared-functions",children:["mot-cl\xe9 ",(0,i.jsx)(n.code,{children:"shared"})]}),"."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Il est ",(0,i.jsx)(n.strong,{children:"d\xe9conseill\xe9"})," d'exposer les fonctions du gestionnaire de requ\xeates aux appels REST externes en utilisant les mots-cl\xe9s ",(0,i.jsx)(n.a,{href:"/docs/ORDA/ordaClasses#exposed-vs-non-exposed-functions",children:(0,i.jsx)(n.code,{children:"exposed"})})," ou ",(0,i.jsx)(n.a,{href:"/docs/ORDA/ordaClasses#onhttpget-keyword",children:(0,i.jsx)(n.code,{children:"onHTTPGet"})}),"."]})}),"\n",(0,i.jsx)(n.h3,{id:"input-an-instance-of-the-4dincomingmessage-class",children:"Input: an instance of the 4D.IncomingMessage class"}),"\n",(0,i.jsxs)(n.p,{children:["When a request has been intercepted by the handler, it is received on the server as an instance of the ",(0,i.jsx)(n.a,{href:"/docs/API/IncomingMessageClass",children:"4D.IncomingMessage class"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"All necessary information about the request are available in this object, including the request url, verb, headers, and, if any, parameters (put in the URL) and body."}),"\n",(0,i.jsx)(n.p,{children:"Then, the request handler can use this information to trigger appropriate business logic."}),"\n",(0,i.jsx)(n.h3,{id:"sortie--une-instance-de-la-classe-4doutgoingmessage",children:"Sortie : une instance de la classe 4D.OutgoingMessage"}),"\n",(0,i.jsxs)(n.p,{children:["Le gestionnaire de requ\xeate peut renvoyer une instance d'objet de la classe ",(0,i.jsx)(n.a,{href:"/docs/API/OutgoingMessageClass",children:"4D.OutGoingMessage"}),", c'est-\xe0-dire un contenu web complet pr\xeat \xe0 \xeatre trait\xe9 par un navigateur, comme un contenu de fichier."]}),"\n",(0,i.jsx)(n.h3,{id:"example-1",children:"Example"}),"\n",(0,i.jsxs)(n.p,{children:["La classe ",(0,i.jsx)(n.a,{href:"/docs/API/IncomingMessageClass",children:"4D.IncomingMessage"})," fournit des fonctions pour obtenir les ",(0,i.jsx)(n.a,{href:"/docs/API/IncomingMessageClass#headers",children:"headers"})," et le ",(0,i.jsx)(n.a,{href:"/docs/API/IncomingMessageClass#gettext",children:"body"})," de la requ\xeate."]}),"\n",(0,i.jsx)(n.p,{children:"Voici un exemple simple pour t\xe9l\xe9charger un fichier sur le serveur."}),"\n",(0,i.jsxs)(n.p,{children:["Le fichier ",(0,i.jsx)(n.strong,{children:"HTTPHandlers.json"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'[\n    {\n        "class": "UploadFile",\n        "method": "uploadFile",\n        "regexPattern": "/putFile",\n        "verbs": "POST"\n    }\n]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["L'URL appel\xe9e est : ",(0,i.jsx)(n.a,{href:"http://127.0.0.1:8044/putFile?fileName=testFile",children:"http://127.0.0.1:8044/putFile?fileName=testFile"})]}),"\n",(0,i.jsxs)(n.p,{children:["Le contenu binaire du fichier est plac\xe9 dans le corps de la requ\xeate et un verbe POST est utilis\xe9. Le nom du fichier est fourni en param\xe8tre (",(0,i.jsx)(n.em,{children:"fileName"}),") dans l'URL. Il est re\xe7u dans l'objet ",(0,i.jsx)(n.a,{href:"/docs/API/IncomingMessageClass#urlquery",children:(0,i.jsx)(n.code,{children:"urlQuery"})})," de la requ\xeate."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-4d",children:'    //UploadFile class\n\nshared singleton Class constructor()\n	\n	\nFunction uploadFile($request : 4D.IncomingMessage) : 4D.OutgoingMessage\n	\n	var $response:=4D.OutgoingMessage.new()\n	\n	var $body:="Not supported file"\n	var $fileName; $fileType : Text\n	var $file : 4D.File\n	var $picture : Picture\n	var $created : Boolean\n	\n	$fileName:=$request.urlQuery.fileName\n	$fileType:=$request.getHeader("Content-Type")\n	\n	Case of \n		: ($fileType="application/pdf")\n			$file:=File("/PACKAGE/Files/"+$fileName+".pdf")\n			$created:=$file.create()\n			$file.setContent($request.getBlob())\n			$body:="Upload OK - File size: "+String($file.size)\n			\n		: ($fileType="image/jpeg")\n			$file:=File("/PACKAGE/Files/"+$fileName+".jpg")\n			$picture:=$request.getPicture()\n			WRITE PICTURE FILE($file.platformPath; $picture)\n			$body:="Upload OK - Image size: "+String($file.size)\n			\n	End case \n	\n	$response.setBody($body)\n	$response.setHeader("Content-Type"; "text/plain")\n	\n	return $response\n\n'})}),"\n",(0,i.jsx)(n.h2,{id:"see-also",children:"See also"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://blog.4d.com/master-http-requests-with-4d-request-handlers/",children:"Ma\xeetriser les requ\xeates HTTP avec les gestionnaires de requ\xeates 4D"})," (blog post)"]})]})}function h(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},250065:function(e,n,s){s.d(n,{Z:()=>a,a:()=>l});var r=s(667294);let i={},t=r.createContext(i);function l(e){let n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);