"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[91787],{603905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>u});var n=a(667294);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var d=n.createContext({}),s=function(e){var t=n.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},m=function(e){var t=s(e.components);return n.createElement(d.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,l=e.mdxType,i=e.originalType,d=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),c=s(a),u=l,b=c["".concat(d,".").concat(u)]||c[u]||p[u]||i;return a?n.createElement(b,r(r({ref:t},m),{},{components:a})):n.createElement(b,r({ref:t},m))}));function u(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var i=a.length,r=new Array(i);r[0]=c;var o={};for(var d in t)hasOwnProperty.call(t,d)&&(o[d]=t[d]);o.originalType=e,o.mdxType="string"==typeof e?e:l,r[1]=o;for(var s=2;s<i;s++)r[s]=a[s];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},286070:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>d,toc:()=>m});a(667294);var n=a(603905);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},l.apply(this,arguments)}function i(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}const r={id:"global-stamp",title:"Utilizando el sello global"},o=void 0,d={unversionedId:"ORDA/global-stamp",id:"version-20-R5/ORDA/global-stamp",title:"Utilizando el sello global",description:"Generalidades",source:"@site/i18n/es/docusaurus-plugin-content-docs/version-20-R5/ORDA/global-stamp.md",sourceDirName:"ORDA",slug:"/ORDA/global-stamp",permalink:"/docs/es/ORDA/global-stamp",draft:!1,editUrl:"https://github.com/4d/docs/issues/new?title=Comment%20on%20ORDA%2Fglobal-stamp.md%20(20-R5)&body=Please%20enter%20your%20comment%3A",tags:[],version:"20-R5",frontMatter:{id:"global-stamp",title:"Utilizando el sello global"},sidebar:"docs",previous:{title:"Trabajar con los datos",permalink:"/docs/es/ORDA/entities"},next:{title:"Bases de datos remotas",permalink:"/docs/es/ORDA/datastores"}},s={},m=[{value:"Generalidades",id:"generalidades",level:2},{value:"Configuraci\xf3n del seguimiento de cambios en los datos",id:"configuraci\xf3n-del-seguimiento-de-cambios-en-los-datos",level:2},{value:"Requisitos de estructura",id:"requisitos-de-estructura",level:3},{value:"Uso del Editor de estructuras",id:"uso-del-editor-de-estructuras",level:3},{value:"Ejemplo",id:"ejemplo",level:2}],p={toc:m};function c(e){var{components:t}=e,a=i(e,["components"]);return(0,n.kt)("wrapper",l({},p,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",l({},{id:"generalidades"}),"Generalidades"),(0,n.kt)("p",null,"4D automatically manages an internal ",(0,n.kt)("strong",{parentName:"p"},"global modification stamp"),", useful to handle data change tracking implementations, for example to monitor activity, backup, run incremental synchronization, etc."),(0,n.kt)("p",null,"El sello de modificaci\xf3n global es un n\xfamero, siempre mantenido por 4D, incluso en caso de restauraci\xf3n de la base de datos, importaci\xf3n, etc. Note however that the stamp can be modified using the ",(0,n.kt)("a",l({parentName:"p"},{href:"/docs/es/API/DataStoreClass#setglobalstamp"}),(0,n.kt)("inlineCode",{parentName:"a"},".setGlobalStamp()"))," function."),(0,n.kt)("p",null,"Once the ",(0,n.kt)("a",l({parentName:"p"},{href:"#configuring-data-change-tracking"}),"data change tracking is configured and enabled"),", the following actions are automatically executed by 4D at each record modification (add, modify, delete):"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},'El valor actual del sello de modificaci\xf3n global se guarda en el atributo especial "',(0,n.kt)("strong",{parentName:"p"},'GlobalStamp" de la entidad implicada.\nIn case of a deletion, a new entity is also added to the `'),'DeletedRecords` table with information about the deleted entity and the current global modification stamp value is saved in the "__Stamp" attribute.')),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Se incrementa el valor del sello de modificaci\xf3n global."))),(0,n.kt)("p",null,"Este mecanismo permite identificar las entidades que han sido modificadas, a\xf1adidas o suprimidas desde un momento dado, y aplicar las medidas oportunas (ver el ejemplo)."),(0,n.kt)("admonition",l({},{type:"info"}),(0,n.kt)("p",{parentName:"admonition"},"Do not confuse the ",(0,n.kt)("strong",{parentName:"p"},"global modification stamp")," with the internal ",(0,n.kt)("strong",{parentName:"p"},"entity stamp"),", used for the ",(0,n.kt)("a",l({parentName:"p"},{href:"/docs/es/ORDA/entities#automatic-optimistic-lock"}),"optimistic locking feature"),".")),(0,n.kt)("h2",l({},{id:"configuraci\xf3n-del-seguimiento-de-cambios-en-los-datos"}),"Configuraci\xf3n del seguimiento de cambios en los datos"),(0,n.kt)("p",null,"By default, the global modification stamp is not created (the ",(0,n.kt)("a",l({parentName:"p"},{href:"/docs/es/API/DataStoreClass#getglobalstamp"}),(0,n.kt)("inlineCode",{parentName:"a"},".getGlobalStamp()"))," function returns 0. Para habilitar el seguimiento de cambios en los datos, debe a\xf1adir campos especiales y una tabla a su estructura. Puede utilizar el men\xfa contextual del Editor de estructura para crear autom\xe1ticamente todos los elementos necesarios."),(0,n.kt)("h3",l({},{id:"requisitos-de-estructura"}),"Requisitos de estructura"),(0,n.kt)("p",null,"To enable data change tracking, the application structure must contain at least one table with a ",(0,n.kt)("inlineCode",{parentName:"p"},"__GlobalStamp")," field."),(0,n.kt)("p",null,"Adem\xe1s, para garantizar el correcto funcionamiento de la funcionalidad, se requieren las siguientes condiciones:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"The ",(0,n.kt)("inlineCode",{parentName:"li"},"__GlobalStamp")," field must must be of type ",(0,n.kt)("em",{parentName:"li"},"Integer 64 bits"),", with ",(0,n.kt)("em",{parentName:"li"},"automatic index"),", ",(0,n.kt)("em",{parentName:"li"},"Expose as REST resource"),", and ",(0,n.kt)("em",{parentName:"li"},"Invisible")," properties selected."),(0,n.kt)("li",{parentName:"ul"},"A ",(0,n.kt)("inlineCode",{parentName:"li"},"__DeletedRecords")," table must be added, with the following fields:")),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",l({parentName:"tr"},{align:null}),"Campo"),(0,n.kt)("th",l({parentName:"tr"},{align:null}),"Tipo"),(0,n.kt)("th",l({parentName:"tr"},{align:null}),"Descripci\xf3n"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:null}),"__PrimaryKey"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"Text"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"Llave primaria de la entidad eliminada")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:null}),"__Stamp"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"Entero 64 bits"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"Sello global justo antes de la eliminaci\xf3n")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:null}),"__TableName"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"Text"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"Nombre de la tabla de entidades eliminada")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:null}),"__TableNumber"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"Entero largo"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"N\xfamero de la tabla de entidades eliminada")))),(0,n.kt)("p",null,"You can only track changes for data in tables having the ",(0,n.kt)("inlineCode",{parentName:"p"},"__GlobalStamp")," field."),(0,n.kt)("admonition",l({},{type:"note"}),(0,n.kt)("p",{parentName:"admonition"},"In the 4D language, the ",(0,n.kt)("inlineCode",{parentName:"p"},"__GlobalStamp")," field value should be handled through a ",(0,n.kt)("inlineCode",{parentName:"p"},"Real")," type variable.")),(0,n.kt)("h3",l({},{id:"uso-del-editor-de-estructuras"}),"Uso del Editor de estructuras"),(0,n.kt)("p",null,"El editor de estructura 4D le permite activar o desactivar el seguimiento de cambios de datos mediante un \xfanico elemento de men\xfa."),(0,n.kt)("p",null,"Para activar el seguimiento de cambios en los datos:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Seleccione la(s) tabla(s) para las cuales desea habilitar el seguimiento de cambios de datos."),(0,n.kt)("li",{parentName:"ol"},"Right-click on a selected table and select ",(0,n.kt)("strong",{parentName:"li"},"Enable data change tracking")," in the contextual menu."),(0,n.kt)("li",{parentName:"ol"},"Aparece una caja de di\xe1logo de confirmaci\xf3n. Presione ",(0,n.kt)("strong",{parentName:"li"},"OK"),".")),(0,n.kt)("p",null,"4D realiza entonces los siguientes cambios:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"A preconfigured ",(0,n.kt)("inlineCode",{parentName:"li"},"__GlobalStamp")," field is added to the table(s)."),(0,n.kt)("li",{parentName:"ul"},"If not already existing, a ",(0,n.kt)("inlineCode",{parentName:"li"},"__DeletedRecords")," table is added to the structure.")),(0,n.kt)("p",null,"Para desactivar el seguimiento de cambios de datos:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Seleccione la tabla o tablas para las que desea eliminar el seguimiento de cambios de datos."),(0,n.kt)("li",{parentName:"ol"},"Right-click on a selected table and select ",(0,n.kt)("strong",{parentName:"li"},"Disable data change tracking")," in the contextual menu."),(0,n.kt)("li",{parentName:"ol"},"Aparece una caja de di\xe1logo de confirmaci\xf3n. Presione ",(0,n.kt)("strong",{parentName:"li"},"OK"),".")),(0,n.kt)("p",null,"4D then removes the ",(0,n.kt)("inlineCode",{parentName:"p"},"__GlobalStamp")," field from the table(s). Note that if you want to remove the ",(0,n.kt)("inlineCode",{parentName:"p"},"__DeletedRecords")," table, you need to do it manually."),(0,n.kt)("h2",l({},{id:"ejemplo"}),"Ejemplo"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-4d"}),'var $oldStamp : Real\nvar $tableName : Text\nvar $modifiedEmps : cs.EmployeeSelection\nvar $deletedEmpsInfo : cs.__DeletedRecordsSelection\n\n$tableName:="Employee"\n$oldStamp:=... //load the previous stamp value  \n    //from which you want to compare the current stamp\n\nIf ($oldStamp # ds.getGlobalStamp())\n        //get all new or modified entities\n    $modifiedEmps:=ds[$tableName].query("__GlobalStamp > :1"; $oldStamp)\n        //get all deleted entities\n    $deletedEmpsInfo:=ds.__DeletedRecords.query("__Stamp > :1 and __TableName = :2";\\\n    $oldStamp; $tableName)\nEnd if\n')))}c.isMDXComponent=!0}}]);