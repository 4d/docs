"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["44530"],{951991:function(e,n,o){o.r(n),o.d(n,{default:()=>u,frontMatter:()=>t,metadata:()=>a,assets:()=>i,toc:()=>l,contentTitle:()=>d});var a=JSON.parse('{"id":"commands-legacy/on-exit-database-method","title":"On Exit database method","description":"M\xe9todo base On Exit","source":"@site/i18n/es/docusaurus-plugin-content-docs/version-20-R8/commands-legacy/on-exit-database-method.md","sourceDirName":"commands-legacy","slug":"/commands/on-exit-database-method","permalink":"/docs/es/commands/on-exit-database-method","draft":false,"unlisted":false,"editUrl":"https://github.com/4d/docs/issues/new?title=Comment%20on%20commands-legacy%2Fon-exit-database-method.md%20(20-R8)&body=Please%20enter%20your%20comment%3A","tags":[],"version":"20-R8","frontMatter":{"id":"on-exit-database-method","title":"On Exit database method","slug":"/commands/on-exit-database-method","displayed_sidebar":"docs"},"sidebar":"docs","previous":{"title":"On Drop database method","permalink":"/docs/es/commands/on-drop-database-method"},"next":{"title":"On Host Database Event database method","permalink":"/docs/es/commands/on-host-database-event-database-method"}}'),s=o("785893"),r=o("250065");let t={id:"on-exit-database-method",title:"On Exit database method",slug:"/commands/on-exit-database-method",displayed_sidebar:"docs"},d=void 0,i={},l=[{value:"Nota",id:"nota",level:4},{value:"Ver tambi\xe9n",id:"ver-tambi\xe9n",level:4}];function c(e){let n={a:"a",br:"br",code:"code",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"M\xe9todo base On Exit"})}),"\n\n\n\n\n\n\n\n",(0,s.jsx)(n.table,{children:(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Este comando no requiere par\xe1metros"}),(0,s.jsx)(n.th,{})]})})}),"\n",(0,s.jsx)(n.h4,{id:""}),"\n",(0,s.jsx)(n.p,{children:"El M\xe9todo base On Exit se llama una vez cuando sale de la base."}),"\n",(0,s.jsx)(n.p,{children:"Este m\xe9todo se utiliza en los siguientes entornos 4D:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"4D en modo local"}),"\n",(0,s.jsx)(n.li,{children:"4D en modo remoto (del lado del cliente)"}),"\n",(0,s.jsx)(n.li,{children:"Aplicaci\xf3n 4D compilada y fusionada con 4D Volume Desktop"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Nota"}),": ",(0,s.jsx)(n.strong,{children:"M\xe9todo base On Exit"})," NO es invocado por 4D Server. Debe utilizar ",(0,s.jsx)(n.a,{href:"metodo-base-on-server-shutdown.md",children:"M\xe9todo base On Server Shutdown"})," en este contexto."]}),"\n",(0,s.jsx)(n.p,{children:"El M\xe9todo base On Exit es invocado autom\xe1ticamente por 4D; a diferencia de los m\xe9todos proyecto, no puede llamar este m\xe9todo base por programaci\xf3n. Sin embargo, puede ejecutarlo desde el editor de m\xe9todos. Igualmente puede utilizar subrutinas."}),"\n",(0,s.jsx)(n.p,{children:"Se sale de una base si:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["El usuario selecciona el comando ",(0,s.jsx)(n.strong,{children:"Salir"})," del men\xfa ",(0,s.jsx)(n.strong,{children:"Archivo"})," en el entorno Dise\xf1o o desde el entorno Aplicaci\xf3n (Quit standard action)."]}),"\n",(0,s.jsxs)(n.li,{children:["Se efect\xfaa una llamada al comando ",(0,s.jsx)(n.a,{href:"/docs/es/commands/quit-4d",children:"QUIT 4D"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Un plug-in 4D hace una llamada al punto de entrada ",(0,s.jsx)(n.a,{href:"/docs/es/commands/quit-4d",children:"QUIT 4D"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Sin importar c\xf3mo se inicie la salida de la base, 4D realiza las siguientes acciones:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Si no existe un M\xe9todo base On Exit, 4D aborta cada proceso en ejecuci\xf3n uno por uno, sin distinci\xf3n. Si el usuario est\xe1 introduciendo datos, los registros no se guardar\xe1n."}),"\n",(0,s.jsx)(n.li,{children:"Si existe un M\xe9todo base On Exit, 4D comienza la ejecuci\xf3n de este m\xe9todo en un proceso local creado recientemente. Observe que saldr\xe1 eventualmente de 4D, el M\xe9todo base On Exit puede realizar toda la limpieza o cierre de las operaciones que usted quiera, pero no puede negarse a salir."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Cuando 4D est\xe1 a punto de salir, el programa:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"pide a los procesos en ejecuci\xf3n que aborten su ejecuci\xf3n lo antes posible (s\xf3lo se tiene en cuenta en los procesos que ejecutan c\xf3digo 4D)"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"establece su bandera \u2018proceso abortado\u2019"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["despierta los procesos que han sido retrasados por ",(0,s.jsx)(n.a,{href:"/docs/es/commands/delay-process",children:"DELAY PROCESS"})," u otros medios."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["4D contin\xfaa iterando procesos mientras cualquier proceso siga vivo, durante una duraci\xf3n m\xe1xima de 13 segundos. Para responder a una acci\xf3n de abandono, recomendamos establecer una bandera (como una entrada en el objeto ",(0,s.jsx)(n.a,{href:"/docs/es/commands/storage",children:"Storage"}),") en el M\xe9todo base On Exit o en su m\xe9todo de abandono personalizado. Podr\xeda tener sentido hacer un bucle en ese m\xe9todo (m\xe1ximo 10 segundos) para dar tiempo a que sus procesos en ejecuci\xf3n respondan y se abandonen a s\xed mismos correctamente. No es recomendable esperar m\xe1s de 10 segundos, para evitar que 4D mate el proceso o el sistema operativo mate toda la aplicaci\xf3n."]}),"\n",(0,s.jsx)(n.p,{children:"El M\xe9todo base On Exit es perfecto para:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Guardar (localmente, en el disco) preferencias o par\xe1metros a reutilizar al comienzo de la siguiente sesi\xf3n en el ."}),"\n",(0,s.jsx)(n.li,{children:"Realizar otras acciones autom\xe1ticamente cada vez que se salga de la base."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Nota:"}),' no olvide que el proceso creado por el M\xe9todo base On Exit es un proceso local/cliente, por lo tanto no puede acceder al archivo de datos. Si el M\xe9todo base On Exit realiza una consulta o una ordenaci\xf3n, un cliente 4D que est\xe1 a punto de salir quedar\xe1 "congelado" y en realidad no saldr\xe1 de la aplicaci\xf3n. Si necesita acceder a datos cuando un cliente sale de la aplicaci\xf3n, cree un nuevo proceso global desde el cual el M\xe9todo base On Exit pueda acceder al archivo de datos. En este caso, aseg\xfarese de que el nuevo proceso termine correctamente antes del final de la ejecuci\xf3n del M\xe9todo base On Exit (utilizando por ejemplo ',(0,s.jsx)(n.a,{href:"/docs/es/commands/storage",children:"Storage"})," o un objeto compartido)."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Nota"}),": en un entorno cliente/servidor, ",(0,s.jsx)(n.strong,{children:"M\xe9todo base On Exit"})," se comporta de manera diferente dependiendo de si el usuario sale manualmente (v\xeda el comando de men\xfa ",(0,s.jsx)(n.strong,{children:"Salir"})," o una llamada al comando ",(0,s.jsx)(n.a,{href:"/docs/es/commands/quit-4d",children:"QUIT 4D"}),") o que 4D Server se cierre, lo que obliga a todos los clientes a salir.",(0,s.jsx)(n.br,{}),"\nCuando se sale de 4D Server y se da un tiempo de corte (por ejemplo, 10 minutos), cada cliente conectado muestra un mensaje de advertencia y si el usuario sale durante el per\xedodo de tiempo determinado, el ",(0,s.jsx)(n.strong,{children:"M\xe9todo base On Exit"})," se ejecuta normalmente. Sin embargo, en otros casos (por ejemplo, el usuario no responde a tiempo, el servidor solicita salir inmediatamente o el administrador desconecta manualmente al cliente), el ",(0,s.jsx)(n.strong,{children:"M\xe9todo base On Exit"})," se ejecuta al mismo tiempo que la conexi\xf3n al servidor se cierra. Como resultado, el c\xf3digo en ",(0,s.jsx)(n.strong,{children:"M\xe9todo base On Exit"})," no puede iniciar otro proceso local o de servidor y no puede esperar a que se cancelen otros procesos (ni estos procesos pueden seguir accediendo al servidor). Si intenta hacerlo, se genera un error de red (como 10001 o 10002) ya que la conexi\xf3n al servidor ya est\xe1 cerrada."]}),"\n",(0,s.jsx)(n.h4,{id:"nota",children:"Nota"}),"\n",(0,s.jsxs)(n.p,{children:["El siguiente ejemplo muestra un caso t\xedpico en el que se lanzan uno o m\xe1s procesos en segundo plano que realizan trabajos regulares, que se ejecutan sin fin, en el ",(0,s.jsx)(n.a,{href:"metodo-base-on-startup.md",children:"M\xe9todo base On Startup"})," (o en el ",(0,s.jsx)(n.a,{href:"metodo-base-on-server-startup.md",children:"M\xe9todo base On Server Startup"}),"). Una bandera en el objeto ",(0,s.jsx)(n.a,{href:"/docs/es/commands/storage",children:"Storage"})," de la aplicaci\xf3n se utiliza para decirles que terminen y para comprobar si han terminado."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["En el ",(0,s.jsx)(n.a,{href:"metodo-base-on-startup.md",children:"M\xe9todo base On Startup"})]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:'\xa0Use(Storage)\n\xa0\xa0\xa0\xa0Storage.global:=New shared object("ExitNow";False)\n\xa0End use\n\xa0$p:=New process("Serverjob";0;"Background job#1")\n\xa0$p1:=New process("Check_Invoices";0;"Background job#2")\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Este es un ejemplo de un m\xe9todo en segundo plano:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:"\xa0\xa0// hacer trabajos regulares en segundo plano en el servidor\n\xa0While(Not(Bool(Storage.global.ExitNow)))\n\xa0\xa0// ejecutar trabajos de contabilidad, calcular datos, etc.\n\xa0\xa0// ...\n\xa0\xa0\xa0\xa0DELAY PROCESS(Current process;60*60)\xa0//dormir un minuto, luego repetir el bucle\n\xa0End while\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["En el ",(0,s.jsx)(n.strong,{children:"M\xe9todo base On Exit"}),":"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-4d",children:"\xa0Use(Storage.global)\n\xa0\xa0\xa0\xa0Storage.global.ExitNow:=True\xa0//pedir a todos los workers en segundo plano que salgan\n\xa0End use\n\xa0\n\xa0$time:=Current time\n\xa0$finished:=False\n\xa0While((($time+10)>(Current time+0))&(Not($finished)))&NBSP;\xa0// m\xe1ximo 10 segundos\n\xa0\xa0\xa0\xa0$list:=Get process activity(Processes only)\xa0// obtener la lista de todos los procesos\n\xa0\xa0\xa0\xa0$sublist:=$list.processes.query(\"name='Background job@' and state >=0\")\xa0//\xbfA\xfan hay un trabajo en segundo plano en ejecuci\xf3n?\n\xa0\xa0\xa0\xa0$finished:=($sublist.length=0)\n\xa0\xa0\xa0\xa0If($sublist.length>0)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0For each($job;$sublist)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0RESUME PROCESS($job.number)\xa0//asegurarse de que todos los procesos est\xe1n despiertos\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0End for each\n\xa0\xa0\xa0\xa0End if\n\xa0End while\n"})}),"\n",(0,s.jsx)(n.h4,{id:"ver-tambi\xe9n",children:"Ver tambi\xe9n"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"metodo-base-on-startup.md",children:"M\xe9todo base On Startup"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.a,{href:"/docs/es/commands/quit-4d",children:"QUIT 4D"})]})]})}function u(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},250065:function(e,n,o){o.d(n,{Z:function(){return d},a:function(){return t}});var a=o(667294);let s={},r=a.createContext(s);function t(e){let n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);