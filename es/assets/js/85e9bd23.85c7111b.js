/*! For license information please see 85e9bd23.85c7111b.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[25255],{884842:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>l});var i=n(474848),r=n(28453);const a={id:"authUsers",title:"Usuarios y sesiones"},o=void 0,t={id:"REST/authUsers",title:"Usuarios y sesiones",description:"Sesiones",source:"@site/i18n/es/docusaurus-plugin-content-docs/version-20-R6/REST/authUsers.md",sourceDirName:"REST",slug:"/REST/authUsers",permalink:"/docs/es/REST/authUsers",draft:!1,unlisted:!1,editUrl:"https://github.com/4d/docs/issues/new?title=Comment%20on%20REST%2FauthUsers.md%20(20-R6)&body=Please%20enter%20your%20comment%3A",tags:[],version:"20-R6",frontMatter:{id:"authUsers",title:"Usuarios y sesiones"},sidebar:"docs",previous:{title:"Configuraci\xf3n del servidor",permalink:"/docs/es/REST/configuration"},next:{title:"Obtener informaci\xf3n del servidor",permalink:"/docs/es/REST/genInfo"}},c={},l=[{value:"Sesiones",id:"sesiones",level:2},{value:"Forzar el modo de inicio de sesi\xf3n",id:"forzar-el-modo-de-inicio-de-sesi\xf3n",level:2},{value:"Peticiones REST descriptivas",id:"peticiones-rest-descriptivas",level:3},{value:"<code>Function authentify</code>",id:"function-authentify",level:2},{value:"Sintaxis",id:"sintaxis",level:3},{value:"Ejemplo",id:"ejemplo",level:3}];function d(e){const s={a:"a",admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h2,{id:"sesiones",children:"Sesiones"}),"\n",(0,i.jsxs)(s.p,{children:["When ",(0,i.jsx)(s.a,{href:"/docs/es/WebServer/sessions#enabling-sessions",children:"scalable sessions are enabled"})," (recommended), REST requests can create and use ",(0,i.jsx)(s.a,{href:"/docs/es/WebServer/sessions",children:"web user sessions"}),", providing extra features such as multiple requests handling, data sharing between web client processes, and control of user privileges."]}),"\n",(0,i.jsxs)(s.p,{children:["Cuando se abre una sesi\xf3n de usuario web, puede manejarla a trav\xe9s del objeto ",(0,i.jsx)(s.code,{children:"Session"})," y la ",(0,i.jsx)(s.a,{href:"/docs/es/API/SessionClass",children:"Session API"}),". Las siguientes peticiones REST reutilizan la misma cookie de sesi\xf3n."]}),"\n",(0,i.jsx)(s.p,{children:"Una sesi\xf3n se abre despu\xe9s de que el usuario haya iniciado sesi\xf3n correctamente (ver m\xe1s abajo)."}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["En 4D Server, para abrir una sesi\xf3n REST es necesario disponer de una licencia gratuita cliente 4D.",(0,i.jsx)(s.br,{})]}),"\n",(0,i.jsx)(s.li,{children:"En 4D monopuesto, puede abrir hasta tres sesiones REST para realizar pruebas."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"forzar-el-modo-de-inicio-de-sesi\xf3n",children:"Forzar el modo de inicio de sesi\xf3n"}),"\n",(0,i.jsx)(s.admonition,{title:"Compatibilidad",type:"note",children:(0,i.jsxs)(s.p,{children:["El modo de inicio de sesi\xf3n heredado basado en el m\xe9todo base ",(0,i.jsx)(s.code,{children:"On REST Authentication"})," est\xe1 ",(0,i.jsx)(s.strong,{children:"obsoleto"})," a partir de 4D 20 R6. It is now recommended to ",(0,i.jsxs)(s.a,{href:"/docs/es/ORDA/privileges#rolesjson-file",children:["use the ",(0,i.jsx)(s.strong,{children:"force login mode"})]})," (automatically enabled in new projects) and to implement the ",(0,i.jsxs)(s.a,{href:"#dsauthentify",children:[(0,i.jsx)(s.code,{children:"ds.authentify()"})," function"]}),". In converted projects, ",(0,i.jsx)(s.a,{href:"/docs/es/settings/web#activate-rest-authentication-through-dsauthentify-function",children:"a button in the Settings dialog box"})," will help you upgrade your configuration. En Qodly Studio for 4D, el modo se puede definir utilizando la opci\xf3n ",(0,i.jsx)(s.a,{href:"/docs/es/WebServer/qodly-studio#force-login",children:(0,i.jsx)(s.strong,{children:"Forzar inicio de sesi\xf3n"})})," en el panel de Privilegios."]})}),"\n",(0,i.jsx)(s.p,{children:"La secuencia de inicio de sesi\xf3n del usuario es la siguiente:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:['En la primera llamada REST (para una llamada webform, por ejemplo), se crea una sesi\xf3n de usuario web "invitado". No tiene privilegios, no tiene derechos para ejecutar solicitudes que no sean ',(0,i.jsx)(s.a,{href:"#descriptive-rest-requests",children:"peticiones REST descriptivas"}),", no tiene consumo de licencia.",(0,i.jsx)(s.br,{}),'\nLas solicitudes REST descriptivas siempre son procesadas por el servidor, aunque no se abra ninguna sesi\xf3n de usuario web que utilice una licencia. En este caso, son procesados a trav\xe9s de sesiones "invitado".']}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["You call your ",(0,i.jsxs)(s.a,{href:"#authentify",children:[(0,i.jsx)(s.code,{children:"authentify()"})," function"]})," (created beforehand), in which you check the user credentials and call ",(0,i.jsx)(s.a,{href:"/docs/es/API/SessionClass#setprivileges",children:(0,i.jsx)(s.code,{children:"Session.setPrivileges()"})})," with appropriate privileges. ",(0,i.jsx)(s.code,{children:"authentify()"})," must be an exposed ",(0,i.jsx)(s.a,{href:"/docs/es/ORDA/ordaClasses#datastore-class",children:"datastore class function"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["La petici\xf3n ",(0,i.jsx)(s.code,{children:"/rest/$catalog/authentify"})," se env\xeda al servidor junto con las credenciales del usuario. Este paso s\xf3lo requiere un formulario de inicio de sesi\xf3n b\xe1sico que no tenga acceso a datos; puede ser un [formulario Qodly](. /WebServer/qodly-studio.md) (llamado a trav\xe9s de la solicitud ",(0,i.jsx)(s.code,{children:"/rest/$getWebForm"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Si el usuario se autentica correctamente, se consume una licencia 4D en el servidor y se aceptan todas las peticiones REST."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"alt-text",src:n(877426).A+"",width:"1344",height:"756"})}),"\n",(0,i.jsxs)(s.p,{children:["En la fase de inicio de sesi\xf3n del usuario, el uso de la licencia est\xe1 desconectado de las sesiones de usuario web. S\xf3lo se requiere una licencia cuando se ejecuta el comando ",(0,i.jsx)(s.a,{href:"/docs/es/API/SessionClass#setprivileges",children:(0,i.jsx)(s.code,{children:"Session.setPrivileges()"})}),", lo que permite controlar el n\xfamero de licencias utilizadas."]}),"\n",(0,i.jsxs)(s.p,{children:["All other REST requests (handling data or executing a function) will only be processed if they are executed within a web session with appropriate privileges, otherwise they return an error. To assign privileges to a web session, you need to execute the ",(0,i.jsx)(s.a,{href:"/docs/es/API/SessionClass#setprivileges",children:(0,i.jsx)(s.code,{children:"Session.setPrivileges()"})})," function for the session. Ejecutar esta funci\xf3n activa el consumo de la licencia 4D."]}),"\n",(0,i.jsx)(s.h3,{id:"peticiones-rest-descriptivas",children:"Peticiones REST descriptivas"}),"\n",(0,i.jsx)(s.p,{children:'Las peticiones REST descriptivas pueden procesarse en sesiones de usuario web que no requieren licencias (sesiones "invitado"). Estas peticiones son:'}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/docs/es/REST/catalog",children:(0,i.jsx)(s.code,{children:"/rest/$catalog"})})," requests (e.g. ",(0,i.jsx)(s.code,{children:"/rest/$catalog/$all"}),") - access to available dataclasses"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"/rest/$catalog/authentify"})," - la funci\xf3n del almac\xe9n de datos utilizada para iniciar sesi\xf3n del usuario"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"/rest/$getWebForm"})," - la renderizaci\xf3n de un formulario Qodly"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"alt-text",src:n(318383).A+"",width:"1171",height:"302"})}),"\n",(0,i.jsx)(s.h2,{id:"function-authentify",children:(0,i.jsx)(s.code,{children:"Function authentify"})}),"\n",(0,i.jsx)(s.h3,{id:"sintaxis",children:"Sintaxis"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-4d",children:"exposed Function authentify({params : type}) {-> result : type}\n\t// c\xf3digo\n"})}),"\n",(0,i.jsxs)(s.p,{children:["La funci\xf3n ",(0,i.jsx)(s.code,{children:"authentify()"})," debe estar implementada en la ",(0,i.jsx)(s.a,{href:"/docs/es/ORDA/ordaClasses#datastore-class",children:"clase DataStore"})," del proyecto y debe ser llamada a trav\xe9s de una petici\xf3n REST."]}),"\n",(0,i.jsx)(s.p,{children:'This function is the only available entry point from REST guest sessions when the "force login" mode is enabled: any other function call or data access is rejected until the session acquires appropriate privileges.'}),"\n",(0,i.jsx)(s.admonition,{type:"note",children:(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"authentify()"})," function can always be executed by a REST guest session, whatever the ",(0,i.jsxs)(s.a,{href:"/docs/es/ORDA/privileges#rolesjson-file",children:[(0,i.jsx)(s.code,{children:"roles.json"})," file"]})," configuration."]})}),"\n",(0,i.jsxs)(s.p,{children:["La funci\xf3n puede recibir cualquier informaci\xf3n de autenticaci\xf3n o contextual como ",(0,i.jsx)(s.a,{href:"/docs/es/REST/classFunctions#parameters",children:"par\xe1metro(s)"})," y puede devolver cualquier valor. Dado que esta funci\xf3n s\xf3lo puede ser llamada desde una petici\xf3n REST, los par\xe1metros deben ser pasados a trav\xe9s del cuerpo de la petici\xf3n POST."]}),"\n",(0,i.jsx)(s.p,{children:"Esta funci\xf3n debe contener dos partes:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"alg\xfan c\xf3digo para identificar y autenticar al remitente de la petici\xf3n REST,"}),"\n",(0,i.jsxs)(s.li,{children:["si la autenticaci\xf3n tiene \xe9xito, una llamada a ",(0,i.jsx)(s.a,{href:"/docs/es/API/SessionClass#setprivileges",children:(0,i.jsx)(s.code,{children:"Session.setPrivileges()"})})," que asigna los privilegios apropiados a la sesi\xf3n."]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["If the function does not call ",(0,i.jsx)(s.a,{href:"/docs/es/API/SessionClass#setprivileges",children:(0,i.jsx)(s.code,{children:"Session.setPrivileges()"})}),", no privileges are assigned, no license is consumed and subsequent non-descriptive REST requests are rejected."]}),"\n",(0,i.jsx)(s.h3,{id:"ejemplo",children:"Ejemplo"}),"\n",(0,i.jsxs)(s.p,{children:["S\xf3lo quiere conocer a los usuarios para abrir una sesi\xf3n web en el servidor. Ha creado la siguiente funci\xf3n ",(0,i.jsx)(s.code,{children:"authentify()"})," en la clase datastore:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-4d",children:'exposed Function authentify($credentials : Object) : Text\n\nvar $users : cs.UsersSelection\nvar $user : cs.UsersEntity\n\n$users:=ds.Users.query("name = :1"; $credentials.name)\n$user:=$users.first()\n\nIf ($user#Null) //the user is known\n\tIf (Verify password hash($credentials.password; $user.password))\n\t\tSession.setPrivileges("vip")\n\tElse\n\n\t\treturn "Wrong password"\n\tEnd if\nElse\n        return "Wrong user"\nEnd if\n'})}),"\n",(0,i.jsxs)(s.p,{children:["Para llamar a la funci\xf3n ",(0,i.jsx)(s.code,{children:"authentify()"}),":"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"POST"})," ",(0,i.jsx)(s.code,{children:"127.0.0.1:8111/rest/$catalog/authentify"})]}),"\n",(0,i.jsx)(s.p,{children:"Cuerpo de la petici\xf3n:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-json",children:'[{"name":"Henry",\n"password":"123"}]\n'})})]})}function u(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},221020:(e,s,n)=>{var i=n(296540),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,t=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,s,n){var i,a={},l=null,d=null;for(i in void 0!==n&&(l=""+n),void 0!==s.key&&(l=""+s.key),void 0!==s.ref&&(d=s.ref),s)o.call(s,i)&&!c.hasOwnProperty(i)&&(a[i]=s[i]);if(e&&e.defaultProps)for(i in s=e.defaultProps)void 0===a[i]&&(a[i]=s[i]);return{$$typeof:r,type:e,key:l,ref:d,props:a,_owner:t.current}}s.Fragment=a,s.jsx=l,s.jsxs=l},474848:(e,s,n)=>{e.exports=n(221020)},318383:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/force-login-1-f9e377d9d1294c166d2e316a30d4eef4.jpeg"},877426:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/force-login-2-c615d4581880aa201c1e7abd591f6146.jpeg"},28453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>t});var i=n(296540);const r={},a=i.createContext(r);function o(e){const s=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(a.Provider,{value:s},e.children)}}}]);