"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["59390"],{507362:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>t,toc:()=>o,default:()=>u,metadata:()=>r,assets:()=>i,contentTitle:()=>d});var r=JSON.parse('{"id":"WebServer/http-rules","title":"Reglas HTTP","description":"Puede definir reglas HTTP para controlar los encabezados de respuesta HTTP para toda petici\xf3n recibida por el servidor web 4D, incluyendo las peticiones REST. Puede a\xf1adir, modificar o eliminar los encabezados HTTP, enviar redirecciones o establecer el estado HTTP. Esta funcionalidad es \xfatil para implementar pol\xedticas de seguridad basadas en el manejo de encabezados.","source":"@site/i18n/es/docusaurus-plugin-content-docs/version-21/WebServer/http-rules.md","sourceDirName":"WebServer","slug":"/WebServer/http-rules","permalink":"/docs/es/WebServer/http-rules","draft":false,"unlisted":false,"editUrl":"https://github.com/4d/docs/issues/new?title=Comment%20on%20WebServer%2Fhttp-rules.md%20(21)&body=Please%20enter%20your%20comment%3A","tags":[],"version":"21","frontMatter":{"id":"http-rules","title":"Reglas HTTP"},"sidebar":"docs","previous":{"title":"HTTP Request handler","permalink":"/docs/es/WebServer/http-request-handler"},"next":{"title":"Permitir m\xe9todos proyecto","permalink":"/docs/es/WebServer/allowProject"}}'),a=s(474848),l=s(884429);let t={id:"http-rules",title:"Reglas HTTP"},d,i={},o=[{value:"Requisitos",id:"requisitos",level:2},{value:"C\xf3mo definir reglas",id:"c\xf3mo-definir-reglas",level:2},{value:"Definici\xf3n de reglas",id:"definici\xf3n-de-reglas",level:2},{value:"Patrones de la URL",id:"patrones-de-la-url",level:3},{value:"Acciones",id:"acciones",level:3},{value:"Encabezados no modificables",id:"encabezados-no-modificables",level:3},{value:"Reglas actuales",id:"reglas-actuales",level:3},{value:"Ejemplos",id:"ejemplos",level:2},{value:"Utilizaci\xf3n de un archivo HTTPRules.json",id:"utilizaci\xf3n-de-un-archivo-httprulesjson",level:3},{value:"Using a <em>settings</em> parameter",id:"using-a-settings-parameter",level:3}];function c(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"Puede definir reglas HTTP para controlar los encabezados de respuesta HTTP para toda petici\xf3n recibida por el servidor web 4D, incluyendo las peticiones REST. Puede a\xf1adir, modificar o eliminar los encabezados HTTP, enviar redirecciones o establecer el estado HTTP. Esta funcionalidad es \xfatil para implementar pol\xedticas de seguridad basadas en el manejo de encabezados."}),"\n",(0,a.jsxs)(n.p,{children:["Para definir reglas HTTP, s\xf3lo tiene que escribir RegEx para declarar los patrones de URL que quiere controlar as\xed como c\xf3mo modificar los encabezados de respuesta. You can set these rules using a ",(0,a.jsx)(n.code,{children:"HTTPRules.json"})," file stored in the project folder, or using the ",(0,a.jsx)(n.em,{children:"settings"})," parameter ",(0,a.jsx)(n.a,{href:"/docs/es/API/WebServerClass#start",children:(0,a.jsx)(n.code,{children:"start()"})})," function of the web server object."]}),"\n",(0,a.jsx)(n.h2,{id:"requisitos",children:"Requisitos"}),"\n",(0,a.jsx)(n.p,{children:"Las reglas HTTP se soportan en los siguientes contextos:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["las ",(0,a.jsx)(n.a,{href:"/docs/es/WebServer/sessions#enabling-web-sessions",children:"sesiones escalables"})," o ",(0,a.jsx)(n.a,{href:"/docs/es/settings/web#no-sessions",children:"sin sesiones"})," est\xe1n activadas,"]}),"\n",(0,a.jsxs)(n.li,{children:["un servidor web ejecutado localmente por 4D o 4D Server, incluyendo aquellos ",(0,a.jsx)(n.a,{href:"/docs/es/WebServer/webServerObject",children:"ejecutados por componentes"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"c\xf3mo-definir-reglas",children:"C\xf3mo definir reglas"}),"\n",(0,a.jsx)(n.p,{children:"Puede declarar las reglas de respuesta HTTP:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["en un archivo de configuraci\xf3n llamado ",(0,a.jsx)(n.strong,{children:"HTTPRules.json"})," almacenado en la carpeta ",(0,a.jsx)(n.a,{href:"/docs/es/Project/architecture#sources",children:(0,a.jsx)(n.code,{children:"Project/Sources"})})," del proyecto. Las reglas se cargan y se aplican en el servidor web principal una vez que se inicia."]}),"\n",(0,a.jsxs)(n.li,{children:["utilizando una propiedad ",(0,a.jsx)(n.a,{href:"/docs/es/API/WebServerClass#rules",children:(0,a.jsx)(n.code,{children:".rules"})})," definida en el par\xe1metro ",(0,a.jsx)(n.em,{children:"settings"})," de la funci\xf3n ",(0,a.jsx)(n.a,{href:"/docs/es/API/WebServerClass#start",children:(0,a.jsx)(n.code,{children:"start()"})}),", para todo objeto servidor web:"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-4d",children:"WEB Server.start($settings.rules) //definir reglas al inicio del servidor web\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Si se utiliza tanto un archivo ",(0,a.jsx)(n.strong,{children:"HTTPRules.json"})," como una llamada al comando ",(0,a.jsx)(n.a,{href:"/docs/es/commands/web-server",children:(0,a.jsx)(n.code,{children:"WEB Server"})})," con un ",(0,a.jsx)(n.code,{children:"$settings.rules"})," v\xe1lido, el comando ",(0,a.jsx)(n.code,{children:"WEB Server"})," tiene prioridad."]}),"\n",(0,a.jsx)(n.p,{children:"Si la URI de la petici\xf3n no coincide con ninguno de los patrones de RegEx, el servidor web devuelve una respuesta por defecto."}),"\n",(0,a.jsx)(n.h2,{id:"definici\xf3n-de-reglas",children:"Definici\xf3n de reglas"}),"\n",(0,a.jsxs)(n.p,{children:["El archivo ",(0,a.jsx)(n.strong,{children:"HTTPRules.json"})," o la propiedad ",(0,a.jsx)(n.a,{href:"/docs/es/API/WebServerClass#rules",children:(0,a.jsx)(n.code,{children:".rules"})})," deben contener una colecci\xf3n de ",(0,a.jsx)(n.strong,{children:"objetos regla"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Un objeto regla se define por:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:'un RegEx que describe un patr\xf3n de URL, por ejemplo, "^(.*\\.(jpg|jpeg|png|gif))"'}),"\n",(0,a.jsx)(n.li,{children:'el nombre de la acci\xf3n a ejecutar para la respuesta HTTP, por ejemplo, "removeHeaders"'}),"\n",(0,a.jsx)(n.li,{children:'el valor de la acci\xf3n, por ejemplo, "X-Unwanted-Header1"'}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Las dem\xe1s propiedades se ignoran."}),"\n",(0,a.jsx)(n.h3,{id:"patrones-de-la-url",children:"Patrones de la URL"}),"\n",(0,a.jsxs)(n.p,{children:["Los patrones de URL se dan usando ",(0,a.jsx)(n.strong,{children:"expresiones regulares"}),'. Para declarar un patr\xf3n de expresi\xf3n regular, utilice el nombre de propiedad "RegExExpattern".']}),"\n",(0,a.jsxs)(n.p,{children:["Ej.: ",(0,a.jsx)(n.code,{children:'"RegExPattern": "/Test/Authorized/(.*)"'})]}),"\n",(0,a.jsxs)(n.p,{children:["Cuando el servidor web recibe una solicitud, ",(0,a.jsx)(n.strong,{children:"todos"})," los patrones de URL se activan secuencialmente en el orden dado y se ejecutan todos los patrones coincidentes. En caso de varias acciones que modifican recursos similares, se tiene en cuenta la \xfaltima acci\xf3n ejecutada."]}),"\n",(0,a.jsx)(n.h3,{id:"acciones",children:"Acciones"}),"\n",(0,a.jsx)(n.p,{children:"Se soportan las siguientes palabras clave de acci\xf3n:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Palabras clave"}),(0,a.jsx)(n.th,{children:"Tipo de valor"}),(0,a.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"removeHeaders"})}),(0,a.jsx)(n.td,{children:"Texto o colecci\xf3n de textos"}),(0,a.jsx)(n.td,{children:"Encabezado(s) para eliminar de las respuestas HTTP. Si un encabezado a eliminar no existe en el encabezado de respuesta, se ignora."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"addHeaders"})}),(0,a.jsx)(n.td,{children:"Object"}),(0,a.jsx)(n.td,{children:"Name (text) and value (text) of header(s) to add to the HTTP responses."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"setHeaders"})}),(0,a.jsx)(n.td,{children:"Object"}),(0,a.jsx)(n.td,{children:"Name (text) and value (text) of header(s) to modify in the HTTP responses. Si un encabezado a modificar no existe en el encabezado de respuesta, se a\xf1ade."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"denyAccess"})}),(0,a.jsx)(n.td,{children:"Boolean"}),(0,a.jsx)(n.td,{children:"true para negar el acceso al recurso, false para permitir el acceso. When the access to a resource is denied, the web server returns a 403 status by default"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"redirect"})}),(0,a.jsx)(n.td,{children:"Text"}),(0,a.jsx)(n.td,{children:"Redirigir URL. Cuando se activa una redirecci\xf3n, el servidor web devuelve un estado 302 por defecto"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"status"})}),(0,a.jsx)(n.td,{children:"Number"}),(0,a.jsx)(n.td,{children:"Estado HTTP"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"encabezados-no-modificables",children:"Encabezados no modificables"}),"\n",(0,a.jsx)(n.p,{children:"Algunos encabezados no pudieron ser a\xf1adidos, modificados o eliminados:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Encabezado"}),(0,a.jsx)(n.th,{children:"Acci\xf3n de a\xf1adir"}),(0,a.jsx)(n.th,{children:"Set"}),(0,a.jsx)(n.th,{children:"Remove"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Fecha"}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsx)(n.td,{children:"No"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Content-Length"}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsx)(n.td,{children:"No"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Content-Encoding"}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsx)(n.td,{children:"No"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Vary"}),(0,a.jsx)(n.td,{children:"S\xed"}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsx)(n.td,{children:"No"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Set-Cookie"}),(0,a.jsx)(n.td,{children:"S\xed"}),(0,a.jsx)(n.td,{children:"A\xf1adir cookie"}),(0,a.jsx)(n.td,{children:"No"})]})]})]}),"\n",(0,a.jsx)(n.p,{children:"Unauthorized changes on these headers do not generate errors, however modifications will be ignored."}),"\n",(0,a.jsx)(n.h3,{id:"reglas-actuales",children:"Reglas actuales"}),"\n",(0,a.jsxs)(n.p,{children:["Puede conocer las reglas actuales utilizando la propiedad ",(0,a.jsxs)(n.a,{href:"/docs/es/API/WebServerClass#rules",children:[(0,a.jsx)(n.code,{children:".rules"})," del objeto Web Server"]}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"var $rules : Collection\n$rules:=WEB Server.rules //reglas actuales\n"})}),"\n",(0,a.jsx)(n.h2,{id:"ejemplos",children:"Ejemplos"}),"\n",(0,a.jsxs)(n.p,{children:["Rules can be set using a ",(0,a.jsx)(n.code,{children:"HTTPRules.json"})," file or the ",(0,a.jsx)(n.em,{children:"settings"})," parameter of the ",(0,a.jsx)(n.a,{href:"/docs/es/API/WebServerClass#start",children:(0,a.jsx)(n.code,{children:".start()"})})," web server function."]}),"\n",(0,a.jsx)(n.h3,{id:"utilizaci\xf3n-de-un-archivo-httprulesjson",children:"Utilizaci\xf3n de un archivo HTTPRules.json"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'\n[\n	{\n		"comment": "All requests: allow GET method for, remove \'Server\' header and set security headers",\n		"regexPattern": "/(.*)",\n		"setHeaders": {\n			"Allow": "GET",\n			"X-Frame-Options": "SAMEORIGIN",\n			"Content-Security-Policy": "default-src \'self\'"\n		},\n		"removeHeaders": [\n			"Server"\n		]\n	},\n	{\n		"comment": "REST requests: allow POST method",\n		"regexPattern": "/rest/(.*)",\n		"addHeaders": {\n			"Allow": "POST"\n		}\n	},\n	{\n		"comment": "HTML files in \'doc\' folder: set cache control",\n		"regexPattern": "/docs/(.*).html",\n		"setHeaders": {\n			"Cache-Control": "max-age=3600"\n		},\n		"removeHeaders": [\n			"X-Powered-By"\n		]\n	},\n	{\n		"comment": "Status 503 on \'maintenance\' page",\n		"regexPattern": "^/maintenance.html",\n		"status": 503\n	},\n	{\n		"comment": "Redirect CSS and JS files",\n		"regexPattern": "^(.*\\\\\\\\.(css|js))",\n		"redirect": "https://cdn.example.com/"\n	},\n	{\n		"comment": "Redirect images with permanent status code",\n		"regexPattern": "^(.*\\\\\\\\.(jpg|jpeg|png|gif))",\n		"redirect": "https://cdn.example.com/images/",\n		"status": 301\n	},\n	{\n		"comment": "Deny access for all resources placed in the \'private\' folder",\n		"regexPattern": "/private/(.*)",\n		"denyAccess": true\n	},\n	{\n		"comment": "Allow access to all resources placed in the \'private/allowed\' folder",\n		"regexPattern": "/private/allowed/(.*)",\n		"denyAccess": false\n	}\n]\n\n'})}),"\n",(0,a.jsxs)(n.h3,{id:"using-a-settings-parameter",children:["Using a ",(0,a.jsx)(n.em,{children:"settings"})," parameter"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-4d",children:'var $rule:={}\n\nvar $settings:={}\n\n$settings.rules:=[]\n\n$rule:={}\n$rule.comment:="All requests: allow GET method for, remove \'Server\' header and set security headers"\n$rule.regexPattern:="/(.*)"\n$rule.setHeaders:={Allow: "GET"}\n$rule.setHeaders["X-Frame-Options"]:="SAMEORIGIN"\n$rule.setHeaders["Content-Security-Policy"]:="default-src \'self\'"\n$rule.removeHeaders:=["Server"]\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="REST requests: allow POST method"\n$rule.regexPattern:="/rest/(.*)"\n$rule.addHeaders:={Allow: "POST"}\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="HTML files in \'doc\' folder: set cache control"\n$rule.regexPattern:="/docs/(.*).html"\n$rule.setHeaders:={}\n$rule.setHeaders["Cache-Control"]:="max-age=3600"\n$rule.removeHeaders:=["X-Powered-By"]\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Status 503 on \'maintenance\' page"\n$rule.regexPattern:="^/maintenance.html"\n$rule.status:=503\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Redirect CSS and JS files"\n$rule.regexPattern:="^(.*\\\\\\\\.(css|js))"\n$rule.redirect:="https://cdn.example.com/"\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Redirect images with permanent status code"\n$rule.regexPattern:="^(.*\\\\\\\\.(jpg|jpeg|png|gif))"\n$rule.redirect:="https://cdn.example.com/images/"\n$rule.status:=301\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Deny access for all resources placed in the \'private\' folder"\n$rule.regexPattern:="/private/(.*)"\n$rule.denyAccess:=True\n$settings.rules.push($rule)\n\n$rule:={}\n$rule.comment:="Allow access to all resources placed in the \'private/allowed\' folder"\n$rule.regexPattern:="/private/allowed/(.*)"\n$rule.denyAccess:=False\n$settings.rules.push($rule)\n\n$return:=WEB Server.start($settings)\n\n'})}),"\n",(0,a.jsx)(n.admonition,{title:"Entrada de blog relacionada",type:"tip",children:(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://blog.4d.com/new-way-to-control-your-http-responses/",children:"Nueva forma de controlar sus respuestas HTTP"})})})]})}function u(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},884429:function(e,n,s){s.d(n,{R:()=>t,x:()=>d});var r=s(296540);let a={},l=r.createContext(a);function t(e){let n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);