<!doctype html><html lang=pt dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-20-R10 docs-doc-page docs-doc-id-Develop-legacy/transactions" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>Transações | 4D Docs</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://developer.4d.com/docs/pt/Develop-legacy/transactions><meta data-rh=true property=og:locale content=pt><meta data-rh=true property=og:locale:alternate content=en><meta data-rh=true property=og:locale:alternate content=fr><meta data-rh=true property=og:locale:alternate content=es><meta data-rh=true property=og:locale:alternate content=ja><meta data-rh=true name=docusaurus_locale content=pt><meta data-rh=true name=docsearch:language content=pt><meta data-rh=true name=docusaurus_version content=20-R10><meta data-rh=true name=docusaurus_tag content=docs-default-20-R10><meta data-rh=true name=docsearch:version content=20-R10><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-20-R10><meta data-rh=true property=og:title content="Transações | 4D Docs"><meta data-rh=true name=description content=Descrição><meta data-rh=true property=og:description content=Descrição><link data-rh=true rel=icon href=/docs/pt/img/favicon/4d.gif><link data-rh=true rel=canonical href=https://developer.4d.com/docs/pt/Develop-legacy/transactions><link data-rh=true rel=alternate href=https://developer.4d.com/docs/Develop-legacy/transactions hreflang=en><link data-rh=true rel=alternate href=https://developer.4d.com/docs/fr/Develop-legacy/transactions hreflang=fr><link data-rh=true rel=alternate href=https://developer.4d.com/docs/es/Develop-legacy/transactions hreflang=es><link data-rh=true rel=alternate href=https://developer.4d.com/docs/ja/Develop-legacy/transactions hreflang=ja><link data-rh=true rel=alternate href=https://developer.4d.com/docs/pt/Develop-legacy/transactions hreflang=pt><link data-rh=true rel=alternate href=https://developer.4d.com/docs/Develop-legacy/transactions hreflang=x-default><link data-rh=true rel=preconnect href=https://OJ04C0M3CU-dsn.algolia.net crossorigin><link rel=search type=application/opensearchdescription+xml title="4D Docs" href=/docs/pt/opensearch.xml><link rel=stylesheet href=/docs/pt/assets/css/styles.1ba35a04.css><script src=/docs/pt/assets/js/main.f7c0f1d7.js defer></script><script src=/docs/pt/assets/js/runtime~main.e06aa9c3.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Saltar para o conteúdo principal"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Saltar para o conteúdo principal</a></div><nav aria-label=Main class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class=navbar__inner><div class=navbar__items><button aria-label="Alternar barra de navegação" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/docs/pt/><div class=navbar__logo><img src=/docs/pt/img/logohome.png alt="Logotipo 4D" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/docs/pt/img/logohome.png alt="Logotipo 4D" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Documentação 4D</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current=page class="navbar__link active" aria-haspopup=true aria-expanded=false role=button href=/docs/pt/Develop-legacy/transactions>20 R10 BETA</a><ul class=dropdown__menu><li><a aria-current=page class="dropdown__link dropdown__link--active" href=/docs/pt/Develop-legacy/transactions>20 R10 BETA</a><li><a class=dropdown__link href=/docs/pt/20-R9/GettingStarted/installation>20 R9</a><li><a class=dropdown__link href=/docs/pt/20/GettingStarted/installation>20</a><li><a class=dropdown__link href=/docs/pt/19/GettingStarted/installation>19</a><li><a class=dropdown__link href=/docs/pt/18/GettingStarted/installation>18</a></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_nlXk><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>Português</a><ul class=dropdown__menu><li><a href=/docs/Develop-legacy/transactions rel="noopener noreferrer" class=dropdown__link lang=en>English</a><li><a href=/docs/fr/Develop-legacy/transactions rel="noopener noreferrer" class=dropdown__link lang=fr>Français</a><li><a href=/docs/es/Develop-legacy/transactions rel="noopener noreferrer" class=dropdown__link lang=es>Español</a><li><a href=/docs/ja/Develop-legacy/transactions rel="noopener noreferrer" class=dropdown__link lang=ja>日本語</a><li><a href=/docs/pt/Develop-legacy/transactions rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=pt>Português</a></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="Alternar entre os modos escuro e claro (atualmente modo Claro)" aria-label="Alternar entre os modos escuro e claro (atualmente modo Claro)" aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_pyhR><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_wfgR><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Pesquisa (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Pesquisa</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Voltar ao topo" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex=-1 class=sidebarLogo_isFc href=/docs/pt/><img src=/docs/pt/img/logohome.png alt="Logotipo 4D" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/docs/pt/img/logohome.png alt="Logotipo 4D" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b>Documentação 4D</b></a><nav aria-label="Barra lateral de documentos" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/pt/category/getting-started>Começando</a><button aria-label="Expandir a categoria 'Começando' da barra lateral" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/docs/pt/category/core-development>Desenvolvimento</a><button aria-label="Fechar categoria da barra lateral 'Desenvolvimento'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/pt/Project/overview>Gestão de projectos</a><button aria-label="Expandir a categoria 'Gestão de projectos' da barra lateral" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/pt/Project/code-overview>Ambiente de desenvolvimento</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/pt/ORDA/overview>ORDA</a><button aria-label="Expandir a categoria 'ORDA' da barra lateral" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/pt/Develop/processes>Processos</a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/docs/pt/Develop-legacy/transactions>Transações</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/pt/Tags/transformation-tags>Etiquetas de transformação</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/pt/category/4d-language>Línguagem 4D</a><button aria-label="Expandir a categoria 'Línguagem 4D' da barra lateral" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/pt/category/administration>Administração</a><button aria-label="Expandir a categoria 'Administração' da barra lateral" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/pt/Extensions/overview>Extensões</a><button aria-label="Expandir a categoria 'Extensões' da barra lateral" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/pt/category/web-applications>Aplicações Web</a><button aria-label="Expandir a categoria 'Aplicações Web' da barra lateral" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/pt/category/desktop-applications>Aplicações Desktop</a><button aria-label="Expandir a categoria 'Aplicações Desktop' da barra lateral" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a href=https://developer.4d.com/go-mobile/ target=_blank rel="noopener noreferrer" class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false>Aplicações móveis</a></div></ul></nav><button type=button title="Recolher a barra lateral" aria-label="Recolher a barra lateral" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_kv0_><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Trilha de navegação"><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Página inicial" class=breadcrumbs__link href=/docs/pt/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/docs/pt/category/core-development><span itemprop=name>Desenvolvimento</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Transações</span><meta itemprop=position content=2></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Versão: 20 R10 BETA</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">Nesta página</button></div><div class="theme-doc-markdown markdown"><header><h1>Transações</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=descrição>Descrição<a href=#descrição class=hash-link aria-label="Link direto para o cabeçalho" title="Link direto para o cabeçalho">​</a></h2>
<p>As transações são uma série de modificações de dados relacionadas que são realizadas em um banco de dados ou armazenamento de dados dentro de um <a href=/docs/pt/Develop-legacy/processes.md>process</a>. Uma transação não é salva em um banco de dados permanentemente até que a transação seja validada. Se uma transação não for concluída, seja porque é cancelada ou por algum evento externo, as modificações não são salvas.</p>
<p>Durante uma transação, todas as alterações feitas nos dados do banco de dados dentro de um processo são armazenadas localmente em um buffer temporário. Se a transação for aceita com <a href=/docs/pt/commands/validate-transaction><code>VALIDATE TRANSACTION</code></a> ou <a href=/docs/pt/API/DataStoreClass#validatetransaction><code>validateTransaction()</code></a>, as alterações são salvas permanentemente. Se a transação for cancelada com <a href=/docs/pt/commands/cancel-transaction><code>CANCEL TRANSACTION</code></a> ou <a href=/docs/pt/API/DataStoreClass#canceltransaction><code>cancelTransaction()</code></a>, as alterações não são salvas. Em todos os casos, nem a seleção atual nem o registro atual são modificados pelos comandos de gerenciamento de transações.</p>
<p>4D suporta transações aninhadas, ou seja, transações em vários níveis hierárquicos. O número de subtransações permitidas é ilimitado. O comando <a href=/docs/pt/commands/transaction-level><code>Transaction level</code></a> pode ser usado para descobrir o nível de transação atual em que o código está sendo executado. Quando transações aninhadas são usadas, o resultado de cada subtransação depende da validação ou cancelamento da transação de nível superior. Se a transação de nível superior for validada, os resultados das subtransações (validação ou cancelamento) são confirmados. Por outro lado, se a operação de nível superior for anulada, todas as suboperações são anuladas, independentemente de seus respectivos resultados.</p>
<p>4D inclui uma funcionalidade que permite <a href=#suspending-transactions>suspender e retomar transações</a> dentro do seu código 4D. Quando uma transação é suspensa, você pode executar operações independentemente da transação em si e, em seguida, retomar a transação para validá-la ou cancelá-la como de costume.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=exemplo>Exemplo<a href=#exemplo class=hash-link aria-label="Link direto para o cabeçalho" title="Link direto para o cabeçalho">​</a></h3>
<p>Neste exemplo, o banco de dados é um sistema de faturamento simples. As linhas de fatura são armazenadas em uma tabela chamada [Invoice Lines], que está relacionada à tabela [Invoices] por meio de um relacionamento entre os campos [Invoices]Invoice ID e [Invoice Lines]Invoice ID. Quando uma fatura é adicionada, um ID único é calculado, usando o comando <a href=/docs/pt/commands/sequence-number><code>Sequence number</code></a>. O relacionamento entre [Invoices] e [Invoice Lines] é um relacionamento automático Relate Many. A caixa de seleção <strong>Asignar automáticamente valor relacionado en subformulario</strong> está marcada.</p>
<p>O relacionamento entre [Invoice Lines] e [Parts] é manual.</p>
<p><img decoding=async loading=lazy src=/docs/pt/assets/images/transactions-structure-c214a6d4a24718af8586b4af126d02bd.png width=489 height=259 class=img_ev3q></p>
<p>Quando uma fatura é adicionada, um ID único é calculado, usando o comando
Quando um usuário insere uma fatura, as seguintes ações são executadas:</p>
<ul>
<li>Adicionar um registro na tabela [Invoices].</li>
<li>Adicionar vários registros na tabela [Invoice Lines].</li>
<li>Atualizar o campo [Parts]In Warehouse de cada peça listada na fatura.</li>
</ul>
<p>Este exemplo é uma situação típica em que você precisa usar uma transação. Você deve ter certeza de que poderá salvar todos esses registros durante a operação ou de que poderá cancelar a transação se um registro não puder ser adicionado ou atualizado. Em outras palavras, você deve salvar os dados relacionados. Se você não usar uma transação, não poderá garantir a integridade lógica dos dados do seu banco de dados. Por exemplo, se um dos registros de [Parts] estiver bloqueado, você não poderá atualizar a quantidade armazenada no campo [Parts]In Warehouse. Portanto, este campo será logicamente incorreto. A soma das peças vendidas e das peças restantes no armazém não será igual à quantidade original inserida no registro. Você pode evitar essa situação usando transações.</p>
<p>Existem várias maneiras de realizar a entrada de dados usando transações:</p>
<ol>
<li>Você pode gerenciar as transações você mesmo usando os comandos de transação <a href=/docs/pt/commands/start-transaction><code>START TRANSACTION</code></a>, <a href=/docs/pt/commands/validate-transaction><code>VALIDATE TRANSACTION</code></a> e <a href=/docs/pt/commands/cancel-transaction><code>CANCEL TRANSACTION</code></a>. Você pode escrever, por exemplo:</li>
</ol>
<div class="language-4d codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-4d codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"> READ WRITE([Invoice Lines])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> READ WRITE([Parts])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> FORM SET INPUT([Invoices];"Input")</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> Repeat</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    START TRANSACTION</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ADD RECORD([Invoices])</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    If(OK=1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       VALIDATE TRANSACTION</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    Else</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       CANCEL TRANSACTION</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    End if</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> Until(OK=0)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> READ ONLY(*)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copiar código para a área de transferência" title=Copiar class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=2>
<li>Para reduzir o bloqueio de registros enquanto a entrada de dados está sendo realizada, você também pode optar por gerenciar as transações a partir do método do formulário e acessar as tabelas em READ WRITE apenas quando necessário. A entrada de dados é realizada usando o formulário de entrada de [Invoices], que contém a tabela relacionada [Invoice Lines] em um subformulário. O formulário tem dois botões: bCancel e bOK, que não são botões de ação.</li>
</ol>
<p>O loop de adição se torna:</p>
<div class="language-4d codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-4d codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"> READ WRITE([Invoice Lines])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> READ ONLY([Parts])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> FORM SET INPUT([Invoices];"Input")</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> Repeat</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ADD RECORD([Invoices])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> Until(bOK=0)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> READ ONLY([Invoice Lines])</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copiar código para a área de transferência" title=Copiar class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=id-transactionstitle-transactions>id: transactions
title: Transactions<a href=#id-transactionstitle-transactions class=hash-link aria-label="Link direto para o cabeçalho" title="Link direto para o cabeçalho">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=description>Description<a href=#description class=hash-link aria-label="Link direto para o cabeçalho" title="Link direto para o cabeçalho">​</a></h2>
<p>As transações são uma série de modificações de dados relacionadas que são realizadas em um banco de dados ou armazenamento de dados dentro de um <a href=/docs/pt/Develop-legacy/processes.md>processo</a>. Uma transação não é salva em um banco de dados permanentemente até que a transação seja validada. Se uma transação não for concluída, seja porque é cancelada ou por algum evento externo, as modificações não são salvas.</p>
<p>Durante uma transação, todas as alterações feitas nos dados do banco de dados dentro de um processo são armazenadas localmente em um buffer temporário. Se a transação for aceita com <a href="https://www.google.com/search?q=../commands-legacy/validate-transaction.md" target=_blank rel="noopener noreferrer"><code>VALIDATE TRANSACTION</code></a> ou <a href=/docs/pt/API/DataStoreClass#validatetransaction><code>validateTransaction()</code></a>, as alterações são salvas permanentemente. Se a transação for cancelada com <a href=/docs/pt/commands/cancel-transaction><code>CANCEL TRANSACTION</code></a> ou <a href=/docs/pt/API/DataStoreClass#canceltransaction><code>cancelTransaction()</code></a>, as alterações não são salvas. Em todos os casos, nem a seleção atual nem o registro atual são modificados pelos comandos de gerenciamento de transações.</p>
<p>O 4D suporta transações aninhadas, ou seja, transações em vários níveis hierárquicos. O número de subtransações permitidas é ilimitado. O comando <a href="https://www.google.com/search?q=../commands-legacy/transaction-level.md" target=_blank rel="noopener noreferrer"><code>Transaction level</code></a> pode ser usado para descobrir o nível de transação atual em que o código está sendo executado. Quando transações aninhadas são usadas, o resultado de cada subtransação depende da validação ou cancelamento da transação de nível superior. Se a transação de nível superior for validada, os resultados das subtransações (validação ou cancelamento) são confirmados. Por outro lado, se a operação de nível superior for anulada, todas as suboperações são anuladas, independentemente de seus respectivos resultados.</p>
<p>O 4D inclui uma funcionalidade que permite <a href=#suspending-transactions>suspender e retomar transações</a> dentro do seu código 4D. Quando uma transação é suspensa, você pode executar operações independentemente da transação em si e, em seguida, retomar a transação para validá-la ou cancelá-la como de costume.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=example>Example<a href=#example class=hash-link aria-label="Link direto para o cabeçalho" title="Link direto para o cabeçalho">​</a></h3>
<p>Neste exemplo, o banco de dados é um sistema de faturamento simples. As linhas de fatura são armazenadas em uma tabela chamada [Invoice Lines], que está relacionada à tabela [Invoices] por meio de um relacionamento entre os campos [Invoices]Invoice ID e [Invoice Lines]Invoice ID. Quando uma fatura é adicionada, um ID único é calculado, usando o comando <a href=/docs/pt/commands/sequence-number><code>Sequence number</code></a>. O relacionamento entre [Invoices] e [Invoice Lines] é um relacionamento automático Relate Many. A caixa de seleção <strong>Asignar automáticamente valor relacionado en subformulario</strong> está marcada.</p>
<p>O relacionamento entre [Invoice Lines] e [Parts] é manual.</p>
<p><img decoding=async loading=lazy src=/docs/pt/assets/images/transactions-structure-c214a6d4a24718af8586b4af126d02bd.png width=489 height=259 class=img_ev3q></p>
<p>Quando um usuário insere uma fatura, as seguintes ações são executadas:</p>
<ul>
<li>Adicionar um registro na tabela [Invoices].</li>
<li>Adicionar vários registros na tabela [Invoice Lines].</li>
<li>Atualizar o campo [Parts]In Warehouse de cada peça listada na fatura.</li>
</ul>
<p>Este exemplo é uma situação típica em que você precisa usar uma transação. Você deve ter certeza de que poderá salvar todos esses registros durante a operação ou de que poderá cancelar a transação se um registro não puder ser adicionado ou atualizado. Em outras palavras, você deve salvar os dados relacionados. Se você não usar uma transação, não poderá garantir a integridade lógica dos dados do seu banco de dados. Por exemplo, se um dos registros de [Parts] estiver bloqueado, você não poderá atualizar a quantidade armazenada no campo [Parts]In Warehouse. Portanto, este campo será logicamente incorreto. A soma das peças vendidas e das peças restantes no armazém não será igual à quantidade original inserida no registro. Você pode evitar essa situação usando transações.</p>
<p>Existem várias maneiras de realizar a entrada de dados usando transações:</p>
<ol>
<li>Você pode gerenciar as transações você mesmo usando os comandos de transação <a href=/docs/pt/commands/start-transaction><code>START TRANSACTION</code></a>, <a href="https://www.google.com/search?q=../commands-legacy/validate-transaction.md" target=_blank rel="noopener noreferrer"><code>VALIDATE TRANSACTION</code></a> e <a href=/docs/pt/commands/cancel-transaction><code>CANCEL TRANSACTION</code></a>. Você pode escrever, por exemplo:</li>
</ol>
<div class="language-4d codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-4d codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"> READ WRITE([Invoice Lines])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> READ WRITE([Parts])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> FORM SET INPUT([Invoices];"Input")</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> Repeat</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    START TRANSACTION</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ADD RECORD([Invoices])</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    If(OK=1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       VALIDATE TRANSACTION</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    Else</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       CANCEL TRANSACTION</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    End if</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> Until(OK=0)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> READ ONLY(*)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Para reduzir o bloqueio de registros enquanto a entrada de dados está sendo realizada, você também pode optar por gerenciar as transações a partir do método do formulário e acessar as tabelas em READ WRITE apenas quando necessário. A entrada de dados é realizada usando o formulário de entrada de [Invoices], que contém a tabela relacionada [Invoice Lines] em um subformulário. O formulário tem dois botões: bCancel e bOK, que não são botões de ação.</span><br></span><span class=token-line style=color:#393A34><span class="token plain">O loop de adição se torna:</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">4D</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> READ WRITE([Invoice Lines])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> READ ONLY([Parts])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> FORM SET INPUT([Invoices];"Input")</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> Repeat</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ADD RECORD([Invoices])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> Until(bOK=0)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> READ ONLY([Invoice Lines])</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Observe que a tabela [Parts] agora está em modo de acesso somente leitura durante a entrada de dados. O acesso de leitura/gravação só estará disponível se a entrada de dados for validada.</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">A transação é iniciada no método do formulário de entrada [Invoices] indicado abaixo:</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">```4d</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> Case of</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    :(Form event code=On Load)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       START TRANSACTION</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       [Invoices]Invoice ID:=Sequence number([Invoices]Invoice ID)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    Else</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       [Invoices]Total Invoice:=Sum([Invoice Lines]Total line)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> End case</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copiar código para a área de transferência" title=Copiar class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>If you click the <em>bCancel</em> button, the data entry as well as the transaction must be canceled. Here is the object method of the <em>bCancel</em> button:</p>
<div class="language-4d codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-4d codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"> Case of</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    :(Form event code=On Clicked)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       CANCEL TRANSACTION</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       CANCEL</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> End case</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copiar código para a área de transferência" title=Copiar class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Se você clicar no botão <em>bOK</em>, tanto a entrada de dados quanto a transação serão canceladas. Este é o método objeto do botão <em>bOK</em>:</p>
<div class="language-4d codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-4d codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"> Case of</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    :(Form event code=On Clicked)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       var $NbLines:=Records in selection([Invoice Lines])</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       READ WRITE([Parts]) //Mudar para acesso de Leitura/Gravação para a tabela [Parts]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       FIRST RECORD([Invoice Lines]) //Começar na primeira linha</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       var $ValidTrans:=True //Assumir que tudo estará OK</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       var $Line : Integer</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       For($Line;1;$NbLines) //Para cada linha</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          RELATE ONE([Invoice Lines]Part No)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          OK:=1 //Assumir que você quer continuar</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          While(Locked([Parts]) & (OK=1)) //Tentar obter o registro em acesso de Leitura/Gravação</span><br></span><span class=token-line style=color:#393A34><span class="token plain">             CONFIRM("The Part "+[Invoice Lines]Part No+" is in use. Wait?")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">             If(OK=1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                DELAY PROCESS(Current process;60)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                LOAD RECORD([Parts])</span><br></span><span class=token-line style=color:#393A34><span class="token plain">             End if</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          End while</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          If(OK=1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">               //Atualizar a quantidade no armazém</span><br></span><span class=token-line style=color:#393A34><span class="token plain">             [Parts]In Warehouse:=[Parts]In Warehouse-[Invoice Lines]Quantity</span><br></span><span class=token-line style=color:#393A34><span class="token plain">             SAVE RECORD([Parts]) //Salvar o registro</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          Else</span><br></span><span class=token-line style=color:#393A34><span class="token plain">             $Line:=$NbLines+1 //Sair do loop</span><br></span><span class=token-line style=color:#393A34><span class="token plain">             $ValidTrans:=False</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          End if</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          NEXT RECORD([Invoice Lines]) //Ir para a próxima linha</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       End for</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       READ ONLY([Parts]) //Definir o estado da tabela como somente leitura</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       If($ValidTrans)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          SAVE RECORD([Invoices]) //Salvar o registro de Invoices</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          VALIDATE TRANSACTION //Validar todas as modificações do banco de dados</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       Else</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          CANCEL TRANSACTION //Cancelar tudo</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       End if</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       CANCEL //air do formulário</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> End case</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copiar código para a área de transferência" title=Copiar class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Neste código, chamamos o comando <code>CANCEL</code> independentemente do botão pressionado. O novo registro não é validado por uma chamada a <a href=/docs/pt/commands/accept><code>ACCEPT</code></a>, mas sim pelo comando <a href=/docs/pt/commands/save-record><code>SAVE RECORD</code></a> Além disso, observe que <code>SAVE RECORD</code> é executado imediatamente antes do comando <a href=/docs/pt/commands/validate-transaction><code>VALIDATE TRANSACTION</code></a>. Portanto, salvar o registro [Invoices] é, na verdade, parte da transação. O comando ACCEPT também validaria o registro, mas neste caso a transação seria validada antes de o registro [Invoices] ser salvo. Em outras palavras, o registro seria salvo fora da transação.</p>
<p>Dependendo de suas necessidades, você pode personalizar seu banco de dados, conforme mostrado nestes exemplos. No último exemplo, o gerenciamento de registros bloqueados na tabela [Parts] poderia ser ainda mais desenvolvido.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=suspensão-de-transações>Suspensão de transações<a href=#suspensão-de-transações class=hash-link aria-label="Link direto para o cabeçalho" title="Link direto para o cabeçalho">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=princípio>Princípio<a href=#princípio class=hash-link aria-label="Link direto para o cabeçalho" title="Link direto para o cabeçalho">​</a></h3>
<p>Suspender uma transação é útil quando você precisa realizar, de dentro de uma transação, certas operações que não precisam ser executadas sob o controle dessa transação. Por exemplo, imagine o caso em que um cliente faz um pedido, portanto dentro de uma transação, e também atualiza seu endereço. Em seguida, o cliente muda de ideia e cancela o pedido. A transação é cancelada, mas você não deseja que a alteração de endereço seja revertida. Este é um exemplo típico em que suspender a transação é útil. Três comandos são usados para suspender e retomar transações:</p>
<ul>
<li><a href=/docs/pt/commands/suspend-transaction><code>SUSPEND TRANSACTION</code></a>: pausa a transação atual. Os registros atualizados ou adicionados permanecem bloqueados.</li>
<li><a href=/docs/pt/commands/resume-transaction><code>RESUME TRANSACTION</code></a>: reativa uma transação suspensa.</li>
<li><a href=/docs/pt/commands/active-transaction><code>Active transaction</code></a>: retorna False se a transação estiver suspensa ou se não houver transação em andamento, e True se tiver sido iniciada ou retomada.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=exemplo-1>Exemplo<a href=#exemplo-1 class=hash-link aria-label="Link direto para o cabeçalho" title="Link direto para o cabeçalho">​</a></h3>
<p>Este exemplo ilustra a necessidade de uma transação suspensa. Em um banco de dados Invoices, queremos obter um novo número de fatura durante uma transação. Este número é calculado e armazenado em uma tabela [Settings]. Em um ambiente multiusuário, acessos concorrentes devem ser protegidos; no entanto, devido à transação, a tabela [Settings] pode estar bloqueada por outro usuário, embora esses dados sejam independentes da transação principal. Neste caso, você pode suspender a transação ao acessar a tabela.</p>
<div class="language-4d codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-4d codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">  //Método padrão que cria uma fatura</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> START TRANSACTION</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> ...</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> CREATE RECORD([Invoices])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> //chamar o método para obter um número disponível</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> [Invoices]InvoiceID:=GetInvoiceNum </span><br></span><span class=token-line style=color:#393A34><span class="token plain"> ...</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> SAVE RECORD([Invoices])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> VALIDATE TRANSACTION</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copiar código para a área de transferência" title=Copiar class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>O método <em>GetInvoiceNum</em> suspende a transação antes de ser executado. Observe que este código funcionará mesmo quando o método for chamado de fora de uma transação:</p>
<div class="language-4d codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-4d codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">  //Método projeto GetInvoiceNum</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  //GetInvoiceNum -> Próximo número de fatura disponível</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> #DECLARE -> $freeNum : Integer</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> SUSPEND TRANSACTION</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> ALL RECORDS([Settings])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> If(Locked([Settings])) //acesso multiusuário</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    While(Locked([Settings]))</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       MESSAGE("Waiting for locked Settings record")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       DELAY PROCESS(Current process;30)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">       LOAD RECORD([Settings])</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    End while</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> End if</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> [Settings]InvoiceNum:=[Settings]InvoiceNum+1</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> $freeNum:=[Settings]InvoiceNum</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> SAVE RECORD([Settings])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> UNLOAD RECORD([Settings])</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> RESUME TRANSACTION</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copiar código para a área de transferência" title=Copiar class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=operação-detalhada>Operação detalhada<a href=#operação-detalhada class=hash-link aria-label="Link direto para o cabeçalho" title="Link direto para o cabeçalho">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=como-funciona-uma-transação-suspensa>Como funciona uma transação suspensa?<a href=#como-funciona-uma-transação-suspensa class=hash-link aria-label="Link direto para o cabeçalho" title="Link direto para o cabeçalho">​</a></h4>
<p>Quando uma transação é suspensa, os seguintes princípios são aplicados:</p>
<ul>
<li>Você pode acessar os registros que foram adicionados ou modificados durante a transação e não pode ver os registros que foram excluídos durante a transação.</li>
<li>Você pode criar, salvar, excluir ou modificar registros fora da transação.</li>
<li>Você pode iniciar uma nova transação, mas dentro desta transação incluída, você não poderá ver nenhum registro ou valor de registro que tenha sido adicionado ou modificado durante a transação suspensa. De fato, esta nova transação é totalmente independente da suspensa, semelhante a uma transação de outro processo, e como a transação suspensa pode ser retomada ou cancelada posteriormente, qualquer registro adicionado ou modificado é automaticamente ocultado para a nova transação. Assim que a nova transação for retomada ou cancelada, esses registros poderão ser vistos novamente.</li>
<li>Os registros modificados, excluídos ou adicionados dentro da transação suspensa permanecem bloqueados para outros processos. Se uma tentativa for feita para modificar ou excluir esses registros fora da transação ou em uma nova transação, um erro é gerado.</li>
</ul>
<p>Essas implementações são resumidas no seguinte gráfico:</p>
<p><img decoding=async loading=lazy src=/docs/pt/assets/images/transactions-schema1-b8e1bad3d5f701207c70ba0375006274.png width=671 height=302 class=img_ev3q></p>
<p><em>Os valores editados durante a transação A (o registro ID1 obtém Val11) não estão disponíveis em uma nova transação (B) criada durante o período "suspenso". Os valores editados durante o período "suspenso" (o registro ID2 obtém Val22 e o registro ID3 obtém Val33) são salvos mesmo após o cancelamento da transação A.</em></p>
<p>Funcionalidades específicas foram adicionadas para gerenciar erros:</p>
<ul>
<li>O registro atual de cada tabela é temporariamente bloqueado se for modificado durante a transação e desbloqueado automaticamente quando a transação é retomada. Este mecanismo é importante para evitar salvamentos indesejados em partes da transação.</li>
<li>Se uma sequência inválida for executada, como iniciar transação / suspender transação / iniciar transação / retomar transação, um erro é gerado. Este mecanismo evita que os desenvolvedores esqueçam de confirmar ou cancelar qualquer transação incluída antes de retomar a transação suspensa.</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=transações-suspensas-e-estado-do-processo>Transações suspensas e estado do processo<a href=#transações-suspensas-e-estado-do-processo class=hash-link aria-label="Link direto para o cabeçalho" title="Link direto para o cabeçalho">​</a></h4>
<p>O comando <a href=/docs/pt/commands/in-transaction><code>In transaction</code></a> etorna True quando uma transação foi iniciada, mesmo que esteja suspensa. Para saber se a transação atual está suspensa, é necessário usar o comando <a href=/docs/pt/commands/active-transaction><code>Active transaction</code></a>, que retorna False neste caso.</p>
<p>Ambos os comandos, no entanto, também retornam False se nenhuma transação foi iniciada. Nesse caso, pode ser necessário usar o comando <a href=/docs/pt/commands/transaction-level><code>Transaction level</code></a>, que retorna 0 neste contexto (nenhuma transação foi iniciada).</p>
<p>O gráfico a seguir ilustra os diferentes contextos de transação e os valores correspondentes retornados pelos comandos de transação:</p>
<p><img decoding=async loading=lazy src=/docs/pt/assets/images/transactions-schema2-aafb10d686c45336a126b62e3cb113bd.png width=691 height=304 class=img_ev3q></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href="https://github.com/4d/docs/issues/new?title=Comment%20on%20Develop-legacy%2Ftransactions.md%20(20-R10)&body=Please%20enter%20your%20comment%3A" target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Comentar esta página</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Navegação nas páginas dos documentos"><a class="pagination-nav__link pagination-nav__link--prev" href=/docs/pt/Develop/preemptive-processes><div class=pagination-nav__sublabel>Anterior</div><div class=pagination-nav__label>Processos preemptivos</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs/pt/Tags/transformation-tags><div class=pagination-nav__sublabel>Próximo</div><div class=pagination-nav__label>Etiquetas de transformação</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#descrição class="table-of-contents__link toc-highlight">Descrição</a><ul><li><a href=#exemplo class="table-of-contents__link toc-highlight">Exemplo</a></ul><li><a href=#id-transactionstitle-transactions class="table-of-contents__link toc-highlight">id: transactions
title: Transactions</a><li><a href=#description class="table-of-contents__link toc-highlight">Description</a><ul><li><a href=#example class="table-of-contents__link toc-highlight">Example</a></ul><li><a href=#suspensão-de-transações class="table-of-contents__link toc-highlight">Suspensão de transações</a><ul><li><a href=#princípio class="table-of-contents__link toc-highlight">Princípio</a><li><a href=#exemplo-1 class="table-of-contents__link toc-highlight">Exemplo</a><li><a href=#operação-detalhada class="table-of-contents__link toc-highlight">Operação detalhada</a></ul></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class=footer__title>Comunidade</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://blog.4d.com target=_blank rel="noopener noreferrer" class=footer__link-item>4D Blog</a><li class=footer__item><a href=https://discuss.4d.com target=_blank rel="noopener noreferrer" class=footer__link-item>4D Forum</a><li class=footer__item><a href=https://facebook.com/4Dsoftware target=_blank rel="noopener noreferrer" class=footer__link-item>Facebook</a><li class=footer__item><a href=https://x.com/4Dsoftware target=_blank rel="noopener noreferrer" class=footer__link-item>X</a><li class=footer__item><a href=https://youtube.com/user/4Dsoftware target=_blank rel="noopener noreferrer" class=footer__link-item>Youtube</a><li class=footer__item><a href=https://github.com/4D target=_blank rel="noopener noreferrer" class=footer__link-item>Github</a></ul></div><div class="col footer__col"><div class=footer__title>Suporte</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://github.com/4d/docs/releases/tag/latest target=_blank rel="noopener noreferrer" class=footer__link-item>Documentation download<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://doc.4d.com target=_blank rel="noopener noreferrer" class=footer__link-item>4D Doc Center (Onde tudo começou)</a><li class=footer__item><a href=https://kb.4d.com target=_blank rel="noopener noreferrer" class=footer__link-item>Base de conhecimento</a><li class=footer__item><a href=https://us.4d.com/product-download/Feature-Release target=_blank rel="noopener noreferrer" class=footer__link-item>Baixares</a><li class=footer__item><a href=https://us.4d.com/resources target=_blank rel="noopener noreferrer" class=footer__link-item>Resources</a><li class=footer__item><a href=https://us.4d.com/4d-technical-support target=_blank rel="noopener noreferrer" class=footer__link-item>Obter suporte</a></ul></div><div class="col footer__col"><div class=footer__title>Empresa</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://us.4d.com/about-us target=_blank rel="noopener noreferrer" class=footer__link-item>Sobre 4D</a><li class=footer__item><a href=https://us.4d.com/contact-us target=_blank rel="noopener noreferrer" class=footer__link-item>Contactar-nos</a><li class=footer__item><a href=https://us.4d.com/4d-around-the-world target=_blank rel="noopener noreferrer" class=footer__link-item>4D no mundo</a><li class=footer__item><a href=https://us.4d.com/Careers target=_blank rel="noopener noreferrer" class=footer__link-item>Careers</a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>© 2025 4D SAS - Todos os direitos reservados</div></div></div></footer></div>