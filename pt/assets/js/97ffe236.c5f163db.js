"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["33128"],{610154:function(e,o,r){r.r(o),r.d(o,{default:()=>m,frontMatter:()=>a,metadata:()=>n,assets:()=>c,toc:()=>i,contentTitle:()=>t});var n=JSON.parse('{"id":"commands-legacy/on-err-call","title":"ON ERR CALL","description":"ON ERR CALL ( metodoErro {; escopo} )","source":"@site/i18n/pt/docusaurus-plugin-content-docs/version-20-R9/commands-legacy/on-err-call.md","sourceDirName":"commands-legacy","slug":"/commands/on-err-call","permalink":"/docs/pt/20-R9/commands/on-err-call","draft":false,"unlisted":false,"editUrl":"https://github.com/4d/docs/issues/new?title=Comment%20on%20commands-legacy%2Fon-err-call.md%20(20-R9)&body=Please%20enter%20your%20comment%3A","tags":[],"version":"20-R9","frontMatter":{"id":"on-err-call","title":"ON ERR CALL","slug":"/commands/on-err-call","displayed_sidebar":"docs"},"sidebar":"docs","previous":{"title":"Method called on event","permalink":"/docs/pt/20-R9/commands/method-called-on-event"},"next":{"title":"ON EVENT CALL","permalink":"/docs/pt/20-R9/commands/on-event-call"}}'),d=r("785893"),s=r("250065");let a={id:"on-err-call",title:"ON ERR CALL",slug:"/commands/on-err-call",displayed_sidebar:"docs"},t=void 0,c={},i=[{value:"Descri\xe7\xe3o",id:"descri\xe7\xe3o",level:2},{value:"Exemplo 1",id:"exemplo-1",level:2},{value:"Exemplo 2",id:"exemplo-2",level:2},{value:"Exemplo 3",id:"exemplo-3",level:2},{value:"Exemplo 4",id:"exemplo-4",level:2},{value:"Ver tamb\xe9m",id:"ver-tamb\xe9m",level:2},{value:"Propriedades",id:"propriedades",level:2}];function l(e){let o={a:"a",br:"br",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(o.p,{children:[(0,d.jsx)(o.strong,{children:"ON ERR CALL"})," ( ",(0,d.jsx)(o.em,{children:"metodoErro"})," {; ",(0,d.jsx)(o.em,{children:"escopo"}),"} )"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(o.table,{children:[(0,d.jsx)(o.thead,{children:(0,d.jsxs)(o.tr,{children:[(0,d.jsx)(o.th,{children:"Par\xe2metro"}),(0,d.jsx)(o.th,{children:"Tipo"}),(0,d.jsx)(o.th,{}),(0,d.jsx)(o.th,{children:"Descri\xe7\xe3o"})]})}),(0,d.jsxs)(o.tbody,{children:[(0,d.jsxs)(o.tr,{children:[(0,d.jsx)(o.td,{children:"metodoErro"}),(0,d.jsx)(o.td,{children:"Text"}),(0,d.jsx)(o.td,{children:"\u2192"}),(0,d.jsx)(o.td,{children:"M\xe9todo de erro a ser chamado, ou string Vazia para n\xe3o capturar erros"})]}),(0,d.jsxs)(o.tr,{children:[(0,d.jsx)(o.td,{children:"escopo"}),(0,d.jsx)(o.td,{children:"Integer"}),(0,d.jsx)(o.td,{children:"\u2192"}),(0,d.jsx)(o.td,{children:"Escopo do m\xe9todo de erro"})]})]})]}),"\n",(0,d.jsx)(o.h2,{id:"descri\xe7\xe3o",children:"Descri\xe7\xe3o"}),"\n",(0,d.jsxs)(o.p,{children:["O comando ",(0,d.jsx)(o.strong,{children:"ON ERR CALL"})," instala o m\xe9todo de projeto, cujo nome se passa em ",(0,d.jsx)(o.em,{children:"metodoErro"}),", como m\xe9todo de tratamento de ocorr\xeancias ou m\xe9todo de gest\xe3o de erros."]}),"\n",(0,d.jsx)(o.p,{children:"M\xe9todos de manejo de erro s\xe3o instalados por projeto: componentes e projetos host podem definri seus m\xe9todos de captura de erros, s\xf3 o m\xe9todo do projeto onde o erro ocorreu ser\xe1 chamado."}),"\n",(0,d.jsx)(o.p,{children:"Uma vez que se instala um projeto de controle de erros, 4D chama ao m\xe9todo cada vez que se produz um erro durante a execu\xe7\xe3o de um comando de linguagem 4D."}),"\n",(0,d.jsx)(o.p,{children:"O alcance deste comando determina o contexto de execu\xe7\xe3o onde um erro ativa a chamada do errorMethod. Como padr\xe3o, se o par\xe2metro escopo for omitido, o escopo do comando \xe9 o contexto da execu\xe7\xe3o local, ou seja, o processo atual. Pode passar uma das constantes abaixo no par\xe2metro escopo"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(o.table,{children:[(0,d.jsx)(o.thead,{children:(0,d.jsxs)(o.tr,{children:[(0,d.jsx)(o.th,{children:"Constante"}),(0,d.jsx)(o.th,{children:"Valor"})]})}),(0,d.jsxs)(o.tbody,{children:[(0,d.jsxs)(o.tr,{children:[(0,d.jsx)(o.td,{children:"ek errors from components"}),(0,d.jsx)(o.td,{children:"2"})]}),(0,d.jsxs)(o.tr,{children:[(0,d.jsx)(o.td,{children:"ek global"}),(0,d.jsx)(o.td,{children:"1"})]}),(0,d.jsxs)(o.tr,{children:[(0,d.jsx)(o.td,{children:"ek local"}),(0,d.jsx)(o.td,{children:"0"})]})]})]}),"\n",(0,d.jsxs)(o.ul,{children:["\n",(0,d.jsx)(o.li,{children:"se escope = ek local (ou se escopo for omitido), s\xf3 erros que aconteceram no processo atual v\xe3o chamar errorMethod. Pode ter um m\xe9todo de manejo de erro por processo por vez, mas pode ter v\xe1rios m\xe9todos de manejo de erro para v\xe1rios processos."}),"\n",(0,d.jsx)(o.li,{children:"se escopo = ek global, todos os erros que ocorreram na aplica\xe7\xe3o, qualquer que seja o processo, exceto componentes, vai chamar errorMethod. Note que se um manejo de erro ek local tamb\xe9m for definido para um processo, o manejo de erro n\xe3o \xe9 chamado ek global. Esse princ\xedpio permite definir um m\xe9todo de manejo de erros gen\xe9rico que vai pegar os erros, enquanto os m\xe9todos de erro locais podem ser estabelecidos para processos espec\xedficos"}),"\n",(0,d.jsx)(o.li,{children:"Note tamb\xe9m que um m\xe9todo de erros global \xe9 \xfatil no servidor, onde podde manejar erros em fun\xe7\xf5es do lado do servidor."}),"\n",(0,d.jsx)(o.li,{children:"se escopo = ek errors from components, s\xf3 erros gerados dos componentes instalados na aplica\xe7\xe3o v\xe3o chamar errorMethod. Note que, se um m\xe9todo de erros for definido em um componente, \xe9 chamado em caso de erro no componente e o ek errors from components conjunto de manejo de erro na aplica\xe7\xe3o host n\xe3o \xe9 chamado."}),"\n",(0,d.jsxs)(o.li,{children:["Note: se ON ERR CALL for chamado de um processo para o qual sua execu\xe7\xe3o preemptiva peticionada (em modo compilado), o compilador verifica se errorMethod \xe9 uma thread-segura e retorna erros se n\xe3o for compativa com o modo preemptivo. Para saber mais veja ",(0,d.jsx)(o.em,{children:"Processos 4D Preemptivos"})," ."]}),"\n",(0,d.jsx)(o.li,{children:"Para parar a captura de erros, chame ON ERR CALL de novo com o par\xe2metro de escopo desejado (se houver) e passe uma string vazia no errorMethod."}),"\n"]}),"\n",(0,d.jsxs)(o.p,{children:["Pode identificar erros lendo a vari\xe1vel sistema Error, a qual cont\xe9m o n\xfamero de c\xf3digo do erro. Os c\xf3digos de erros s\xe3o listados no tema ",(0,d.jsx)(o.em,{children:"C\xf3digos de Erro"}),". Para maior informa\xe7\xe3o, consulte a se\xe7\xe3o ",(0,d.jsx)(o.em,{children:"Erros de Sintaxe (1 -> 81)"}),". O valor da vari\xe1vel Error \xe9 significativo s\xf3 no m\xe9todo de gest\xe3o de erros; se necessitar o c\xf3digo do erro no m\xe9todo que provocou o erro, copie a vari\xe1vel Error em sua pr\xf3pria vari\xe1vel processo. Tamb\xe9m pode acessar as vari\xe1veis sistema Error method e Error line as quais cont\xe9m respectivamente, o nome do m\xe9todo e o n\xfamero de linha onde ocorreu o erro (ver ",(0,d.jsx)(o.em,{children:"Error, Error method, Error line"}),")."]}),"\n",(0,d.jsxs)(o.p,{children:["Pode usar o comando ",(0,d.jsx)(o.a,{href:"/docs/pt/20-R9/commands/last-errors",children:"Last errors"})," ou ",(0,d.jsx)(o.a,{href:"/docs/pt/20-R9/commands/last-errors",children:"Last errors"}),"  para obter a sequ\xeancia de errors (ou seja a pilha de erros) na fonte da interrup\xe7\xe3oo."]}),"\n",(0,d.jsx)(o.p,{children:"O m\xe9todo de gest\xe3o de erros deve tratar os erros de maneira apropriada ou mostrar uma mensagem de erro ao usu\xe1rio. Os erros podem ser gerados por:"}),"\n",(0,d.jsxs)(o.ul,{children:["\n",(0,d.jsx)(o.li,{children:"O motor de banco de dados de 4D; por exemplo, quando guarda um registro trata de duplicar uma chave de \xedndice \xfanico."}),"\n",(0,d.jsx)(o.li,{children:"O ambiente de 4D; por exemplo, quando n\xe3o tem suficiente memoria para encher um array."}),"\n",(0,d.jsx)(o.li,{children:"O sistema operativo no qual \xe9 executado o banco; por exemplo, disco cheio ou erros de entrada/sa\xedda."}),"\n"]}),"\n",(0,d.jsxs)(o.p,{children:["O comando ",(0,d.jsx)(o.a,{href:"/docs/pt/20-R9/commands/abort",children:"ABORT"})," pode ser utilizado para terminar o processo. Se n\xe3o chamar ",(0,d.jsx)(o.a,{href:"/docs/pt/20-R9/commands/abort",children:"ABORT"})," no m\xe9todo instalado, 4D devolve o m\xe9todo interrompido e continua a execu\xe7\xe3o do m\xe9todo. Utilize o comando ",(0,d.jsx)(o.a,{href:"/docs/pt/20-R9/commands/abort",children:"ABORT"})," quando a execu\xe7\xe3o n\xe3o pode ser recuperado."]}),"\n",(0,d.jsxs)(o.p,{children:["Se ocorrer um erro no m\xe9todo de gest\xe3o de erros, 4D retoma o controle da gest\xe3o de erros. Portanto, deve ter certeza de que o m\xe9todo de gest\xe3o de erros n\xe3o possa gerar um erro. Igualmente, n\xe3o pode utilizar ",(0,d.jsx)(o.strong,{children:"ON ERR CALL"})," dentro do m\xe9todo de gest\xe3o de erros."]}),"\n",(0,d.jsx)(o.h2,{id:"exemplo-1",children:"Exemplo 1"}),"\n",(0,d.jsx)(o.p,{children:"Pode definir um m\xe9todo de gest\xe3o de erros global por exemplo no m\xe9todo base On Open:"}),"\n",(0,d.jsx)(o.pre,{children:(0,d.jsx)(o.code,{className:"language-4d",children:'\xa0ON ERR CALL("myGlobalErrorHandler";ek global)\n'})}),"\n",(0,d.jsx)(o.h2,{id:"exemplo-2",children:"Exemplo 2"}),"\n",(0,d.jsx)(o.p,{children:"O m\xe9todo de projeto a seguir trata de criar um documento cujo nome \xe9 recebido como par\xe2metro. Se n\xe3o for poss\xedvel criar o documento, o m\xe9todo de projeto retorna 0 (zero) ou o c\xf3digo de erro:"}),"\n",(0,d.jsx)(o.pre,{children:(0,d.jsx)(o.code,{className:"language-4d",children:'\xa0\xa0// M\xe9todo de projeto Criar doc\n\xa0\xa0// Criar doc ( String ; Pointer ) -> Inteiro longo\n\xa0\xa0// Criar doc ( DocName ; ->DocRef ) -> C\xf3digo de erro resultante\n\xa0\n\xa0gError:=0\n\xa0ON ERR CALL("IO GESTOR DE ERROS")\n\xa0$2->:=Create document($1)\n\xa0ON ERR CALL("")\n\xa0$0:=gError\n'})}),"\n",(0,d.jsx)(o.p,{children:"O m\xe9todo de projeto IO_GESTOR_ERROS \xe9 o seguinte:"}),"\n",(0,d.jsx)(o.pre,{children:(0,d.jsx)(o.code,{className:"language-4d",children:"\xa0\xa0// M\xe9todo de projeto IO_GESTOR_ERROS\n"})}),"\n",(0,d.jsx)(o.pre,{children:(0,d.jsx)(o.code,{className:"language-4d",children:"\xa0gError:=Error\xa0// Simplesmente copie o c\xf3digo do erro na vari\xe1vel de processo gError\n"})}),"\n",(0,d.jsx)(o.p,{children:"Note a utiliza\xe7\xe3o da vari\xe1vel processo gError para obter o c\xf3digo do erro no m\xe9todo de execu\xe7\xe3o atual. Quando estes m\xe9todos estiverem presentes em seu banco de dados, pode escrever:"}),"\n",(0,d.jsx)(o.pre,{children:(0,d.jsx)(o.code,{className:"language-4d",children:'\xa0\xa0// ...\n\xa0var vhDocRef : Time\n\xa0$vlErrCode:=Criar doc($vsDocumentNome;->vhDocRef)\n\xa0If($vlErrCode=0)\n\xa0\xa0//...\n\xa0\xa0\xa0\xa0CLOSE DOCUMENT($vlErrCode)\n\xa0Else\n\xa0\xa0\xa0\xa0ALERT("O documento n\xe3o pode ser criado, erro de E/S "+String($vlErrCode))\n\xa0End if\n'})}),"\n",(0,d.jsx)(o.h2,{id:"exemplo-3",children:"Exemplo 3"}),"\n",(0,d.jsxs)(o.p,{children:["Enquanto implementa um conjunto de opera\xe7\xf5es complexas, pode terminar com v\xe1rias subrotinas que necessitem diferentes m\xe9todos de gest\xe3o de erros. S\xf3 pode ter um m\xe9todo de gest\xe3o de erros por processo, de maneira que tem duas op\xe7\xf5es:",(0,d.jsx)(o.br,{}),"\n- Manter contato com o m\xe9todo atual cada vez que chama a ON ERR CALL, ou",(0,d.jsx)(o.br,{}),"\n- Utiliza a vari\xe1vel array processo (neste caso, ",(0,d.jsx)(o.em,{children:"asMetodoErro"}),") para \u201Cempilhar\u201D os m\xe9todos de gest\xe3o de erros e um m\xe9todo de projeto (neste caso, ON ERROR CALL) para instalar e reinstalar os m\xe9todos de gest\xe3o de erros.",(0,d.jsx)(o.br,{}),"\nDeve inicializar o array ao come\xe7o da execu\xe7\xe3o do processo:"]}),"\n",(0,d.jsx)(o.pre,{children:(0,d.jsx)(o.code,{className:"language-4d",children:"\xa0\xa0// NAO esque\xe7a inicializar o array ao in\xedcio\n\xa0\xa0// do m\xe9todo de processo (o m\xe9todo de projeto que executa o processo)\n\xa0ARRAY STRING(63;asMetodoErro;0)\n"})}),"\n",(0,d.jsx)(o.p,{children:"Este \xe9 o m\xe9todo personalizado ON ERROR CALL:"}),"\n",(0,d.jsx)(o.pre,{children:(0,d.jsx)(o.code,{className:"language-4d",children:'\xa0\xa0// M\xe9todo de projeto ON ERROR CALL\n\xa0\xa0// ON ERROR CALL { ( String) }\n\xa0\xa0// ON ERROR CALL { ( Nome do m\xe9todo ) }\n\xa0\n\xa0C_STRING(63;$1;$MetodoErro)\n\xa0var $vlElem : Integer\n\xa0\n\xa0If(Count parameters>0)\n\xa0\xa0\xa0\xa0$MetodoErro:=$1\n\xa0Else\n\xa0\xa0\xa0\xa0$MetodoErro:=""\n\xa0End if\n\xa0\n\xa0If($MetodoErro#"")\n\xa0\xa0\xa0\xa0var gError : Integer\n\xa0\xa0\xa0\xa0gError:=0\n\xa0\xa0\xa0\xa0$vlElem:=1+Size of array(asMetodoErro)\n\xa0\xa0\xa0\xa0INSERT IN ARRAY(asMetodoErro;$vlElem)\n\xa0\xa0\xa0\xa0asMetodoErro{$vlElem}:=$1\n\xa0\xa0\xa0\xa0ON ERR CALL($1)\n\xa0Else\n\xa0\xa0\xa0\xa0ON ERR CALL("")\n\xa0\xa0\xa0\xa0$vlElem:=Size of array(asMetodoErro)\n\xa0\xa0\xa0\xa0If($vlElem>0)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0DELETE FROM ARRAY(asMetodoErro;$vlElem)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0If($vlElem>1)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ON ERR CALL(asMetodoErro{$vlElem-1})\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0End if\n\xa0\xa0\xa0\xa0End if\n\xa0End if\n'})}),"\n",(0,d.jsx)(o.p,{children:"Depois, pode cham\xe1-lo desta maneira:"}),"\n",(0,d.jsx)(o.pre,{children:(0,d.jsx)(o.code,{className:"language-4d",children:'\xa0gError:=0\n\xa0ON ERROR CALL("IO ERRORS")\xa0// Instale o m\xe9todo de gest\xe3o de erros IO ERRORS\n\xa0\xa0// ...\n\xa0ON ERROR CALL("ALL ERRORS")\xa0// Instale o m\xe9todo de gest\xe3o de erros ALL ERRORS\n'})}),"\n",(0,d.jsx)(o.pre,{children:(0,d.jsx)(o.code,{className:"language-4d",children:"\xa0\xa0// ...\n\xa0ON ERROR CALL\xa0// Reinstale o m\xe9todo de gest\xe3o de erros ALL ERRORS e reinstale IO ERRORS\n\xa0\xa0// ...\n\xa0ON ERROR CALL\xa0// Reinstale o m\xe9todo de gest\xe3o de erros IO ERRORS\n\xa0\xa0// ...\n"})}),"\n",(0,d.jsx)(o.h2,{id:"exemplo-4",children:"Exemplo 4"}),"\n",(0,d.jsx)(o.p,{children:"O m\xe9todo abaixo de gest\xe3o de erros ignora as interrup\xe7\xf5es de usu\xe1rio e mostra o texto do erro:"}),"\n",(0,d.jsx)(o.pre,{children:(0,d.jsx)(o.code,{className:"language-4d",children:'\xa0\xa0//M\xe9todo de projeco Show_errors_only\n\xa0If(Error#1006)\xa0//esta n\xe3o \xe9 uma interrup\xe7\xe3o do usu\xe1rio\n\xa0\xa0\xa0\xa0ALERT("The error "+String(Error)+" occurred. The code in question is: \\""+Error formula+"\\"")\n\xa0End if\n'})}),"\n",(0,d.jsx)(o.h2,{id:"ver-tamb\xe9m",children:"Ver tamb\xe9m"}),"\n",(0,d.jsxs)(o.p,{children:[(0,d.jsx)(o.a,{href:"/docs/pt/20-R9/commands/abort",children:"ABORT"}),(0,d.jsx)(o.br,{}),"\n",(0,d.jsx)(o.em,{children:"Error Handler"}),(0,d.jsx)(o.br,{}),"\n",(0,d.jsx)(o.a,{href:"/docs/pt/20-R9/commands/last-errors",children:"Last errors"}),(0,d.jsx)(o.br,{}),"\n",(0,d.jsx)(o.a,{href:"/docs/pt/20-R9/commands/last-errors",children:"Last errors"}),(0,d.jsx)(o.br,{}),"\n",(0,d.jsx)(o.a,{href:"/docs/pt/20-R9/commands/method-called-on-error",children:"Method called on error"}),(0,d.jsx)(o.br,{}),"\n",(0,d.jsx)(o.em,{children:"Vari\xe1veis sistema"})]}),"\n",(0,d.jsx)(o.h2,{id:"propriedades",children:"Propriedades"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(o.table,{children:[(0,d.jsx)(o.thead,{children:(0,d.jsxs)(o.tr,{children:[(0,d.jsx)(o.th,{}),(0,d.jsx)(o.th,{})]})}),(0,d.jsxs)(o.tbody,{children:[(0,d.jsxs)(o.tr,{children:[(0,d.jsx)(o.td,{children:"N\xfamero do comando"}),(0,d.jsx)(o.td,{children:"155"})]}),(0,d.jsxs)(o.tr,{children:[(0,d.jsx)(o.td,{children:"Thread-seguro"}),(0,d.jsx)(o.td,{children:"\u2713"})]})]})]})]})}function m(e={}){let{wrapper:o}={...(0,s.a)(),...e.components};return o?(0,d.jsx)(o,{...e,children:(0,d.jsx)(l,{...e})}):l(e)}},250065:function(e,o,r){r.d(o,{Z:function(){return t},a:function(){return a}});var n=r(667294);let d={},s=n.createContext(d);function a(e){let o=n.useContext(s);return n.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function t(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:a(e.components),n.createElement(s.Provider,{value:o},e.children)}}}]);