"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[60304],{603905:(e,a,t)=>{t.d(a,{Zo:()=>p,kt:()=>c});var n=t(667294);function l(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){l(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,n,l=function(e,a){if(null==e)return{};var t,n,l={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(l[t]=e[t]);return l}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var d=n.createContext({}),s=function(e){var a=n.useContext(d),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},p=function(e){var a=s(e.components);return n.createElement(d.Provider,{value:a},e.children)},m={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,l=e.mdxType,r=e.originalType,d=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=s(t),c=l,b=u["".concat(d,".").concat(c)]||u[c]||m[c]||r;return t?n.createElement(b,o(o({ref:a},p),{},{components:t})):n.createElement(b,o({ref:a},p))}));function c(e,a){var t=arguments,l=a&&a.mdxType;if("string"==typeof e||l){var r=t.length,o=new Array(r);o[0]=u;var i={};for(var d in a)hasOwnProperty.call(a,d)&&(i[d]=a[d]);i.originalType=e,i.mdxType="string"==typeof e?e:l,o[1]=i;for(var s=2;s<r;s++)o[s]=t[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},14060:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>d,toc:()=>p});t(667294);var n=t(603905);function l(){return l=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},l.apply(this,arguments)}function r(e,a){if(null==e)return{};var t,n,l=function(e,a){if(null==e)return{};var t,n,l={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(l[t]=e[t]);return l}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}const o={id:"global-stamp",title:"Usando o selo global"},i=void 0,d={unversionedId:"ORDA/global-stamp",id:"version-20-R5/ORDA/global-stamp",title:"Usando o selo global",description:"Vis\xe3o Geral",source:"@site/i18n/pt/docusaurus-plugin-content-docs/version-20-R5/ORDA/global-stamp.md",sourceDirName:"ORDA",slug:"/ORDA/global-stamp",permalink:"/docs/pt/ORDA/global-stamp",draft:!1,editUrl:"https://github.com/4d/docs/issues/new?title=Comment%20on%20ORDA%2Fglobal-stamp.md%20(20-R5)&body=Please%20enter%20your%20comment%3A",tags:[],version:"20-R5",frontMatter:{id:"global-stamp",title:"Usando o selo global"},sidebar:"docs",previous:{title:"Trabalhar com dados",permalink:"/docs/pt/ORDA/entities"},next:{title:"Remote datastores",permalink:"/docs/pt/ORDA/datastores"}},s={},p=[{value:"Vis\xe3o Geral",id:"vis\xe3o-geral",level:2},{value:"Configurando rastreamento de altera\xe7\xf5es de dados",id:"configurando-rastreamento-de-altera\xe7\xf5es-de-dados",level:2},{value:"Requisitos de estrutura",id:"requisitos-de-estrutura",level:3},{value:"Usando o Editor de estruturas",id:"usando-o-editor-de-estruturas",level:3},{value:"Exemplo",id:"exemplo",level:2}],m={toc:p};function u(e){var{components:a}=e,t=r(e,["components"]);return(0,n.kt)("wrapper",l({},m,t,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("h2",l({},{id:"vis\xe3o-geral"}),"Vis\xe3o Geral"),(0,n.kt)("p",null,"4D gestiona autom\xe1ticamente un ",(0,n.kt)("strong",{parentName:"p"},"sello de modificaci\xf3n global")," interno, \xfatil para manejar implementaciones de seguimiento de cambios de datos, por ejemplo para monitorear la actividad, realizar copias de seguridad, ejecutar sincronizaciones incrementales"),(0,n.kt)("p",null,"The global modification stamp is a number, always maintained by 4D, even in case of database restoration, import, etc. Note however that the stamp can be modified using the ",(0,n.kt)("a",l({parentName:"p"},{href:"/docs/pt/API/DataStoreClass#setglobalstamp"}),(0,n.kt)("inlineCode",{parentName:"a"},".setGlobalStamp()"))," function."),(0,n.kt)("p",null,"Una vez ",(0,n.kt)("a",l({parentName:"p"},{href:"#configuring-data-change-tracking"}),"configurado y habilitado el seguimiento de cambios de datos"),", las siguientes acciones son ejecutadas autom\xe1ticamente por 4D en cada modificaci\xf3n de registro (a\xf1adir, modificar, borrar):"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},'The current global modification stamp value is saved in the special "',(0,n.kt)("strong",{parentName:"p"},'GlobalStamp" attribute of the involved entity.\nEn caso de eliminaci\xf3n, una nueva entidad tambi\xe9n se a\xf1ade a la tabla `'),'DeletedRecords` con informaci\xf3n sobre la entidad eliminada y el valor actual del sello de modificaci\xf3n global se guarda en el atributo "__Stamp".')),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"The global modification stamp value is incremented."))),(0,n.kt)("p",null,"This mechanism allows you to identify entities that have been modified, added, or deleted since a point in time, and to implement any appropriate action (see example)."),(0,n.kt)("admonition",l({},{type:"info"}),(0,n.kt)("p",{parentName:"admonition"},"No confunda el ",(0,n.kt)("strong",{parentName:"p"},"sello de modificaci\xf3n global")," con el ",(0,n.kt)("strong",{parentName:"p"},"sello de entidad")," interna, utilizado para la ",(0,n.kt)("a",l({parentName:"p"},{href:"/docs/pt/ORDA/entities#automatic-optimistic-lock"}),"funcionalidad bloqueo optimista"),".")),(0,n.kt)("h2",l({},{id:"configurando-rastreamento-de-altera\xe7\xf5es-de-dados"}),"Configurando rastreamento de altera\xe7\xf5es de dados"),(0,n.kt)("p",null,"By default, the global modification stamp is not created (the ",(0,n.kt)("a",l({parentName:"p"},{href:"/docs/pt/API/DataStoreClass#getglobalstamp"}),(0,n.kt)("inlineCode",{parentName:"a"},".getGlobalStamp()"))," function returns 0. To enable data change tracking, you need to add special fields and a table to your structure. You can use the contextual menu of the Structure Editor to create automatically all necessary elements."),(0,n.kt)("h3",l({},{id:"requisitos-de-estrutura"}),"Requisitos de estrutura"),(0,n.kt)("p",null,"Para habilitar el seguimiento de cambios de datos, la estructura de la aplicaci\xf3n debe contener al menos una tabla con un campo ",(0,n.kt)("inlineCode",{parentName:"p"},"__GlobalStamp"),"."),(0,n.kt)("p",null,"In addition, to ensure proper operation of the feature, the following conditions are required:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"El campo ",(0,n.kt)("inlineCode",{parentName:"li"},"__GlobalStamp")," debe ser del tipo ",(0,n.kt)("em",{parentName:"li"},"Entero 64 bits"),", con las propiedades ",(0,n.kt)("em",{parentName:"li"},"\xedndice autom\xe1tico"),", ",(0,n.kt)("em",{parentName:"li"},"Exponer como recurso REST")," e ",(0,n.kt)("em",{parentName:"li"},"Invisible")," seleccionadas."),(0,n.kt)("li",{parentName:"ul"},"Debe a\xf1adirse una tabla ",(0,n.kt)("inlineCode",{parentName:"li"},"__DeletedRecords"),", con los siguientes campos:")),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",l({parentName:"tr"},{align:null}),"Campo"),(0,n.kt)("th",l({parentName:"tr"},{align:null}),"Tipo"),(0,n.kt)("th",l({parentName:"tr"},{align:null}),"Descri\xe7\xe3o"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:null}),"__PrimaryKey"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"Text"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"Chave prim\xe1ria da entidade exclu\xedda")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:null}),"__Stamp"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"Integer 64 bits"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"Global stamp just before the deletion")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:null}),"__TableName"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"Text"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"Nome da tabela de entidades exclu\xedda")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:null}),"__TableNumber"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"Long Integer"),(0,n.kt)("td",l({parentName:"tr"},{align:null}),"N\xfamero da tabela da entidade exclu\xedda")))),(0,n.kt)("p",null,"S\xf3lo puede realizar un seguimiento de los cambios de los datos de las tablas que tengan el campo ",(0,n.kt)("inlineCode",{parentName:"p"},"__GlobalStamp"),"."),(0,n.kt)("admonition",l({},{type:"note"}),(0,n.kt)("p",{parentName:"admonition"},"En el lenguaje 4D, el valor del campo ",(0,n.kt)("inlineCode",{parentName:"p"},"__GlobalStamp")," debe manejarse a trav\xe9s de una variable de tipo ",(0,n.kt)("inlineCode",{parentName:"p"},"Real"),".")),(0,n.kt)("h3",l({},{id:"usando-o-editor-de-estruturas"}),"Usando o Editor de estruturas"),(0,n.kt)("p",null,"The 4D Structure Editor allows you to enable or disable data change tracking using a single menu item."),(0,n.kt)("p",null,"Para ativar o rastreamento de altera\xe7\xf5es de dados:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Selecione a(s) tabela(s) para as quais voc\xea deseja habilitar o rastreamento de altera\xe7\xf5es nos dados."),(0,n.kt)("li",{parentName:"ol"},"Haga clic derecho en una tabla seleccionada y seleccione ",(0,n.kt)("strong",{parentName:"li"},"Enable data change tracking")," en el men\xfa contextual."),(0,n.kt)("li",{parentName:"ol"},"\xc9 exibida uma caixa de di\xe1logo de confirma\xe7\xe3o. Clique em ",(0,n.kt)("strong",{parentName:"li"},"OK"),".")),(0,n.kt)("p",null,"Em seguida, 4D faz as seguintes altera\xe7\xf5es:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Se a\xf1ade un campo preconfigurado ",(0,n.kt)("inlineCode",{parentName:"li"},"__GlobalStamp")," a la(s) tabla(s)."),(0,n.kt)("li",{parentName:"ul"},"Si no existe ya, se a\xf1ade a la estructura una tabla ",(0,n.kt)("inlineCode",{parentName:"li"},"__DeletedRecords"),".")),(0,n.kt)("p",null,"Para desativar o rastreamento de altera\xe7\xf5es de dados:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Selecione a(s) tabela(s) para as quais voc\xea deseja remover o rastreamento de altera\xe7\xf5es nos dados."),(0,n.kt)("li",{parentName:"ol"},"Haga clic derecho en una tabla seleccionada y seleccione ",(0,n.kt)("strong",{parentName:"li"},"Disable data change tracking")," en el men\xfa contextual."),(0,n.kt)("li",{parentName:"ol"},"\xc9 exibida uma caixa de di\xe1logo de confirma\xe7\xe3o. Clique em ",(0,n.kt)("strong",{parentName:"li"},"OK"),".")),(0,n.kt)("p",null,"4D elimina entonces el campo ",(0,n.kt)("inlineCode",{parentName:"p"},"__GlobalStamp")," de la(s) tabla(s). Tenga en cuenta que si desea eliminar la tabla ",(0,n.kt)("inlineCode",{parentName:"p"},"__DeletedRecords"),", deber\xe1 hacerlo manualmente."),(0,n.kt)("h2",l({},{id:"exemplo"}),"Exemplo"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-4d"}),'var $oldStamp : Real\nvar $tableName : Text\nvar $modifiedEmps : cs.EmployeeSelection\nvar $deletedEmpsInfo : cs.__DeletedRecordsSelection\n\n$tableName:="Employee"\n$oldStamp:=... //load the previous stamp value  \n    //from which you want to compare the current stamp\n\nIf ($oldStamp # ds.getGlobalStamp())\n        //get all new or modified entities\n    $modifiedEmps:=ds[$tableName].query("__GlobalStamp > :1"; $oldStamp)\n        //get all deleted entities\n    $deletedEmpsInfo:=ds.__DeletedRecords.query("__Stamp > :1 and __TableName = :2";\\\n    $oldStamp; $tableName)\nEnd if\n')))}u.isMDXComponent=!0}}]);